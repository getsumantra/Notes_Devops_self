"use strict";define("Build/Queue-Panel",["require","exports","Build/Flux/Action","Build/Flux/Store","Build/SourceProviders/Common","VSS/Core/Observable","VSS/Core/Util/String","VSS/Platform/Feature","react","VSSUI/Button","VSSUI/List","VSSUI/MessageCard","VSSUI/Observer","VSSUI/Panel","VSSUI/Resources.Input","VSSUI/Spinner","VSSUI/Table","VSSUI/TextField","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Utilities/Provider","VSSUI/Status","VSSUI/FormItem","VSSUI/PickList","VSSUI/Icon","VSSUI/Link","VSSUI/Ago","VSS/Core/TimerManagement","VSSUI/Checkbox","VSSUI/ButtonGroup","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/RadioButton","Build/Common/Library/Legacy/Components/BranchDropdown","VSS/Platform/Layout","Build/Common/Library/Resources","Build/Common/Library/Legacy/Components/ShelvesetAction","Build/Common/Library/Legacy/Stores/Queue","Build/Common/Library/SingletonManager","DistributedTask/Common/Library/AgentQueueSelector","DistributedTask/Common/Library/Sources/Queue","Build/Common/Library/Security","Build/Common/Library/Stores/Permissions","VSS/Platform/FPS","VSSUI/Header","VSSUI/Intersection","VSSUI/SplitButton"],(function(e,t,s,i,n,r,a,o,l,c,u,h,d,p,m,g,_,b,R,v,f,S,P,C,x,E,w,y,B,D,N,T,V,O,A,I,L,k,F,q,M,U,j,Q,H,z,W){var G,Y,K,J,$,X,Z,ee,te,se,ie,ne,re,ae,oe,le,ce,ue,he,de,pe,me,ge;G=t[ge="Resources"]={},t[ge].AddDemandButton="Add demand",t[ge].AddDemandPanelTitle="New demand",t[ge].AddVariableButton="Add variable",t[ge].AddVariablePanelTitle="New variable",t[ge].AdvancedOptionsLabel="Advanced options",t[ge].AgentSpecificationRequired="Selecting an agent specification is required",t[ge].AllBranchesButtonText="All branches",t[ge].AllOptionsSelected="All {0} values selected",t[ge].AgentPool="Agent pool",t[ge].Back="Back",t[ge].BranchLabel="Branch/tag",t[ge].BranchLabelPipelineResource="Branch",t[ge].BranchLabelNew="Select pipeline version by branch/tag",t[ge].BuildQueuedMessage="Build #{0} has been queued.",t[ge].BuildResourceNoRunsText="This build has no runs yet",t[ge].BuildResourceNoSearchResultsText="No build names match '{0}'",t[ge].BuildResourcePanelDescription="Select the build version to use",t[ge].BuildResourceSearchBarText="Search builds",t[ge].BuildRunColumnHeadingForBuildResourcePanel="Build",t[ge].BuildResourceUpdateButtonText="Use selected build",t[ge].CancelButtonText="Cancel",t[ge].CannotSkipState="{0}. Cannot skip this stage.",t[ge].ClearButtonLabel="Clear",t[ge].CloseButtonLabel="Close",t[ge].ConditionFieldLabel="Condition",t[ge].ContainerResourceNoRunsText="This repository has no images yet",t[ge].ContainerResourceUpdateButtonText="Use selected image",t[ge].CreateButtonText="Create",t[ge].DeleteButtonEmptyTooltip="Delete variable",t[ge].DeleteButtonTooltip="Delete variable '{0}'",t[ge].DemandsEmptySecondaryText="This pipeline has no defined demands",t[ge].DemandsLearnMore="Learn more about demands",t[ge].DemandsManySecondaryText="{0} demands defined",t[ge].DemandsOneSecondaryText="1 demand defined",t[ge].DemandsTitle="Demands",t[ge].DependsOn="Depends on: {0}",t[ge].DisabledDueToInvalidTemplateParametersMessage="This option is unavailable while parameters are invalid",t[ge].DuplicateVariableMessage="Variable '{0}' is already defined",t[ge].EmptyDemandsDescription="You can add demands for this run.",t[ge].LearnMoreMessage=" Learn more.",t[ge].EmptyVariablesDescription="You can add variables for this run.",t[ge].EnforcedEmptyVariablesDescription="You can't add variables for this run.",t[ge].EqualsCondition="equals",t[ge].ExistsCondition="exists",t[ge].FilterByBuildName="Search only through run names",t[ge].GitSourceSelectorDescription="Select a branch from the list or enter the name of a tag as refs/tags/<tagname>",t[ge].ListItemRoleDescription="button",t[ge].NameFieldLabel="Name",t[ge].NewQueueBuildPanelBackParametersButtonText="Back: Parameters",t[ge].NewQueueBuildPanelErrorWhileValidatingResources="Loading resources resulted in error",t[ge].NewQueueBuildPanelValidatingResources="Validating with parameters...",t[ge].NewQueueBuildPanelNextResourcesButtonText="Next: Resources",t[ge].NoPipelineResources="No pipeline artifacts found.",t[ge].NoStageDependencies="No dependencies",t[ge].NotEnoughPermissionsToEditQueueVariables='To change variables and free-text parameters, you need the "Edit queue build configuration" permission for this pipeline.',t[ge].NumericInputErrorMessage="Entered value must be a number",t[ge].PipelineResourceLastRun="Last successful run (for specified branch/tags)",t[ge].BuildResourceLastRun="Last build version",t[ge].PipelineResourcePanelDescription="Select the pipeline run to use",t[ge].PipelineRunColumnHeadingForPipelineResourcePanel="Pipeline run",t[ge].CompletedColumnHeadingForPipelineResourcePanel="Completed",t[ge].ProcessingYamlMessage="Processing pipeline YAML...",t[ge].QueueButtonText="Run",t[ge].QueuePanelDescription="Select parameters below and manually run the pipeline",t[ge].QueuePanelTitleNoDefinition="Run pipeline",t[ge].QueuePanelBranchPickerTitle="Pipeline version",t[ge].RepositoryResourcePanelDescription="on {0}",t[ge].RepositoryResourceSourceLabel="Source version to use",t[ge].RepositoryResourceUpdateButtonText="Use selected version",t[ge].PipelineResourceUpdateButtonText="Use selected run",t[ge].RequiredLabel="Required",t[ge].Resources="Resources",t[ge].ResourceCountBuildRun="1 build run",t[ge].ResourceCountBuildRuns="{0} build runs",t[ge].ResourceCountContainerRun="1 container image",t[ge].ResourceCountContainerRuns="{0} container images",t[ge].ResourceCountPackageRun="1 package run",t[ge].ResourceCountPackageRuns="{0} package runs",t[ge].ResourceCountPipelineRun="1 pipeline run",t[ge].ResourceCountPipelineRuns="{0} pipeline runs",t[ge].ResourceCountRepository="1 repository",t[ge].ResourceCountRepostiories="{0} repositories",t[ge].ResourcesDescriptionText="Review the resources to use with this run",t[ge].ResourcesNoResourcesText="This pipeline has no specified resources",t[ge].PipelineResourceCannotDetermine="Cannot determine pipeline run version",t[ge].PipelineResourceNoRunsText="This pipeline has no runs yet",t[ge].PipelineResourceSearchBarText="Search pipeline runs",t[ge].PipelineResourceNoSearchResultsText="No run names match '{0}'",t[ge].PipelineResourceNoSearchResultsWithTagsText="No runs match '{0}'",t[ge].PackageResourceSearchBarText="Enter package version",t[ge].PipelineResourcesLabel="Pipeline artifacts",t[ge].ResourcesUseLatestText="Use latest version of all resources",t[ge].StageOptionsRunAsConfigured="Run as configured",t[ge].RunAllStages="Run all stages",t[ge].RunWithDiagnostics="Enable system diagnostics",t[ge].RunWithWarningsButtonText="Run anyway",t[ge].SaveAndRunWithWarningsButtonText="Save and run anyway",t[ge].SaveAndQueueButtonText="Save and run",t[ge].SaveComment="Save comment",t[ge].SecretFieldLabel="Keep this value secret",t[ge].SelectAllLabel="Select all",t[ge].ShowSuccesfulRunsOnly="Show successful runs only",t[ge].SingleStagePipeline="Configuration is only available for multi-stage pipelines.",t[ge].SkippedStagesWarning="Ensure that skipped stages do not produce any artifacts required by later stages.",t[ge].SourceSelectorDescription="Select the pipeline to run by branch, commit, or tag",t[ge].SourceVersionLabel="Source version",t[ge].StagesToRun="Stages to run",t[ge].StagesToRunSecondaryText="Deselect stages you want to skip for this run",t[ge].StartingRun="Starting run...",t[ge].TemplateParametersLabel="Parameters",t[ge].TfsGitSourceSelectorDescription="Select the branch, commit, or tag",t[ge].UnableToLoadStages="Unable to load the pipeline's stages.",t[ge].UpdateButtonText="Update",t[ge].UpdateDemandPanelTitle="Update demand",t[ge].UseSelectedStages="Use selected stages",t[ge].UpdateVariablePanelTitle="Update variable",t[ge].ValueFieldLabel="Value",t[ge].VariablesLearnMore="Learn more about variables",t[ge].VariableRequiredNameMessage="Variable name is required",t[ge].VariablesEmptySecondaryText="This pipeline has no defined variables",t[ge].VariablesManySecondaryText="{0} variables defined",t[ge].VariablesOneSecondaryText="1 variable defined",t[ge].VariablesTitle="Variables",t[ge].YamlMissingError="Encountered error(s): Could not find valid pipeline YAML file for this branch/tag",t[ge].YamlParseError="Encountered error(s) while parsing pipeline YAML:\n{0}",function(e){Y=t[e]={};t[e].EnableDiagnosticActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i}toggleEnableDiagnostic(e){this._actionHub.toggleEnableDiagnostic.invoke(e)}};class i{constructor(){this._toggleEnableDiagnostic=new s.Action}get toggleEnableDiagnostic(){return this._toggleEnableDiagnostic}}t[e].EnableDiagnosticActionHub=i;class n{constructor(e){this._actionHub=e.actionHub||new r}queueBuild(e){e.isYaml?this._runPipeline(e):this._queueBuild(e)}_runPipeline(e){const t=e.repositoryResources||{};t.self={refName:e.sourceBranch,version:e.sourceVersion};const s={repositories:t,pipelines:e.pipelineResources,builds:e.buildResources,containers:e.containerResources,packages:e.packageResources},i={stagesToSkip:e.stagesToSkip,resources:s,templateParameters:e.templateParameters,variables:e.variables};e.pageContext.getRestClient("IPipelinesRestClient").runPipeline(i,e.projectId,e.definitionId).then((e=>this._actionHub.buildQueued.invoke({buildId:e.id}))).catch((e=>{this._actionHub.buildQueued.invoke({buildId:void 0,message:e.message,messageSeverity:"Error"})}))}_queueBuild(e){const t={agentSpecification:e.agentSpecification,queue:{id:e.agentQueueId},definition:{id:e.definitionId},project:{id:e.projectId},sourceBranch:e.sourceBranch,sourceVersion:e.sourceVersion,reason:1,demands:e.demands,parameters:e.serializedVariables};e.pageContext.getRestClient("IBuildRestClient").queueBuild(t,e.projectId,e.ignoreWarnings).then((e=>this._actionHub.buildQueued.invoke({buildId:e.id}))).catch((e=>{const t=n._getErrorAndWarningMessage(e);this._actionHub.buildQueued.invoke({buildId:void 0,message:t.message,messageSeverity:t.severity})}))}static _getErrorAndWarningMessage(e){let t="",s="Info";if(e&&e.length>0){const i=e.filter((e=>2===e.result));i.length>0?(t=this._joinValidateResults(i),s="Error"):(t=this._joinValidateResults(e),s="Warning")}else if(e)return this._getErrorMessageFromServer(e);return{message:t,severity:s}}static _joinValidateResults(e){let t=e.map((e=>e.message));return t=t.filter((e=>!!e)),t.join(",")}static _getErrorMessageFromServer(e){let t="",s="Error";if(e&&(t=e.message||""),e&&e.serverError&&e.serverError.customProperties){let i=e.serverError.customProperties.ValidationResults;if(i&&i.length>0){const e=i.filter((e=>2===e.result));t=this._joinValidateResults(e);const n=i.filter((e=>1===e.result));n&&n.length>0&&(t=this._joinValidateResults(n),s="Warning")}}else e&&e.serverError&&0===t.length&&(t=e.serverError.message||"");return{message:t,severity:s}}}t[e].QueueBuildActionCreator=n;class r{constructor(){this._buildQueued=new s.Action}get buildQueued(){return this._buildQueued}}t[e].QueueBuildActionHub=r;t[e].SourceVersionActionCreator=class{constructor(e){this._actionHub=e.actionHub||new a}updateVersion(e){this._actionHub.versionUpdated.invoke(e)}updateBranch(e){this._actionHub.branchUpdated.invoke(e)}updateTag(e){this._actionHub.tagUpdated.invoke(e)}updateShelveset(e){this._actionHub.shelvesetUpdated.invoke(e)}};class a{constructor(){this._versionUpdated=new s.Action,this._branchUpdated=new s.Action,this._shelvesetUpdated=new s.Action,this._tagUpdated=new s.Action}get versionUpdated(){return this._versionUpdated}get branchUpdated(){return this._branchUpdated}get tagUpdated(){return this._tagUpdated}get shelvesetUpdated(){return this._shelvesetUpdated}}t[e].SourceVersionActionHub=a}("Action"),function(e){K=t[e]={},function(e){e.RefsHeadsPrefix="refs/heads/",e.RefsTagsPrefix="refs/tags/",e.RefsPrefix="refs/",e.ShortenedCommitHashLength=8}(t[e].GitConstants||(t[e].GitConstants={}))}("Constants"),function(e){J=t[e]={};const s="ms.vss-build-web.pipeline-run-parameters-data-provider",l="ms.vss-build-web.pipeline-resource-runs-data-provider",c="ms.vss-build-web.build-resource-runs-data-provider",u="system.debug",h="agent.diagnostic";class d extends i.Store{constructor(e){super(),this._sourceVersion="",this._shelvesetName="",this._runParametersAreLoaded=!1,this._resourcesWereFetched=!1,this._pipelineResourcesWereFetchedObservable=new r.ObservableValue(!1),this._useResourceRetrieveOption=!1,this._enableNewYamlPPResourcesLoadLogic=!1,this._templateParametersAreValid=new r.ObservableValue(!0),this._previousTemplateParameters={},this._errorMessage=new r.ObservableValue(""),this._lastFetchPipelineRunsTime=void 0,this._lastFetchPipelineResourcesTime=void 0,this._allowSkippingResourcePanel=new r.ObservableValue(!1),this.updateDefinition=(e,t,s,i,n,a,o)=>{i||(this._buildDefinition=void 0),this._definitionId=e,this._enableDiagnostic=!1,this._definitionVariables=a,this._runtimeVariables=new r.ObservableArray(this._createRuntimeVariablesArray(t)),this._previousTemplateParameters=o||{},this._sourceBranch=s||"",this._sourceVersion="",this._shelvesetName="",this._sourceTag="",this._selectedQueue={},this._buildRepository=n||{},this._resetPipelineResources()},this.updateBuildDefinition=(e,t,s,i)=>{const n=e&&e.repository?e.repository.defaultBranch:"";this._buildDefinition=e,e&&e.id&&this.updateDefinition(e.id,t,n,!0,e.repository,s,i)},this.fetchBuildDefinition=()=>this._buildDefinition&&this._buildDefinition.id===this._definitionId?Promise.resolve(this._buildDefinition):this._buildClient.getDefinition(this._projectId,this._definitionId).then((e=>(this._buildDefinition=e,this._buildDefinition))),this.fetchUpdatedDefaultBranch=()=>this._buildClient.getDefinition(this._projectId,this._definitionId).then((e=>e.repository.defaultBranch)),this.fetchDemands=()=>{this._demands?this._demands.removeAll():this._demands=new r.ObservableArray([]),this.fetchBuildDefinition().then((e=>{const t=this._convertSerializedDemandToDemandData(e.demands);this._demands.value=t}),(e=>{console.log("failed to retrieve build definition: "+e)}))},this.getBuildResourceRuns=e=>this._buildResourceRuns&&this._buildResourceRuns.get(e),this.getContainerResourceRuns=e=>this._containerResourceRuns&&this._containerResourceRuns.get(e),this.getPipelineResourceRuns=e=>this._pipelineResourceRuns&&this._pipelineResourceRuns.get(e),this.getVariables=()=>this._runtimeVariables,this.updateBranchForCommit=e=>{this._sourceTag="",this._sourceBranch=e,this.emitChanged()},this.updateVariable=(e,t)=>{this._runtimeVariables.change(t,e)},this.addVariable=e=>{this._runtimeVariables.push(e)},this.deleteVariable=e=>{this._runtimeVariables.splice(e,1)},this.addDemand=e=>{this._demands.push(e)},this.deleteDemand=e=>{this._demands.splice(e,1)},this.updateDemand=e=>{this._demands.change(e.index,e)},this.updateStageOptions=e=>{this._stageOptions.value=e.map((e=>Object.assign({},e)))},this.updateRepositoryResource=e=>{if(this._repositoryResources&&e){const t=this._repositoryResources.value.findIndex((t=>t.alias===e.alias));t>-1&&this._repositoryResources.change(t,Object.assign({},e))}},this.updatePipelineResource=e=>{if(this._pipelineResources&&e){const t=this._pipelineResources.value.findIndex((t=>t.alias===e.alias));t>-1&&this._pipelineResources.change(t,Object.assign({},e))}},this.updateBuildResource=e=>{if(this._buildResources&&e){const t=this._buildResources.value.findIndex((t=>t.alias===e.alias));t>-1&&this._buildResources.change(t,Object.assign({},e))}},this.updateContainerResource=e=>{if(this._containerResources&&e){const t=this._containerResources.value.findIndex((t=>t.alias===e.alias));t>-1&&this._containerResources.change(t,Object.assign({},e))}},this.updatePackageResource=e=>{if(this._packageResources&&e){const t=this._packageResources.value.findIndex((t=>t.alias===e.alias));t>-1&&this._packageResources.change(t,Object.assign({},e))}},this.updateTemplateParameter=e=>{const t=this._templateParameters.value.findIndex((t=>t.data.name===e.data.name));if(t>-1){const s={data:e.data,value:e.value,errorMessage:this._validateTemplateParameterInput(e.data,e.value)};this._templateParameters.change(t,s),e.errorMessage!==s.errorMessage&&this._updateTemplateParametersValidity(),this._resetParameterDependentResources()}},this._createRuntimeVariablesArray=e=>{const t=[];e&&e.length>0&&e.forEach(((e,s)=>{if(e.name.startsWith("system.")||e.name.startsWith(h)){if(!e.variable.disableDelete)return;{const t=this._definitionVariables&&this._definitionVariables[e.name];t&&(e.variable.value=t.value)}}t.push({index:s,name:e.name,value:e.variable.value,isSecret:e.variable.isSecret,disableDelete:e.variable.disableDelete})}));const s=t.findIndex((e=>e.name===u&&"true"===e.value)),i=t.findIndex((e=>e.name===h&&"true"===e.value));if(s>-1&&i>-1){const e=t[s],n=t[i];if(e.disableDelete){const t=this._definitionVariables&&this._definitionVariables[u];t&&(e.value=t.value)}else t.splice(s,1);if(n.disableDelete){const e=this._definitionVariables&&this._definitionVariables[h];e&&(n.value=e.value)}else{const e=t.findIndex((e=>e.name===h));t.splice(e,1)}this._handleToggleEnableDiagnostic(!0)}return t},this._isGit=e=>{const t=e.toLowerCase();return t===n.RepositoryTypes.Bitbucket.toLowerCase()||t===n.RepositoryTypes.ExternalGit.toLowerCase()||t===n.RepositoryTypes.GitHub.toLowerCase()||t===n.RepositoryTypes.GitHubEnterprise.toLowerCase()||t===n.RepositoryTypes.TfsGit.toLowerCase()},this._handleQueueSelected=e=>{this._selectedQueue=e,this.fetchDemands(),this.emitChanged()},this._handleBranchUpdated=e=>{this._resetPipelineSources(),this._sourceBranch=e,this._resetPipelineResources(),this.emitChanged()},this._handleTagUpdated=e=>{this._resetPipelineSources(),this._sourceTag=e,this._resetPipelineResources(),this.emitChanged()},this._handleShelvesetUpdated=e=>{this._shelvesetName=e,this.emitChanged()},this._handleToggleEnableDiagnostic=e=>{this._enableDiagnostic=e,this.emitChanged()},this._handleVersionUpdated=e=>{this._sourceVersion=e,this._resetPipelineResources(),this.emitChanged()},this._resetPipelineSources=()=>{this._sourceBranch="",this._sourceTag="",this._sourceVersion=""},this.updateLastPipelineRunsFetchExecutionTime=e=>{this._lastFetchPipelineRunsTime=e},this._pageContext=e.pageContext,this._useResourceRetrieveOption=(0,o.isFeatureFlagEnabled)(this._pageContext,"Build2.AllowOverwritingResourcesWhenTemplatePermissionsAreMissing",!1),this._enableNewYamlPPResourcesLoadLogic=(0,o.isFeatureFlagEnabled)(this._pageContext,"DistributedTask.EnableNewYamlPPResourcesLoadLogic",!1),this._definitionId=e.definitionId,e.buildDefinition&&(this._buildDefinition=e.buildDefinition),this._sourceBranch=e.sourceBranch||"",this._projectId=e.projectId,this._sourceVersionActionHub=e.sourceVersionActionHub,this._shelvesetPickerActiobHub=e.shelvesetPickerActiobHub,this._buildRepository=e.buildRepository,this._queueActionHub=e.queueActionHub,this._definitionVariables=e.definitionVariables,this._runtimeVariables=new r.ObservableArray(this._createRuntimeVariablesArray(e.runtimeVariables)),this._enableDiagnosticActionHub=e.enableDiagnosticActionHub,this._sourceVersionActionHub.versionUpdated.addListener(this._handleVersionUpdated),this._sourceVersionActionHub.branchUpdated.addListener(this._handleBranchUpdated),this._sourceVersionActionHub.tagUpdated.addListener(this._handleTagUpdated),this._shelvesetPickerActiobHub.pickerDismissed.addListener(this._handleShelvesetUpdated),this._enableDiagnosticActionHub.toggleEnableDiagnostic.addListener(this._handleToggleEnableDiagnostic),this._queueActionHub.queueSelected.addListener(this._handleQueueSelected),this._demands=new r.ObservableArray([]),this._stageOptions=new r.ObservableArray([]),this._buildClient=this._pageContext.getRestClient("IBuildRestClient"),this._templateParameters=new r.ObservableArray([]),this._previousTemplateParameters=e.previousTemplateParameters,this._repositoryResources=new r.ObservableArray([]),this._pipelineResources=new r.ObservableArray([]),this._pipelineResourceRuns=new r.ObservableObject,this._buildResources=new r.ObservableArray([]),this._buildResourceRuns=new r.ObservableObject,this._containerResources=new r.ObservableArray([]),this._containerResourceRuns=new r.ObservableObject,this._packageResources=new r.ObservableArray([])}async fetchPipelineResources(e){this._useResourceRetrieveOption?await this._fetchPipelineWithRetrieveOptions(2,!0,e):await this._fetchPipelineRunParameters(!1,e)}async fetchPipelineStages(e){return this._stageOptions.removeAll(),this._useResourceRetrieveOption?await this._fetchPipelineWithRetrieveOptions(0,!1,e):await this._fetchPipelineRunParameters(!1,e),this._stageOptions.value}async fetchOrgSettings(){return await this._fetchOrgSettings(),this._orgSettings}async fetchProjSettings(){return await this._fetchProjSettings(),this._projSettings}async fetchPipelineResourceRuns(e,t,s,i,n,r,a=!1,o=!1,l=!1,c=void 0){await this._fetchPipelineResourceRuns(e,t,s,i,n,r,a,o,l,c)}async fetchBuildResourceRuns(e,t,s,i,n){await this._fetchBuildResourceRuns(e,t,s,i,n)}async fetchContainerResourceRuns(e,t,s,i){await this._fetchContainerResourceRuns(e,t,s,i)}async fetchPipelineTemplateParameters(){this._templateParametersAreValid.value=!1,this._useResourceRetrieveOption?await this._fetchPipelineWithRetrieveOptions(1):await this._fetchPipelineRunParameters(!0)}getRunTimeVariables(){const e={};return this._runtimeVariables.value.forEach((t=>{t.name&&t.name.trim()&&(!t.isSecret||t.value)&&(e[t.name]={value:t.value,isSecret:t.isSecret})})),this._enableDiagnostic&&(e[u]={value:"true",isSecret:!1},e[h]={value:"true",isSecret:!1}),e}getSerializedVariables(){const e={};return this._runtimeVariables.value.forEach((t=>{t.name&&t.name.trim()&&(!t.isSecret||t.value)&&(e[t.name]=t.value)})),this._enableDiagnostic&&(e[u]="true",e[h]="true"),JSON.stringify(e)}getDemandsValues(){return this._convertDemandDataToSerializedDemand()}get demands(){return this._demands}get runtimeVariables(){return this._runtimeVariables}get buildResources(){return this._buildResources}get containerResources(){return this._containerResources}get packageResources(){return this._packageResources}get pipelineResources(){return this._pipelineResources}get repositoryResources(){return this._repositoryResources}get buildResourceRuns(){return this._buildResourceRuns}get containerResourceRuns(){return this._containerResourceRuns}get pipelineResourceRuns(){return this._pipelineResourceRuns}get templateParameters(){return this._templateParameters}get templateParametersAreValid(){return this._templateParametersAreValid}get allowSkippingResourcePanel(){return this._allowSkippingResourcePanel}get runParametersAreLoaded(){return!!this._pipelineRunParameters&&this._runParametersAreLoaded}get resourcesWereFetched(){return!this._useResourceRetrieveOption&&this._runParametersAreLoaded||this._useResourceRetrieveOption&&this._resourcesWereFetched}get resourcesWereFetchedObservable(){return this._pipelineResourcesWereFetchedObservable}get templateParametersAreLoaded(){return!!this._pipelineRunParameters&&!!this._pipelineRunParameters.templateParameters}get stageOptions(){return this._stageOptions}get skippedStageNames(){return this._stageOptions.value.filter((e=>e.skip)).map((e=>e.refName))}get errorMessage(){return this._errorMessage}getSourceBranch(){if(this._buildRepository&&this._buildRepository.type&&this._isGit(this._buildRepository.type)){if(this._sourceBranch&&!this._sourceBranch.startsWith(K.GitConstants.RefsHeadsPrefix)&&!this._sourceBranch.startsWith(K.GitConstants.RefsPrefix))return K.GitConstants.RefsHeadsPrefix+this._sourceBranch;if(this._sourceTag)return this._sourceTag.startsWith(K.GitConstants.RefsTagsPrefix)?this._sourceTag:K.GitConstants.RefsTagsPrefix+this._sourceTag}return this._sourceBranch}getSourceVersion(){return this._sourceVersion}getShelvesetName(){return this._shelvesetName}getSelectedQueue(){return this._selectedQueue}getEnableDiagnosticState(){return this._enableDiagnostic}getShelvesetPickerActionHub(){return this._shelvesetPickerActiobHub}getSourceControlSelectorActionHub(){return this._sourceVersionActionHub}getEnableDiagnosticActionHub(){return this._enableDiagnosticActionHub}dispose(){this._sourceVersionActionHub.versionUpdated.removeListener(this._handleVersionUpdated),this._sourceVersionActionHub.branchUpdated.removeListener(this._handleBranchUpdated),this._sourceVersionActionHub.tagUpdated.removeListener(this._handleTagUpdated),this._shelvesetPickerActiobHub.pickerDismissed.removeListener(this._handleBranchUpdated),this._queueActionHub.queueSelected.removeListener(this._handleQueueSelected)}getModifiedRepositoryResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.repositoryResources||[];return(this._repositoryResources&&this._repositoryResources.value||[]).filter((t=>{const s=e.find((e=>e.alias===t.alias));return!(s&&t.refName===s.refName&&t.version===s.version)}))}getModifiedBuildResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.buildResources||[];return(this._buildResources&&this._buildResources.value||[]).filter((t=>{const s=e.find((e=>e.alias===t.alias));return!(s&&t.version===s.version)}))}getModifiedContainerResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.containerResources||[];return(this._containerResources&&this._containerResources.value||[]).filter((t=>{const s=e.find((e=>e.alias===t.alias));return!(s&&t.version===s.version)}))}getModifiedPackageResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.packageResources||[];return(this._packageResources&&this._packageResources.value||[]).filter((t=>{const s=e.find((e=>e.alias===t.alias));return!(s&&t.version===s.version)}))}getModifiedPipelineResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.pipelineResources||[],t=this._pipelineResources&&this._pipelineResources.value||[];let s=(0,o.isFeatureFlagEnabled)(this._pageContext,"DistributedTask.AllowResourcePipelineSelectionByRunId");return t.filter((t=>{const i=e.find((e=>e.alias===t.alias));return!(i&&(!s&&t.version===i.version||s&&t.runId===i.runId))}))}getModifiedOrDefinedPipelineResources(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.pipelineResources||[],t=this._pipelineResources&&this._pipelineResources.value||[],s=[],i=[],n=[];let r=(0,o.isFeatureFlagEnabled)(this._pageContext,"DistributedTask.AllowResourcePipelineSelectionByRunId");return t.forEach((t=>{const a=e.find((e=>e.alias===t.alias));a&&(!r&&t.version===a.version||r&&t.runId===a.runId)?t.runId>0?i.push(t):n.push(t):s.push(t)})),this.publishModifiedOrDefinedPipelineResourcesTelemetry(this._pageContext,this._definitionId,i,s,n),s.concat(i)}publishModifiedOrDefinedPipelineResourcesTelemetry(e,t,s,i,n){const r={};r.definitionId=t,r.countPipelineResourcesModified=i.length,r.countPipelineResourcesUntouched=s.length,r.countPipelineResourcesNotFound=n.length,r.pipelineResourcesModified=i.map((e=>e.alias)).join(","),r.pipelineResourcesUntouched=s.map((e=>e.alias)).join(","),r.pipelineResourcesNotFound=n.map((e=>e.alias)).join(",");e.getService("IVssTelemetryService").publishEvent("Build","queueBuildWithPipelineResources",r)}getTemplateParametersDictionary(){const e=this.templateParameters&&this.templateParameters.value;let t;return e&&e.length>0&&(t={},e.forEach((e=>{t[e.data.name]=e.value||e.data.default}))),t}_resetPipelineResources(){this._errorMessage.value="",this._runParametersAreLoaded=!1,this._pipelineRunParameters=void 0,this._resourcesWereFetched=!1,this._pipelineResourcesWereFetchedObservable.value=!1,this._templateParameters.value=[],this._repositoryResources&&(this._repositoryResources.value=[]),this._pipelineResources&&(this._pipelineResources.value=[]),this._buildResources&&(this._buildResources.value=[]),this._containerResources&&(this._containerResources.value=[]),this._pipelineResourceRuns&&this._pipelineResourceRuns.keys().length&&(this._pipelineResourceRuns=new r.ObservableObject),this._buildResourceRuns&&this._buildResourceRuns.keys().length&&(this._buildResourceRuns=new r.ObservableObject),this._containerResourceRuns&&this._containerResourceRuns.keys().length&&(this._containerResourceRuns=new r.ObservableObject),this._packageResources&&(this._packageResources.value=[]),this._stageOptions.value=[]}getLastPipelineRunsFetchExecutionTime(){return this._lastFetchPipelineRunsTime}_resetParameterDependentResources(){this._repositoryResources&&(this._repositoryResources.value=[]),this._pipelineResourceRuns&&this._pipelineResourceRuns.keys().length&&(this._pipelineResourceRuns=new r.ObservableObject),this._buildResourceRuns&&this._buildResourceRuns.keys().length&&(this._buildResourceRuns=new r.ObservableObject),this._containerResourceRuns&&this._containerResourceRuns.keys().length&&(this._containerResourceRuns=new r.ObservableObject),this._stageOptions.value=[],this._runParametersAreLoaded=!1,this._resourcesWereFetched=!1,this._pipelineResourcesWereFetchedObservable.value=!1}_convertDemandDataToSerializedDemand(){const e=[];return(this._demands.value||[]).forEach((t=>{switch(t.condition){case 0:e.push(t.name.trim());break;case 1:e.push((0,a.format)("{0} -equals {1}",t.name.trim(),t.value.trim()))}})),e}_convertSerializedDemandToDemandData(e){const t=[];return e&&e.length>0&&e.forEach(((e,s)=>{const i={index:s,name:"",condition:0,value:""},n=d._demandRegex.exec(e)||{};n&&(i.name=n[1]?n[1]:"",i.value=n[4]?n[4]:"",n[3]&&n[3].length>0&&"equals"===n[3].toLocaleLowerCase()?i.condition=1:i.condition=0),t.push(i)})),t}_fetchPipelineRunParameters(e=!1,t=!1){const s=e?1:0;return this._fetchPipelineWithRetrieveOptions(s,!0,t)}_fetchPipelineWithRetrieveOptions(e=0,t=!0,i=!1){const n=(new Date).getTime();return this._lastFetchPipelineResourcesTime=n,new Promise((r=>{var a=1===e,o=2===e,l=this._enableNewYamlPPResourcesLoadLogic&&0===e&&0===this.stageOptions.value.length;if(this.runParametersAreLoaded&&!a&&!o&&!l||this._resourcesWereFetched&&o)this._updateFromRunParameters(),r();else{const l={pipelineId:this._definitionId,sourceBranch:this.getSourceBranch(),sourceVersion:this.getSourceVersion(),onlyFetchTemplateParameters:a,retrieveOptions:e,templateParameters:this.getTemplateParametersDictionary()||{}},c=this._pageContext.getService("IVssContributionService");c.getDataAsync(s,l,!0).then((e=>{const l=c.getDataProviderExceptions()[s];if(e){if(!t&&e.errors.length>0){var u=this._pipelineRunParameters;this._pipelineRunParameters=e,u&&(this._pipelineRunParameters.repositoryResources=u.repositoryResources,this._pipelineRunParameters.pipelineResources=u.pipelineResources,this._pipelineRunParameters.buildResources=u.buildResources,this._pipelineRunParameters.containerResources=u.containerResources,this._pipelineRunParameters.packageResources=u.packageResources)}else this._pipelineRunParameters=e;if(a)this._updateTemplateParameters(),this._allowSkippingResourcePanel.value=e.allowSkippingResourcePanel;else if(o){if(i&&this._lastFetchPipelineResourcesTime!=n)return void r();this._updateFromRunParameters(),this._resourcesWereFetched=!0,this._pipelineResourcesWereFetchedObservable.value=!0,0===e.errors.length&&(this._runParametersAreLoaded=!0)}else{if(i&&this._lastFetchPipelineResourcesTime!=n)return void r();this._updateFromRunParameters(t,i),this._useResourceRetrieveOption&&0===e.errors.length&&(this._resourcesWereFetched=!0),this._runParametersAreLoaded=!0,this._pipelineResourcesWereFetchedObservable.value=!0}this._setErrorMessage(a,i),r()}else if(l&&"YamlFileNotFoundException"===l.exceptionType)this._errorMessage.value=G.YamlMissingError;else{const e=l&&l.message;console.log("Failed to retrieve pipeline resources and stages: "+e),r()}}))}}))}_fetchOrgSettings(){return new Promise((e=>{this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.pipelines-org-settings-queue-data-provider",void 0).then((t=>{this._orgSettings=t,e()}))}))}_fetchProjSettings(){return new Promise((e=>{this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.pipelines-general-settings-queue-data-provider",void 0).then((t=>{this._projSettings=t,e()}))}))}_updateFromRunParameters(e=!0,t=!1){const s=this._pipelineRunParameters;if(s){if(s.stages&&this._stageOptions){const e={};s.stages.forEach((t=>e[t.refName.toLowerCase()]=t.name)),this._stageOptions.value=s.stages.map((t=>({name:t.name,refName:t.refName,dependsOn:(t.dependsOn||[]).map((t=>e[t.toLowerCase()])),skip:!1,isSkippable:t.isSkippable})))}t||(0===s.errors.length||e)&&(s.buildResources&&this._buildResources&&(this._buildResources.value=s.buildResources.map((e=>Object.assign({},e))).sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name)))),s.containerResources&&this._containerResources&&(this._containerResources.value=s.containerResources.map((e=>Object.assign({},e))).sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name)))),s.packageResources&&this._packageResources&&(this._packageResources.value=s.packageResources.map((e=>Object.assign({},e))).sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name)))),s.pipelineResources&&this._pipelineResources&&(this._pipelineResources.value=s.pipelineResources.map((e=>Object.assign({},e))).sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name)))),s.repositoryResources&&this._repositoryResources&&(this._repositoryResources.value=s.repositoryResources.map((e=>Object.assign({},e))).sort(((e,t)=>(0,a.localeIgnoreCaseComparer)(e.name,t.name)))))}}_updateTemplateParameters(){const e=this._pipelineRunParameters&&this._pipelineRunParameters.templateParameters;e&&(this._templateParameters.value=e.map((e=>{const t=this._previousTemplateParameters[e.name]||e.default||e.values&&e.values.length>0&&e.values[0]||3===e.type&&"false"||"";return{data:Object.assign({},e),value:t,errorMessage:this._validateTemplateParameterInput(e,t)}})),this._updateTemplateParametersValidity())}_setErrorMessage(e,t=!1){const s=this._pipelineRunParameters&&this._pipelineRunParameters.errors;s&&0!==s.length?(this._errorMessage.value=(0,a.format)(G.YamlParseError,s.join("\n")),e&&(this._templateParametersAreValid.value=!1)):t&&(this._errorMessage.value="")}_validateTemplateParameterInput(e,t){if(!e||3===e.type||5===e.type||4===e.type)return;const s=t.trim();return s||e.default?2===e.type&&isNaN(Number(s))?G.NumericInputErrorMessage:void 0:""}_updateTemplateParametersValidity(){const e=this._templateParameters.value;if(e){let t=!0;for(let s=0;s<e.length;s++){if(void 0!==e[s].errorMessage){t=!1;break}}this._templateParametersAreValid.value!==t&&(this._templateParametersAreValid.value=t)}}_fetchPipelineResourceRuns(e,t,s,i,n,a,o,c,u,h=void 0){return new Promise((d=>{const p={keywordFilter:i,project:e,source:s,branch:n,tags:a,useV2:o,showSuccessfulRunsOnly:c,searchOnlyBuildNumber:u},m=this._pageContext.getService("IVssContributionService");m.getDataAsync(l,p,!0).then((e=>{if(h&&this._lastFetchPipelineRunsTime&&this._lastFetchPipelineRunsTime>h&&d(),e)this._pipelineResourceRuns=new r.ObservableObject,this._pipelineResourceRuns.add(t,e),d();else{const e=m.getDataProviderExceptions()[l],t=e&&e.message;console.log("Failed to retrieve pipeline runs for the resource: "+t),d()}}))}))}_fetchBuildResourceRuns(e,t,s,i,n){return new Promise((a=>{const o={connectionId:t,source:i,buildType:s,branch:n},l=this._pageContext.getService("IVssContributionService");l.getDataAsync(c,o,!0).then((t=>{if(t)this._buildResourceRuns||(this._buildResourceRuns=new r.ObservableObject),this._buildResourceRuns.add(e,t),a();else{const e=l.getDataProviderExceptions()[c];if(e&&"AccessCheckException"===e.exceptionType)this._errorMessage.value=e.message;else{const t=e&&e.message;console.log("Failed to retrieve build runs for the resource: "+t)}a()}}))}))}_fetchContainerResourceRuns(e,t,s,i){return new Promise((n=>{const a={connectionId:t,properties:i,containerType:s},o=this._pageContext.getService("IVssContributionService");o.getDataAsync("ms.vss-build-web.container-resource-runs-data-provider",a,!0).then((t=>{if(t)this._containerResourceRuns||(this._containerResourceRuns=new r.ObservableObject),this._containerResourceRuns.add(e,t),n();else{const e=o.getDataProviderExceptions()[c],t=e&&e.message;console.log("Failed to retrieve container images for the resource: "+t),n()}}))}))}}t[e].QueueBuildStore=d,d._demandRegex=/^([^\s]+)(\s+\-([^\s]+)\s+(.*))?/,d.key="build-commands-queue-build-store"}("StoresQueueBuild"),function(e){$=t[e]={};class s extends l.Component{constructor(e){super(e),this._selection=new u.ListSelection({selectOnFocus:!1,multiSelect:!1}),this._renderRunCell=(e,t,s,i)=>{const n=l.createElement(R.Tooltip,{text:i.runId,overflowOnly:!0},l.createElement("span",{className:"text-ellipsis primary-text"},i.buildName));return l.createElement(_.TwoLineTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t,line1:n,line2:l.createElement("span",null)})},this._update=()=>{const e=Object.assign({},this.state);e.version=this._selectedRun,e.versionName=this._selectedRunName,this.props.onUpdate(e),this.props.onDismiss()},this._onChangeSearchText=(e,t)=>{this._searchBuildRuns(t)},this._onClickClearButton=e=>{this._filteredRuns.value=this._runs.value,this._updateSelection(this._filteredRuns.value),this.setState({searchText:""})},this._searchBuildRuns=e=>{const t=e.toLowerCase(),s=this._runs.value.filter((e=>e.buildName.toLowerCase().indexOf(t)>-1||e.runId.toLowerCase().indexOf(t)>-1));this._filteredRuns.value=s,this._updateSelection(s),this.setState({searchText:e})},this._updateSelection=e=>{let t=!1;this.state.version?(e.some(((e,s)=>{if((0,a.equals)(e.runId,this.state.version))return this._selection.select(s),this.setState({useSelecteRunDisabled:!1}),this._selectedRun=e.runId,this._selectedRunName=e.buildName,t=!0,!0})),t||this._selection.clear()):this.state.searchText||e.length>0&&(this._selection.select(0),this.setState({version:e[0].runId,versionName:e[0].buildName,useSelecteRunDisabled:!1}))},this._updateResourceRuns=()=>{const e=[];if(this.props.store.buildResourceRuns){const t=this.props.store.buildResourceRuns.get(this.state.alias);t&&t.length>0&&e.push(...t)}this._runs.value=e,this.state.searchText?this._searchBuildRuns(this.state.searchText):(this._filteredRuns.value=e,this._updateSelection(e))},this._tableColumns=[new _.ColumnSelect,{id:"pipeline-run",width:404,name:G.BuildRunColumnHeadingForBuildResourcePanel,renderCell:this._renderRunCell}],this._isLoading=new r.ObservableValue(!1),this._runs=new r.ObservableArray([]),this._filteredRuns=new r.ObservableArray([]);const t=Object.assign(Object.assign({},e.resource),{searchText:"",useSelecteRunDisabled:!1});this.state=t}componentDidMount(){this._initializeResourceVersions()}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:G.BuildResourcePanelDescription,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:this.props.resource.name},className:"pipeline-resource-panel",footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:G.BuildResourceUpdateButtonText,disabled:this.state.useSelecteRunDisabled,primary:!0,onClick:this._update}]},l.createElement("div",{className:"margin-vertical-8 flex-grow"},this._getSearchBar(),this._buildVersionsTableComponent()))}componentWillUnmount(){this.props.store.buildResourceRuns&&this.props.store.buildResourceRuns.unsubscribe(this._updateResourceRuns)}async _initializeResourceVersions(){this.props.store.getBuildResourceRuns(this.state.alias)||(this._isLoading.value=!0,await this.props.store.fetchBuildResourceRuns(this.state.alias,this.state.connectionId,this.state.buildType,this.state.name,this.state.branch),this._isLoading.value=!1),this._updateResourceRuns(),this.props.store.buildResourceRuns&&this.props.store.buildResourceRuns.subscribe(this._updateResourceRuns)}_buildVersionsTableComponent(){return l.createElement("div",{className:"flex flex-grow flex-column"},l.createElement(d.Observer,{loading:this._isLoading,versions:this._filteredRuns},(e=>e.loading?l.createElement("div",null,l.createElement(g.Spinner,{className:"queue-build-spinner"})):l.createElement(d.Observer,{errorMessage:this.props.store.errorMessage,versions:this._filteredRuns},(e=>{if(e.errorMessage)return l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{className:"multiline-error",severity:"Error"},e.errorMessage," "));if(e.versions.length>0)return l.createElement(_.Table,{pageSize:50,selection:this._selection,onSelect:(e,t)=>{let s=!1;0==this._selection.selectedCount&&(s=!0),this.setState({useSelecteRunDisabled:s}),this._selectedRun=t.data.runId,this._selectedRunName=t.data.buildName},columns:this._tableColumns,itemProvider:this._getItemProvider(e.versions)});{const e=this.state.searchText?(0,a.format)(G.BuildResourceNoSearchResultsText,this.state.searchText):G.BuildResourceNoRunsText;return l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Info"},e))}})))))}_getSearchBar(){return l.createElement(b.TextField,{placeholder:G.BuildResourceSearchBarText,className:"margin-horizontal-20 margin-bottom-8",onChange:this._onChangeSearchText,prefixIconProps:{iconName:"Search"},suffixIconProps:this.state.searchText?{render:e=>l.createElement(c.Button,{ariaLabel:m.ClearFilter,className:(0,v.css)(e,"bolt-text-filterbaritem-clear"),iconProps:{iconName:"Cancel"},onClick:this._onClickClearButton})}:void 0,value:this.state.searchText})}_getItemProvider(e){const t=e.map((e=>e));return new f.ArrayItemProvider(t)}}t[e].BuildResourcePanel=s}("BuildResourcePanel"),function(e){X=t[e]={};class s extends l.Component{constructor(e){super(e),this._selection=new u.ListSelection({selectOnFocus:!1,multiSelect:!1}),this._renderRunCell=(e,t,s,i)=>{const n=l.createElement(R.Tooltip,{text:i.imageId,overflowOnly:!0},l.createElement("span",{className:"text-ellipsis primary-text"},"#",i.imageId));return l.createElement(_.TwoLineTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t,iconProps:{render:()=>l.createElement(S.Status,Object.assign({},this._getStatusPropsForBuildResult(),{key:"result",size:"24",className:"flex-self-center margin-right-8"}))},line1:n,line2:l.createElement("span",null)})},this._update=()=>{const e=Object.assign({},this.state);e.version=this._selectedRun,this.props.onUpdate(e),this.props.onDismiss()},this._onChangeSearchText=(e,t)=>{this._searchContainerRuns(t)},this._onClickClearButton=e=>{this._filteredRuns.value=this._runs.value,this._updateSelection(this._filteredRuns.value),this.setState({searchText:""})},this._searchContainerRuns=e=>{const t=e.toLowerCase(),s=this._runs.value.filter((e=>e.imageId.toLowerCase().indexOf(t)>-1));this._filteredRuns.value=s,this._updateSelection(s),this.setState({searchText:e})},this._updateSelection=e=>{let t=!1;this.state.version?(e.some(((e,s)=>{if((0,a.equals)(e.imageId,this.state.version))return this._selection.select(s),this.setState({useSelectedImageDisabled:!1}),t=!0,!0})),t||this._selection.clear()):this.state.searchText||e.length>0&&(this._selection.select(0),this._selectedRun=e[0].imageId,this.setState({version:e[0].imageId,useSelectedImageDisabled:!1}))},this._updateResourceRuns=()=>{const e=[];if(this.props.store.containerResourceRuns){const t=this.props.store.containerResourceRuns.get(this.state.alias);t&&t.length>0&&e.push(...t)}this._runs.value=e,this.state.searchText?this._searchContainerRuns(this.state.searchText):(this._filteredRuns.value=e,this._updateSelection(e))},this._getStatusPropsForBuildResult=()=>S.Statuses.Success,this._tableColumns=[new _.ColumnSelect,{id:"pipeline-run",width:404,name:"Pipeline run",renderCell:this._renderRunCell}],this._isLoading=new r.ObservableValue(!1),this._runs=new r.ObservableArray([]),this._filteredRuns=new r.ObservableArray([]);const t=Object.assign(Object.assign({},e.resource),{searchText:"",useSelectedImageDisabled:!1});this.state=t}componentDidMount(){this._initializeResourceVersions()}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:G.PipelineResourcePanelDescription,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:this.props.resource.name},className:"pipeline-resource-panel",footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{disabled:this.state.useSelectedImageDisabled,text:G.ContainerResourceUpdateButtonText,primary:!0,onClick:this._update}]},l.createElement("div",{className:"margin-vertical-8 flex-grow"},this._getSearchBar(),this._buildVersionsTableComponent()))}componentWillUnmount(){this.props.store.containerResourceRuns&&this.props.store.containerResourceRuns.unsubscribe(this._updateResourceRuns)}async _initializeResourceVersions(){this.props.store.getContainerResourceRuns(this.state.alias)||(this._isLoading.value=!0,await this.props.store.fetchContainerResourceRuns(this.state.alias,this.state.connectionId,this.state.containerType,this.state.properties),this._isLoading.value=!1),this._updateResourceRuns(),this.props.store.containerResourceRuns&&this.props.store.containerResourceRuns.subscribe(this._updateResourceRuns)}_buildVersionsTableComponent(){return l.createElement("div",{className:"flex flex-grow flex-column"},l.createElement(d.Observer,{loading:this._isLoading,versions:this._filteredRuns},(e=>e.loading?l.createElement("div",null,l.createElement(g.Spinner,{className:"queue-build-spinner"})):l.createElement(d.Observer,{versions:this._filteredRuns},(e=>{if(e.versions.length>0)return l.createElement(_.Table,{selection:this._selection,onSelect:(e,t)=>{let s=!1;0==this._selection.selectedCount&&(s=!0),this.setState({useSelectedImageDisabled:s}),this._selectedRun=t.data.imageId},columns:this._tableColumns,itemProvider:this._getItemProvider(e.versions)});{const e=this.state.searchText?(0,a.format)(G.PipelineResourceNoSearchResultsText,this.state.searchText):G.ContainerResourceNoRunsText;return l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Info"},e))}})))))}_getSearchBar(){return l.createElement(b.TextField,{placeholder:G.PipelineResourceSearchBarText,className:"margin-horizontal-20 margin-bottom-8",onChange:this._onChangeSearchText,prefixIconProps:{iconName:"Search"},suffixIconProps:this.state.searchText?{render:e=>l.createElement(c.Button,{ariaLabel:m.ClearFilter,className:(0,v.css)(e,"bolt-text-filterbaritem-clear"),iconProps:{iconName:"Cancel"},onClick:this._onClickClearButton})}:void 0,value:this.state.searchText})}_getItemProvider(e){const t=e.map((e=>e));return new f.ArrayItemProvider(t)}}t[e].ContainerResourcePanel=s}("ContainerResourcePanel"),function(e){Z=t[e]={};t[e].FormInputLabel=e=>{const{primaryLabel:t,secondaryLabel:s}=e;return l.createElement("div",{className:"flex-row variable-label-div"},l.createElement("div",{className:"variable-label-primary-text"},t),l.createElement("div",{className:"variable-label-secondary-text secondary-text"},s))}}("FormInputLabel"),function(e){ee=t[e]={};class s extends l.Component{constructor(e){super(e),this._onKeyDown=e=>{const t=!this._isValidName()||!this._isValidValue();"Enter"!==e.key||e.defaultPrevented||t||(this._clickOk(),e.preventDefault())},this._onNameChanged=(e,t)=>{this.state.demand.name=t,this.setState({demand:this.state.demand})},this._onValueChanged=(e,t)=>{this.state.demand.value=t,this.setState({demand:this.state.demand})},this._onConditionChanged=e=>{this.state.demand.condition=e,this.setState({demand:this.state.demand})},this._isValidName=()=>{const e=this.state.demand;return!(!e.name||""===e.name.trim())},this._isValidValue=()=>{const e=this.state.demand;return!!(1!==e.condition||e.value&&""!==e.value.trim())},this._clickOk=()=>{this.props.isNewDemand&&this.props.onDemandAdded?this.props.onDemandAdded(this.state.demand):!this.props.isNewDemand&&this.props.onDemandUpdated&&this.props.onDemandUpdated(this.state.demand),this.props.onDismiss()},this.state={demand:this.props.demand}}render(){const e=this.props.isNewDemand?G.AddDemandPanelTitle:G.UpdateDemandPanelTitle,t=this.props.isNewDemand?G.CreateButtonText:G.UpdateButtonText,s=!this._isValidName()||!this._isValidValue(),n=this.props.isNewDemand?".variable-panel-demand-name":".variable-panel-demand-condition";return l.createElement(p.Panel,{backButtonProps:{subtle:!0,iconProps:{iconName:"Back"},onClick:this.props.onDismiss,ariaLabel:G.Back},onDismiss:this.props.onDismiss,titleProps:{text:e},className:"variable-panel",defaultActiveElement:n,footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:t,primary:!0,onClick:this._clickOk,disabled:s}]},l.createElement(i,{demand:this.state.demand,isNewDemand:this.props.isNewDemand,onNameChanged:this._onNameChanged,onConditionChanged:this._onConditionChanged,onValueChanged:this._onValueChanged,onKeyDown:this._onKeyDown}))}}t[e].DemandPanel=s;class i extends l.Component{constructor(){super(...arguments),this._getDemandNameControl=()=>l.createElement(P.FormItem,{className:"variable-panel-demand-name flex-grow margin-bottom-16",label:l.createElement(Z.FormInputLabel,{primaryLabel:G.NameFieldLabel,secondaryLabel:G.RequiredLabel})},l.createElement(b.TextField,{ariaLabel:G.NameFieldLabel,value:this.props.demand.name,className:"primary-text",ref:e=>{this._nameTextFieldRef=e},onChange:this.props.onNameChanged,disabled:!this.props.isNewDemand,required:!0})),this._getDemandConditionControl=()=>l.createElement("div",{className:"variable-condition-container flex-grow margin-bottom-16"},l.createElement("label",{className:"flex-grow flex-row margin-bottom-8"},G.ConditionFieldLabel),l.createElement(C.PickListDropdown,{selectOnFocus:!0,ariaLabelFormat:G.ConditionFieldLabel,selectedItems:this._getSelectedCondition(),className:"variable-panel-demand-condition flex-grow primary-text",ref:e=>{this._conditionDropDownRef=e},getPickListItems:this._getConditions,getListItem:e=>({key:e&&e.key?e.key.toString():"",name:e?e.name:""}),onSelectionChanged:e=>this.props.onConditionChanged(e.selectedItems[0].key)})),this._getDemandValueControl=()=>l.createElement(P.FormItem,{className:"flex-grow margin-bottom-16",label:l.createElement(Z.FormInputLabel,{primaryLabel:G.ValueFieldLabel,secondaryLabel:G.RequiredLabel})},l.createElement(b.TextField,{value:this.props.demand.value,className:"primary-text",onChange:this.props.onValueChanged,required:!0})),this._getSelectedCondition=()=>1===this.props.demand.condition?[{key:this.props.demand.condition,name:G.EqualsCondition}]:[{key:this.props.demand.condition,name:G.ExistsCondition}],this._getConditions=()=>[{key:1,name:G.EqualsCondition},{key:0,name:G.ExistsCondition}]}render(){return l.createElement("div",{className:"variable-panel-content flex-grow",onKeyDown:this.props.onKeyDown},this._getDemandNameControl(),this._getDemandConditionControl(),1===this.props.demand.condition&&this._getDemandValueControl())}componentDidMount(){this.props.isNewDemand?(this._nameTextFieldRef&&this._nameTextFieldRef.focus(),this._nameTextFieldRef&&this._nameTextFieldRef.select()):this._conditionDropDownRef&&this._conditionDropDownRef.focus()}}}("DemandPanel"),function(e){te=t[e]={};class s extends l.Component{constructor(e){super(e),this._defaultListSelectionIndex=-1,this._onKeyDown=e=>{"delete"===e.key.toLowerCase()&&this._listSelectionIndex!=this._defaultListSelectionIndex&&(this.props.store.deleteDemand(this._listSelectionIndex),e.preventDefault())},this._renderRow=(e,t,s)=>{const i=t.name?(0,a.format)(G.DeleteButtonTooltip,t.name):G.DeleteButtonEmptyTooltip,n=1===t.condition?"= "+t.value:G.ExistsCondition,r=(0,v.getSafeId)(this.c_hiddenAriaDivId);return s.onFocusItem=e=>this._onFocusItem(e),l.createElement(u.ListItem,{key:"list-item"+e,index:e,details:s},l.createElement("div",{className:"queue-panel-list-row flex-grow flex-row"},l.createElement("div",{className:"flex-column justify-center","aria-describedby":r},l.createElement("span",{className:"text-ellipsis primary-text","aria-label":t.name},t.name),l.createElement("span",{className:"font-size text-ellipsis secondary-text","aria-label":n},n),l.createElement("div",{id:r,className:"hidden"},G.ListItemRoleDescription)),l.createElement("span",{className:"flex-grow flex-row justify-end"},l.createElement("div",{className:"flex-column justify-center margin-right-16"},l.createElement(c.Button,{ariaLabel:i,className:"bolt-list-cell-content-reveal",iconProps:{iconName:"Delete"},onClick:t=>{this.props.store.deleteDemand(e),t.preventDefault()},subtle:!0,tooltipProps:{text:i}})),l.createElement(x.Icon,{iconName:"ChevronRightMed",size:"medium"}))))},this._createDemand=()=>{const e={index:this.props.store.demands.length,condition:0};this._renderDemandPanel(e,!0)},this._updateDemand=(e,t)=>{this._renderDemandPanel(Object.assign({},t.data),!1)},this._renderDemandPanel=(e,t)=>{this.props.pageContext.getService("IVssLayoutManager").renderCallout((s=>l.createElement(ee.DemandPanel,{demand:e,isNewDemand:t,onDismiss:s,onDemandAdded:e=>this.props.store.addDemand(e),onDemandUpdated:e=>this.props.store.updateDemand(e)})))},this.c_hiddenAriaDivId="hiddenAriaDiv",this._itemProvider=this.props.store.demands,this._listSelectionIndex=this._defaultListSelectionIndex}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:this.props.pipelineName,escDismiss:!0,footerButtonProps:[{text:G.AddDemandButton,primary:!0,onClick:this._createDemand}],onDismiss:this.props.onDismiss,titleProps:{text:G.DemandsTitle}},l.createElement("div",{className:"queue-panel-list-container"},l.createElement("div",{className:"flex-row scroll-auto",onKeyDown:this._onKeyDown},l.createElement(u.ScrollableList,{ariaLabel:G.DemandsTitle,itemProvider:this._itemProvider,renderRow:this._renderRow,width:"100%",singleClickActivation:!0,onActivate:this._updateDemand,outerClassName:"custom-scrollbar",role:"list"})),l.createElement(d.Observer,{demands:this._itemProvider},(e=>0===e.demands.length?l.createElement("span",{className:"flex-row margin-vertical-8 padding-horizontal-20 primary-text"},l.createElement("label",{className:"margin-right-4"},G.EmptyDemandsDescription),l.createElement(E.Link,{href:"https://go.microsoft.com/fwlink/?linkid=2087182",ariaLabel:G.DemandsLearnMore},G.LearnMoreMessage)):null))))}_onFocusItem(e){this._listSelectionIndex=e}}t[e].DemandsControllerView=s}("DemandsControllerView"),function(e){se=t[e]={};class s extends l.Component{constructor(e){super(e),this._update=()=>{const e=Object.assign({},this.state);this.props.onUpdate(e),this.props.onDismiss()};const t=Object.assign(Object.assign({},e.resource),{searchText:""});this.state=t}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:G.PipelineResourcePanelDescription,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:this.props.resource.name},className:"pipeline-resource-panel",footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:G.PipelineResourceUpdateButtonText,primary:!0,onClick:this._update}]},l.createElement("div",{className:"margin-vertical-8 flex-grow"},this._getTextField()))}_getTextField(){return l.createElement(b.TextField,{placeholder:G.PackageResourceSearchBarText,className:"margin-horizontal-20 margin-bottom-8",value:this.state.version,onChange:(e,t)=>this.setState({version:t})})}}t[e].PackageResourcePanel=s}("PackageResourcePanel"),function(e){function s(e){switch(e){case"Succeeded":return S.Statuses.Success;case"PartiallySucceeded":return S.Statuses.Warning;case"Failed":return S.Statuses.Failed;case"Canceled":return S.Statuses.Canceled;default:return S.Statuses.Queued}}ie=t[e]={},t[e].getStatusPropsForBuildResult=s;const i="refs/tags/";function n(e,t,n,r){var a;const o=l.createElement(R.Tooltip,{text:r.buildNumber,overflowOnly:!0},l.createElement("span",{className:"text-ellipsis primary-text"},"#",r.buildNumber));let c,u="OpenSource";r.sourceBranch.startsWith(i)?(u="Tag",c=r.sourceBranch.replace(i,"")):c=r.sourceBranch.replace("refs/heads/","");const h=l.createElement("span",{className:"fontSize secondary-text flex-row flex-baseline text-ellipsis"},l.createElement(x.Icon,{className:"margin-right-4",iconName:u}),l.createElement(R.Tooltip,{text:r.sourceBranch,overflowOnly:!0},l.createElement("span",{className:"source-branch-content font-size text-ellipsis secondary-text"},c)),l.createElement(x.Icon,{className:"margin-left-4",iconName:"BranchCommit"}),l.createElement("span",null,null===(a=r.sourceVersion)||void 0===a?void 0:a.substring(0,8)));return l.createElement(_.TwoLineTableCell,{columnIndex:t,tableColumn:n,key:"col-"+t,iconProps:{render:()=>l.createElement(S.Status,Object.assign({},s(r.result),{key:r.result,size:"24",className:"flex-self-center margin-right-8"}))},line1:o,line2:h})}function r(e,t,s,i){return l.createElement(_.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},l.createElement("span",{className:"flex-row flex-center font-size-m secondary-text"},i.finishTime&&l.createElement(w.Ago,{date:i.finishTime,format:0})))}t[e].getTableColumns=function(){return[new _.ColumnSelect,{id:"pipeline-run",width:300,name:G.PipelineRunColumnHeadingForPipelineResourcePanel,renderCell:n},{id:"completed",width:104,name:G.CompletedColumnHeadingForPipelineResourcePanel,renderCell:r}]},t[e].getItemProvider=function(e){const t=e.map((e=>e));return new f.ArrayItemProvider(t)}}("HelpersPipelineResourcePanelHelper"),function(e){ne=t[e]={};class s extends l.Component{constructor(e){super(e),this._selection=new u.ListSelection({selectOnFocus:!1,multiSelect:!1}),this.isAllowedSelectionByBranch=!1,this._update=()=>{const e=Object.assign({},this.state);e.version=this._selectedRun.version,e.runBranch=this._selectedRun.branch,this.isAllowedSelectionByBranch&&(e.runId=this._selectedRun.runId),this.props.onUpdate(e),this.props.onDismiss()},this._onChangeSearchText=(e,t)=>{this.setState({searchText:t,version:"",runId:0}),this._searchPipelineRuns(t)},this._onClickClearButton=e=>{this.setState({searchText:"",version:"",runId:0}),this._fetchPipelineResourceRuns("")},this._searchPipelineRuns=e=>{this._fetchPipelineResourceRuns(e)},this._updateSelection=e=>{let t=!1;var s;(this.isAllowedSelectionByBranch?this.state.runId&&this.state.runId>0&&e.some(((e,s)=>{if((0,a.equals)(e.runId.toString(),this.state.runId.toString()))return this._selection.select(s),this.setState({useSelecteRunDisabled:!1}),t=!0,!0})):this.state.version&&""!=this.state.version&&e.some(((e,s)=>{if((0,a.equals)(e.buildNumber,this.state.version))return this._selection.select(s),this.setState({useSelecteRunDisabled:!1}),t=!0,!0})),t)||(this._selection.clear(),e.length>0&&(-1!=(s=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"Build2.ResolveDefaultResourceVersion",!1)?e.findIndex((e=>e.isDefaultSelection)):0)?(this._selection.select(s),this._selectedRun={version:e[s].buildNumber,runId:this.isAllowedSelectionByBranch?e[s].runId:0,branch:e[s].sourceBranch},this.setState({version:e[s].buildNumber,branch:this.isAllowedSelectionByBranch?e[s].sourceBranch:"",runId:this.isAllowedSelectionByBranch?e[s].runId:0,useSelecteRunDisabled:!1})):this.setState({useSelecteRunDisabled:!0})))},this._updateResourceRuns=()=>{const e=[];if(this.props.store.pipelineResourceRuns){const t=this.props.store.pipelineResourceRuns.get(this.state.alias);t&&t.length>=0&&e.push(...t)}this._runs.value=e,this._filteredRuns.value=e,this._updateSelection(e)},this.isAllowedSelectionByBranch=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"DistributedTask.AllowResourcePipelineSelectionByRunId",!1),this._selectedRun={version:e.resource.version,runId:this.isAllowedSelectionByBranch?e.resource.runId:0,branch:e.resource.runBranch||""},this._isLoading=new r.ObservableValue(!1),this._runs=new r.ObservableArray([]),this._filteredRuns=new r.ObservableArray([]);const t=Object.assign(Object.assign({},e.resource),{searchText:"",useSelecteRunDisabled:!1});this.state=t,this._timerManagement=new y.TimerManagement,this._tableColumns=(0,ie.getTableColumns)(),this._searchPipelineRuns=this._timerManagement.debounce(this._searchPipelineRuns,500)}componentDidMount(){this._initializeResourceVersions()}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:G.PipelineResourcePanelDescription,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:this.props.resource.name},className:"pipeline-resource-panel",footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:G.PipelineResourceUpdateButtonText,disabled:this.state.useSelecteRunDisabled,primary:!0,onClick:this._update}]},l.createElement("div",{className:"margin-vertical-8 flex-grow"},this._getSearchBar(),this._pipelineVersionsTableComponent()))}componentWillUnmount(){this.props.store.pipelineResourceRuns&&this.props.store.pipelineResourceRuns.unsubscribe(this._updateResourceRuns)}async _initializeResourceVersions(){this._fetchPipelineResourceRuns("")}async _fetchPipelineResourceRuns(e){this._isLoading.value=!0,await this.props.store.fetchPipelineResourceRuns(this.state.project,this.state.alias,this.state.name,e,this.state.branch,this.state.tags),this._isLoading.value=!1,this._updateResourceRuns(),this.props.store.pipelineResourceRuns&&this.props.store.pipelineResourceRuns.subscribe(this._updateResourceRuns)}_pipelineVersionsTableComponent(){return l.createElement("div",{className:"flex flex-grow flex-column"},l.createElement(d.Observer,{loading:this._isLoading,versions:this._filteredRuns},(e=>e.loading?l.createElement("div",null,l.createElement(g.Spinner,{className:"queue-build-spinner"})):l.createElement(d.Observer,{versions:this._filteredRuns},(e=>{if(e.versions.length>0)return l.createElement(_.Table,{selection:this._selection,onSelect:(e,t)=>{let s=!1;0==this._selection.selectedCount&&(s=!0),this.setState({useSelecteRunDisabled:s}),this._selectedRun={version:t.data.buildNumber,runId:this.isAllowedSelectionByBranch?t.data.runId:0,branch:t.data.sourceBranch}},columns:this._tableColumns,itemProvider:(0,ie.getItemProvider)(e.versions)});{const e=this.state.searchText?(0,a.format)(G.PipelineResourceNoSearchResultsText,this.state.searchText):G.PipelineResourceNoRunsText;return l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Info"},e))}})))))}_getSearchBar(){return l.createElement(b.TextField,{placeholder:G.PipelineResourceSearchBarText,className:"margin-horizontal-20 margin-bottom-8",onChange:this._onChangeSearchText,prefixIconProps:{iconName:"Search"},suffixIconProps:this.state.searchText?{render:e=>l.createElement(c.Button,{ariaLabel:m.ClearFilter,className:(0,v.css)(e,"bolt-text-filterbaritem-clear"),iconProps:{iconName:"Cancel"},onClick:this._onClickClearButton})}:void 0,value:this.state.searchText})}}t[e].PipelineResourcePanel=s}("PipelineResourcePanel"),function(e){re=t[e]={};const s="refs/heads/",i="refs/tags/";class n extends l.Component{constructor(e){super(e),this._isLoading=new r.ObservableValue(!0),this._selection=new u.ListSelection({selectOnFocus:!1,multiSelect:!1}),this.isAllowedSelectionByRunId=!1,this._options=[],this._knownBranches=[],this._branchSelection=new T.DropdownSelection,this._fetchPipelineResourceRuns=async(e,t,s,i,n)=>{e.includes("_")&&(e="*"+e+"*"),await this.props.store.fetchPipelineResourceRuns(this.state.project,this.state.alias,this.state.name,e,t,this.state.tags,!0,s,i,n),this.props.store.getLastPipelineRunsFetchExecutionTime()==n&&(this._isLoading.value=!1,this._updateResourceRuns()),this.props.store.pipelineResourceRuns&&this.props.store.pipelineResourceRuns.subscribe(this._updateResourceRuns)},this._renderBranchText=(e,t)=>{const s=t[e.value[0].beginIndex];let i=this._normalizeBranchName(s&&s.text||"");return 1===e.selectedCount?l.createElement("div",{className:"branch-text"},l.createElement("span",null,G.BranchLabelPipelineResource,": ",l.createElement("span",{className:"branch-name"},i))):l.createElement("span",{className:"text-ellipsis branch-text"},G.BranchLabelPipelineResource)},this._normalizeBranchName=e=>e&&e.startsWith(s)?e.substr(11):e&&e.startsWith(i)?e.substr(10):e||"",this._onChangeBranchSearchText=(e,t)=>{let s=t.length>0;t=this._prepareBranchName(t),this._options=[],this._knownBranches.forEach((e=>{this._options.push({text:e,id:e}),(0,a.equals)(e,t,!1)&&(s=!1)})),s&&this._options.push({text:t,id:t}),this.forceUpdate()},this._onBranchSelected=(e,t)=>{this._branchSelected(t.text),-1===this._knownBranches.indexOf(t.text)&&t.text!=s&&this._knownBranches.push(t.text),this.forceUpdate()},this._onToggleShowSuccessfulRunsOnly=(e,t)=>{this.setState(Object.assign(Object.assign({},this.state),{showSuccessfulRunsOnly:t,useSelecteRunDisabled:!0})),this.forceUpdate(),this._notDelayedFetchOfPipelineResourceRuns(this.state.searchText,this.state.selectedBranch,t,this.state.searchOnlyBuildName,(new Date).getTime())},this._onToggleSearchOnlyBuildName=(e,t)=>{this.setState(Object.assign(Object.assign({},this.state),{searchOnlyBuildName:t,useSelecteRunDisabled:!0})),this.forceUpdate(),this._notDelayedFetchOfPipelineResourceRuns(this.state.searchText,this.state.selectedBranch,this.state.showSuccessfulRunsOnly,t,(new Date).getTime())},this._branchSelected=e=>{this.setState(Object.assign(Object.assign({},this.state),{selectedBranch:e,useSelecteRunDisabled:!0})),this.forceUpdate(),this._notDelayedFetchOfPipelineResourceRuns(this.state.searchText,e,this.state.showSuccessfulRunsOnly,this.state.searchOnlyBuildName,(new Date).getTime())},this._update=()=>{const e=Object.assign({},this.state);e.version=this._selectedRun.version,e.runBranch=this._selectedRun.branch,this.isAllowedSelectionByRunId&&(e.runId=this._selectedRun.runId),e.runResult=this._selectedRun.runResult,this.props.onUpdate(e),this.props.onDismiss()},this._onChangeSearchText=(e,t)=>{this.setState(Object.assign(Object.assign({},this.state),{searchText:t,useSelecteRunDisabled:!0})),this.forceUpdate(),this._delayedFetchOfPipelineResourceRuns(t,this.state.selectedBranch,this.state.showSuccessfulRunsOnly,this.state.searchOnlyBuildName,(new Date).getTime())},this._onClickSearchTextClearButton=e=>{this.setState({searchText:"",useSelecteRunDisabled:!0}),this.forceUpdate(),this._delayedFetchOfPipelineResourceRuns("",this.state.selectedBranch,this.state.showSuccessfulRunsOnly,this.state.searchOnlyBuildName,(new Date).getTime())},this._delayedFetchOfPipelineResourceRuns=(e,t,s,i,n)=>{this.props.store.updateLastPipelineRunsFetchExecutionTime(n),this._isLoading.value=!0,this._delayedFetch(e,t,s,i,n)},this._notDelayedFetchOfPipelineResourceRuns=(e,t,s,i,n)=>{this.props.store.updateLastPipelineRunsFetchExecutionTime(n),this._isLoading.value=!0,this._fetchPipelineResourceRuns(e,t,s,i,n)},this._updateSelection=e=>{let t=!1;this.isAllowedSelectionByRunId?this.state.runId&&this.state.runId>0&&e.some(((e,s)=>{if((0,a.equals)(e.runId.toString(),this.state.runId.toString()))return this._selection.select(s),this.setState({useSelecteRunDisabled:!1}),t=!0,!0})):this.state.version&&""!=this.state.version&&e.some(((e,s)=>{if((0,a.equals)(e.buildNumber,this.state.version))return this._selection.select(s),this.setState({useSelecteRunDisabled:!1}),t=!0,!0})),t||(this._selection.clear(),this._selectedRun={version:"",runId:0,branch:"",runResult:""},this.setState({version:"",runBranch:"",runId:0,useSelecteRunDisabled:!0}))},this._updateResourceRuns=()=>{this._selection.clear();const e=[];if(this.props.store.pipelineResourceRuns){const t=this.props.store.pipelineResourceRuns.get(this.state.alias);t&&t.length>=0&&e.push(...t)}this._runs.value=e,this._filteredRuns.value=e,this._updateSelection(e),this._updateBranchFilters(e),this.forceUpdate()},this._updateBranchFilters=e=>{e.forEach((e=>{if(e.sourceBranch&&e.sourceBranch.length>0){const t=this._prepareBranchName(e.sourceBranch);if(-1===this._knownBranches.indexOf(t)){this._knownBranches.push(t);let e="";this._options.forEach((t=>{-1===this._knownBranches.indexOf(t.text)&&(e=t.text)})),this._options=[],this._knownBranches.forEach((e=>{this._options.push({text:e,id:e})})),e.length>0&&this._options.push({text:e,id:e})}}}))},this.isAllowedSelectionByRunId=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"DistributedTask.AllowResourcePipelineSelectionByRunId",!1),this._selectedRun={version:e.resource.version,runId:this.isAllowedSelectionByRunId?e.resource.runId:0,branch:e.resource.runBranch||"",runResult:e.resource.runResult||""},this._runs=new r.ObservableArray([]),this._filteredRuns=new r.ObservableArray([]);const t=Object.assign(Object.assign({},e.resource),{searchText:"",selectedBranch:"",useSelecteRunDisabled:!1,showSuccessfulRunsOnly:!0,searchOnlyBuildName:!0});if(this._timerManagement=new y.TimerManagement,this._delayedFetch=this._timerManagement.debounce(this._fetchPipelineResourceRuns,2e3),this._options=[],this._tableColumns=(0,ie.getTableColumns)(),this.props.resource.branch&&this.props.resource.branch.length>0&&this.props.resource.runId&&this.props.resource.runId>0){let e=this._prepareBranchName(this.props.resource.branch);this.props.resource.runBranch&&this.props.resource.runBranch.length>0&&this._prepareBranchName(this.props.resource.runBranch)===e&&(this._options.push({text:e,id:e}),this._branchSelection.select(0),this._knownBranches=[e],t.selectedBranch=e)}this.props.resource.runResult&&this.props.resource.runResult.length>0&&("succeeded"===this.props.resource.runResult.toLowerCase()?t.showSuccessfulRunsOnly=!0:t.showSuccessfulRunsOnly=!1),this.state=t}_prepareBranchName(e){return e.startsWith("refs/")||(e=s+e),e}componentDidMount(){this._initializeResourceVersions()}render(){const e=`${this.props.resource.name}-title}`,t={text:this.props.resource.name};return[].push({id:"queue-panel-close-button",onActivate:this.props.onDismiss,ariaLabel:G.CloseButtonLabel,iconProps:{iconName:"Cancel"},subtle:!0,role:"button"}),l.createElement(p.CustomPanel,{ariaLabelledBy:e,className:"pipeline-resource-panel flex-column h-scroll-hidden",lightDismiss:!0,onDismiss:this.props.onDismiss},l.createElement(p.PanelHeader,{backButtonProps:{onClick:this.props.onDismiss},description:G.PipelineResourcePanelDescription,onDismiss:this.props.onDismiss,showSeparator:!1,titleProps:Object.assign({id:e},t)}),this._getSearchBar(),l.createElement(p.PanelContent,{className:"pipeline-resource-panel-child no-padding"},this._pipelineVersionsTableComponent()),l.createElement("div",{className:"flex-column margin-horizontal-20 margin-top-8"},l.createElement(B.Checkbox,{label:G.ShowSuccesfulRunsOnly,className:"flex-grow margin-bottom-8",checked:this.state.showSuccessfulRunsOnly,onChange:this._onToggleShowSuccessfulRunsOnly}),l.createElement(B.Checkbox,{label:G.FilterByBuildName,className:"flex-grow margin-bottom-8",checked:this.state.searchOnlyBuildName,onChange:this._onToggleSearchOnlyBuildName})),l.createElement(p.PanelFooter,{className:"flex-column flex-end"},l.createElement(D.ButtonGroup,{className:"bolt-panel-footer-buttons"},l.createElement(c.Button,{text:G.CancelButtonText,onClick:this.props.onDismiss}),l.createElement(d.Observer,{useSelectedRunDisabled:this.state.useSelecteRunDisabled},(e=>l.createElement(c.Button,{text:G.PipelineResourceUpdateButtonText,primary:!0,onClick:this._update,disabled:e.useSelectedRunDisabled}))))))}componentWillUnmount(){this.props.store.pipelineResourceRuns&&this.props.store.pipelineResourceRuns.unsubscribe(this._updateResourceRuns)}async _initializeResourceVersions(){this._notDelayedFetchOfPipelineResourceRuns("",this.state.selectedBranch,this.state.showSuccessfulRunsOnly,!0,(new Date).getTime())}_pipelineVersionsTableComponent(){return l.createElement("div",{className:"flex flex-grow flex-row"},l.createElement(d.Observer,{loading:this._isLoading,versions:this._filteredRuns},(e=>{var t,s;if(e.loading)return l.createElement("div",{className:"flex-grow padding-vertical-20"},l.createElement(g.Spinner,{className:"queue-build-spinner"}));if(e.versions.length>0)return l.createElement(_.Table,{key:e.versions.length+"-"+(null!==(s=null===(t=e.versions[0])||void 0===t?void 0:t.buildNumber)&&void 0!==s?s:""),selection:this._selection,onSelect:(e,t)=>{let s=!1;0==this._selection.selectedCount&&(s=!0),this.setState({useSelecteRunDisabled:s}),this._selectedRun={version:t.data.buildNumber,runId:this.isAllowedSelectionByRunId?t.data.runId:0,branch:t.data.sourceBranch,runResult:t.data.result}},columns:this._tableColumns,itemProvider:(0,ie.getItemProvider)(e.versions)});{const e=this.state.searchText?this.state.searchOnlyBuildName?(0,a.format)(G.PipelineResourceNoSearchResultsText,this.state.searchText):(0,a.format)(G.PipelineResourceNoSearchResultsWithTagsText,this.state.searchText,this.state.searchText):G.PipelineResourceNoRunsText;return l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20 flex-grow"},l.createElement(h.MessageCard,{severity:"Info"},e))}})))}_getSearchBar(){return l.createElement("div",{className:"flex-row margin-vertical-8 margin-horizontal-20"},l.createElement(b.TextField,{placeholder:G.PipelineResourceSearchBarText,className:"margin-right-16 margin-bottom-8",containerClassName:"pipeline-resource-search-bar",onChange:this._onChangeSearchText,prefixIconProps:{iconName:"Search"},suffixIconProps:this.state.searchText?{render:e=>l.createElement(c.Button,{ariaLabel:m.ClearFilter,className:(0,v.css)(e,"bolt-text-filterbaritem-clear"),iconProps:{iconName:"Cancel"},onClick:this._onClickSearchTextClearButton})}:void 0,value:this.state.searchText}),l.createElement(d.Observer,{options:this._options},(e=>l.createElement("div",{className:"pipeline-resource-dropdown"},l.createElement(N.Dropdown,{className:"margin-right-8 flex-grow",containerClassName:"pipeline-resource-dropdown-container",calloutContentClassName:"pipeline-resource-dropdown-container",ariaLabel:G.BranchLabelPipelineResource,placeholder:G.BranchLabelPipelineResource,filterByText:!0,showFilterBox:!0,enforceSingleSelect:!0,onFilterTextChanged:this._onChangeBranchSearchText,items:e.options,renderSelectedItems:this._renderBranchText,renderExpandable:N.DropdownExpandableButton,selection:this._branchSelection,actions:[{className:"queue-panel-parameter-multi-option-action",text:G.AllBranchesButtonText,iconProps:{iconName:"Cancel"},onClick:()=>{this._branchSelection.unselect(0,this._options.length),this._branchSelected("")}}],onSelect:this._onBranchSelected})))))}}t[e].PipelineResourcePanelV2=n}("PipelineResourcePanelV2"),function(e){ae=t[e]={};class s extends l.Component{constructor(e){super(e),this._initializeResources=async()=>{this.props.store.templateParametersAreLoaded||(this._isLoading.value=!0,await this.props.store.fetchPipelineTemplateParameters(),this._isLoading.value=!1)},this._isLoading=new r.ObservableValue(!1),this._templateParameters=e.store.templateParameters}componentDidMount(){this._templateParameters&&(this._initializeResources(),this._templateParameters.subscribe((()=>this._initializeResources())))}render(){return l.createElement(d.Observer,{loading:this._isLoading,templateParameters:this._templateParameters},(e=>e.loading?l.createElement("div",{className:(0,v.css)(this.props.className,"flex-row justify-start")},l.createElement(g.Spinner,{orientation:0,label:G.ProcessingYamlMessage})):e.templateParameters&&e.templateParameters.length>0?l.createElement("div",null,l.createElement("h2",{className:(0,v.css)("padding-horizontal-20 primary-text title-s",!this.props.isV2&&"margin-vertical-0 template-parameters-title")},G.TemplateParametersLabel),l.createElement("div",{className:(0,v.css)(this.props.className,"flex-column flex-noshrink rhythm-vertical-16 margin-bottom-16")},e.templateParameters.map((e=>l.createElement(i,{key:e.data.name,allowEditing:this.props.allowEditing,onValueChanged:this.props.store.updateTemplateParameter,templateParameter:e,doNotAllowChanges:this.props.doNotAllowChanges}))))):null))}}t[e].TemplateParametersView=s;const i=e=>{switch(e.templateParameter.data.type){case 3:return l.createElement(o,Object.assign({},e));case 0:return l.createElement(n,Object.assign({},e));case 2:return l.createElement(n,Object.assign({},e,{inputType:"number"}));case 5:return l.createElement(c,Object.assign({},e));case 4:return l.createElement(u,Object.assign({},e));case 6:return l.createElement(h,Object.assign({},e));default:return l.createElement(n,Object.assign({},e,{multiline:!0}))}},n=e=>{const{onValueChanged:t,templateParameter:s,multiline:i=!1,inputType:n="text"}=e,{data:r,value:a,errorMessage:o}=s,c=r.default?l.createElement(l.Fragment,null,l.createElement("span",{className:"parameter-name"},r.displayName||r.name),!e.allowEditing&&l.createElement(x.Icon,{className:"more-info-icon env-panel-info",iconName:"Info",tooltipProps:{text:G.NotEnoughPermissionsToEditQueueVariables},tabIndex:0,ariaLabel:G.NotEnoughPermissionsToEditQueueVariables})):l.createElement(l.Fragment,null,l.createElement("div",{className:"flex-row"},l.createElement("span",{className:"flex-grow parameter-name"},r.displayName||r.name),l.createElement("div",{className:"secondary-text"},G.RequiredLabel)),!e.allowEditing&&l.createElement(x.Icon,{className:"more-info-icon env-panel-info",iconName:"Info",tooltipProps:{text:G.NotEnoughPermissionsToEditQueueVariables},tabIndex:0,ariaLabel:G.NotEnoughPermissionsToEditQueueVariables}));return l.createElement(P.FormItem,{className:"flex-stretch flex-noshrink",error:!!o,label:c,message:o},l.createElement(b.TextField,{autoAdjustHeight:i,inputType:n,multiline:i,disabled:!e.allowEditing||e.doNotAllowChanges,onChange:(e,s)=>t({data:r,value:s,errorMessage:o}),placeholder:r.default,value:a}))},o=e=>{const{onValueChanged:t,templateParameter:s}=e,{data:i,value:n,errorMessage:r}=s,a=l.createElement("span",{className:"parameter-name"},i.displayName||i.name);return l.createElement(B.Checkbox,{checked:"true"===n.toLowerCase(),className:"flex-stretch flex-noshrink padding-horizontal-0",label:a,disabled:e.doNotAllowChanges,onChange:(e,s)=>{t({data:i,value:s?"true":"false",errorMessage:r})}})},c=e=>{const{onValueChanged:t,templateParameter:s}=e,{data:i,value:n,errorMessage:r}=s;if(!i.values||0===i.values.length)return null;const a=i.values.map((e=>({id:e,text:e}))),o=new T.DropdownSelection,c=i.values.findIndex((e=>e===n)),u=c>-1?c:0;o.select(u);const h=i.displayName||i.name,d=l.createElement("span",{className:"parameter-name"},i.displayName||i.name);return l.createElement(P.FormItem,{className:"flex-stretch flex-noshrink",label:d},l.createElement(N.Dropdown,{ariaLabel:h,items:a,onSelect:(e,s)=>{t({data:i,value:s.text||"",errorMessage:r})},selection:o,disabled:e.doNotAllowChanges}))},u=e=>{const{onValueChanged:t,templateParameter:s}=e,{data:i,value:n,errorMessage:r}=s;if(!i.values||0===i.values.length)return null;const a=n||i.default;return l.createElement(V.RadioButtonGroup,{className:"flex-noshrink radio-button-parameter",onSelect:e=>{t({data:i,value:e,errorMessage:r})},selectedButtonId:a,text:i.displayName||i.name},i.values.map(((t,s)=>l.createElement(V.RadioButton,{key:`radio-button-${i.name}-${s}`,id:t,text:t,disabled:e.doNotAllowChanges}))))},h=e=>{const{onValueChanged:t,templateParameter:s}=e,{data:i,value:n,errorMessage:r}=s;if(!i.values||0===i.values.length)return null;let o=[];try{o=JSON.parse(n)}catch(e){o=[]}const c=[{text:G.SelectAllLabel,id:"select_all_key"},...i.values.map((e=>({text:e,id:(0,a.format)("paramter.{0}",e)})))],[u]=l.useState(new T.DropdownMultiSelection);c.forEach(((e,t)=>{o.includes(e.text)&&u.select(t)}));const h=e=>e.value.some((e=>0===e.beginIndex));h(u)?c.length!==u.selectedCount&&u.unselect(0):c.length-1===u.selectedCount?u.select(0):u.unselect(0);l.useEffect((()=>{}),[n]);const d=l.createElement("span",{className:"parameter-name"},i.displayName||i.name);return l.createElement("div",{className:"flex-column"},l.createElement(P.FormItem,{className:"flex-stretch flex-noshrink",label:d},l.createElement(N.Dropdown,{disabled:e.doNotAllowChanges,ariaLabel:i.displayName,filterByText:!0,showFilterBox:c.length>10,items:c,selection:u,actions:[{className:"queue-panel-parameter-multi-option-action",text:G.ClearButtonLabel,iconProps:{iconName:"Cancel"},onClick:()=>{u.unselect(0,c.length),t({data:i,value:JSON.stringify([]),errorMessage:r})}}],onSelect:(e,s)=>{"select_all_key"==s.id&&(h(u)?u.select(0,c.length):u.unselect(0,c.length));const n=u.value.map((e=>c.slice(e.beginIndex,e.endIndex+1).filter((e=>"select_all_key"!=e.id)).map((e=>e.text)))).flat();t({data:i,value:JSON.stringify(n),errorMessage:r})},renderSelectedItems:(e,t)=>h(e)?(0,a.format)(G.AllOptionsSelected,i.values.length):(0,N.renderDropdownSelectedItemText)(e,t)})))}}("TemplateParametersView"),function(e){oe=t[e]={};const s="refs/heads/",i="refs/tags/";class r extends l.Component{constructor(e){super(e),this._branchSelected=e=>{const t=e.startsWith(s)?e:s+e;this.setState({refName:t,version:""})},this._branchSelectedForCommit=e=>{const t=e.startsWith(s)?e:s+e;this.setState({refName:t})},this._tagSelected=e=>{const t=e.startsWith(i)?e:i+e;this.setState({refName:t,version:""})},this._versionSelected=e=>{this.setState({version:e})},this._onFetchRepoError=e=>{this.setState({errorMessage:e})},this._update=()=>{const e=Object.assign({},this.state);this.props.onUpdate(e),this.props.onDismiss()};const t=Object.assign({},e.resource);this._initializeState(t),this.state=t}render(){const e=(0,a.format)(G.RepositoryResourcePanelDescription,this.sourceProvider.getName());return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:e,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:this.props.resource.name},footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:G.RepositoryResourceUpdateButtonText,primary:!0,disabled:!this._isDirty(),onClick:this._update}]},l.createElement("div",{className:"flex-column flex-grow padding-horizontal-20 rhythm-vertical-8"},this.state.errorMessage&&l.createElement(h.MessageCard,{severity:"Error"},this.state.errorMessage),this._getBranchControl()))}_initializeState(e){if(this._isTfsGit()&&!e.projectName&&!e.projectId){const t=this.props.resource.name.split("/");if(2===t.length)e.projectName=t[0],e.name=t[1];else{const t=this.props.pageContext.getService("ITfsPageService").getData();t&&t.project&&(e.projectName=t.project.name,e.projectId=t.project.id)}}}_isTfsGit(){return(0,a.equals)(this.props.resource.type,n.RepositoryTypes.TfsGit,!0)}_getBranchControl(){const e=this.state,t=this._isTfsGit()?G.TfsGitSourceSelectorDescription:G.GitSourceSelectorDescription;return l.createElement(O.BranchDropdown,{className:"flex-column label margin-bottom-16 flex-grow",ariaLabel:G.RepositoryResourceSourceLabel,label:G.RepositoryResourceSourceLabel,autoFocus:!0,repositoryType:e.type,repositoryId:this.state.name,projectId:e.projectId||e.projectName,defaultBranch:this._getFriendlyRefName(this.props.resource.refName),description:t,connectionId:e.connectionId,currentCommit:e.version,onBranchSelected:this._branchSelected,onBranchSelectedForCommit:this._branchSelectedForCommit,onError:this._onFetchRepoError,onVersionSelected:this._versionSelected,onTagSelected:this._tagSelected,viewCommits:!0,viewTags:!0,pageContext:this.props.pageContext,isDrodownFullWidth:!0,showBranchPickerOnCommitSelected:!0})}_getFriendlyRefName(e){return(e=e||"").startsWith(s)?e.substr(11):e.startsWith(i)?e.substr(10):e}_isDirty(){return this.state.refName!==this.props.resource.refName||this.state.version!==this.props.resource.version}get sourceProvider(){return this.props.pageContext.getService("ISourceProviderService").getSourceProvider(this.state.type)}}t[e].RepositoryResourcePanel=r}("RepositoryResourcePanel"),function(e){function s(e){return void 0!==e.refName}function i(e){return void 0!==e.buildType}function n(e){const t=e;return void 0!==t.containerType&&void 0!==t.properties}function r(e){return void 0!==e.packageType}function o(e){return e.startsWith(K.GitConstants.RefsHeadsPrefix)?[e.substr(K.GitConstants.RefsHeadsPrefix.length),"OpenSource"]:e.startsWith(K.GitConstants.RefsTagsPrefix)?[e.substr(K.GitConstants.RefsTagsPrefix.length),"Tag"]:e.startsWith(K.GitConstants.RefsPrefix)?[e.substr(K.GitConstants.RefsPrefix.length),"OpenSource"]:[e.substr(0,K.GitConstants.ShortenedCommitHashLength),"BranchCommit"]}le=t[e]={},t[e].isRepositoryResource=s,t[e].isBuildResource=i,t[e].isContainerResource=n,t[e].isPackageResource=r,t[e].renderResourceRow=function(e,t,n,r){let c,h,d,p;if(s(n)){c=n.alias.indexOf("://")>-1?n.name:(0,a.format)("{0} [{1}]",n.name,n.alias),d=function(e,t){return e.getService("ISourceProviderService").getSourceProvider(t.type)}(e,n).getRepoIconName(),[h,p]=o(n.version||n.refName)}else i(n)?(c=(0,a.format)("{0} [{1}]",n.name,n.alias),d="Build",h=n.versionName||G.BuildResourceLastRun,p=void 0):(c=(0,a.format)("{0} [{1}]",n.name,n.alias),d="Package",h=n.version||G.PipelineResourceLastRun,p=void 0);return l.createElement(u.ListItem,{key:"list-item"+t,index:t,details:r},l.createElement("div",{className:"queue-panel-list-row flex-grow flex-row"},l.createElement(x.Icon,{iconName:d,size:"medium",className:"queue-panel-list-icon margin-right-8"}),l.createElement("div",{className:"flex-column justify-center margin-left-4"},l.createElement("span",{className:"text-ellipsis primary-text"},c),l.createElement("span",{className:"flex-center flex-row font-size secondary-text text-ellipsis"},p&&l.createElement(x.Icon,{iconName:p,size:"small",className:"margin-right-4"}),l.createElement("span",null,h))),l.createElement("span",{className:"flex-grow flex-row justify-end"},l.createElement(x.Icon,{iconName:"ChevronRightMed",size:"medium"}))))},t[e].renderPipelineResourceRow=function(e,t,s,i){let n,r,c=(0,a.format)("{0} [{1}]",s.name,s.alias),h=s.version||G.PipelineResourceCannotDetermine,d="",p="",m=!1;return"branch"in s&&s.branch&&s.branch.length>0&&([d,p]=o(s.branch)),"version"in s&&s.version&&s.version.length>0&&(h=s.version,m=!0),"runBranch"in s&&s.runBranch&&s.runBranch.length>0&&([d,p]=o(s.runBranch)),"runResult"in s&&s.runResult&&(n=(0,ie.getStatusPropsForBuildResult)(s.runResult),r=s.runResult),l.createElement(u.ListItem,{key:"list-item"+t,index:t,details:i},l.createElement("div",{className:"queue-panel-list-row-new flex-grow flex-row margin-bottom-4"},n&&l.createElement(S.Status,Object.assign({},n,{key:r,size:"24",className:"flex-self-center margin-right-8"})),!n&&l.createElement(x.Icon,{iconName:"Package",size:"small",className:"queue-panel-list-icon package-icon-resource margin-right-8"}),l.createElement("div",{className:"flex-column justify-center margin-left-4"},l.createElement("span",{className:"text-ellipsis font-size secondary-text pipeline-resource-name",title:c},c),l.createElement("span",{className:"flex-center flex-row primary-text text-ellipsis padding-vertical-4"},l.createElement("span",{className:(0,A.css)(!m&&"pipeline-resource-cannot-determine","pipeline-resource-version"),title:h},h)),d&&d.length>0&&l.createElement("span",{className:"flex-center flex-row font-size secondary-text text-ellipsis pipeline-resource-branch"},l.createElement(x.Icon,{iconName:p,size:"small",className:"margin-right-4"}),l.createElement("span",{className:"pipeline-resource-branch-name",title:d},d))),l.createElement("span",{className:"flex-grow flex-row justify-end"},l.createElement(x.Icon,{iconName:"ChevronRightMed",size:"medium"}))))},t[e].editResource=function(e,t,a,o){const c=a.data,u=e.getService("IVssLayoutManager");s(c)?u.renderCallout((s=>l.createElement(oe.RepositoryResourcePanel,{pageContext:e,resource:c,onDismiss:s,onUpdate:t.updateRepositoryResource}))):n(c)?u.renderCallout((s=>l.createElement(X.ContainerResourcePanel,{pageContext:e,store:t,resource:c,onDismiss:s,onUpdate:t.updateContainerResource}))):i(c)?u.renderCallout((s=>l.createElement($.BuildResourcePanel,{pageContext:e,store:t,resource:c,onDismiss:s,onUpdate:t.updateBuildResource}))):r(c)?u.renderCallout((s=>l.createElement(se.PackageResourcePanel,{pageContext:e,store:t,resource:c,onDismiss:s,onUpdate:t.updatePackageResource}))):o?u.renderCallout((s=>l.createElement(re.PipelineResourcePanelV2,{pageContext:e,store:t,resource:c,onDismiss:s,onUpdate:t.updatePipelineResource}))):u.renderCallout((s=>l.createElement(ne.PipelineResourcePanel,{pageContext:e,store:t,resource:c,onDismiss:s,onUpdate:t.updatePipelineResource})))}}("HelpersResourcesPanelHelper"),function(e){ce=t[e]={};class s extends l.Component{constructor(e){super(e),this._onKeyDown=e=>{const t=this._getDuplicateValidationMessage(),s=!this._isValidVariableName()||""!==t;"Enter"!==e.key||e.defaultPrevented||s||(this._clickOk(),e.preventDefault())},this._isValidVariableName=()=>{const e=this.state.variable.name;return!!e&&""!==e.trim()},this._isUnchangedVariableValue=()=>!this.props.isNewVariable&&this._originalVariableValue===this.state.variable.value,this._getDuplicateValidationMessage=()=>{const e=this.state.variable,t=e.name?e.name.trim().toLocaleLowerCase():"";return this._getDuplicateVariableNamesMap()[t]>1?(0,a.format)(G.DuplicateVariableMessage,e.name):""},this._getDuplicateVariableNamesMap=()=>{let e={};if(!this.props.runtimeVariables)return e;return(this.props.isNewVariable?this.props.runtimeVariables.value.concat([this.state.variable]):this.props.runtimeVariables.value).forEach((t=>{if(t&&t.name){let s=t.name?t.name.trim().toLocaleLowerCase():"";e.hasOwnProperty(s)?e[s]++:e[s]=1}})),e},this._clickOk=()=>{this.props.isNewVariable&&this.props.onVariableAdded?this.props.onVariableAdded(this.state.variable):!this.props.isNewVariable&&this.props.onVariableUpdated&&this.props.onVariableUpdated(this.state.variable),this.props.onDismiss()},this._onNameChanged=(e,t)=>{this.state.variable.name=t,this.setState({variable:this.state.variable})},this._onValueChanged=(e,t)=>{this.state.variable.value=t,this.setState({variable:this.state.variable})},this.state={variable:this.props.variable},this._originalVariableValue=this.props.isNewVariable?void 0:this.props.variable.value}render(){const e=this.props.isNewVariable?G.AddVariablePanelTitle:G.UpdateVariablePanelTitle,t=this.props.isNewVariable?G.CreateButtonText:G.UpdateButtonText,s=this._getDuplicateValidationMessage(),n=!this._isValidVariableName()||""!==s,r=this.props.isNewVariable?".variable-panel-variable-name-input":".variable-panel-variable-value-input";return l.createElement(p.Panel,{backButtonProps:{subtle:!0,iconProps:{iconName:"Back"},ariaLabel:G.Back,onClick:this.props.onDismiss},onDismiss:this.props.onDismiss,escDismiss:!0,titleProps:{text:e},className:"variable-panel",defaultActiveElement:r,footerButtonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:t,primary:!0,onClick:this._clickOk,disabled:n||this._isUnchangedVariableValue()}]},l.createElement(i,{variable:this.props.variable,isNewVariable:this.props.isNewVariable,validationMessage:s,onNameChanged:this._onNameChanged,onValueChanged:this._onValueChanged,onKeyDown:this._onKeyDown}))}}t[e].VariablePanel=s;class i extends l.Component{constructor(e){super(e),this._getVariableNameControl=()=>l.createElement(P.FormItem,{className:"flex-grow margin-bottom-16",label:l.createElement(Z.FormInputLabel,{primaryLabel:G.NameFieldLabel,secondaryLabel:G.RequiredLabel}),error:""!==this.props.validationMessage,message:this.props.validationMessage},l.createElement(b.TextField,{ariaLabel:G.NameFieldLabel,ref:e=>{this._nameTextFieldRef=e},value:this.props.variable.name,inputClassName:"variable-panel-variable-name-input",onChange:this.props.onNameChanged,disabled:this.props.variable.disableDelete,required:!0})),this._getVariableValueControl=()=>{const e=this.props.variable,t=e.isSecret?"password":"text",s=e.isSecret&&null===e.value?this.c_secretVariableFillerText:e.value;return l.createElement(P.FormItem,{label:G.ValueFieldLabel,className:"flex-grow margin-bottom-8"},l.createElement(b.TextField,{value:s,inputClassName:"variable-panel-variable-value-input",ref:e=>{this._valueTextFieldRef=e},inputType:t,onChange:this.props.onValueChanged}))},this._getVariableSecretControl=()=>{const e=!!this.props.variable&&this.props.variable.isSecret;return l.createElement(B.Checkbox,{className:"no-h-padding",label:G.SecretFieldLabel,checked:e,disabled:!0})},this.c_secretVariableFillerText="*****",this.state={variable:this.props.variable}}render(){return l.createElement("div",{className:"variable-panel-content flex-grow",onKeyDown:this.props.onKeyDown},this._getVariableNameControl(),this._getVariableValueControl(),!this.props.isNewVariable&&this.props.variable&&this.props.variable.isSecret&&this._getVariableSecretControl())}componentDidMount(){this.props.isNewVariable?(this._nameTextFieldRef&&this._nameTextFieldRef.focus(),this._nameTextFieldRef&&this._nameTextFieldRef.select()):(this._valueTextFieldRef&&this._valueTextFieldRef.focus(),this._valueTextFieldRef&&this._valueTextFieldRef.select())}}}("VariablePanel"),function(e){ue=t[e]={};class s extends l.Component{constructor(e){super(e),this._listSelection=new u.ListSelection,this.c_hiddenAriaDivId="hiddenAriaDiv",this._onKeyDown=e=>{if("delete"===e.key.toLowerCase()&&this._listSelection.selectedCount>0){const t=this._listSelection.value[0].beginIndex;this._itemProvider.value[t].disableDelete||(this.props.store.deleteVariable(t),e.preventDefault())}},this._renderRow=(e,t,s)=>{const i=t.name?(0,a.format)(G.DeleteButtonTooltip,t.name):G.DeleteButtonEmptyTooltip,n=t.isSecret?I.VariableSecretMask:"= "+t.value,r=t.isSecret?"Lock":"Variable",o=(0,v.getSafeId)(this.c_hiddenAriaDivId);return l.createElement(u.ListItem,{key:"list-item"+e,index:e,details:s},l.createElement("div",{className:"queue-panel-list-row flex-grow flex-row"},l.createElement(x.Icon,{iconName:r,size:"medium",className:"queue-panel-list-icon margin-right-8"}),l.createElement("div",{className:"flex-column justify-center margin-left-4","aria-describedby":o},l.createElement("span",{className:"text-ellipsis primary-text","aria-label":t.name},t.name),l.createElement("span",{className:"font-size text-ellipsis secondary-text","aria-label":n},n),l.createElement("div",{id:o,className:"hidden"},G.ListItemRoleDescription)),l.createElement("span",{className:"flex-grow flex-row justify-end"},!t.disableDelete&&l.createElement("div",{className:"flex-column justify-center margin-right-16"},l.createElement(c.Button,{ariaLabel:i,className:"bolt-list-cell-content-reveal",iconProps:{iconName:"Delete"},onClick:t=>{this.props.store.deleteVariable(e),t.preventDefault()},subtle:!0,tooltipProps:{text:i}})),this.props.allowEditing&&l.createElement(x.Icon,{iconName:"ChevronRightMed",size:"medium"}),!this.props.allowEditing&&l.createElement(x.Icon,{className:"more-info-icon env-panel-info",iconName:"Info",tooltipProps:{text:G.NotEnoughPermissionsToEditQueueVariables},tabIndex:0}))))},this._createVariable=()=>{this._renderVariablePanel({},this.props.store.runtimeVariables.length,!0)},this._updateVariable=(e,t)=>{this._renderVariablePanel(Object.assign({},t.data),t.index,!1)},this._renderVariablePanel=(e,t,s)=>{this.props.pageContext.getService("IVssLayoutManager").renderCallout((i=>l.createElement(ce.VariablePanel,{isNewVariable:s,onDismiss:i,onVariableAdded:e=>this.props.store.addVariable(e),onVariableUpdated:e=>this.props.store.updateVariable(e,t),runtimeVariables:this.props.store.runtimeVariables,variable:e})))},this._itemProvider=this.props.store.runtimeVariables}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:this.props.pipelineName,escDismiss:!0,footerButtonProps:this.getFooterButtonProps(),onDismiss:this.props.onDismiss,titleProps:{text:G.VariablesTitle}},l.createElement("div",{className:"queue-panel-list-container"},l.createElement("div",{className:"flex-row scroll-auto",onKeyDown:this._onKeyDown},l.createElement(u.ScrollableList,{ariaLabel:G.VariablesTitle,itemProvider:this._itemProvider,renderRow:this._renderRow,width:"100%",singleClickActivation:!0,selection:this._listSelection,onActivate:this.props.allowEditing?this._updateVariable:void 0,outerClassName:"custom-scrollbar"})),l.createElement(d.Observer,{variables:this._itemProvider},(e=>0===e.variables.length?l.createElement("span",{className:"flex-row margin-vertical-8 padding-horizontal-20 primary-text"},this._renderEmptyVariableMessage()):null))))}_renderEmptyVariableMessage(){return this.props.enforceSettableVar?l.createElement(l.Fragment,null,l.createElement("label",{className:"margin-right-4"},G.EnforcedEmptyVariablesDescription),l.createElement(E.Link,{href:"https://aka.ms/AzPipelines/SettingVariablesAtQueueTime",ariaLabel:G.VariablesLearnMore},G.LearnMoreMessage)):l.createElement(l.Fragment,null,l.createElement("label",{className:"margin-right-4"},G.EmptyVariablesDescription),l.createElement(E.Link,{href:"https://go.microsoft.com/fwlink/?linkid=2087183",ariaLabel:G.VariablesLearnMore},G.LearnMoreMessage))}getFooterButtonProps(){const e=[{text:G.AddVariableButton,primary:!0,onClick:this._createVariable}];return this.props.enforceSettableVar?[]:e}}t[e].VariablesControllerView=s}("VariablesControllerView"),function(e){he=t[e]={};class s extends l.Component{constructor(e){super(e),this._changeAllItems=(e,t)=>{void 0===t&&(t=!1);for(let e=0;e<this._stageOptions.length;e++)this._changeStageAt(e,!t);this._updateSelectAllState()},this._renderRow=(e,t,s)=>{const i=(0,v.getSafeId)(this.c_hiddenAriaDivId),n=0===t.dependsOn.length?G.NoStageDependencies:(0,a.format)(G.DependsOn,t.dependsOn.join(", ")),r=t.isSkippable?n:(0,a.format)(G.CannotSkipState,n);return l.createElement(u.ListItem,{key:"list-item"+e,index:e,details:s},l.createElement("div",{className:"queue-panel-list-row flex-grow flex-row"},l.createElement("div",{className:"flex-column margin-right-8 justify-center"},l.createElement(B.Checkbox,{className:"no-h-padding",checked:!t.skip,disabled:!t.isSkippable})),l.createElement("div",{className:"flex-column justify-center margin-left-4","aria-describedby":i},l.createElement("span",{className:"text-ellipsis primary-text","aria-label":t.name},t.name),l.createElement("span",{className:"font-size text-ellipsis secondary-text"},r),l.createElement("div",{id:i,className:"hidden"},G.ListItemRoleDescription))))},this._getMessageCard=(e,t)=>l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{className:"multiline-error",severity:e},t)),this._initializeStageOptions=()=>{const e=this.props.store.stageOptions;0===e.length?(this._loadingStages.value=!0,this._stageOptions.removeAll(),this.props.store.fetchPipelineStages(this.props.isV2).then((e=>{this._copyStageOptions(e),this._loadingStages.value=!1}))):this._copyStageOptions(e.value)},this._changeStageAt=(e,t)=>{const s=this._stageOptions.value[e];s.isSkippable&&(s.skip=t,this._stageOptions.change(e,s))},this._updateSelectAllState=()=>{0==this._skippedStages.length?this._runAllStagesValue.value=!0:this._skippedStages.length==this._stageOptions.length?this._runAllStagesValue.value=!1:this._runAllStagesValue.value=void 0},this._onStageSelectionChanged=(e,t)=>{this._changeStageAt(e,t),this._updateSelectAllState()},this._submitStageSelection=()=>{this.props.store.updateStageOptions(this._stageOptions.value),this.props.onDismiss()},this.c_hiddenAriaDivId="hiddenAriaDiv",this._loadingStages=new r.ObservableValue(!1),this._stageOptions=new r.ObservableArray([]),this._runAllStagesValue=new r.ObservableValue(!0),this._initializeStageOptions()}render(){return l.createElement(p.CustomPanel,{onDismiss:this.props.onDismiss},l.createElement(p.PanelHeader,{backButtonProps:{onClick:this.props.onDismiss},titleProps:{text:G.StagesToRun},description:G.StagesToRunSecondaryText,onDismiss:this.props.onDismiss}),l.createElement(p.PanelContent,{className:"queue-panel-child no-padding"},l.createElement("div",{className:"queue-panel-list-container custom-scrollbar"},l.createElement(d.Observer,{loading:this._loadingStages},(e=>e.loading?l.createElement("div",null,l.createElement(g.Spinner,{className:"queue-build-spinner"})):this._displayStageOptions())))),l.createElement(d.Observer,{stages:this._stageOptions},(e=>l.createElement(p.PanelFooter,{buttonProps:[{text:G.CancelButtonText,onClick:this.props.onDismiss},{text:G.UseSelectedStages,primary:!0,disabled:e.stages.length<=1||this._skippedStages.length===e.stages.length,onClick:this._submitStageSelection}]}))))}_displayStageOptions(){return l.createElement(d.Observer,{errorMessage:this.props.store.errorMessage,stages:this._stageOptions},(e=>{const t=e.stages.length;return e.errorMessage?this._getMessageCard("Error",e.errorMessage):t>1?l.createElement(l.Fragment,null,l.createElement(B.TriStateCheckbox,{label:G.RunAllStages,className:"run-all-stages-checkbox",checked:this._runAllStagesValue,onChange:this._changeAllItems,triState:!0}),l.createElement("div",{className:"v-scroll-auto custom-scrollbar"},l.createElement(u.ScrollableList,{itemProvider:this._stageOptions,renderRow:this._renderRow,width:"100%",singleClickActivation:!0,onActivate:(e,t)=>this._onStageSelectionChanged(t.index,!t.data.skip)}),this._skippedStages.length>0&&this._getMessageCard("Warning",G.SkippedStagesWarning))):1===t?this._getMessageCard("Info",G.SingleStagePipeline):this._getMessageCard("Error",G.UnableToLoadStages)}))}_copyStageOptions(e){this._stageOptions.value=e.map((e=>Object.assign({},e)))}get _skippedStages(){return this._stageOptions.value.filter((e=>e.skip))}}t[e].StageOptionsControllerView=s}("StageOptionsControllerView"),function(e){de=t[e]={};class s extends l.Component{constructor(e){super(e),this._listSelection=new u.ListSelection,this._renderRow=(e,t,s)=>(0,le.renderResourceRow)(this.props.pageContext,e,t,s),this._editResource=(e,t)=>(0,le.editResource)(this.props.pageContext,this.props.store,t,this._enableNewUI),this._updateResources=()=>{const e=[];if(this.props.store.repositoryResources){const t=this.props.store.repositoryResources.value.filter((e=>!(0,a.equals)(e.alias,"self",!0)));e.push(...t)}if(this.props.store.pipelineResources&&this.props.renderAllResources){const t=this.props.store.pipelineResources.value;e.push(...t)}if(this.props.store.buildResources){const t=this.props.store.buildResources.value;e.push(...t)}if(this.props.store.containerResources){const t=this.props.store.containerResources.value;e.push(...t)}if(this.props.store.packageResources){const t=this.props.store.packageResources.value;e.push(...t)}this._resources.value=e},this._isLoading=new r.ObservableValue(!1),this._resources=new r.ObservableArray([]),this._retrieveResourcesEvenIfErrorsInParsingFF=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"Build2.AllowOverwritingResourcesWhenTemplatePermissionsAreMissing",!1),this._enableNewUI=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"Build2.NewQueueBuildPanel",!1)}componentDidMount(){this._initializeResources()}render(){return l.createElement(p.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"queue-panel-child no-padding",description:G.ResourcesDescriptionText,escDismiss:!0,footerButtonProps:[{text:G.CloseButtonLabel,onClick:this.props.onDismiss}],onDismiss:this.props.onDismiss,titleProps:{text:G.Resources}},l.createElement("div",{className:"queue-panel-list-container custom-scrollbar"},l.createElement(d.Observer,{loading:this._isLoading},(e=>e.loading?l.createElement("div",null,l.createElement(g.Spinner,{className:"queue-build-spinner"})):l.createElement(d.Observer,{errorMessage:this.props.store.errorMessage,resources:this._resources},(e=>this._retrieveResourcesEvenIfErrorsInParsingFF?l.createElement("div",null,e.errorMessage&&l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{className:"multiline-error",severity:"Error"},e.errorMessage)),e.resources.length>0?l.createElement(u.List,{itemProvider:this._resources,renderRow:this._renderRow,width:"100%",singleClickActivation:!0,selection:this._listSelection,onActivate:this._editResource,initialPageCount:10}):l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Info"},G.ResourcesNoResourcesText))):e.errorMessage?l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{className:"multiline-error",severity:"Error"},e.errorMessage)):e.resources.length>0?l.createElement(u.List,{itemProvider:this._resources,renderRow:this._renderRow,width:"100%",singleClickActivation:!0,selection:this._listSelection,onActivate:this._editResource,initialPageCount:10}):l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Info"},G.ResourcesNoResourcesText))))))))}async _initializeResources(){(this._retrieveResourcesEvenIfErrorsInParsingFF&&!this.props.store.resourcesWereFetched||!this._retrieveResourcesEvenIfErrorsInParsingFF&&!this.props.store.runParametersAreLoaded)&&(this._isLoading.value=!0,await this.props.store.fetchPipelineResources(!this.props.renderAllResources),this._isLoading.value=!1),this._updateResources(),this.props.store.repositoryResources&&this.props.store.repositoryResources.subscribe(this._updateResources),this.props.store.pipelineResources&&this.props.store.pipelineResources.subscribe(this._updateResources),this.props.store.buildResources&&this.props.store.buildResources.subscribe(this._updateResources),this.props.store.containerResources&&this.props.store.containerResources.subscribe(this._updateResources),this.props.store.packageResources&&this.props.store.packageResources.subscribe(this._updateResources)}}t[e].ResourcesControllerView=s}("ResourcesControllerView"),function(e){pe=t[e]={},t[e].renderAdvancedOptionRow=function(e,t,s,i){const n=e.selectable(t),r=n?s.secondaryText:G.DisabledDueToInvalidTemplateParametersMessage;return l.createElement(u.ListItem,{className:n?"cursor-pointer":"advanced-option-disabled",key:"list-item"+t,index:t,details:i},l.createElement("div",{className:"row-width flex-grow flex-row padding-horizontal-20"},l.createElement("div",{className:"text-width flex-column flex-grow padding-vertical-8"},l.createElement("span",{className:"primary-text"},s.primaryText),l.createElement("span",{className:"flex-row scroll-hidden flex-center font-size-ms secondary-text"},r)),l.createElement(x.Icon,{iconName:"ChevronRightMed",size:"medium"})))},t[e].registerStageAndResourcesAdvancedOptions=function(e,t,s,i,n,r,o,c,u=!1){const h=[];return h.push({component:ue.VariablesControllerView,primaryText:G.VariablesTitle,props:{pageContext:s,pipelineName:t.name,store:i,enforceSettableVar:c,allowEditing:o},requiresFullYamlParse:!1,secondaryText:l.createElement(d.Observer,{variables:i.runtimeVariables},(e=>l.createElement("span",null,0===e.variables.length?G.VariablesEmptySecondaryText:1===e.variables.length?G.VariablesOneSecondaryText:(0,a.format)(G.VariablesManySecondaryText,e.variables.length))))}),e&&!n&&r&&h.push({component:he.StageOptionsControllerView,primaryText:G.StagesToRun,props:{pageContext:s,store:i,pipelineId:t.id,isV2:u},requiresFullYamlParse:!0,secondaryText:l.createElement(d.Observer,{stageOptions:i.stageOptions},(e=>{const t=e.stageOptions.filter((e=>e.skip)).length,s=e.stageOptions.filter((e=>!e.skip)).map((e=>e.name));return l.createElement("span",null,0===t?G.StageOptionsRunAsConfigured:s.join(", "))}))}),e&&r&&(i.repositoryResources||i.pipelineResources||i.buildResources||i.containerResources||i.packageResources)&&h.push({component:de.ResourcesControllerView,primaryText:G.Resources,props:{pageContext:s,store:i,pipelineId:t.id,renderAllResources:!u},requiresFullYamlParse:!0,secondaryText:l.createElement(d.Observer,{repositoryResources:i.repositoryResources,pipelineResources:i.pipelineResources,buildResources:i.buildResources,containerResources:i.containerResources,packageResources:i.packageResources},(e=>{let t="";if(i.runParametersAreLoaded||i.resourcesWereFetched){const s=e.repositoryResources&&e.repositoryResources.filter((e=>!(0,a.equals)(e.alias,"self",!0))),i=e.pipelineResources,n=e.buildResources,r=e.containerResources,o=e.packageResources,l=s?1===s.length?G.ResourceCountRepository:(0,a.format)(G.ResourceCountRepostiories,s.length):"",c=i?1===i.length?G.ResourceCountPipelineRun:(0,a.format)(G.ResourceCountPipelineRuns,i.length):"",h=n?1===n.length?G.ResourceCountBuildRun:(0,a.format)(G.ResourceCountBuildRuns,n.length):"",d=r?1===r.length?G.ResourceCountContainerRun:(0,a.format)(G.ResourceCountContainerRuns,r.length):"",p=o?1===o.length?G.ResourceCountPackageRun:(0,a.format)(G.ResourceCountPackageRuns,o.length):"";t=u?(0,a.format)("{0}, {1}, {2}, {3}",l,h,d,p):l&&c&&h&&p?(0,a.format)("{0}, {1}, {2}, {3}, {4}",l,c,h,d,p):l||c||h||p||G.ResourcesUseLatestText}else t=G.ResourcesUseLatestText;return l.createElement(R.Tooltip,{overflowOnly:!0},l.createElement("span",{className:"text-ellipsis"},t))}))}),h},t[e].prepareResourcesForQueueBuild=function(e,t,s){const i=t.getModifiedRepositoryResources();let n;i.length>0&&(n={},i.forEach((e=>{n[e.alias]={refName:e.refName,version:e.version}})));const r=e?t.getModifiedOrDefinedPipelineResources():t.getModifiedPipelineResources();let a;r.length>0&&(a={},r.forEach((e=>{a[e.alias]=s?{runId:e.runId}:{version:e.version}})));const o=t.getModifiedBuildResources();let l;o.length>0&&(l={},o.forEach((e=>{l[e.alias]={version:e.version}})));const c=t.getModifiedContainerResources();let u;c.length>0&&(u={},c.forEach((e=>{u[e.alias]={version:e.version}})));const h=t.getModifiedPackageResources();let d;return h.length>0&&(d={},h.forEach((e=>{d[e.alias]={version:e.version}}))),{repositoryResources:n,pipelineResources:a,buildResources:l,containerResources:u,packageResources:d}},t[e].publishQueueBuildTelemetry=function(e,t,s){const i=e.getDemandsValues(),n=e.getVariables(),r={};r.variablesCount=n?n.length:0,r.customDemandsCount=i?i.length:0,r.buildDefinitionId=s,t.getService("IVssTelemetryService").publishEvent("Build","queueBuild",r)}}("HelpersQueuePanelHelper"),function(e){me=t[e]={};class s extends l.Component{constructor(e){super(e),this._resourcesToRenderInPanelSelection=new u.ListSelection,this._advancedOptionsItemProvider=new r.ObservableArray([]),this._advancedOptionsListSelection=new u.ListSelection,this._resourcesToRenderInPanelItemProvider=new r.ObservableArray([]),this._timerManagement=new y.TimerManagement,this._queueActionPending=new r.ObservableValue(!1),this._isLoading=new r.ObservableValue(!1),this._updateResources=()=>{const e=[];if(this.props.store.pipelineResources){const t=this.props.store.pipelineResources.value;e.push(...t)}this._resourcesToRenderInPanelItemProvider.value=e},this._registerAdvancedOptions=()=>{this._advancedOptionsItemProvider.value=(0,pe.registerStageAndResourcesAdvancedOptions)(!0,this.props.buildDefinition,this.props.pageContext,this.props.store,this.props.stageChooserDisabled,this.props.wasDefinitionPreviouslySaved,this.props.allowEditing,this.props.enforceSettableVar,!0)},this._renderAdvancedOptionRow=(e,t,s)=>(0,pe.renderAdvancedOptionRow)(this._advancedOptionsListSelection,e,t,s),this._renderResourceRow=(e,t,s)=>(0,le.renderPipelineResourceRow)(this.props.pageContext,e,t,s),this._clearSelectionsFromResources=(e,t)=>{this._advancedOptionsListSelection.clear()},this._editResource=(e,t)=>(0,le.editResource)(this.props.pageContext,this.props.store,t,!0),this._onAdvancedOptionSelected=(e,t)=>{this._resourcesToRenderInPanelSelection.clear();this.props.pageContext.getService("IVssLayoutManager").renderCallout((e=>l.createElement(t.data.component,Object.assign(Object.assign({},t.data.props),{onDismiss:e}))))}}componentDidMount(){this._initializeResources(),this._registerAdvancedOptions()}componentWillUnmount(){this._timerManagement.dispose()}render(){return l.createElement(d.Observer,{queueActionPending:this._queueActionPending,loading:this._isLoading},(e=>l.createElement(l.Fragment,null,e.loading&&l.createElement(g.Spinner,{className:"queue-build-spinner"}),!e.loading&&l.createElement("div",{className:"flex-grow"},this._renderPanel()),e.queueActionPending&&l.createElement(p.PanelOverlay,{overlayContent:l.createElement(g.Spinner,{label:G.StartingRun})}))))}_renderPanel(){return l.createElement("div",{className:"pipeline-resource-panel"},l.createElement(d.Observer,{resources:this._resourcesToRenderInPanelItemProvider},(e=>l.createElement("div",{className:"queue-panel-list-container custom-scrollbar padding-bottom-16"},l.createElement("h2",{className:"padding-horizontal-20 primary-text title-s"},G.PipelineResourcesLabel),0==e.resources.length&&l.createElement("span",{className:"no-pipeline-artifacts"},G.NoPipelineResources),e.resources.length>0&&l.createElement(u.List,{itemProvider:this._resourcesToRenderInPanelItemProvider,renderRow:this._renderResourceRow,width:"100%",singleClickActivation:!0,selection:this._resourcesToRenderInPanelSelection,onSelect:this._clearSelectionsFromResources,onActivate:this._editResource})))),l.createElement("h2",{className:"padding-horizontal-20 primary-text title-s"},G.AdvancedOptionsLabel),l.createElement(u.List,{ariaLabel:G.AdvancedOptionsLabel,itemProvider:this._advancedOptionsItemProvider,onSelect:this._onAdvancedOptionSelected,renderRow:this._renderAdvancedOptionRow,selection:this._advancedOptionsListSelection,width:"100%"}))}async _initializeResources(){this.props.store.resourcesWereFetched||(this._isLoading.value=!0,await this.props.store.fetchPipelineResources(!0),this._isLoading.value=!1),this._updateResources(),this.props.store.repositoryResources&&this.props.store.repositoryResources.subscribe(this._updateResources),this.props.store.pipelineResources&&this.props.store.pipelineResources.subscribe(this._updateResources),this.props.store.buildResources&&this.props.store.buildResources.subscribe(this._updateResources),this.props.store.containerResources&&this.props.store.containerResources.subscribe(this._updateResources),this.props.store.packageResources&&this.props.store.packageResources.subscribe(this._updateResources)}}t[e].QueuePanelResourcesPanel=s}("QueuePanelResourcesPanel"),function(e){t[e]={};const s="refs/heads/",i="refs/tags/";class m extends l.Component{constructor(e){super(e),this._advancedOptionsItemProvider=new r.ObservableArray([]),this._advancedOptionsListSelection=new u.ListSelection,this._showPanel=!1,this._showError=!1,this._errorMessage="",this._enableDiagnostic=!1,this._agentSpecificationServiceErrorMessage=new r.ObservableValue(""),this._agentSpecifications=new r.ObservableArray,this._isLoadingAgentSpecifications=new r.ObservableValue(!1),this._runButtonDisabled=new r.ObservableValue(!0),this._saveCommentText=new r.ObservableValue(""),this._queueActionPending=new r.ObservableValue(!1),this._isLoadingResources=new r.ObservableValue(!1),this._showLoadingResourcesError=new r.ObservableValue(!1),this._showResourcePanel=new r.ObservableValue(!1),this._timerManagement=new y.TimerManagement,this._pendingOverlayTimeoutId=0,this._isTfsGit=!1,this._commentTextFieldRef=l.createRef(),this._overflowing=!1,this._observingOverflow=!1,this._intersectionCallbackRegistered=!1,this._wasDefinitionPreviouslySaved=!1,this._stageChooserDisabled=!1,this._enforceSettableVar=!1,this._enableEditPipelineQueueConfigurationPermission=!1,this._enableNewPanel=!1,this._onTemplateParametersAreUpdated=()=>{this._queueBuildStore.templateParametersAreLoaded&&0==this._queueBuildStore.templateParameters.length&&(this._showResourcePanel.value=!0)},this._loadResourcesPanel=e=>{this._isLoadingResources.value=!0,this._queueBuildStore.resourcesWereFetched?(this._isLoadingResources.value=!1,this._showLoadingResourcesError.value=!1,this._showResourcePanel.value=!0):this._queueBuildStore.fetchPipelineResources(!0).then((()=>{this._isLoadingResources.value=!1,this._showLoadingResourcesError.value=!1,this._showResourcePanel.value=!0})).catch((e=>{this._isLoadingResources.value=!1,this._showLoadingResourcesError.value=!0}))},this._closeResourcePanel=e=>{this._showResourcePanel.value=!1},this._renderAdvancedOptionRow=(e,t,s)=>(0,pe.renderAdvancedOptionRow)(this._advancedOptionsListSelection,e,t,s),this._onFetchRepoError=e=>{this._showError=!0,this._errorMessage=e,this._messageSeverity="Error",this.setState(this._getState())},this._onSaveCommentChange=(e,t)=>{this._saveCommentText.value=t},this._branchSelectedV2=e=>{this._showResourcePanel.value=!1,this._branchSelected(e)},this._branchSelected=e=>{this._sourceVersionActionCreator.updateBranch(e)},this._branchSelectedForCommitV2=e=>{this._showResourcePanel.value=!1,this._queueBuildStore.updateBranchForCommit(e)},this._branchSelectedForCommit=e=>{this._queueBuildStore.updateBranchForCommit(e)},this._versionSelectedV2=e=>{this._showResourcePanel.value=!1,this._sourceVersionActionCreator.updateVersion(e)},this._versionSelected=e=>{this._sourceVersionActionCreator.updateVersion(e)},this._tagSelectedV2=e=>{this._showResourcePanel.value=!1,this._sourceVersionActionCreator.updateTag(e)},this._tagSelected=e=>{this._sourceVersionActionCreator.updateTag(e)},this._shelvesetSelected=e=>{this._sourceVersionActionCreator.updateShelveset(e)},this._dismissPanel=()=>{this._shortcutService.setShortcutsEnabled(!0),this._showPanel=!1,this.setState(this._getState()),this.props.onDismiss()},this._storeChanged=()=>{this._selectedAgentQueue=this._queueBuildStore.getSelectedQueue(),this._sourceVersion=this._queueBuildStore.getSourceVersion(),this._shelvesetName=this._queueBuildStore.getShelvesetName(),this._currentCommit=this._queueBuildStore.getSourceVersion(),this._enableDiagnostic=this._queueBuildStore.getEnableDiagnosticState(),this.setState(this._getState())},this._queueStoreChanged=()=>{this._queues=this._queueStore.getQueues()||[],this.setState(this._getState())},this._queueBuildV2=()=>{this._queueBuildImpl(!0)},this._queueBuild=()=>{this._queueBuildImpl(!1)},this._queueBuildImpl=e=>{this._shortcutService.setShortcutsEnabled(!0),this._pendingOverlayTimeoutId=this._timerManagement.setTimeout(this._showOverlay,250),this._runButtonDisabled.value=!0;let t=Promise.resolve(this._buildDefinition),s=!1;this.props.isSaveEnabled&&this.props.onSave&&(t=this.props.onSave(this._saveCommentText.value),s=!0);const i=this._queueBuildStore.getShelvesetName(),r=(0,o.isFeatureFlagEnabled)(this.props.pageContext,"DistributedTask.AllowResourcePipelineSelectionByRunId",!1),{repositoryResources:a,pipelineResources:l,buildResources:c,containerResources:u,packageResources:h}=(0,pe.prepareResourcesForQueueBuild)(e,this._queueBuildStore,r);t.then((e=>{const t=this._queueStore.getSelectedQueue(),r=t?t.id:-1,o={isYaml:this._isYamlBuildDefinition(),definitionId:this.props.definitionId,agentQueueId:r,ignoreWarnings:"Warning"===this.state.messageSeverity,projectId:this.props.projectId,pageContext:this.props.pageContext,variables:this._queueBuildStore.getRunTimeVariables(),serializedVariables:this._queueBuildStore.getSerializedVariables(),demands:this._queueBuildStore.getDemandsValues(),sourceBranch:i||this._queueBuildStore.getSourceBranch(),sourceVersion:this._queueBuildStore.getSourceVersion()||void 0,stagesToSkip:this._queueBuildStore.skippedStageNames,repositoryResources:a,pipelineResources:l,buildResources:c,containerResources:u,packageResources:h,templateParameters:this._queueBuildStore.getTemplateParametersDictionary(),agentSpecification:this._selectedAgentSpecification};s&&!i&&e&&e.repository&&e.repository.type.toLowerCase()===n.RepositoryTypes.TfsVersionControl.toLowerCase()&&(o.sourceBranch=e.repository.defaultBranch),this._actionCreator.queueBuild(o)})).catch((e=>{this._timerManagement.clearTimeout(this._pendingOverlayTimeoutId);let t="";e&&(t=e.message||e),this._showError=!0,this._errorMessage=t,this._messageSeverity="Error",this._queueActionPending.value=!1,this.setState(this._getState())}))},this._onSelectedQueueChanged=e=>{e&&(this._selectedAgentSpecification=void 0,this._queueActionCreator.selectQueue(e),this._updateAgentSpecifications(e))},this._onToggleEnableDiagnostic=(e,t)=>{this._enableDiagnosticActionCreator.toggleEnableDiagnostic(t)},this._onSelectedAgentSpecificationChanged=e=>{this._selectedAgentSpecification=e,this._agentSpecificationServiceErrorMessage.value="",this._runButtonDisabled.value=!1,this.setState(this._getState())},this._showOverlay=()=>{this._showPanel&&(this._queueActionPending.value=!0)},this._handleBuildQueued=e=>{(0,pe.publishQueueBuildTelemetry)(this._queueBuildStore,this.props.pageContext,this.props.definitionId),this._timerManagement.clearTimeout(this._pendingOverlayTimeoutId),e.buildId?this._onSuccess(e.buildId):(this._queueActionPending.value=!1,this._showError=!0,this._errorMessage=e.message||"",this._messageSeverity=e.messageSeverity||"Info",this._runButtonDisabled.value=!1,this.setState(this._getState()))},this._onSuccess=e=>{const t=this.props.pageContext.getService("IBuildLinkingService").getBuildUrl(e);(0,Q.onClickFPS)(this.props.pageContext,t,!0)},this._observeElement=e=>{e&&this._intersectionContext&&!this._observingOverflow&&(this._intersectionContext.observe(e),this._observedElement=e,this._observingOverflow=!0)},this._onIntersect=e=>{const t=e.find((e=>e.target===this._observedElement));if(t){const e=Math.round(t.rootBounds.bottom)<Math.round(t.boundingClientRect.bottom);e!==this._overflowing&&(this._overflowing=e,this.setState(this._getState()))}},this._registerAdvancedOptions=()=>{const e=this._isYamlBuildDefinition(),t=[];this._enableNewPanel&&e||t.push(...(0,pe.registerStageAndResourcesAdvancedOptions)(e,this._buildDefinition,this.props.pageContext,this._queueBuildStore,this._stageChooserDisabled,this._wasDefinitionPreviouslySaved,!this._enableEditPipelineQueueConfigurationPermission||this._security.canEditPipelineQueueConfiguration(this._buildDefinition),this._enforceSettableVar,!1)),e||t.push({component:te.DemandsControllerView,primaryText:G.DemandsTitle,props:{pageContext:this.props.pageContext,pipelineName:this._buildDefinition.name,store:this._queueBuildStore},requiresFullYamlParse:!1,secondaryText:l.createElement(d.Observer,{demands:this._queueBuildStore.demands},(e=>l.createElement("span",null,0===e.demands.length?G.DemandsEmptySecondaryText:1===e.demands.length?G.DemandsOneSecondaryText:(0,a.format)(G.DemandsManySecondaryText,e.demands.length))))}),this._advancedOptionsItemProvider.value=t,e&&this._queueBuildStore.templateParameters&&(this._onTemplateParametersValidityUpdate(this._queueBuildStore.templateParametersAreValid.value),this._queueBuildStore.templateParametersAreValid.subscribe(this._onTemplateParametersValidityUpdate))},this._onTemplateParametersValidityUpdate=e=>{if(e)this._advancedOptionsListSelection.clearUnselectable();else{const e=this._advancedOptionsItemProvider.value;for(let t=0;t<e.length;t++)e[t].requiresFullYamlParse&&this._advancedOptionsListSelection.addUnselectable(t)}},this._onAdvancedOptionSelected=(e,t)=>{this.props.pageContext.getService("IVssLayoutManager").renderCallout((e=>l.createElement(t.data.component,Object.assign(Object.assign({},t.data.props),{onDismiss:e}))))},this._getState=()=>({showPanel:this._showPanel,showError:this._showError,errorMessage:this._errorMessage,messageSeverity:this._messageSeverity,isRootPath:!1,queues:this._queues,selectedAgentQueue:this._selectedAgentQueue,sourceVersion:this._sourceVersion,shelvesetName:this._shelvesetName,currentCommit:this._currentCommit,agentSpecifications:this._agentSpecifications?this._agentSpecifications.value:[],selectedAgentSpecification:this._selectedAgentSpecification,isLoadingAgentSpecifications:!!this._isLoadingAgentSpecifications&&this._isLoadingAgentSpecifications.value,enableDiagnostic:this._enableDiagnostic,overflowing:this._overflowing}),this._enableEditPipelineQueueConfigurationPermission=(0,o.isFeatureFlagEnabled)(e.pageContext,"Build2.EditPipelineQueueConfigurationPermission",!1),this._enableNewPanel=(0,o.isFeatureFlagEnabled)(e.pageContext,"Build2.NewQueueBuildPanel",!1),this._permissions=new j.PermissionsStore({pageContext:e.pageContext}),this._security=new U.Security({projectId:e.projectId,store:this._permissions}),this._shortcutService=e.pageContext.getService("IVssKeyboardShortcutService"),this._showPanel=e.showPanel,this._wasDefinitionPreviouslySaved=this.props.definitionId>0,this.props.runtimeVariables&&this.props.runtimeVariables.length>0&&this.props.runtimeVariables.forEach((e=>{e.variable.disableDelete=void 0===e.variable.disableDelete||e.variable.disableDelete})),this._isTfsGit=!(!this.props.buildRepository||!this.props.buildRepository.type||this.props.buildRepository.type.toLowerCase()!==n.RepositoryTypes.TfsGit.toLowerCase()),this._actionHub=new Y.QueueBuildActionHub,this._actionCreator=new Y.QueueBuildActionCreator({actionHub:this._actionHub});let t=(0,F.getSingletonManager)().get(k.QueueStore.key);t?this._queues=t.getQueues():(this._queueActionHub=new k.QueueActionHub,t=new k.QueueStore({pageContext:e.pageContext,project:e.projectId,actionHub:this._queueActionHub}),(0,F.getSingletonManager)().add(k.QueueStore.key,t)),this._queueStore=t,this._queueActionHub=t.getActionHub(),this._queueActionCreator=new k.QueueActionCreator({actionHub:this._queueActionHub,source:new M.QueueSource({pageContext:this.props.pageContext,project:this.props.projectId})});let s=(0,F.getSingletonManager)().get(J.QueueBuildStore.key);s?(this._sourceVersionActionHub=s.getSourceControlSelectorActionHub(),this._shelvesetPickerActionHub=s.getShelvesetPickerActionHub(),this._enableDiagnosticActionHub=s.getEnableDiagnosticActionHub(),e.buildDefinition?s.updateBuildDefinition(e.buildDefinition,e.runtimeVariables,void 0,e.previousTemplateParameters):s.updateDefinition(e.definitionId,e.runtimeVariables,e.sourceBranch,!1,e.buildRepository,e.definitionVariables,e.previousTemplateParameters)):(this._sourceVersionActionHub=new Y.SourceVersionActionHub,this._shelvesetPickerActionHub=new L.ShelvesetPickerActionHub,this._enableDiagnosticActionHub=new Y.EnableDiagnosticActionHub,s=new J.QueueBuildStore({pageContext:e.pageContext,projectId:e.projectId,definitionId:e.definitionId,buildDefinition:e.buildDefinition,sourceBranch:e.sourceBranch,runtimeVariables:this.props.runtimeVariables,previousTemplateParameters:this.props.previousTemplateParameters||{},definitionVariables:this.props.definitionVariables,sourceVersionActionHub:this._sourceVersionActionHub,shelvesetPickerActiobHub:this._shelvesetPickerActionHub,enableDiagnosticActionHub:this._enableDiagnosticActionHub,queueActionHub:this._queueActionHub,buildRepository:e.buildRepository}),(0,F.getSingletonManager)().add(J.QueueBuildStore.key,s)),this._queueBuildStore=s,this._sourceVersionActionCreator=new Y.SourceVersionActionCreator({actionHub:this._sourceVersionActionHub}),this._enableDiagnosticActionCreator=new Y.EnableDiagnosticActionCreator({actionHub:this._enableDiagnosticActionHub}),this.state=this._getState(),this._queueBuildStore.fetchDemands(),Promise.all([this._setupAgentSpecifications(),this._setupOrgSettings(),this._setupProjectSettings()]).then((()=>this._registerAdvancedOptions()))}componentDidMount(){this._actionHub.buildQueued.addListener(this._handleBuildQueued),this._queueStore.addListener(this._queueStoreChanged),this._queueBuildStore.addListener(this._storeChanged),this._queueBuildStore.templateParameters.subscribe(this._onTemplateParametersAreUpdated)}componentWillUnmount(){this._actionHub.buildQueued.removeListener(this._handleBuildQueued),this._queueStore.removeListener(this._queueStoreChanged),this._queueBuildStore.removeListener(this._storeChanged),this._queueBuildStore.templateParameters.unsubscribe(this._onTemplateParametersAreUpdated),this._timerManagement.dispose(),this._intersectionContext&&this._intersectionContext.unregister(this._onIntersect)}componentDidUpdate(){this._intersectionContext&&!this._intersectionCallbackRegistered&&(this._intersectionContext.register(this._onIntersect),this._intersectionCallbackRegistered=!0),this.props.isSaveEnabled&&this._commentTextFieldRef&&this._commentTextFieldRef.current&&this._commentTextFieldRef.current.focus()}render(){const e=this._isYamlBuildDefinition(),t=!this._buildDefinition,s=this._getRunButtonText(),i=[],n=e&&!!this._queueBuildStore.templateParameters&&this._wasDefinitionPreviouslySaved,r=this._enableNewPanel&&e,a=r||this._enableNewPanel&&t;return i.push({id:"queue-panel-close-button",onActivate:this._dismissPanel,ariaLabel:G.CloseButtonLabel,iconProps:{iconName:"Cancel"},subtle:!0,role:"button"}),this._shortcutService.setShortcutsEnabled(!1),l.createElement(d.Observer,{isPanelOpen:this._showPanel,queueActionPending:this._queueActionPending,showResourcePanel:this._showResourcePanel},(o=>o.isPanelOpen?l.createElement(p.CustomPanel,{className:"queue-panel flex-column h-scroll-hidden",lightDismiss:!o.queueActionPending,onDismiss:this._dismissPanel},a&&l.createElement(p.PanelHeader,{description:G.QueuePanelDescription,onDismiss:this.props.onDismiss,showSeparator:!1,titleProps:{id:"run-pipeline",text:G.QueuePanelTitleNoDefinition}}),!a&&l.createElement(H.Header,{className:"bolt-panel-header title-m",commandBarItems:i,title:G.QueuePanelTitleNoDefinition,description:G.QueuePanelDescription}),l.createElement(p.PanelContent,null,l.createElement(z.Intersection,null,l.createElement("div",{className:(0,v.css)(this.state.overflowing&&"bottom-border","custom-scrollbar flex-column flex-grow v-scroll-auto")},l.createElement(z.IntersectionContext.Consumer,null,(s=>(this._intersectionContext=s,l.createElement("div",{className:"flex-column flex-grow",ref:e=>this._observeElement(e)},l.createElement(d.Observer,{storeError:this._queueBuildStore.errorMessage},(e=>e.storeError?l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:"Error"},l.createElement("span",{className:"multiline-error"},e.storeError))):null)),this.state.showError&&l.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},l.createElement(h.MessageCard,{severity:this.state.messageSeverity},l.createElement("span",{className:"multiline-error"},this.state.errorMessage))),o.isPanelOpen&&!t&&!r&&this._renderPanelV1(e,n),o.isPanelOpen&&!t&&r&&this._renderPanelV2(n,o.showResourcePanel),t&&o.isPanelOpen&&l.createElement(g.Spinner,{className:"queue-build-spinner"})))))))),a&&o.showResourcePanel&&l.createElement(B.Checkbox,{label:G.RunWithDiagnostics,className:"margin-horizontal-20",onChange:this._onToggleEnableDiagnostic,checked:this.state.enableDiagnostic}),l.createElement(p.PanelFooter,{className:(0,v.css)(a?"flex-row flex-end":"flex-row")},!a&&l.createElement(B.Checkbox,{label:G.RunWithDiagnostics,className:"flex-grow margin-right-8",onChange:this._onToggleEnableDiagnostic,checked:this.state.enableDiagnostic}),r&&l.createElement(d.Observer,{isloadingResources:this._isLoadingResources,showLoadingResourcesError:this._showLoadingResourcesError},(e=>l.createElement(l.Fragment,null,e.isloadingResources||e.showLoadingResourcesError?l.createElement(l.Fragment,null,e.isloadingResources&&l.createElement(g.Spinner,{className:"flex-row loading-resources-spinner",label:G.NewQueueBuildPanelValidatingResources}),e.showLoadingResourcesError&&l.createElement(h.MessageCard,{severity:"Error"},l.createElement("span",{className:"multiline-error"},G.NewQueueBuildPanelErrorWhileValidatingResources))):null))),l.createElement(d.Observer,{runButtonDisabled:this._runButtonDisabled,templateParametersAreValid:this._queueBuildStore.templateParametersAreValid,allowSkippingResourcePanel:this._queueBuildStore.allowSkippingResourcePanel},(e=>l.createElement(l.Fragment,null,a&&this._renderPanelV2Buttons(e.runButtonDisabled,e.templateParametersAreValid,e.allowSkippingResourcePanel,o.showResourcePanel,n),!a&&l.createElement(D.ButtonGroup,{className:"bolt-panel-footer-buttons flex-grow"},l.createElement(c.Button,{text:G.CancelButtonText,onClick:this._dismissPanel}),l.createElement(c.Button,{text:s,primary:!0,onClick:this._queueBuild,disabled:e.runButtonDisabled||n&&!e.templateParametersAreValid})))))),o.queueActionPending&&l.createElement(p.PanelOverlay,{overlayContent:l.createElement(g.Spinner,{label:G.StartingRun})})):null))}_renderPanelV2Buttons(e,t,s,i,n){const r=this._queueBuildStore.templateParameters&&this._queueBuildStore.templateParameters.length>0;return this._queueBuildStore.templateParametersAreLoaded?r?i?l.createElement(D.ButtonGroup,{className:"flex-grow bolt-panel-footer-buttons"},l.createElement(c.Button,{text:G.NewQueueBuildPanelBackParametersButtonText,onClick:this._closeResourcePanel}),l.createElement(c.Button,{text:G.QueueButtonText,primary:!0,disabled:e,onClick:this._queueBuildV2})):l.createElement(d.Observer,{isLoadingResources:this._isLoadingResources},(i=>l.createElement(D.ButtonGroup,{className:"flex-grow bolt-panel-footer-buttons"},l.createElement(c.Button,{text:G.CancelButtonText,onClick:this._dismissPanel}),s&&l.createElement(W.SplitButton,{primary:!0,disabled:e||n&&!t,key:"queue-build-button",className:"queue-build-button",buttonProps:{text:G.NewQueueBuildPanelNextResourcesButtonText,onClick:this._loadResourcesPanel,id:"queuebuild-verify-resources",role:"menuitem"},menuButtonProps:{subtle:!0,iconProps:{iconName:"ChevronDown"},role:"menuitem",contextualMenuProps:{menuProps:{id:"queuebuild-menu",items:[{id:"queuebuild-without-resources",onActivate:this._queueBuild,text:G.QueuePanelTitleNoDefinition}]}}}}),!s&&l.createElement(c.Button,{text:G.NewQueueBuildPanelNextResourcesButtonText,primary:!0,onClick:this._loadResourcesPanel,disabled:e||n&&!t||i.isLoadingResources,key:"queuebuild-verify-resources",className:"queuebuild-resources"})))):l.createElement(d.Observer,{pipelineResourcesWereFetched:this._queueBuildStore.resourcesWereFetchedObservable},(t=>l.createElement(D.ButtonGroup,{className:"flex-grow bolt-panel-footer-buttons"},l.createElement(c.Button,{text:G.CancelButtonText,onClick:this._dismissPanel}),l.createElement(c.Button,{text:G.QueueButtonText,primary:!0,disabled:e||!t.pipelineResourcesWereFetched,onClick:this._queueBuild})))):l.createElement(l.Fragment,null)}_renderPanelV1(e,t){return l.createElement(l.Fragment,null,l.createElement("div",{className:"padding-horizontal-20"},!e&&l.createElement(l.Fragment,null,this._getSaveCommentContent(),this._getAgentPools()),this._getBranchControl(!1)),l.createElement("div",{className:"flex-column rhythm-vertical-16"},t&&l.createElement(ae.TemplateParametersView,{allowEditing:!this._enableEditPipelineQueueConfigurationPermission||this._security.canEditPipelineQueueConfiguration(this._buildDefinition),className:"padding-horizontal-20",store:this._queueBuildStore,addTitle:!1,doNotAllowChanges:!1,isV2:!1}),l.createElement("h2",{className:"padding-horizontal-20 primary-text title-s margin-vertical-0"},G.AdvancedOptionsLabel),l.createElement(u.List,{ariaLabel:G.AdvancedOptionsLabel,itemProvider:this._advancedOptionsItemProvider,onSelect:this._onAdvancedOptionSelected,renderRow:this._renderAdvancedOptionRow,selection:this._advancedOptionsListSelection,width:"100%"})))}_renderPanelV2(e,t){const s=this._queueBuildStore.templateParameters&&this._queueBuildStore.templateParameters.length>0;return l.createElement(l.Fragment,null,l.createElement("div",{className:"padding-horizontal-20"},(!t||!s)&&this._getBranchControl(!0)),l.createElement("div",{className:"flex-column rhythm-vertical-16"},t&&l.createElement(me.QueuePanelResourcesPanel,{pageContext:this.props.pageContext,store:this._queueBuildStore,buildDefinition:this._buildDefinition,onDismiss:this._dismissPanel,stageChooserDisabled:this._stageChooserDisabled,wasDefinitionPreviouslySaved:this._wasDefinitionPreviouslySaved,enforceSettableVar:this._enforceSettableVar,allowEditing:!this._enableEditPipelineQueueConfigurationPermission||this._security.canEditPipelineQueueConfiguration(this._buildDefinition)}),!t&&e&&l.createElement(d.Observer,{isloadingResources:this._isLoadingResources},(e=>l.createElement(ae.TemplateParametersView,{allowEditing:!this._enableEditPipelineQueueConfigurationPermission||this._security.canEditPipelineQueueConfiguration(this._buildDefinition),className:"padding-horizontal-20 template-parameters",store:this._queueBuildStore,addTitle:!0,doNotAllowChanges:e.isloadingResources,isV2:!0}))),!t&&this._advancedOptionsItemProvider.value.length>0&&l.createElement(l.Fragment,null,l.createElement("h2",{className:"padding-horizontal-20 primary-text title-s margin-vertical-0"},G.AdvancedOptionsLabel),l.createElement(u.List,{ariaLabel:G.AdvancedOptionsLabel,itemProvider:this._advancedOptionsItemProvider,onSelect:this._onAdvancedOptionSelected,renderRow:this._renderAdvancedOptionRow,selection:this._advancedOptionsListSelection,width:"100%"}))))}async _setupAgentSpecifications(){return this._agentSpecificationService=this.props.pageContext.getService("IAgentSpecificationService"),this._queueBuildStore.fetchBuildDefinition().then((e=>{this._buildDefinition=e;const t=e.queue;if(t&&e.project&&(this._selectedAgentQueue={id:t.id,name:t.name,pool:t.pool,projectId:e.project.id}),this._queueActionCreator.selectQueue(this._selectedAgentQueue),!this._isYamlBuildDefinition()){this._updateAgentSpecifications(this._selectedAgentQueue);const t=e.process;t&&t.target&&t.target.agentSpecification&&(this._selectedAgentSpecification=t.target.agentSpecification)}this._runButtonDisabled.value=!1,this.setState(this._getState())})).catch((e=>{e&&e.message&&(this._errorMessage=e.message,this._showError=!0,this.setState(this._getState()))}))}async _setupOrgSettings(){return this._queueBuildStore.fetchOrgSettings().then((e=>{e&&(this._stageChooserDisabled=e.disableStageChooser)}))}async _setupProjectSettings(){return this._queueBuildStore.fetchProjSettings().then((e=>{e&&(this._enforceSettableVar=e.enforceSettableVar.enabled)}))}_isYamlBuildDefinition(){return!(!this._buildDefinition||!this._buildDefinition.process)&&this._buildDefinition.process.type===m.YamlProcessType}_updateAgentSpecifications(e){this._isLoadingAgentSpecifications.value=!0,this._runButtonDisabled.value=!0,this.setState(this._getState()),this._agentSpecificationService.getAgentSpecificationsByQueue(e).then((e=>{this._agentSpecificationServiceErrorMessage.value="",this._agentSpecifications.removeAll(),e&&e.length>0&&(this._agentSpecifications.push(...e),this._selectedAgentSpecification||(this._agentSpecificationServiceErrorMessage.value=G.AgentSpecificationRequired)),this._runButtonDisabled.value=!!this._agentSpecificationServiceErrorMessage.value})).catch((e=>{this._agentSpecifications.removeAll(),e&&e.message&&(this._agentSpecificationServiceErrorMessage.value=e.message)})).then((()=>{this._isLoadingAgentSpecifications.value=!1,this.setState(this._getState())}))}_getSaveCommentContent(){return this.props.isSaveEnabled?l.createElement(l.Fragment,null,l.createElement("div",{className:"flex-column"},l.createElement("label",{className:"label"},G.SaveComment),l.createElement(b.TextField,{ariaLabel:G.SaveComment,value:this._saveCommentText,onChange:this._onSaveCommentChange,ref:this._commentTextFieldRef})),l.createElement("hr",null)):null}_getAgentPools(){return l.createElement(d.Observer,{agentSpecifications:this._agentSpecifications,errorMessage:this._agentSpecificationServiceErrorMessage,isLoading:this._isLoadingAgentSpecifications},(e=>l.createElement(q.AgentQueueSelector,{agentSpecifications:[...e.agentSpecifications],autoFocus:!this.props.isSaveEnabled,isLoadingAgentSpecifications:e.isLoading,selectedAgentSpecification:this.state.selectedAgentSpecification,onAgentSpecificationSelected:this._onSelectedAgentSpecificationChanged,agentSpecificationErrorMessage:e.errorMessage,label:G.AgentPool,agentQueues:this.state.queues,selectedQueue:this._selectedAgentQueue,onAgentChanged:this._onSelectedQueueChanged})))}_getBranchControl(e){const t=this._buildDefinition?this._buildDefinition.repository:void 0,s=t&&t.properties&&t.properties.connectedServiceId||"",i=e?G.BranchLabelNew:this.props.buildRepository.type===n.RepositoryTypes.TfsVersionControl?G.SourceVersionLabel:G.BranchLabel,r=this.state.sourceVersion,a=!!this._buildDefinition&&this._buildDefinition.process.type===m.YamlProcessType,o=e&&this._normalizeBranchName(this._queueBuildStore.getSourceBranch())||this._normalizeBranchName(this.props.sourceBranch),c=e?G.SourceSelectorDescription:this._isTfsGit?G.TfsGitSourceSelectorDescription:G.GitSourceSelectorDescription;return l.createElement("div",{className:(0,v.css)(e&&"margin-bottom-16")},e&&l.createElement("h2",{className:"title-s primary-text"},G.QueuePanelBranchPickerTitle),l.createElement(O.BranchDropdown,{className:(0,v.css)("flex-column label",e&&"new-queue-build-panel-branch-dropdown",!e&&"margin-bottom-16"),ariaLabel:i,label:i,autoFocus:a&&!this.props.isSaveEnabled,repositoryType:this.props.buildRepository.type,repositoryId:this.props.buildRepository.id,defaultBranch:o,description:c,connectionId:s,sourceVersion:r,shelvesetName:this.state.shelvesetName,currentCommit:this.state.currentCommit,onBranchSelected:e?this._branchSelectedV2:this._branchSelected,onBranchSelectedForCommit:e?this._branchSelectedForCommitV2:this._branchSelectedForCommit,onError:this._onFetchRepoError,onVersionSelected:e?this._versionSelectedV2:this._versionSelected,onTagSelected:e?this._tagSelectedV2:this._tagSelected,onShelvesetSelected:this._shelvesetSelected,viewCommits:!0,viewTags:!0,pageContext:this.props.pageContext,actionHub:this._shelvesetPickerActionHub,isDrodownFullWidth:!0,showBranchPickerOnCommitSelected:!0,dropdownMinHeight:29}))}_getRunButtonText(){return this.props.isSaveEnabled?"Warning"!==this.state.messageSeverity?G.SaveAndQueueButtonText:G.SaveAndRunWithWarningsButtonText:"Warning"!==this.state.messageSeverity?G.QueueButtonText:G.RunWithWarningsButtonText}_normalizeBranchName(e){return e&&e.startsWith(s)?e.substr(11):e&&e.startsWith(i)?e.substr(10):e||""}}t[e].QueuePanel=m,m.YamlProcessType=2}("QueuePanel")}),["Resources","Action","Constants","Stores/QueueBuild","BuildResourcePanel","ContainerResourcePanel","FormInputLabel","DemandPanel","DemandsControllerView","PackageResourcePanel","Helpers/PipelineResourcePanelHelper","PipelineResourcePanel","PipelineResourcePanelV2","TemplateParametersView","RepositoryResourcePanel","Helpers/ResourcesPanelHelper","VariablePanel","VariablesControllerView","StageOptionsControllerView","ResourcesControllerView","Helpers/QueuePanelHelper","QueuePanelResourcesPanel","QueuePanel"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.queue-panel"}}));