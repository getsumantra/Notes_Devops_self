"use strict";define("Build/Settings",["require","exports","Build/Flux/Sources/Contribution","Tfs/Platform/Page","VSS/Core/Observable","VSS/Platform/Context","VSS/Platform/Telemetry","Build/Flux/Store","react","Build/SettingsToggle/SettingsToggle","VSS/Platform/Layout","VSS/Platform/Components/Format","VSSUI/Observer","VSSUI/Spinner","VSS/Platform/Feature","VSSUI/Checkbox","VSSUI/RadioButton","Build/Common/Library/PipelineTriggerSettings","VSS/Core/Util/String","VSS/Platform/Components/ErrorBoundary","VSSUI/MessageCard","VSSUI/FormItem","VSSUI/Icon","VSSUI/Link","VSSUI/TextField","VSSUI/Card","VSSUI/Header"],(function(e,t,i,s,n,r,o,a,l,c,g,d,u,p,h,b,m,S,P,R,f,v,C,T,E,k,_){var A,F,O,q,w,y;A=t[y="Resources"]={},t[y].BadgesArePrivate="Disable anonymous access to badges",t[y].BadgesArePrivateToolTip="Anonymous users can access the status badge API for all pipelines unless this option is enabled.",t[y].DaysToKeepArtifacts="Days to keep artifacts, symbols and attachments",t[y].DaysToKeepPullRequestRuns="Days to keep pull request runs",t[y].DaysToKeepRuns="Days to keep runs",t[y].DisableClassicPipelineCreation="Disable creation of classic build and classic release pipelines",t[y].DisableClassicPipelineCreationToolTip="When this is enabled, users will not be able to create / import classic pipelines, classic release pipelines, task groups, and deployment groups. Existing classic (release) pipelines, task groups, and deployment groups will continue to work.",t[y].DisableClassicBuildPipelineCreation="Disable creation of classic build pipelines",t[y].DisableClassicBuildPipelineCreationToolTip="No classic build pipelines can be created / imported. Existing ones will continue to work.",t[y].DisableClassicReleasePipelineCreation="Disable creation of classic release pipelines",t[y].DisableClassicReleasePipelineCreationToolTip="No classic release pipelines, task groups, and deployment groups can be created / imported. Existing ones will continue to work.",t[y].ForkProtectionEnabled="Limit building pull requests from forked GitHub repositories",t[y].ForkProtectionEnabledTooltip="Configure how to build pull requests from forked repositories.",t[y].ForkProtectionEnabledToggleHighRiskTitle="Turn on the setting or select recommended configuration to improve security.",t[y].DisableBuildsInPullRequestsFromForkedRepositories="Disable building pull requests from forked repositories",t[y].DisableBuildsInPullRequestsFromForkedRepositoriesTooltip="No pipeline will build pull requests from forked repositories.",t[y].SecurelyBuildPullRequestsFromForkedRepositories="Securely build pull requests from forked repositories",t[y].SecurelyBuildPullRequestsFromForkedRepositoriesTooltip="Following security best practices, builds of pull requests from forked repositories do not have access to secrets or have the same permissions as regular builds. All pull requests require a team member's comment before building.",t[y].CustomizeRulesOfBuildingPullRequestsFromForkedRepositories="Customize rules for building pull requests from forked repositories",t[y].EnforceNoAccessToSecretsFromForks="Prevent pipelines from making secrets available to fork builds.",t[y].EnforceJobAuthScopeForForks="Prevent pipelines from making fork builds have the same permissions as regular builds.",t[y].IsCommentRequiredForPullRequest="Require a team member's comment before building a pull request.",t[y].RequireCommentsForAllPullRequests="On all pull requests",t[y].RequireCommentsForNonTeamMembersOnly="Only on pull requests from non-team members",t[y].RequireCommentsForNonTeamMemberAndNonContributors="Only on pull requests from non-team members and contributors",t[y].EnforceJobAuthScope="Limit job authorization scope to current project for non-release pipelines",t[y].EnforceJobAuthScopeForReleases="Limit job authorization scope to current project for release pipelines",t[y].EnforceJobAuthScopeToolTip="Non-Release Pipelines can run with collection scoped access tokens unless this option is enabled. With this option enabled, you can reduce the scope of access for all non-release pipelines to the current project.",t[y].EnforceJobAuthScopeForReleasesToolTip="Release pipelines can run with collection scoped access tokens unless this option is enabled. With this option enabled, you can reduce the scope of access for all release pipelines to the current project.",t[y].EnforceReferencedRepoScopedToken="Protect access to repositories in YAML pipelines",t[y].EnforceReferencedRepoScopedTokenToolTip="Apply checks and approvals when accessing repositories from YAML pipelines. Also, generate a job access token that is scoped to repositories that are explicitly referenced in the YAML pipeline.",t[y].EnforceVariable="Limit variables that can be set at queue time",t[y].EnforceVariableToolTip='You can set any variables at queue time unless this option is enabled. With this option enabled, only those variables that are explicitly marked as "Settable at queue time" can be set.',t[y].EvaluateArtifactTooltip="Evaluate artifact",t[y].General="General",t[y].LearnMore="Learn more about run retention",t[y].LoadingText="Loading...",t[y].NumberOfRecentRunsPerPipeline="Number of recent runs to retain per pipeline",t[y].PurgeArtifactsSettingIgnored="The artifacts, symbols and attachments retention setting is being ignored because the runs retention setting is evaluated first.",t[y].RequiredValueRangeError="Enter a value between {0} and {1}",t[y].RetentionPolicy="Retention policy",t[y].RunsPerPipelineMoreInfo="This many runs will also be retained per protected branch and default pipeline branch. (Azure Repos only)",t[y].Settings="Settings",t[y].Triggers="Triggers",t[y].SettingEnforcedOrgLevel="This setting cannot be changed as it is enforced at the organization level.",t[y].PublishPipelineMetadata="Publish metadata from pipelines (preview)",t[y].PublishPipelineMetadataTooltip="Allows pipelines to record metadata. {0} check can be configured to define policies using the metadata recorded.",t[y].RetentionPolicyNoPermissions="Access to the pipeline retention policy settings is restricted to administrators and those with the view build resources permission.",t[y].EnableShellTasksArgsSanitizing="Enable shell tasks arguments validation",t[y].EnableShellTasksArgsSanitizingToolTip="When this is enabled, argument parameters for built-in shell tasks are validated to check for inputs that can inject commands into scripts.",t[y].ShellTasksArgsValidationPreviewToolTip="You can preview impact on scripts before preventing shell tasks from being executed.",t[y].ShellTasksArgsValidationPreviewOn="Preview On",t[y].ShellTasksArgsValidationPreviewOff="Preview Off",t[y].DisableImpliedYAMLCiTriggerTitle="Disable implied YAML CI trigger",t[y].DisableImpliedYAMLCiTriggerDescription="Trigger a pipeline only for code changes that match its trigger section. Do not trigger the pipeline if the trigger section is missing.",function(e){t[e]={};class a extends r.VssService{constructor(){super(...arguments),this.updateBadgesArePrivate=async e=>{await this._updateSetting(this.c_badgesPublic,!e)},this.updateEnforceSettableVar=async e=>{await this._updateSetting(this.c_enforceSettableVar,e)},this.updateAuditEnforceSettableVar=async e=>{await this._updateSetting(this.c_auditEnforceSettableVar,e)},this.updateJobAuthScope=async e=>{await this._updateSetting(this.c_enforceJobAuthScope,e)},this.updateJobAuthScopeForReleases=async e=>{await this._updateSetting(this.c_enforceJobAuthScopeForReleases,e)},this.updatePublishPipelineMetadata=async e=>{const t={[this.c_publishPipelineMetadata]:e.toString()},i=(0,s.getTFSProject)(this.pageContext);(0,o.publishEvent)(this.pageContext,"PublishPipelineMetadata","SettingValueSwitch",{value:e,projectId:i&&i.id||""}),await this._update(t)},this.updateEnforceReferencedRepoScopedToken=async e=>{await this._updateSetting(this.c_enforceReferencedRepoScopedToken,e)},this.updateDisableClassicPipelineCreation=async e=>{await this._updateSetting(this.c_disableClassicPipelineCreation,e)},this.updateDisableClassicBuildPipelineCreation=async e=>{await this._updateSetting(this.c_disableClassicBuildPipelineCreation,e)},this.updateDisableClassicReleasePipelineCreation=async e=>{await this._updateSetting(this.c_disableClassicReleasePipelineCreation,e)},this.updatePipelineTriggerSettings=async e=>{const{forkProtectionEnabled:t,buildsEnabledForForks:i,enforceJobAuthScopeForForks:s,enforceNoAccessToSecretsFromForks:n,isCommentRequiredForPullRequest:r,requireCommentsForNonTeamMembersOnly:o,requireCommentsForNonTeamMemberAndNonContributors:a}=e;var l={};void 0!==t&&(l[this.c_forkProtectionEnabled]=t.toString()),void 0!==i&&(l[this.c_buildsEnabledForForks]=i.toString()),void 0!==s&&(l[this.c_enforceJobAuthScopeForForks]=s.toString()),void 0!==n&&(l[this.c_enforceNoAccessToSecretsFromForks]=n.toString()),void 0!==r&&(l[this.c_isCommentRequiredForPullRequest]=r.toString()),void 0!==o&&(l[this.c_requireCommentsForNonTeamMembersOnly]=o.toString()),void 0!==a&&(l[this.c_requireCommentsForNonTeamMemberAndNonContributors]=a.toString()),await this._updateSettings(l)},this.updateEnableShellTasksArgsSanitizing=async e=>{await this._updateSetting(this.c_enableShellTasksArgsSanitizing,e)},this.updateEnableShellTasksArgsSanitizingAudit=async e=>{await this._updateSetting(this.c_enableShellTasksArgsSanitizingAudit,e)},this.updateDisableImpliedYAMLCiTrigger=async e=>{await this._updateSetting(this.c_disableImpliedYAMLCiTrigger,e)},this._updateSettings=async e=>{await this._update(e)},this._updateSetting=async(e,t)=>{const i={[e]:t.toString()};await this._update(i)},this.c_contributionId="ms.vss-build-web.pipelines-general-settings-data-provider",this.c_badgesPublic="badgesArePublic",this.c_enforceSettableVar="enforceSettableVar",this.c_auditEnforceSettableVar="auditEnforceSettableVar",this.c_enforceJobAuthScope="enforceJobAuthScope",this.c_enforceJobAuthScopeForReleases="enforceJobAuthScopeForReleases",this.c_publishPipelineMetadata="publishPipelineMetadata",this.c_enforceReferencedRepoScopedToken="enforceReferencedRepoScopedToken",this.c_disableClassicPipelineCreation="disableClassicPipelineCreation",this.c_disableClassicBuildPipelineCreation="disableClassicBuildPipelineCreation",this.c_disableClassicReleasePipelineCreation="disableClassicReleasePipelineCreation",this.c_forkProtectionEnabled="forkProtectionEnabled",this.c_buildsEnabledForForks="buildsEnabledForForks",this.c_enforceJobAuthScopeForForks="enforceJobAuthScopeForForks",this.c_enforceNoAccessToSecretsFromForks="enforceNoAccessToSecretsFromForks",this.c_isCommentRequiredForPullRequest="isCommentRequiredForPullRequest",this.c_requireCommentsForNonTeamMembersOnly="requireCommentsForNonTeamMembersOnly",this.c_requireCommentsForNonTeamMemberAndNonContributors="requireCommentsForNonTeamMemberAndNonContributors",this.c_enableShellTasksArgsSanitizing="enableShellTasksArgsSanitizing",this.c_enableShellTasksArgsSanitizingAudit="enableShellTasksArgsSanitizingAudit",this.c_disableImpliedYAMLCiTrigger="disableImpliedYAMLCiTrigger"}get data(){return this._settings}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e)}async _update(e){const t=await this._source.getDataAsync(this.c_contributionId,e,!0);t&&(this._settings.value=t)}refreshData(){}async _initialize(){this._source=new i.ContributionSource({pageContext:this.pageContext}),this._settings=new n.ObservableValue({}),await this._update(void 0)}}t[e].GeneralSettingsService=a,r.Services.add("IGeneralSettingsService",{serviceFactory:a})}("generalGeneralSettingsService"),function(e){F=t[e]={};class s extends a.Store{constructor(e){super(),this._onPurgeArtifactsChanged=e=>{this._onValueChanged(e,this._purgeArtifactsSetting)},this._onPurgePullRequestRunsChanged=e=>{this._onValueChanged(e,this._purgePullRequestRunsSetting)},this._onPurgeRunsChanged=e=>{this._onValueChanged(e,this._purgeRunsSetting)},this._onrunsToRetainPerProtectedBranchChanged=e=>{this._onValueChanged(e,this._runsToRetainPerProtectedBranchSetting)},this._onValueChanged=async(e,t)=>{if(!this._pageIsReadOnly){const i=parseInt(e),s=i>=t.serverSetting.min&&i<=t.serverSetting.max;if(t.isValid!=s&&(t.isValid=s,this.emitChanged()),this.isValid&&i!==t.serverSetting.value){const e={[this.c_purgeArtifactsAfter]:this.purgeArtifactsAfter.value,[this.c_purgePullRequestRunsAfter]:this.purgePullRequestRunsAfter.value,[this.c_purgeRunsAfter]:this.purgeRunsAfter.value,[this.c_runsToRetainPerProtectedBranch]:this.runsToRetainPerProtectedBranch.value};await this._update(e)}}},this.c_contributionId="ms.vss-build-web.pipelines-retention-data-provider",this.c_purgeRunsAfter="PurgeRuns",this.c_purgePullRequestRunsAfter="PurgePullRequestRuns",this.c_purgeArtifactsAfter="PurgeArtifacts",this.c_runsToRetainPerProtectedBranch="runsToRetainPerProtectedBranch",this._source=new i.ContributionSource({pageContext:e.pageContext}),this._pageIsReadOnly=!0,this._showSettings=!0,this._purgeArtifactsSetting={value:new n.ObservableValue(""),isValid:!1,serverSetting:{min:0,max:0,value:0}},this._purgeRunsSetting={value:new n.ObservableValue(""),isValid:!1,serverSetting:{min:0,max:0,value:0}},this._purgePullRequestRunsSetting={value:new n.ObservableValue(""),isValid:!1,serverSetting:{min:0,max:0,value:0}},this._runsToRetainPerProtectedBranchSetting={value:new n.ObservableValue(""),isValid:!1,serverSetting:{min:0,max:0,value:0}},this._purgeArtifactsSetting.value.subscribe(this._onPurgeArtifactsChanged),this._purgeRunsSetting.value.subscribe(this._onPurgeRunsChanged),this._purgePullRequestRunsSetting.value.subscribe(this._onPurgePullRequestRunsChanged),this._runsToRetainPerProtectedBranchSetting.value.subscribe(this._onrunsToRetainPerProtectedBranchChanged)}dispose(){this._purgeArtifactsSetting.value.unsubscribe(this._onPurgeArtifactsChanged),this._purgeRunsSetting.value.unsubscribe(this._onPurgeRunsChanged),this._purgePullRequestRunsSetting.value.unsubscribe(this._onPurgePullRequestRunsChanged),this._runsToRetainPerProtectedBranchSetting.value.unsubscribe(this._onrunsToRetainPerProtectedBranchChanged)}get isReadOnly(){return this._pageIsReadOnly}get showSettings(){return this._showSettings}get isValid(){return!(this.purgeArtifactsInvalid||this.purgePullRequestRunsInvalid||this.purgeRunsInvalid||this.runsToRetainPerProtectedBranchInvalid)}get purgeArtifactsAfter(){return this._purgeArtifactsSetting.value}get purgeArtifactsIgnored(){return this._purgeArtifactsIgnored}get purgeArtifactsInvalid(){return!this._purgeArtifactsSetting.isValid}get purgeArtifactsSetting(){return this._purgeArtifactsSetting.serverSetting}get purgeRunsAfter(){return this._purgeRunsSetting.value}get purgeRunsInvalid(){return!this._purgeRunsSetting.isValid}get purgeRunsSetting(){return this._purgeRunsSetting.serverSetting}get purgePullRequestRunsAfter(){return this._purgePullRequestRunsSetting.value}get purgePullRequestRunsInvalid(){return!this._purgePullRequestRunsSetting.isValid}get purgePullRequestRunsSetting(){return this._purgePullRequestRunsSetting.serverSetting}get runsToRetainPerProtectedBranch(){return this._runsToRetainPerProtectedBranchSetting.value}get runsToRetainPerProtectedBranchInvalid(){return!this._runsToRetainPerProtectedBranchSetting.isValid}get runsToRetainPerProtectedBranchSetting(){return this._runsToRetainPerProtectedBranchSetting.serverSetting}async fetch(){await this._update(void 0)}async _update(e){this._pageIsReadOnly=!0,this.emitChanged();const t=await this._source.getDataAsync(this.c_contributionId,e,!0);t?(this._showSettings=!0,this._purgeArtifactsSetting.serverSetting=t.purgeAllArtifacts,this._purgePullRequestRunsSetting.serverSetting=t.purgePullRequestRuns,this._purgeRunsSetting.serverSetting=t.purgeRuns,this._runsToRetainPerProtectedBranchSetting.serverSetting=t.runsToRetainPerProtectedBranch,this._purgeArtifactsSetting.value.value=this._purgeArtifactsSetting.serverSetting.value.toString(),this._purgeRunsSetting.value.value=this._purgeRunsSetting.serverSetting.value.toString(),this._purgePullRequestRunsSetting.value.value=this._purgePullRequestRunsSetting.serverSetting.value.toString(),this._runsToRetainPerProtectedBranchSetting.value.value=this._runsToRetainPerProtectedBranchSetting.serverSetting.value.toString(),this._purgeArtifactsSetting.isValid=!0,this._purgeRunsSetting.isValid=!0,this._purgePullRequestRunsSetting.isValid=!0,this._runsToRetainPerProtectedBranchSetting.isValid=!0,this._pageIsReadOnly=t.viewOnlyPermissions,this._purgeArtifactsIgnored=this._purgeArtifactsSetting.serverSetting.value>=this._purgeRunsSetting.serverSetting.value):(this._showSettings=!1,this._pageIsReadOnly=!0),this.emitChanged()}}t[e].RetentionSettingsStore=s}("retentionRetentionSettingsStore"),function(e){O=t[e]={};class i extends g.VssComponent{constructor(e,t){super(e,t),this._renderPublishPipelineMetadataTooltip=()=>l.createElement("div",{className:"pipelines-settings-metadata-tooltip"},l.createElement(d.FormatComponent,{format:A.PublishPipelineMetadataTooltip},l.createElement("i",null,A.EvaluateArtifactTooltip))),this._service=this.context.pageContext.getService("IGeneralSettingsService"),this._settings=this._service.data,this._checkAudit=!0}render(){const e=(0,h.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.AllowEnableShellTasksArgsSanitizingToggle",!1),t=(0,h.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.AllowEnableShellTasksArgsSanitizingAuditToggle",!1),i=(0,h.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.EnableShellTasksArgsSanitizingHighRisk",!1);return l.createElement(u.Observer,{settings:this._settings},(s=>{const n=Object.keys(s.settings).length;return l.createElement("div",{className:"settings-view"},n>0&&l.createElement("div",null,!s.settings.publicProject&&l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.statusBadgesArePrivate.enabled||s.settings.statusBadgesArePrivate.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.statusBadgesArePrivate.orgEnabled,title:A.BadgesArePrivate,description:A.BadgesArePrivateToolTip,onChange:(e,t)=>this._service.updateBadgesArePrivate(t),toggleTooltipProps:s.settings.statusBadgesArePrivate.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})),l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.enforceSettableVar.enabled||s.settings.enforceSettableVar.orgEnabled,auditChecked:this._checkAudit&&(s.settings.auditEnforceSettableVar.enabled||s.settings.auditEnforceSettableVar.orgEnabled),disabled:s.settings.viewOnlyPermissions||s.settings.enforceSettableVar.orgEnabled,auditDisabled:s.settings.viewOnlyPermissions||s.settings.auditEnforceSettableVar.orgEnabled,title:A.EnforceVariable,description:A.EnforceVariableToolTip,onChange:(e,t)=>this._service.updateEnforceSettableVar(t),onAuditChange:(e,t)=>this._service.updateAuditEnforceSettableVar(t),toggleTooltipProps:s.settings.enforceSettableVar.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0,toggleAuditTooltipProps:this._checkAudit&&s.settings.auditEnforceSettableVar.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0,isHighRisk:!0,isHighRiskAudit:this._checkAudit,learnMoreLink:"https://go.microsoft.com/fwlink/?linkid=2214054"})),l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.enforceJobAuthScope.enabled||s.settings.enforceJobAuthScope.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.enforceJobAuthScope.orgEnabled,title:A.EnforceJobAuthScope,description:A.EnforceJobAuthScopeToolTip,onChange:(e,t)=>this._service.updateJobAuthScope(t),toggleTooltipProps:s.settings.enforceJobAuthScope.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})),(0,h.isFeatureFlagEnabled)(this.context.pageContext,"AzureDevOps.ReleaseManagement.EnforceJobAuthScopeForReleases",!1)&&l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.enforceJobAuthScopeForReleases.enabled||s.settings.enforceJobAuthScopeForReleases.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.enforceJobAuthScopeForReleases.orgEnabled,title:A.EnforceJobAuthScopeForReleases,description:A.EnforceJobAuthScopeForReleasesToolTip,onChange:(e,t)=>this._service.updateJobAuthScopeForReleases(t),toggleTooltipProps:s.settings.enforceJobAuthScopeForReleases.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})),l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.publishPipelineMetadata.enabled||s.settings.publishPipelineMetadata.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.publishPipelineMetadata.orgEnabled,title:A.PublishPipelineMetadata,description:this._renderPublishPipelineMetadataTooltip(),onChange:(e,t)=>this._service.updatePublishPipelineMetadata(t)})),l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.enforceReferencedRepoScopedToken.enabled||s.settings.enforceReferencedRepoScopedToken.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.enforceReferencedRepoScopedToken.orgEnabled,title:A.EnforceReferencedRepoScopedToken,description:A.EnforceReferencedRepoScopedTokenToolTip,onChange:(e,t)=>this._service.updateEnforceReferencedRepoScopedToken(t)})),(0,h.isFeatureFlagEnabled)(this.context.pageContext,"Build2.NewTogglesToDisableClassicPipelineCreation",!1)&&l.createElement("div",null,l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.disableClassicBuildPipelineCreation.enabled||s.settings.disableClassicBuildPipelineCreation.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.disableClassicBuildPipelineCreation.orgEnabled,title:A.DisableClassicBuildPipelineCreation,description:A.DisableClassicBuildPipelineCreationToolTip,onChange:(e,t)=>this._service.updateDisableClassicBuildPipelineCreation(t),toggleTooltipProps:s.settings.disableClassicBuildPipelineCreation.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})),l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.disableClassicReleasePipelineCreation.enabled||s.settings.disableClassicReleasePipelineCreation.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.disableClassicReleasePipelineCreation.orgEnabled,title:A.DisableClassicReleasePipelineCreation,description:A.DisableClassicReleasePipelineCreationToolTip,onChange:(e,t)=>this._service.updateDisableClassicReleasePipelineCreation(t),toggleTooltipProps:s.settings.disableClassicReleasePipelineCreation.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0}))),!(0,h.isFeatureFlagEnabled)(this.context.pageContext,"Build2.NewTogglesToDisableClassicPipelineCreation",!1)&&l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.disableClassicPipelineCreation.enabled||s.settings.disableClassicPipelineCreation.orgEnabled,disabled:s.settings.viewOnlyPermissions||s.settings.disableClassicPipelineCreation.orgEnabled,title:A.DisableClassicPipelineCreation,description:A.DisableClassicPipelineCreationToolTip,onChange:(e,t)=>this._service.updateDisableClassicPipelineCreation(t),toggleTooltipProps:s.settings.disableClassicPipelineCreation.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})),e&&l.createElement("div",null,l.createElement(c.SettingsToggle,{checked:s.settings.enableShellTasksArgsSanitizing.enabled||s.settings.enableShellTasksArgsSanitizing.orgEnabled,auditChecked:this._checkAudit&&(s.settings.enableShellTasksArgsSanitizingAudit.enabled||s.settings.enableShellTasksArgsSanitizingAudit.orgEnabled),disabled:s.settings.viewOnlyPermissions||s.settings.enableShellTasksArgsSanitizing.orgEnabled,auditDisabled:s.settings.viewOnlyPermissions||s.settings.enableShellTasksArgsSanitizingAudit.orgEnabled,title:A.EnableShellTasksArgsSanitizing,description:A.EnableShellTasksArgsSanitizingToolTip,onChange:(e,t)=>this._service.updateEnableShellTasksArgsSanitizing(t),onAuditChange:(e,t)=>this._service.updateEnableShellTasksArgsSanitizingAudit(t),isHighRisk:i,isHighRiskAudit:this._checkAudit&&t&&i,toggleTooltipProps:s.settings.enableShellTasksArgsSanitizing.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0,toggleAuditTooltipProps:s.settings.enableShellTasksArgsSanitizingAudit.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0,learnMoreLink:"https://aka.ms/ado/75787",forceShowAuditToggle:t,customHighRiskAuditToolTipText:A.ShellTasksArgsValidationPreviewToolTip,customHighRiskAuditToggleOnText:A.ShellTasksArgsValidationPreviewOn,customHighRiskAuditToggleOffText:A.ShellTasksArgsValidationPreviewOff}))),0===n&&l.createElement(p.Spinner,{className:"loading-spinner",label:A.LoadingText}))}))}}t[e].GeneralSettingsView=i}("generalGeneralSettingsView"),function(e){q=t[e]={};class i{static isForkProtectionEnabled(e){return e.forkProtectionEnabled.orgEnabled||e.forkProtectionEnabled.enabled}static getOrgLevelCommentRequirementOption(e){return e.requireCommentsForNonTeamMembersOnly.orgEnabled||e.requireCommentsForNonTeamMemberAndNonContributors.orgEnabled?e.requireCommentsForNonTeamMembersOnly.orgEnabled?S.CommentTriggerOption.NonTeamMembers:S.CommentTriggerOption.NonTeamMembersNonContributor:S.CommentTriggerOption.All}static getOrgLevelBuildProtectionOption(e){return e.forkProtectionEnabled.orgEnabled?e.buildsEnabledForForks.orgEnabled?e.buildsEnabledForForks.orgEnabled&&e.enforceJobAuthScopeForForks.orgEnabled&&e.enforceNoAccessToSecretsFromForks.orgEnabled&&e.isCommentRequiredForPullRequest.orgEnabled&&!e.requireCommentsForNonTeamMembersOnly.orgEnabled&&!e.requireCommentsForNonTeamMemberAndNonContributors.orgEnabled?S.ForkProtectionOption.BestPractice:S.ForkProtectionOption.Custom:S.ForkProtectionOption.Disabled:S.ForkProtectionOption.None}static getCommentRequirementOption(e){var t=e.forkProtectionEnabled.orgEnabled&&e.buildsEnabledForForks.orgEnabled&&e.isCommentRequiredForPullRequest.orgEnabled,i=this.getOrgLevelCommentRequirementOption(e),s=e.requireCommentsForNonTeamMembersOnly.enabled||e.requireCommentsForNonTeamMemberAndNonContributors.enabled?e.requireCommentsForNonTeamMembersOnly.enabled?S.CommentTriggerOption.NonTeamMembers:S.CommentTriggerOption.NonTeamMembersNonContributor:S.CommentTriggerOption.All;const n=e=>Object.keys(S.CommentTriggerOption).indexOf(e);return t&&n(i)>n(s)?i:s}static getBuildProtectionOption(e){return this._areBuildsDisabled(e)?S.ForkProtectionOption.Disabled:this.areBuildsBestPractice(e)?S.ForkProtectionOption.BestPractice:S.ForkProtectionOption.Custom}static areBuildsBestPractice(e){return this.getOrgLevelBuildProtectionOption(e)===S.ForkProtectionOption.BestPractice&&e.buildsEnabledForForks.enabled&&e.enforceJobAuthScopeForForks.enabled&&e.enforceNoAccessToSecretsFromForks.enabled&&e.isCommentRequiredForPullRequest.enabled&&!e.requireCommentsForNonTeamMembersOnly.enabled&&!e.requireCommentsForNonTeamMemberAndNonContributors.enabled}static _areBuildsDisabled(e){return e.forkProtectionEnabled.orgEnabled&&!e.buildsEnabledForForks.orgEnabled||!e.buildsEnabledForForks.enabled}}class s extends g.VssComponent{constructor(e,t){super(e,t),this._handleCommentRequirementRadioButtonSelection=(e,t)=>{if(t!==i.getCommentRequirementOption(e))switch(t){case S.CommentTriggerOption.All:this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,isCommentRequiredForPullRequest:!0,requireCommentsForNonTeamMembersOnly:!1,requireCommentsForNonTeamMemberAndNonContributors:!1});break;case S.CommentTriggerOption.NonTeamMembers:this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,isCommentRequiredForPullRequest:!0,requireCommentsForNonTeamMembersOnly:!0,requireCommentsForNonTeamMemberAndNonContributors:!1});break;case S.CommentTriggerOption.NonTeamMembersNonContributor:this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,isCommentRequiredForPullRequest:!0,requireCommentsForNonTeamMembersOnly:!1,requireCommentsForNonTeamMemberAndNonContributors:!0})}},this._handleForkProtectionLevelRadioButtonSelection=e=>{const{selectedProtectionOption:t}=this.state;if(e!==t)switch(this.setState({selectedProtectionOption:e}),e){case S.ForkProtectionOption.Disabled:this._service.updatePipelineTriggerSettings(S.DisabledSettings);break;case S.ForkProtectionOption.BestPractice:case S.ForkProtectionOption.Custom:this._service.updatePipelineTriggerSettings(S.BestPracticeSettings)}},this._service=this.context.pageContext.getService("IGeneralSettingsService"),this._settings=this._service.data,this.state={selectedProtectionOption:void 0}}_renderForkProtectionToggle(e){var t=e=>{this._service.updatePipelineTriggerSettings({forkProtectionEnabled:e}),this.setState({selectedProtectionOption:S.ForkProtectionOption.Disabled})};return l.createElement(c.SettingsToggle,{checked:e.forkProtectionEnabled.orgEnabled||e.forkProtectionEnabled.enabled,disabled:e.viewOnlyPermissions||e.forkProtectionEnabled.orgEnabled,title:A.ForkProtectionEnabled,description:A.ForkProtectionEnabledTooltip,onChange:(e,i)=>t(i),isHighRisk:!0,highRiskTitle:A.ForkProtectionEnabledToggleHighRiskTitle,learnMoreLink:"https://go.microsoft.com/fwlink/?linkid=862029",toggleTooltipProps:e.forkProtectionEnabled.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0})}_renderCommentRequirementSettings(e){const t=e.forkProtectionEnabled.orgEnabled&&e.buildsEnabledForForks.orgEnabled&&e.isCommentRequiredForPullRequest.orgEnabled,s=i.getOrgLevelCommentRequirementOption(e);return l.createElement("div",{className:"flex row margin-left-16 padding-left-16 margin-top-4"},l.createElement(m.RadioButtonGroup,{selectedButtonId:i.getCommentRequirementOption(e),onSelect:t=>{this._handleCommentRequirementRadioButtonSelection(e,t)}},l.createElement(m.RadioButton,{id:S.CommentTriggerOption.All,text:A.RequireCommentsForAllPullRequests,disabled:e.viewOnlyPermissions||t&&s===S.CommentTriggerOption.All,tooltipProps:t&&s===S.CommentTriggerOption.All?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement(m.RadioButton,{id:S.CommentTriggerOption.NonTeamMembers,text:A.RequireCommentsForNonTeamMembersOnly,disabled:e.viewOnlyPermissions||t&&s===S.CommentTriggerOption.All,tooltipProps:t&&s===S.CommentTriggerOption.All?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement(m.RadioButton,{id:S.CommentTriggerOption.NonTeamMembersNonContributor,text:A.RequireCommentsForNonTeamMemberAndNonContributors,disabled:e.viewOnlyPermissions||t&&s!==S.CommentTriggerOption.NonTeamMembersNonContributor,tooltipProps:t&&s!==S.CommentTriggerOption.NonTeamMembersNonContributor?{text:A.SettingEnforcedOrgLevel}:void 0})))}_renderCustomForkProtectionLevelSettings(e){const t=e.forkProtectionEnabled.orgEnabled&&e.buildsEnabledForForks.orgEnabled,i=t&&e.isCommentRequiredForPullRequest.orgEnabled||e.isCommentRequiredForPullRequest.enabled;return l.createElement("div",null,l.createElement(b.Checkbox,{onChange:(e,t)=>this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,enforceNoAccessToSecretsFromForks:t}),label:A.EnforceNoAccessToSecretsFromForks,checked:t&&e.enforceNoAccessToSecretsFromForks.orgEnabled||e.enforceNoAccessToSecretsFromForks.enabled,disabled:e.viewOnlyPermissions||t&&e.enforceNoAccessToSecretsFromForks.orgEnabled,tooltipProps:t&&e.enforceNoAccessToSecretsFromForks.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement(b.Checkbox,{onChange:(e,t)=>this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,enforceJobAuthScopeForForks:t}),label:A.EnforceJobAuthScopeForForks,checked:t&&e.enforceJobAuthScopeForForks.orgEnabled||e.enforceJobAuthScopeForForks.enabled,disabled:e.viewOnlyPermissions||t&&e.enforceJobAuthScopeForForks.orgEnabled,tooltipProps:t&&e.enforceJobAuthScopeForForks.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement(b.Checkbox,{onChange:(e,t)=>this._service.updatePipelineTriggerSettings({forkProtectionEnabled:!0,buildsEnabledForForks:!0,isCommentRequiredForPullRequest:t}),label:A.IsCommentRequiredForPullRequest,checked:t&&e.isCommentRequiredForPullRequest.orgEnabled||e.isCommentRequiredForPullRequest.enabled,disabled:e.viewOnlyPermissions||t&&e.isCommentRequiredForPullRequest.orgEnabled,tooltipProps:t&&e.isCommentRequiredForPullRequest.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0}),i&&this._renderCommentRequirementSettings(e))}_renderForkProtectionLevelSettings(e){const{selectedProtectionOption:t}=this.state;void 0===t&&this.setState({selectedProtectionOption:i.getBuildProtectionOption(e)});const s=i.getOrgLevelBuildProtectionOption(e);return l.createElement("div",{className:"github-fork-protection-settings flex-row padding-horizontal-20"},l.createElement("div",{className:"flex-column margin-right-16 padding-right-16 base-toggle-width"}),l.createElement("div",{className:"flex-column flex-grow margin-left-16 padding-horizontal-16"},l.createElement(m.RadioButtonGroup,{selectedButtonId:t,onSelect:e=>{this._handleForkProtectionLevelRadioButtonSelection(e)}},l.createElement(m.RadioButton,{id:S.ForkProtectionOption.Disabled,text:A.DisableBuildsInPullRequestsFromForkedRepositories,ariaDescribedBy:"forkProtectionOption-disabled",disabled:e.viewOnlyPermissions||s==S.ForkProtectionOption.Disabled,tooltipProps:s===S.ForkProtectionOption.Disabled?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement("div",{className:"body-s margin-left-16 margin-bottom-2 padding-left-16","aria-labelledby":"forkProtectionOption-disabled"},l.createElement("span",{id:"forkProtectionOption-disabled",className:"secondary-text"},A.DisableBuildsInPullRequestsFromForkedRepositoriesTooltip)),l.createElement(m.RadioButton,{id:S.ForkProtectionOption.BestPractice,text:A.SecurelyBuildPullRequestsFromForkedRepositories,ariaDescribedBy:"forkProtectionOption-secure",disabled:e.viewOnlyPermissions||s===S.ForkProtectionOption.Disabled,tooltipProps:s===S.ForkProtectionOption.Disabled?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement("div",{className:"body-s margin-left-16 margin-bottom-4 padding-left-16","aria-labelledby":"forkProtectionOption-secure"},l.createElement("span",{id:"forkProtectionOption-secure",className:"secondary-text"},A.SecurelyBuildPullRequestsFromForkedRepositoriesTooltip)),l.createElement(m.RadioButton,{id:S.ForkProtectionOption.Custom,text:A.CustomizeRulesOfBuildingPullRequestsFromForkedRepositories,disabled:e.viewOnlyPermissions||s===S.ForkProtectionOption.BestPractice||s===S.ForkProtectionOption.Disabled,tooltipProps:s===S.ForkProtectionOption.BestPractice||s===S.ForkProtectionOption.Disabled?{text:A.SettingEnforcedOrgLevel}:void 0}),l.createElement("div",{className:"flex row margin-left-16 padding-left-16 margin-top-4 full-width"},t==S.ForkProtectionOption.Custom&&this._renderCustomForkProtectionLevelSettings(e)))))}_renderSettings(e){return 0===(e?Object.keys(e).length:0)?l.createElement(p.Spinner,{className:"loading-spinner",label:A.LoadingText}):l.createElement(l.Fragment,null,this._renderForkProtectionToggle(e),i.isForkProtectionEnabled(e)&&this._renderForkProtectionLevelSettings(e))}render(){return l.createElement(u.Observer,{settings:this._settings},(e=>l.createElement("div",{className:"settings-view"},this._renderSettings(e.settings))))}}t[e].GithubForkProtectionSettingsView=s}("githubforkprotectionGithubForkProtectionSettingsView"),function(e){w=t[e]={};class i extends g.VssComponent{constructor(e,t){super(e,t),this._noContent=()=>l.createElement(R.ErrorBoundary,{handlerComponentType:"tfs.page-error-handler"},l.createElement(g.RegionComponent,{componentRegion:"retention-policy-tab-content-region",fallbackComponent:()=>l.createElement("div",null,A.RetentionPolicyNoPermissions)})),this._onStoreChanged=()=>{this.setState({isReadOnly:this._store.isReadOnly,purgeArtifactsIgnored:this._store.purgeArtifactsIgnored,purgeArtifactsInvalid:this._store.purgeArtifactsInvalid,purgeArtifactsMessage:this._store.purgeArtifactsInvalid?this.getRequiredRangeMessage(this._store.purgeArtifactsSetting):"",purgePullRequestRunsInvalid:this._store.purgePullRequestRunsInvalid,purgePullRequestRunsMessage:this._store.purgePullRequestRunsInvalid?this.getRequiredRangeMessage(this._store.purgePullRequestRunsSetting):"",purgeRunsInvalid:this._store.purgeRunsInvalid,purgeRunsMessage:this._store.purgeRunsInvalid?this.getRequiredRangeMessage(this._store.purgeRunsSetting):"",ready:!0,runsToRetainPerProtectedBranchMessage:this._store.runsToRetainPerProtectedBranchInvalid?this.getRequiredRangeMessage(this._store.runsToRetainPerProtectedBranchSetting):"",settingsValid:this._store.isValid,showSettings:this._store.showSettings})},this.state={isReadOnly:!0,purgeArtifactsIgnored:!1,purgeArtifactsInvalid:!1,purgeArtifactsMessage:"",purgePullRequestRunsInvalid:!1,purgePullRequestRunsMessage:"",purgeRunsInvalid:!1,purgeRunsMessage:"",ready:!1,runsToRetainPerProtectedBranchMessage:"",settingsValid:!1,showSettings:!0},this._store=new F.RetentionSettingsStore({pageContext:t.pageContext}),this._store.fetch()}componentDidMount(){this._store.addListener(this._onStoreChanged);this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("Admin","RetentionSettings")}componentWillUnmount(){this._store.removeListener(this._onStoreChanged)}render(){return this.state.ready?this.state.showSettings?l.createElement("div",{className:"settings-view flex-column rhythm-vertical-8"},this.getPurgeArtifactsIgnoredMessageRow(this.state.purgeArtifactsIgnored),this.getRetentionRow(A.DaysToKeepArtifacts,this._store.purgeArtifactsInvalid,this._store.purgeArtifactsAfter,this.state.purgeArtifactsMessage),this.getRetentionRow(A.DaysToKeepRuns,this._store.purgeRunsInvalid,this._store.purgeRunsAfter,this.state.purgeRunsMessage),this.getRetentionRow(A.DaysToKeepPullRequestRuns,this._store.purgePullRequestRunsInvalid,this._store.purgePullRequestRunsAfter,this.state.purgePullRequestRunsMessage),this.getRetentionRow(A.NumberOfRecentRunsPerPipeline,this._store.runsToRetainPerProtectedBranchInvalid,this._store.runsToRetainPerProtectedBranch,this.state.runsToRetainPerProtectedBranchMessage,A.RunsPerPipelineMoreInfo),l.createElement(T.Link,{className:"is-link margin-top-16",href:"https://go.microsoft.com/fwlink/?linkid=2114007",target:"_blank"},A.LearnMore),l.createElement("div",{className:"clear",key:"clear"})):this._noContent():l.createElement(p.Spinner,{className:"loading-spinner",label:A.LoadingText,key:"spinner"})}getPurgeArtifactsIgnoredMessageRow(e){return e?l.createElement("div",{key:"ignored"},l.createElement("div",{className:"retention-settings-row"},l.createElement(f.MessageCard,{className:"retention-settings-message",severity:"Warning"},A.PurgeArtifactsSettingIgnored))):l.createElement("span",{key:"ignored"})}getRetentionRow(e,t,i,s,n){return l.createElement("div",{key:e},l.createElement("div",{className:"retention-settings-row flex-row flex-start"},l.createElement("div",{className:"retention-settings-label flex-center flex-row margin-vertical-8"},e,n&&l.createElement(C.Icon,{className:"more-info-icon",iconName:"Info",tooltipProps:{text:n},tabIndex:0})),l.createElement(v.FormItem,{className:"retention-settings-value",error:t,message:s},l.createElement(E.TextField,{readOnly:this.state.isReadOnly,value:i,onChange:(e,t)=>i.value=t}))))}getRequiredRangeMessage(e){return(0,P.format)(A.RequiredValueRangeError,e.min,e.max)}}t[e].RetentionSettingsView=i}("retentionRetentionSettingsView"),function(){t.SettingsView={};class e extends g.VssComponent{constructor(e,t){super(e,t),this._service=this.context.pageContext.getService("IGeneralSettingsService"),this._settings=this._service.data;const i=t.pageContext.getService("IVssPageService").getData();this._isHosted=null==i?void 0:i.isHosted}render(){const e=this._showGithubForkProtectionSettings(),t=this._showDisableImpliedYAMLCiTriggerSettings();return l.createElement("div",{className:"bolt-page-grey pipeline-settings flex flex-column flex-grow"},l.createElement(_.Header,{title:A.Settings,titleSize:1}),this._showProjectRetentionSettings()&&l.createElement(k.Card,{className:"bolt-card-white pipelines-settings-card",titleProps:{text:A.RetentionPolicy,size:2}},l.createElement("div",null,l.createElement(w.RetentionSettingsView,null))),l.createElement(k.Card,{className:"bolt-card-white pipelines-settings-card",titleProps:{text:A.General,size:2},contentProps:{contentPadding:!1}},l.createElement("div",null,l.createElement(O.GeneralSettingsView,null))),(e||t)&&l.createElement(k.Card,{className:"bolt-card-white pipelines-settings-card",titleProps:{text:A.Triggers,size:2},contentProps:{contentPadding:!1}},l.createElement("div",{className:"settings-view"},e&&l.createElement("div",{className:"flex-row"},l.createElement(q.GithubForkProtectionSettingsView,null)),t&&this._getDisableImpliedYAMLCiTriggerContent())))}_showProjectRetentionSettings(){return(0,h.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.SimplifiedRetention",!1)&&(0,h.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.PipelineBillingModel2",!1)}_showGithubForkProtectionSettings(){return!!this._isHosted&&this._isHosted}_showDisableImpliedYAMLCiTriggerSettings(){return(0,h.isFeatureFlagEnabled)(this.context.pageContext,"Build2.DisableImpliedYAMLCiTrigger",!1)}_getDisableImpliedYAMLCiTriggerContent(){return l.createElement("div",{className:"flex-row"},l.createElement(u.Observer,{settings:this._settings},(e=>e.settings.disableImpliedYAMLCiTrigger?l.createElement(c.SettingsToggle,{checked:e.settings.disableImpliedYAMLCiTrigger.enabled||e.settings.disableImpliedYAMLCiTrigger.orgEnabled,title:A.DisableImpliedYAMLCiTriggerTitle,description:A.DisableImpliedYAMLCiTriggerDescription,onChange:(e,t)=>this._service.updateDisableImpliedYAMLCiTrigger(t),disabled:e.settings.viewOnlyPermissions||e.settings.disableImpliedYAMLCiTrigger&&e.settings.disableImpliedYAMLCiTrigger.orgEnabled,toggleTooltipProps:e.settings.disableImpliedYAMLCiTrigger.orgEnabled?{text:A.SettingEnforcedOrgLevel}:void 0}):null)))}}g.Components.add("pipelines-settings-view",e)}()}),["Resources","general/GeneralSettingsService","retention/RetentionSettingsStore","general/GeneralSettingsView","github-fork-protection/GithubForkProtectionSettingsView","retention/RetentionSettingsView","SettingsView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.settings"}}));