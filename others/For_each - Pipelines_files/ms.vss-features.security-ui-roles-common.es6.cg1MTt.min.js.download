"use strict";define("VSS/Features/SecurityUI",["require","exports","VSS/Core/Observable","VSS/Platform/Identity"],(function(e,s,t,i){var n,r;n=s[r="Resources"]={},s[r].AccessAssigned="Assigned",s[r].AccessInherited="Inherited",function(e){s[e]={};class r{constructor(e,s=!1){this.deleted=new t.ObservableValue(!1),this.dirty=new t.ObservableValue(!1),this.originalRoleAssignment=s?{role:{}}:e,this.roleAssignment=Object.assign({},e),this.checkDirty()}get displayName(){return this.roleAssignment.identity.displayName||this.roleAssignment.identity.uniqueName}get role(){return this.roleAssignment.role}set role(e){this.roleAssignment.role.identifier!==e.identifier&&(this.roleAssignment.role=e,this.checkDirty())}get access(){return this.roleAssignment.access}get accessDisplayName(){return 1===this.roleAssignment.access?n.AccessAssigned:n.AccessInherited}get userId(){return this.roleAssignment.identity.id}isDirty(){return this.dirty}isDeleted(){return this.deleted}delete(){this.deleted.value=!0,this.originalRoleAssignment={role:{}},this.checkDirty()}getIdentityImageUrl(e){return(0,i.getIdentityImageUrl)(e,this.roleAssignment.identity)}checkDirty(){let e=!1;this.originalRoleAssignment.role.identifier!==this.roleAssignment.role.identifier&&(e=!0),this.dirty.value=e}}s[e].RoleAssignmentItemModel=r;s[e].RoleAssignmentsModel=class{constructor(){this.dirty=new t.ObservableValue(!1),this.error=new t.ObservableValue(null),this.ready=new t.ObservableValue(!1),this.roleAssignments=new t.ObservableArray,this.inheritanceOn=new t.ObservableValue(!1),this.inheritanceOff=new t.ObservableValue(!0),this.canManageRoles=new t.ObservableValue(!0)}initialize(e,s,t){this.setRoleAssignments(e),this.roleDefinitions=s,this.canManageRoles.value=this.userCanManageRoleAssignments(t),this.ready.value=!0}getError(){return this.error}setError(e){this.error.value=e}getRoleDefinitions(){return this.roleDefinitions}isInheritanceOn(){return this.inheritanceOn}isInheritanceOff(){return this.inheritanceOff}isDirty(){return this.dirty}isReady(){return this.ready}userCanManageRoles(){return this.canManageRoles}getRoleAssignments(){return this.roleAssignments}setRoleAssignments(e){this.originalRoleAssignments=e;const s=e.map((e=>new r(e)));s.sort(this.sortRoleAssignments),this.roleAssignments.value=s,this.inheritanceOn.value=e.some((e=>2===e.access)),this.inheritanceOff.value=!this.inheritanceOn.value,this.checkDirty()}resetRoleAssignments(){this.setRoleAssignments(this.originalRoleAssignments)}changeRoleAssignment(e,s){e.role=s,this.checkDirty()}getChangedRoleAssignments(){return this.roleAssignments.value.filter((e=>!e.isDeleted().value&&e.isDirty().value)).map((e=>({userId:e.userId,roleName:e.role.name})))}deleteRoleAssignment(e){e.delete(),this.checkDirty()}getDeletedRoleAssignments(){return this.roleAssignments.value.filter((e=>e.isDeleted().value)).map((e=>e.userId))}addRoleAssignment(e,s){const t=this.roleAssignments.value.find((e=>e.userId===s.id));if(t)this.changeRoleAssignment(t,e);else{const t=this.roleAssignments.value;t.push(new r({access:1,role:e,identity:{id:s.id,displayName:s.name}},!0)),t.sort(this.sortRoleAssignments),this.roleAssignments.value=t,this.checkDirty()}}sortRoleAssignments(e,s){return e.displayName.localeCompare(s.displayName,navigator.language)}userCanManageRoleAssignments(e){const{canEdit:s,manageRolesPermission:t,userId:i}=e;if(!1===s)return!1;if(i&&void 0!==t){const e=this.roleAssignments.value.find((e=>e.userId===i));if(e)return(e.role.allowPermissions&t)===t}return!0}checkDirty(){let e=!1;this.originalRoleAssignments.length!==this.roleAssignments.length&&(e=!0),e||(e=this.roleAssignments.value.some((e=>e.isDirty().value))),this.dirty.value=e}}}("Models")}),["Resources","Models"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.security-ui-roles-common"}}));