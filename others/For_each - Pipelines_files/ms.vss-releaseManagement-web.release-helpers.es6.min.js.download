"use strict";define("Release/Helpers",["require","exports","VSS/Platform/Trace","VSS/Platform/Location","VSS/Platform/FPS","VSS/Core/Util/String","VSS/Platform/Context"],(function(e,t,r,n,s,a,o){var i,c,l;i=t[l="Resources"]={},t[l].FormattedDate="{0}-{1}-{2}",t[l]._FormattedDate="{0} = year {1} = month {2} = day",t[l].FormattedTime="{0}:{1}",t[l]._FormattedTime="{0} = hours {1} = minutes",t[l].DayFormat="{0}d",t[l].HourFormat="{0}h",t[l].MillisecondFormat="{0}ms",t[l].MinuteFormat="{0}m",t[l].SecondFormat="{0}s",function(e){var r;t[e]={},function(e){e.Area="ReleaseManagement"}(r=t[e].PerformanceConstants||(t[e].PerformanceConstants={})),function(e){e.ReleasesHub="VSO.ReleasesHub",e.ReleasesPivot="VSO.ReleasesHub.ReleasesPivot",e.DeploymentsPivot="VSO.ReleasesHub.DeploymentsPivot",e.AnalyticsPivot="VSO.ReleasesHub.AnalyticsPivot",e.ActivePivot="VSO.ReleasesHub.ActivePivot",e.AllPivot="VSO.ReleasesHub.AllPivot",e.SearchResults="VSO.ReleasesHub.SearchResults",e.NewFolder="VSO.ReleasesHub.NewFolder",e.UpdateFolder="VSO.ReleasesHub.UpdateFolder",e.DeleteFolder="VSO.ReleasesHub.DeleteFolder",e.ExpandFolder="VSO.ReleasesHub.ExpandFolder",e.MoveDefinition="VSO.ReleasesHub.MoveDefinition",e.MoveAndRenameDefinition="VSO.ReleasesHub.MoveAndRenameDefinition",e.FetchMoreDefinitions="VSO.ReleasesHub.FetchMoreDefinitions"}(t[e].PerfScenarios||(t[e].PerfScenarios={})),t[e].endScenario=function(e,t,s=!1){e.getService("IVssPerformanceService").endScenario(r.Area,t,s,void 0,void 0,void 0,n)},t[e].startScenario=function(e,t,r=!1){e.getService("IVssPerformanceService").startScenario(t,r)},t[e].markTimeToInteractive=function(e,t){e.getService("IVssPerformanceService").markTimeToInteractive(r.Area,t,void 0,void 0,void 0,n)};const n={serviceInstanceType:"0000000d-0000-8888-8000-000000000000"}}("Performance"),function(e){t[e]={};t[e].ReleaseContractsStatusConverter=class{static toEnvironmentStatus(e){switch(e.toLowerCase()){case"succeeded":return 4;case"inprogress":return 2;case"rejected":return 16;case"canceled":return 8;case"partiallysucceeded":return 128;case"queued":return 32;default:return 0}}static toDeploymentStatus(e){switch(e.toLowerCase()){case"all":return 31;case"notdeployed":return 1;case"inprogress":return 2;case"succeeded":return 4;case"partiallysucceeded":return 8;case"failed":return 16;default:return 0}}static toDeploymentOperationStatus(e){switch(e.toLowerCase()){case"queued":return 1;case"scheduled":return 2;case"pending":return 4;case"approved":return 8;case"rejected":return 16;case"deferred":return 32;case"queuedforagent":return 64;case"phaseinprogress":return 128;case"phasesucceeded":return 256;case"phasepartiallysucceeded":return 512;case"phasefailed":return 1024;case"canceled":return 2048;case"phasecanceled":return 4096;case"manualinterventionpending":return 8192;case"queuedforpipeline":return 16384;case"cancelling":return 32768;case"evaluatinggates":return 65536;case"gatefailed":return 131072;default:return 0}}}}("ReleaseContractsStatusConverter"),function(e){c=t[e]={},t[e].FeatureArea="DefinitionsHub";function n(r,n,s,a="",o){a&&(o.source=a),r.getService("IVssTelemetryService").publishEvent(t[e].FeatureArea,n,Object.assign({[s]:1},o),"0000000d-0000-8888-8000-000000000000")}t[e].publishSuccessEvent=function(e,t,r="",s={}){n(e,t,"Success",r,s)},t[e].publishFailedEvent=function(e,t,r="",s={}){n(e,t,"Failure",r,s)},t[e].publishClickEvent=function(e,t,r="",s={}){n(e,t,"Click",r,s)},t[e].traceHubException=function(n,s,a,o){(0,r.traceException)(n,t[e].FeatureArea,s,a,o)}}("Telemetry"),function(e){function r(e,t,r){const s=e.getService("IVssNavigationService").getCurrentRoute().routeValues;let a=Object.assign({},r);r.project&&r.project!==s.project||(a.project=s.project,s.team&&(a.team=s.team));try{return(0,n.routeUrl)(e,t,a)}catch(t){const r=e.getService("IVssContributionService").getSharedData("_routes"),n=r?{availableRoutes:Object.keys(r)}:{};return(0,c.traceHubException)(e,"ResolveRoute",t,n),""}}t[e]={},t[e].createUrlForRoute=r,t[e].handleEventAndNavigate=function(e,t,r){if(r){if(t&&(t.ctrlKey||t.nativeEvent&&2===t.nativeEvent.which)){const e=window.open();e&&(e.opener=null,e.location.href=r)}else(0,s.FastPageSwitch)(e,r,!0);t&&(t.preventDefault(),t.stopPropagation())}},t[e].createReleaseViewUrl=function(e,t){return r(e,"ms.vss-releaseManagement-web.cd-release-progress-default-route",{_a:"release-pipeline-progress",releaseId:t.toString(10)})},t[e].createReleaseEnvironmentUrl=function(e,t,n){return r(e,"ms.vss-releaseManagement-web.hub-explorer-3-default-route",{definitionId:n.toString(),environmentId:t.toString(),_a:"deployments"})},t[e].createReleaseDefinitionUrl=function(e,t){return r(e,"ms.vss-releaseManagement-web.hub-explorer-3-default-route",{definitionId:t.toString(),_a:"releases"})},t[e].createReleaseLogsUrl=function(e,t,n){return r(e,"ms.vss-releaseManagement-web.cd-release-progress-default-route",{releaseId:t.toString(),environmentId:n.toString(),_a:"release-environment-logs"})},t[e].createTestResultsTabUrl=function(e,t,n){return r(e,"ms.vss-releaseManagement-web.cd-release-progress-default-route",{releaseId:t.toString(),environmentId:n.toString(),_a:"release-environment-extension",extensionId:"ms.vss-test-web.test-result-in-release-environment-editor-tab"})},t[e].createBuildResultsUrl=function(e,t){return r(e,"ms.vss-build-web.ci-results-hub-route",{buildId:t.toString()})},t[e].createBuildDefinitionUrl=function(e,t){return r(e,"ms.vss-build-web.pipelines-hub-route",{definitionId:t.toString()})}}("Link"),function(e){function r(e,t,r,s){const a=e.getService("ITfsPageService").getData();let o="";a&&a.project&&(o=a.project.id);const i=n(t,r,s);return i&&(o=o+"/"+i),o}function n(e,t,r){let n="";return e&&e!==s&&(n=e.startsWith(s)?e.substring(1):e,n=n.split(s).join("/")),t&&t>0&&(n&&(n+="/"),n+=t,r&&r>0&&(n=(0,a.format)("{0}/Environment/{1}",n,r))),n}t[e]={},t[e].ReleaseManagementNamespace="C788C23E-1B46-4162-8F5E-D7585343B5DE",t[e].ReleaseManagementUINamespace="7c7d32f7-0e86-4cd6-892e-b35dbba870bd",t[e].ReleaseManagementUIPermissionToken="/ReleaseManagementUI",t[e].hasRmPermissions=function(n,s,a,i){if(n.getService("IVssFeatureService").isFeatureFlagEnabled(o))return!0;const c=r(n,s,a);return n.getService("IVssSecurityService").hasPermission(t[e].ReleaseManagementNamespace,c,i)},t[e].hasRmEnvironmentPermissions=function(n,s,a,i,c){if(n.getService("IVssFeatureService").isFeatureFlagEnabled(o))return!0;const l=r(n,s,a,i);return n.getService("IVssSecurityService").hasPermission(t[e].ReleaseManagementNamespace,l,c)},t[e].hasRmUIPermissions=function(r,n){return r.getService("IVssSecurityService").hasPermission(t[e].ReleaseManagementUINamespace,t[e].ReleaseManagementUIPermissionToken,n)},t[e].userHasMemberClaim=function(e){return e.getService("IVssUserClaimsService").hasClaim("member")},t[e].getFullSecurityToken=r,t[e].createFolderPathSecurityToken=n;const s="\\",o="WebAccess.ReleaseManagement.HidePermissionWarning"}("Permission"),function(e){t[e]={},t[e].saveContentToLocalStorage=function(e,t){if(!e)throw new Error("BrowserStorage.saveContentToLocalStorage : storageKey is null or empty");window.localStorage.setItem(e,t)},t[e].getContentFromLocalStorage=function(e){return window.localStorage.getItem(e)}}("BrowserStorage"),function(e){function r(e,t=2){const r="{0}{1}";let n=(0,a.localeFormat)(r,e,"");for(;n.length<t;)n=(0,a.localeFormat)(r,0,n);return n}t[e]={},t[e].padZeroes=r,t[e].diffDate=function(e,t){e||(e=new Date),t||(t=new Date);let n="",s=Math.round(Math.abs(e.valueOf()-t.valueOf())/1e3);const a=Math.floor(s/3600);n+=r(a,2)+":",s-=3600*a;const o=Math.floor(s/60);return n+=r(o,2)+":",s-=60*o,n+=r(Math.round(s),2),n},t[e].parseDuration=function(e){let t,r;const n="{0} {1}";return e?(r=function(e){let t=e.split("."),r=0;t[0]&&t[1]&&t[1].indexOf(":")>0&&(r=parseInt(t[0]),e=t[1]);e=e.replace(".",":"),t=e.split(":");let n=0;if(t[3]){let e=parseFloat("."+t[3]);n=Math.round(1e3*e)}return{days:r,hours:t[0]?parseInt(t[0]):0,minutes:t[1]?parseInt(t[1]):0,seconds:t[2]?parseInt(t[2]):0,milliseconds:n}}(e),t=r.days>0?(0,a.localeFormat)(n,(0,a.localeFormat)(i.DayFormat,r.days),r.hours>0?(0,a.localeFormat)(i.HourFormat,r.hours):""):r.hours>0?(0,a.localeFormat)(n,(0,a.localeFormat)(i.HourFormat,r.hours),r.minutes>0?(0,a.localeFormat)(i.MinuteFormat,r.minutes):""):r.minutes>0?(0,a.localeFormat)(n,(0,a.localeFormat)(i.MinuteFormat,r.minutes),r.seconds>0?(0,a.localeFormat)(i.SecondFormat,r.seconds===Math.round(r.seconds)?r.seconds.toString():r.seconds.toFixed(2)):""):r.seconds>0?(0,a.localeFormat)(n,(0,a.localeFormat)(i.SecondFormat,r.seconds),r.milliseconds>0?(0,a.localeFormat)(i.MillisecondFormat,r.milliseconds):""):0===r.milliseconds?(0,a.localeFormat)(i.SecondFormat,0):(0,a.localeFormat)(i.MillisecondFormat,r.milliseconds),t):""}}("DateTime"),function(e){t[e]={},t[e].getEnvironmentNamesInProgress=function(e){let t=[];return e&&e.environments&&e.environments.forEach((e=>{(e.preDeployApprovals&&e.preDeployApprovals.some((e=>1===e.status))||e.deploySteps&&e.deploySteps.some((e=>2===e.status)))&&t.push(e.name)})),t}}("ReleaseEnvironment"),function(){t.BuildReleaseDefinitionProvider={};class e extends o.VssService{_serviceStart(e){super._serviceStart(e),this._contributionService=e.getService("IVssContributionService")}async getReleaseDefinitionsByBuild(e,t){await this._contributionService.getContributionAsync("ms.vss-releaseManagement-web.release-service-location");const r={readConsistencyLevel:o.IVssReadConsistencyLevel.Eventual},n=this.pageContext.getRestClient("IReleaseRestClient",r);return await n.getReleaseDefinitions(e,void 0,void 0,"Build",`${e}:${t}`,1)}}o.Services.add("IBuildReleaseDefinitionProvider",{serviceFactory:e})}()}),["Resources","Performance","ReleaseContractsStatusConverter","Telemetry","Link","Permission","BrowserStorage","DateTime","ReleaseEnvironment","BuildReleaseDefinitionProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-releaseManagement-web.release-helpers"}}));