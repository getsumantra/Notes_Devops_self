"use strict";define("Build/ArtifactsView",["require","exports","VSS/Core/Observable","VSS/Platform/Context","VSS/Platform/FPS","react","VSSUI/Clipboard","VSSUI/Observer","VSSUI/Util","VSSUI/Menu","Build/Common/Artifacts/Common","Build/Common/Library/Navigation","Build/Common/Library/Stores/Permissions","Build/Common/Library/Security","Build/Client/Linking","Build/Common/Library/Constants","VSS/Platform/Feature","VSS/Core/Util/String","VSS/Platform/Layout","VSSUI/Card","VSSUI/Page","VSSUI/Surface","VSSUI/TreeEx","VSSUI/Utilities/TreeItemProvider","VSSUI/Header","VSSUI/Spinner","Environments/Providers/External/Kubernetes/WebUI/ImageDetails/ImageDetails","VSS/Core/TimerManagement","VSSUI/Tabs","VSS/Features/PlatformUI/ContributedTab","VSSUI/Table","VSSUI/TooltipEx","VSSUI/Icon","VSSUI/Button","VSS/Platform/Location"],(function(e,t,i,s,a,r,o,n,c,l,d,u,m,p,h,C,b,g,v,f,S,_,y,A,I,T,x,P,w,N,B,E,V,U,k){var D,R,F,L,q,z,H,O,j,M,G,W;D=t[W="Resources"]={},t[W].ArtifactsColumnName="Name",t[W].ArtifactsColumnSize="Size",t[W].ArtifactsNonePublished="No artifacts have been published for this build.",t[W].ArtifactsView_Header="Artifacts",t[W].PublishedArtifactsView_Header="Artifacts published",t[W].AzureContainerRepository="Azure Container Repository",t[W].ConsumedArtifactsText="Consumed artifacts",t[W].ConsumedArtifactsTabName="Consumed",t[W].ConsumedArtifactsNameColumn="Name",t[W].ConsumedArtifactsSizeColumn="Size",t[W].ConsumedArtifactsImageColumn="Image",t[W].ConsumedContainerTableText="Consumed Container Resource",t[W].ConsumedPipelineTableText="Consumed Pipeline Resource",t[W].ConsumedRepositoryTableText="Consumed Repository Resource",t[W].CopyArtifactUrl="Copy download URL",t[W].CopiedToClipboard="Copied to clipboard",t[W].CopyFileShareLocation="Copy file share location to clipboard",t[W].CopyToClipboard="Copy to clipboard",t[W].DownloadArtifacts="Download artifacts",t[W].ImageDetailsNotFound="No image details found",t[W].Jenkins="Jenkins",t[W].Pipeline="Pipeline",t[W].Repository="Repository",t[W].Container="Container",t[W].PublishedArtifactsTabName="Published",t[W].PublishedArtifactsText="Published artifacts",t[W].TitleArtifacts="Pipelines - Run {0} artifacts",t[W].ViewDetails="View details",t[W].WebHook="WebHook",function(e){t[e]={};class r extends s.VssService{constructor(){super(...arguments),this.items=new i.ObservableArray}getBreadcrumbItems(){return this.items}setBreadcrumbs(e,t,i,s,r,o,n,c){this.items.removeAll(),this.items.push({key:"pipeline-breadcrumb",text:e,href:t,onClick:e=>{(0,a.onClickFPS)(this.pageContext,t,!0,e,{telemetrySource:"pipeline-breadcrumb"})}}),this.items.push({key:"run-breadcrumb",text:i,href:s,onClick:e=>{(0,a.onClickFPS)(this.pageContext,s,!0,e,{telemetrySource:"run-breadcrumb"})}}),r&&o&&this.items.push({key:"artifact-tab-breadcrumb",text:r,href:o,onClick:e=>{(0,a.onClickFPS)(this.pageContext,o,!0,e,{telemetrySource:"artifact-tab-breadcrumb"})}}),n&&c&&this.items.push({key:"container-image-view-details-breadcrumb",text:n,href:c,onClick:e=>{(0,a.onClickFPS)(this.pageContext,c,!0,e,{telemetrySource:"container-image-view-details-breadcrumb"})}})}clearBreadcrumbs(){this.items.removeAll()}}t[e].ArtifactsHeaderBreadcrumbService=r,s.Services.add("artifacts-header-breadcrumb-service",{serviceFactory:r})}("ComponentsArtifactsHeaderBreadcrumbService"),function(e){R=t[e]={};t[e].TreeColumnAction=class{constructor(e){this.columnLayout=0,this.id="_action",this.width=42,this.downloadUrl=new i.ObservableValue(void 0),this.renderCell=(e,t,i,s)=>r.createElement("td",{key:"col-action","aria-colindex":t,className:(0,c.css)("bolt-table-cell-side-action bolt-table-cell bolt-list-cell","col-"+t),"data-column-index":t,onClick:c.preventDefault,onDoubleClick:c.preventDefault,onMouseDown:c.preventDefault},this.renderActionButton(s.underlyingItem.data)),this.renderActionButton=e=>{let t=new i.ObservableArray([{id:"download",text:D.DownloadArtifacts,className:"text-ellipsis",onActivate:()=>{this._publishTelemetry("downloadArtifacts"),this.downloadItem(e)},href:this.downloadUrl.value,iconProps:{iconName:"Download"}}]);return this.getDownloadUrl(e).then((e=>{this.downloadUrl.value=e,this.downloadUrl.value&&t.push({id:"copy",text:D.CopyArtifactUrl,className:"text-ellipsis",onActivate:e=>{(0,o.copyToClipboard)(e.href),this.showCopiedToast(),this._publishTelemetry("copyArtifactUrl")},href:this.downloadUrl.value,iconProps:{iconName:"Copy"}})})),this.downloadAvailable(e)?r.createElement(n.Observer,{href:this.downloadUrl},(()=>r.createElement(l.MoreButton,{className:"bolt-table-cell-content-reveal justify-center",role:"menuitem",contextualMenuProps:{menuProps:{id:"header-submenu",items:t}},subtle:!0}))):this.copyAvailable(e)?r.createElement(o.ClipboardButton,{className:"bolt-table-cell-content-reveal justify-center",getContent:()=>this.getCopyUrl(e),onCopy:this.showCopiedToast,subtle:!0,tooltipProps:{text:D.CopyFileShareLocation,anchorOrigin:{horizontal:"center",vertical:"end"},tooltipOrigin:{horizontal:"center",vertical:"start"}}}):void 0},this.renderHeaderCell=(e,t)=>r.createElement("th",{key:"col-action",className:(0,c.css)(t.headerClassName,"bolt-table-header-cell bolt-table-header-cell-empty","col-header-"+e),"data-column-index":e}),this.showCopiedToast=()=>{this.pageContext.getService("IGlobalMessagesService").addToast({duration:2e3,message:D.CopiedToClipboard})},this.pageContext=e.pageContext,this.downloadAvailable=e.downloadAvailable,this.downloadItem=e.downloadItem,this.copyAvailable=e.copyAvailable,this.getCopyUrl=e.getCopyUrl,this.getDownloadUrl=e.getDownloadUrl}_publishTelemetry(e){this.pageContext.getService("IVssTelemetryService").publishEvent("Build",e,{})}}}("ComponentsTreeColumnAction"),function(e){F=t[e]={},function(e){e.Area="Build",e.RunArtifacts="Pipelines.RunArtifacts"}(t[e].Telemetry||(t[e].Telemetry={}))}("Constants"),function(e){L=t[e]={};const s="ms.vss-build-web.run-artifacts-data-provider",o="directory",c="file";class l extends v.VssComponent{constructor(e,t){super(e,t),this._onBackClick=e=>{let t=this.context.pageContext,i=t.getService("IBuildLinkingService");const s=this.context.pageContext.getService("IVssHistoryService");let r=parseInt(s.getState()[h.RouteParameters.BuildId]),o=i.getBuildUrl(r);(0,a.onClickFPS)(t,o,!0)},this._contributionService=()=>this.context.pageContext.getService("IVssContributionService"),this._onDataUpdated=()=>{const e=this._itemProvider.value.filter((e=>!e.parentItem)),t=[{insertAfter:e.length>0?e[e.length-1].underlyingItem:void 0,items:this._convertToTreeItems(this._data.value.items.filter((e=>!this._displayedArtifactIds.has(e.artifactId))))}];this._itemProvider.splice(void 0,void 0,t),this._displayedArtifactIds=this._getDisplayedArtifactIds();const i=this._data.value&&this._data.value.items.some((e=>this._canExplore(e.type)));this._nameColumn.hierarchical=i,this._nameColumn.renderCell=i?y.renderExpandableTreeCell:y.renderTreeCell},this._setBreadcrumbs=e=>{const t=this.context.pageContext.getService("IBuildLinkingService"),i=this.context.pageContext.getService("IVssHistoryService"),s=e.definitionName,a=t.getDefinitionUrl(e.definitionId),r=e.buildNumber,o=t.getBuildUrl(e.buildId),n=D.PublishedArtifactsText,c=t.getBuildUrl(e.buildId,C.NavConstants.artifacts,void 0,void 0,{[h.RouteParameters.Type]:i.getState()[h.RouteParameters.Type]});this.context.pageContext.getService("artifacts-header-breadcrumb-service").setBreadcrumbs(s,a,r,o,n,c)},this._renderNoArtifacts=()=>r.createElement(r.Fragment,null,D.ArtifactsNonePublished),this._renderArtifactsTree=()=>r.createElement(y.Tree,{columns:this._columns,itemProvider:this._itemProvider,onActivate:this._onActivate,onToggle:this._onToggle,ariaLabel:D.PublishedArtifactsText}),this._getDisplayedArtifactIds=()=>this._data.value&&this._data.value.items?new Set(this._data.value.items.map((e=>e.artifactId))):new Set,this._artifactTreeItemComparer=(e,t)=>g.localeIgnoreCaseComparer(e.name,t.name),this._createTreeItem=(e,t,s)=>{let a=s;return a||this._canExplore(t)&&(a=[{data:new i.ObservableValue(void 0)}]),{data:e,expanded:!1,childItems:a}},this._getIcon=e=>g.equals(e.type,d.BuildArtifactTypes.Container,!0)||g.equals(e.type,d.BuildArtifactTypes.PipelineArtifact,!0)||g.equals(e.type,d.BuildArtifactTypes.FilePath,!0)?"Package":g.equals(e.type,d.BuildArtifactTypes.GitRef,!0)?"OpenSource":g.equals(e.type,d.BuildArtifactTypes.VersionControl,!0)||g.equals(e.type,d.BuildArtifactTypes.TfvcLabel,!0)?"TFVCLogo":g.equals(e.type,c,!0)?"Page":g.equals(e.type,o,!0)?"FolderHorizontal":"ZipFolder",this._createTableItem=e=>({name:{text:this._getArtifactShortName(e),iconProps:{iconName:this._getIcon(e)}},size:this._getFileSizeText(e.size),artifactId:e.artifactId,fullPath:e.sourcePath,type:e.type}),this._getArtifactShortName=e=>g.equals(e.type,d.BuildArtifactTypes.Container,!0)||g.equals(e.type,d.BuildArtifactTypes.PipelineArtifact,!0)||g.equals(e.type,d.BuildArtifactTypes.FilePath,!0)?e.name:e.name.substring(e.name.lastIndexOf("/")+1),this._onToggle=async(e,t)=>{const i=t.underlyingItem;if(this._itemProvider.toggle(i),this._canExplore(i.data.type)){let e;if((0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)){if(!this._data.value)return Promise.resolve(void 0);e=await this._contributionService().getDataAsync(s,{artifactId:i.data.artifactId,buildId:this._data.value.buildId},!1)}else e=await this.props.service.getArtifactTree(i.data.artifactId);e?this._itemProvider.splice(i,i.childItems,[{items:this._convertToTreeItems(e.items)}]):this._itemProvider.splice(i,i.childItems)}},this._onActivate=(e,t)=>{const i=t.data.underlyingItem.data;g.equals(i.type,c,!0)?this._downloadItem(i):this._onToggle(e,t.data)},this._convertToTreeItems=e=>e.map((e=>this._createTreeItem(this._createTableItem(e),e.type,e.items&&this._convertToTreeItems(e.items)))),this._canExplore=e=>this._isUserMember&&(g.equals(e,d.BuildArtifactTypes.Container,!0)||g.equals(e,d.BuildArtifactTypes.PipelineArtifact,!0)),this._isDownloadAvailable=e=>this._isDownloadableItem(e.type),this._isDownloadableItem=e=>g.equals(e,d.BuildArtifactTypes.Container,!0)||g.equals(e,d.BuildArtifactTypes.PipelineArtifact,!0)||g.equals(e,c,!0)||g.equals(e,o,!0),this._downloadItem=async e=>{const t=await this._getDownloadUrl(e);t&&(0,u.openLinkSecurely)(t,!1)},this._getDownloadUrl=async e=>{if(e){let t;(g.equals(e.type,c,!0)||g.equals(e.type,o,!0))&&(t=e.fullPath);const i=!g.equals(e.type,c,!0);return await this.props.service.getDownloadUrl(e.artifactId,i,t,e.type)}},this._isCopyAvailable=e=>e&&this._isCopyableItem(e.type),this._isCopyableItem=e=>g.equals(e,d.BuildArtifactTypes.FilePath,!0),this._getCopyUrl=e=>this._isCopyAvailable(e)?e.fullPath:"";const n=this.context.pageContext.getService("ITfsPageService").getData(),l=n&&n.project&&n.project.id;if(l){const e=new m.PermissionsStore({pageContext:this.context.pageContext}),t=new p.Security({store:e,projectId:l});this._isUserMember=t.isMember()}else this._isUserMember=!1;(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?this._data=new i.ObservableValue(this._contributionService().getData(s)):this._data=this.props.service.data,this._itemProvider=this._getItemProvider(),this._displayedArtifactIds=this._getDisplayedArtifactIds();const v=this._data.value&&this._data.value.items.some((e=>this._canExplore(e.type)));if(this._nameColumn={hierarchical:v,id:"name",name:D.ArtifactsColumnName,renderCell:v?y.renderExpandableTreeCell:y.renderTreeCell,width:-58,columnLayout:2},this._columns=[this._nameColumn],v){const e={id:"size",name:D.ArtifactsColumnSize,renderCell:y.renderTreeCell,width:-28};this._columns.push(e)}if(this._data.value&&this._data.value.items.some((e=>this._isDownloadableItem(e.type)||this._isCopyableItem(e.type)))){const e={pageContext:this.context.pageContext,copyAvailable:this._isCopyAvailable,getCopyUrl:this._getCopyUrl,downloadAvailable:this._isDownloadAvailable,downloadItem:this._downloadItem,getDownloadUrl:this._getDownloadUrl},t=new R.TreeColumnAction(e);this._columns.push(t)}}render(){return r.createElement(_.Surface,{background:1},r.createElement(S.Page,{className:"run-artifacts-view"},(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&r.createElement(I.Header,{backButtonProps:{onClick:this._onBackClick},title:D.PublishedArtifactsView_Header,titleSize:1}),r.createElement(n.Observer,{data:this._data},(e=>r.createElement("div",{className:"run-artifacts-content page-content page-content-top"},e.data&&e.data.items&&e.data.items.length>0?r.createElement(f.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1}},this._renderArtifactsTree()):r.createElement(f.Card,{className:"flex-grow"},this._renderNoArtifacts()))))))}componentDidMount(){this._data.value&&(this._setBreadcrumbs(this._data.value),document.title=g.format(D.TitleArtifacts,this._data.value.buildNumber)),this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(F.Telemetry.Area,F.Telemetry.RunArtifacts),this._data.subscribe(this._onDataUpdated),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)||this.props.service.startListening()}componentWillUnmount(){this._data.unsubscribe(this._onDataUpdated),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)||this.props.service.stopListening()}_getItemProvider(){const e=(this._data.value&&this._data.value.items||[]).sort(this._artifactTreeItemComparer);return new A.TreeItemProvider(this._convertToTreeItems(e))}_getFileSizeText(e){return e<=0?"":e<1024?`${e} B`:e<1048576?`${Math.ceil(e/1024)} KB`:`${Math.ceil(e/1048576)} MB`}}t[e].PublishedArtifactsView=l}("ComponentsPublishedArtifactsView"),function(e){q=t[e]={};class s extends v.VssComponent{constructor(e,t){super(e,t),this._setBreadcrumbs=()=>{this._getBuildAsync().then((e=>{let t=e.definition.name,i=this.linkingService.getDefinitionUrl(e.definition.id),s=e.buildNumber,a=e.id,r=this.linkingService.getBuildUrl(a),o=C.NavConstants.consumedArtifacts,n=this.linkingService.getBuildUrl(a,C.NavConstants.artifacts,void 0,void 0,{[h.RouteParameters.Type]:o}),c=this.props.containerAlias+"/ "+this.props.containerTag,l=this.linkingService.getBuildUrl(a,C.NavConstants.artifacts,void 0,void 0,{[C.NavConstants.imageUri]:this.props.imageUri,[C.NavConstants.alias]:this.props.containerAlias,[C.NavConstants.tag]:this.props.containerTag});this.context.pageContext.getService("artifacts-header-breadcrumb-service").setBreadcrumbs(t,i,s,r,o,n,c,l)}))},this._navigateToArtifactsPage=()=>{let e=this.context.pageContext,t=parseInt(this.historyService.getState()[h.RouteParameters.BuildId]),i=C.NavConstants.consumedArtifacts,s=this.linkingService.getBuildUrl(t,C.NavConstants.artifacts,void 0,void 0,{[h.RouteParameters.Type]:i});(0,a.onClickFPS)(e,s,!0)},this.data=new i.ObservableValue(void 0),this.linkingService=this.context.pageContext.getService("IBuildLinkingService"),this.historyService=this.context.pageContext.getService("IVssHistoryService")}render(){return r.createElement(n.Observer,{data:this.data},(e=>e.data&&e.data.imageUri?r.createElement(_.Surface,{background:1},r.createElement(S.Page,{className:"kubernetes-container flex flex-grow"},r.createElement(x.ImageDetails,{imageDetails:e.data,onBackButtonClick:this._navigateToArtifactsPage}))):r.createElement("div",{className:"flex-column flex-grow"},r.createElement(T.Spinner,{size:"medium"}))))}componentDidMount(){this._getImageDetails(this.props.imageUri).then((e=>{this.data.value=e})),this._setBreadcrumbs()}async _getBuildAsync(){let e=this.historyService.getState()[h.RouteParameters.BuildId],t=this.historyService.getState()[h.RouteParameters.Project];return this.context.pageContext.getRestClient("IBuildRestClient").getBuild(t,parseInt(e))}_getImageDetails(e){let t={imageName:"https://"+e};return this.context.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-environments-web.image-details-data-provider",t,!0)}}t[e].ContainerImageDetails=s,v.VssComponent.register("run-summary-container-image-details",s)}("ComponentsContainerImageDetails"),function(e){t[e]={};const a="ms.vss-build-web.run-artifacts-data-provider";class o extends s.VssService{constructor(){super(...arguments),this.refreshData=()=>{this._refreshDataDebounced()},this._refreshData=async()=>{if(!this._data.value)return Promise.resolve();const e=await this._contributionService().getDataAsync(a,{buildId:this._data.value.buildId},!0);e&&(this._data.value=e)},this.getDownloadUrl=(e,t,i,s)=>{if(!this._data.value)return Promise.resolve("");const a="directory"===s,r={artifactId:e,buildId:this._data.value.buildId,compressDownload:t,path:i||"",saveAbsolutePath:!a};return this._contributionService().getDataAsync("ms.vss-build-web.run-artifacts-download-data-provider",r).then((e=>e?e.downloadUrl:""))},this._renderPublishedArtifacts=()=>r.createElement(n.Observer,{data:this._data},(()=>r.createElement(L.PublishedArtifactsView,{service:this}))),this._tab={id:"publishedArtifacts",name:D.PublishedArtifactsTabName,order:1,render:this._renderPublishedArtifacts},this._contributionService=()=>this.pageContext.getService("IVssContributionService"),this._data=new i.ObservableValue(void 0),this._tabs=new i.ObservableArray}getTabs(e,t){return this._initialize(),this._data.value&&this._data.value.items.length>0&&0===this._tabs.length&&this._tabs.push(this._tab),this._tabs}get data(){return this._data}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._timerManagement.clearAllTimers()}startListening(){this._data.value&&(this._signalR=this.pageContext.getService("ISignalRService"),this._signalR.watch(this._data.value.buildId))}stopListening(){this._signalR&&(this._data.value&&this._signalR.endWatch(this._data.value.buildId),this._signalR=void 0)}getArtifactTree(e){return this._data.value?this._contributionService().getDataAsync(a,{artifactId:e,buildId:this._data.value.buildId},!1):Promise.resolve(void 0)}_initialize(){if(!this._data.value){const e=this._contributionService().getData(a);e&&(this._data.value=e),this._timerManagement=new P.TimerManagement,this._refreshDataDebounced=this._timerManagement.debounce(this._refreshData,3e3)}}}t[e].PublishedArtifactsTabService=o,s.Services.add("pipelines-run-published-artifacts-tab-provider-service",{serviceFactory:o})}("ComponentsPublishedArtifactsTabService"),function(e){t[e]={};class s extends v.VssComponent{constructor(e,t){super(e,t),this._onBackClick=e=>{let t=this.context.pageContext,i=t.getService("IBuildLinkingService"),s=parseInt(this.historyService.getState()[h.RouteParameters.BuildId]),r=i.getBuildUrl(s);(0,a.onClickFPS)(t,r,!0)},this._onSelectedTabChanged=e=>{e||(e=this.defaultTab),this.selectedTabId.value=e,this._updateHistoryState(e)},this.tabProviders=new i.ObservableCollection,this.selectedTabId=new i.ObservableValue(""),this.defaultTab="",this.historyService=this.context.pageContext.getService("IVssHistoryService"),this.tabProviders.push((0,N.getTabs)(t.pageContext,"ms.vss-build-web.run-artifacts-details-view-tabs")),this._getArtifactsCount().then((e=>{e&&e.publishedArtifactsCount>0?this.defaultTab=C.NavConstants.publishedArtifacts:e&&e.consumedArtifactsCount>0&&(this.defaultTab=C.NavConstants.consumedArtifacts);let t=this._getViewFromHistoryState();this._updateHistoryState(t),this._setSelectedTab(t)}))}render(){return(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?r.createElement(L.PublishedArtifactsView,{service:this.context.pageContext.getService("pipelines-run-published-artifacts-tab-provider-service")}):(this._getImageDetails(),this.imageUri&&this.containerAlias&&this.containerTag?r.createElement(q.ContainerImageDetails,{imageUri:this.imageUri,containerAlias:this.containerAlias,containerTag:this.containerTag}):this._getTabView())}_getImageDetails(){this.imageUri=this.historyService.getState()[C.NavConstants.imageUri],this.containerAlias=this.historyService.getState()[C.NavConstants.alias],this.containerTag=this.historyService.getState()[C.NavConstants.tag]}_getTabView(){return r.createElement(_.Surface,{background:1},r.createElement(S.Page,{className:"flex-grow",tabProviders:this.tabProviders,selectedTabId:this.selectedTabId},r.createElement(I.Header,{backButtonProps:{onClick:this._onBackClick},title:D.ArtifactsView_Header,titleSize:1}),r.createElement(w.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onSelectedTabChanged}),r.createElement(w.TabContent,null)))}_getArtifactsCount(){let e=this.context.pageContext.getService("IVssContributionService");const t={buildId:this.historyService.getState()[h.RouteParameters.BuildId]};return e.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",t,!0)}_updateHistoryState(e){let t=this.historyService.getState()||{};t[C.NavConstants.type]=e||this.selectedTabId.value,this.historyService.replaceState(t)}_getViewFromHistoryState(){let e=this.historyService.getState();return e[C.NavConstants.type]?e[C.NavConstants.type]:this.defaultTab}_setSelectedTab(e){this.selectedTabId.value=e||this.defaultTab}}t[e].default=s,v.Components.add("run-artifacts-content",s)}("ComponentsArtifactsTabView"),function(e){z=t[e]={},function(e){e.Pipeline="Pipeline",e.TfsVersionControl="TfsVersionControl",e.Git="Git",e.TfsGit="TfsGit",e.GitHub="GitHub",e.GitHubEnterprise="GitHubEnterprise",e.Bitbucket="Bitbucket",e.Svn="Svn",e.DockerHub="DockerHub",e.AzureContainerRepository="AzureContainerRepository"}(t[e].ConsumedArtifactTypes||(t[e].ConsumedArtifactTypes={})),function(e){e.PipelineArtifactCategory="pipeline",e.ContainerArtifactCategory="container",e.RepositoryArtifactCategory="repository",e.BuildArtifactCategory="build"}(t[e].ArtifactCategory||(t[e].ArtifactCategory={})),function(e){e.ProjectId="projectId",e.ContainerImageUri="ContainerUri"}(t[e].ConsumedArtifactPropertyKeys||(t[e].ConsumedArtifactPropertyKeys={}))}("ComponentsConsumedArtifactsComponentConsumedArtifactsResources"),function(e){H=t[e]={};class s extends v.VssComponent{constructor(e,t){super(e,t),this._renderIcon=()=>r.createElement("div",null,r.createElement("img",{src:(0,k.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/azure-container-repository.svg"),alt:D.Container})),this._getIcon=()=>"Package",this._renderNameCell=(e,t,i)=>r.createElement(B.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},r.createElement(V.Icon,{className:"pipelines-icon-right-margin",iconName:this._getIcon()}),r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(E.Tooltip,{overflowOnly:!0,text:this.containerImageUri},r.createElement("span",{className:"text-ellipsis fontWeightSemiBold"},this.containerImageUri)))),this._renderCopyButton=(e,t,i,s)=>r.createElement(B.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},r.createElement(U.Button,{className:"bolt-table-cell-content-reveal justify-center",subtle:!0,ariaLabel:"Copy to Clipboard",iconProps:{iconName:"Copy"},onClick:()=>{(0,o.copyToClipboard)(this.containerImageUri)},tooltipProps:{text:D.CopyToClipboard}})),this._jobsTableColumns=[{id:D.ConsumedArtifactsImageColumn,width:-20,name:D.ConsumedArtifactsImageColumn,renderCell:this._renderNameCell,columnStyle:2},{id:"copyButton",width:new i.ObservableValue(100),renderCell:this._renderCopyButton}],this.containerImageUri=this.props.consumedSource.properties[z.ConsumedArtifactPropertyKeys.ContainerImageUri];const s="https://"+this.containerImageUri;this._hasImageDetails(s).then((e=>{e&&e.hasOwnProperty("hasImageDetails")&&(this.hasImageDetails=e.hasImageDetails[s],this.setState({}))}))}render(){return this.props.consumedSource?r.createElement(f.Card,{className:"bolt-table-card",headerIconProps:{render:this._renderIcon},titleProps:{text:this.props.consumedSource.alias+" / "+this.props.consumedSource.versionName},headerCommandBarItems:this._getCommandBarItems(),contentProps:{contentPadding:!1}},this._jobsTable()):r.createElement(r.Fragment,null)}_getCommandBarItems(){let e=[];return this.hasImageDetails&&e.push({important:!0,id:"viewDetails"+this.props.consumedSource.versionId,text:D.ViewDetails,onActivate:()=>{var e=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.buildId,C.NavConstants.artifacts,void 0,void 0,{[C.NavConstants.imageUri]:this.props.consumedSource.properties[z.ConsumedArtifactPropertyKeys.ContainerImageUri],[C.NavConstants.alias]:this.props.consumedSource.alias,[C.NavConstants.tag]:this.props.consumedSource.versionName});(0,a.onClickFPS)(this.context.pageContext,e,!0)}}),e}_jobsTable(){const e=new i.ObservableArray(this.props.consumedSource.consumedArtifacts);return r.createElement(B.Table,{itemProvider:e,columns:this._jobsTableColumns,ariaLabel:D.ConsumedContainerTableText})}_hasImageDetails(e){let t={imageNames:[e]};return this.context.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-environments-web.has-image-details-data-provider",t,!0)}}t[e].ConsumedContainerResourcesCard=s}("ComponentsConsumedArtifactsComponentConsumedContainerResourcesCard"),function(e){O=t[e]={};class s extends v.VssComponent{constructor(){super(...arguments),this._renderIcon=()=>r.createElement("div",null,r.createElement("img",{src:(0,k.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:D.Pipeline})),this._getIcon=()=>"Package",this._renderNameCell=(e,t,i,s)=>r.createElement(B.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},r.createElement(V.Icon,{className:"pipelines-icon-right-margin",iconName:this._getIcon()}),r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(E.Tooltip,{overflowOnly:!0,text:s.artifactName},r.createElement("span",{className:"text-ellipsis fontWeightSemiBold"},s.artifactName)))),this._commandBarItems=[{important:!0,id:"viewDetails"+this.props.consumedSource.versionId,text:D.ViewDetails,onActivate:()=>{let e=this.context.pageContext.getService("IBuildLinkingService");(0,a.onClickFPS)(this.context.pageContext,e.getBuildUrl(Number(this.props.consumedSource.versionId),"",this.props.consumedSource.properties[z.ConsumedArtifactPropertyKeys.ProjectId]),!0)}}],this._jobsTableColumns=[{id:D.ConsumedArtifactsNameColumn,width:-100,name:D.ConsumedArtifactsNameColumn,renderCell:this._renderNameCell,columnStyle:2}]}render(){return this.props.consumedSource?r.createElement(f.Card,{className:"bolt-table-card",headerIconProps:{render:this._renderIcon},titleProps:{text:this.props.consumedSource.alias+" / # "+this.props.consumedSource.versionName},headerCommandBarItems:this._commandBarItems,contentProps:{contentPadding:!1}},this._jobsTable()):r.createElement(r.Fragment,null)}_jobsTable(){const e=new i.ObservableArray(this.props.consumedSource.consumedArtifacts);return r.createElement(B.Table,{itemProvider:e,columns:this._jobsTableColumns,ariaLabel:D.ConsumedPipelineTableText})}}t[e].ConsumedPipelineResourcesCard=s}("ComponentsConsumedArtifactsComponentConsumedPipelineResourcesCard"),function(e){j=t[e]={};class s extends v.VssComponent{constructor(e,t){super(e,t),this._renderIcon=()=>r.createElement("div",null,r.createElement("img",{src:(0,k.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/repository.svg"),alt:D.Repository})),this._getIcon=e=>{if(e){if(g.equals(e.artifactType,z.ConsumedArtifactTypes.TfsVersionControl,!0))return"TFVCLogo";if(g.equals(e.artifactType,z.ConsumedArtifactTypes.TfsGit,!0))return"GitLogo";if(g.equals(e.artifactType,z.ConsumedArtifactTypes.GitHub,!0)||g.equals(e.artifactType,z.ConsumedArtifactTypes.GitHubEnterprise,!0))return"GitHubLogo";if(g.equals(e.artifactType,z.ConsumedArtifactTypes.Svn,!0))return"SVNLogo";if(g.equals(e.artifactType,z.ConsumedArtifactTypes.Bitbucket,!0))return"BitbucketLogo32"}return"Repo"},this._renderNameCell=(e,t,i,s)=>r.createElement(B.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},r.createElement(V.Icon,{className:"pipelines-icon-right-margin",iconName:this._getIcon(this.props.consumedSource)}),r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(E.Tooltip,{overflowOnly:!0,text:s.artifactName},r.createElement("span",{className:"text-ellipsis fontWeightSemiBold"},s.artifactName)))),this._commandBarItems=[{important:!0,id:"viewDetails"+this.props.consumedSource.versionId,text:D.ViewDetails,onActivate:()=>{(0,a.onClickFPS)(this.context.pageContext,this.state.commitLink,!0)}}],this._jobsTableColumns=[{id:D.ConsumedArtifactsNameColumn,width:-100,name:D.ConsumedArtifactsNameColumn,renderCell:this._renderNameCell,columnStyle:2}],this.state={commitLink:"#"}}componentDidMount(){if(super.componentDidMount(),this.props.consumedSource){const e=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(this.props.consumedSource.artifactType),t=this.props.consumedSource.consumedArtifacts&&this.props.consumedSource.consumedArtifacts.length>0?this.props.consumedSource.consumedArtifacts[0].artifactName:"",i=this.props.consumedSource.versionId?this.props.consumedSource.versionId.split(":")[0]:"",s=this.props.consumedSource.properties[z.ConsumedArtifactPropertyKeys.ProjectId];e&&this.trackPromise(e.fetchCommitLink({repositoryName:t,commitId:i,displayUri:""},s)).promise.then((e=>{this.setState({commitLink:e})}),(e=>{e.isCanceled||console.log(e)}))}}render(){if(!this.props.consumedSource)return r.createElement(r.Fragment,null);const e=this.props.consumedSource.versionId?this.props.consumedSource.versionId.split(":")[0]:"";return r.createElement(f.Card,{className:"bolt-table-card",headerIconProps:{render:this._renderIcon},titleProps:{text:this.props.consumedSource.alias+" / "+e},headerCommandBarItems:this._commandBarItems,contentProps:{contentPadding:!1}},this._jobsTable())}_jobsTable(){const e=new i.ObservableArray(this.props.consumedSource.consumedArtifacts);return r.createElement(B.Table,{itemProvider:e,columns:this._jobsTableColumns,ariaLabel:D.ConsumedRepositoryTableText})}}t[e].ConsumedRepositoryResourcesCard=s}("ComponentsConsumedArtifactsComponentConsumedRepositoryResourcesCard"),function(e){M=t[e]={};class s extends v.VssComponent{constructor(){super(...arguments),this._renderIcon=()=>r.createElement("div",null,r.createElement("img",{src:(0,k.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:D.Pipeline})),this._getIcon=()=>"Package",this._renderNameCell=(e,t,i,s)=>r.createElement(B.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},r.createElement(V.Icon,{className:"pipelines-icon-right-margin",iconName:this._getIcon()}),r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(E.Tooltip,{overflowOnly:!0,text:s.artifactName},r.createElement("span",{className:"text-ellipsis fontWeightSemiBold"},s.artifactName)))),this._jobsTableColumns=[{id:D.ConsumedArtifactsNameColumn,width:-100,name:D.ConsumedArtifactsNameColumn,renderCell:this._renderNameCell,columnStyle:2}]}render(){return this.props.consumedSource?r.createElement(f.Card,{className:"bolt-table-card",headerIconProps:{render:this._renderIcon},titleProps:{text:this.props.consumedSource.alias+" / # "+this.props.consumedSource.versionName},contentProps:{contentPadding:!1}},this._jobsTable()):r.createElement(r.Fragment,null)}_jobsTable(){const e=new i.ObservableArray(this.props.consumedSource.consumedArtifacts);return r.createElement(B.Table,{itemProvider:e,columns:this._jobsTableColumns,ariaLabel:D.ConsumedPipelineTableText})}}t[e].ConsumedBuildResourcesCard=s}("ComponentsConsumedArtifactsComponentConsumedBuildResourcesCard"),function(e){G=t[e]={};class i extends v.VssComponent{constructor(e){super(e),this._setBreadcrumbs=()=>{const e=this.context.pageContext.getService("IBuildLinkingService"),t=this.context.pageContext.getService("IVssHistoryService"),i=this.props.data.definitionName,s=e.getDefinitionUrl(this.props.data.definitionId),a=this.props.data.buildNumber,r=e.getBuildUrl(this.props.data.buildId),o=D.ConsumedArtifactsText,n=e.getBuildUrl(this.props.data.buildId,C.NavConstants.artifacts,void 0,void 0,{[h.RouteParameters.Type]:t.getState()[h.RouteParameters.Type]});this.context.pageContext.getService("artifacts-header-breadcrumb-service").setBreadcrumbs(i,s,a,r,o,n)}}render(){this.context;return r.createElement("div",null,this._getPipelineResources(),this._getContainerResources(),this._getRepositoryResources(),this._getBuildResources())}componentDidMount(){this._setBreadcrumbs()}_getPipelineResources(){const e=this.props.data.consumedSources.filter((e=>g.equals(e.artifactCategory,z.ArtifactCategory.PipelineArtifactCategory,!0))).map(((e,t)=>r.createElement("div",{className:"page-content-left page-content-right page-content-top",key:"consumed-pipeline-resources-"+t},r.createElement(O.ConsumedPipelineResourcesCard,{consumedSource:e,buildId:this.props.data.buildId}))));return r.createElement("div",{className:e&&e.length>0?"card-spacer":""},...e)}_getContainerResources(){const e=this.props.data.consumedSources.filter((e=>g.equals(e.artifactCategory,z.ArtifactCategory.ContainerArtifactCategory,!0))).map(((e,t)=>r.createElement("div",{className:"page-content-left page-content-right page-content-top",key:"consumed-container-resources-"+t},r.createElement(H.ConsumedContainerResourcesCard,{consumedSource:e,buildId:this.props.data.buildId}))));return r.createElement("div",{className:e&&e.length>0?"card-spacer":""},...e)}_getRepositoryResources(){const e=this.props.data.consumedSources.filter((e=>g.equals(e.artifactCategory,z.ArtifactCategory.RepositoryArtifactCategory,!0))).map(((e,t)=>r.createElement("div",{className:"page-content-left page-content-right page-content-top",key:"consumed-repository-resources-"+t},r.createElement(j.ConsumedRepositoryResourcesCard,{consumedSource:e,buildId:this.props.data.buildId}))));return r.createElement("div",{className:e&&e.length>0?"card-spacer":""},...e)}_getBuildResources(){const e=this.props.data.consumedSources.filter((e=>g.equals(e.artifactCategory,z.ArtifactCategory.BuildArtifactCategory,!0))).map(((e,t)=>r.createElement("div",{className:"page-content-left page-content-right page-content-top",key:"consumed-repository-resources-"+t},r.createElement(M.ConsumedBuildResourcesCard,{consumedSource:e,buildId:this.props.data.buildId}))));return r.createElement("div",{className:e&&e.length>0?"card-spacer":""},...e)}}t[e].ConsumedArtifactsView=i}("ComponentsConsumedArtifactsComponentConsumedArtifactsView"),function(){t.ComponentsConsumedArtifactsComponentConsumedArtifactsTabService={};class e extends s.VssService{constructor(){super(...arguments),this._renderConsumedArtifacts=()=>r.createElement(n.Observer,{data:this._data},(e=>r.createElement(G.ConsumedArtifactsView,{data:e.data}))),this._tab={id:"consumedArtifacts",name:D.ConsumedArtifactsTabName,order:2,render:this._renderConsumedArtifacts},this._contributionService=()=>this.pageContext.getService("IVssContributionService"),this._data=new i.ObservableValue(void 0),this._tabs=new i.ObservableArray}getTabs(e,t){return this._initialize(),this._data.value&&this._data.value.consumedSources.length>0&&0===this._tabs.length&&this._tabs.push(this._tab),this._tabs}_initialize(){const e=this._contributionService().getData("ms.vss-build-web.run-consumed-artifacts-data-provider");e&&(this._data.value=e)}}s.Services.add("pipelines-run-consumed-artifacts-tab-provider-service",{serviceFactory:e})}()}),["Resources","Components/ArtifactsHeaderBreadcrumbService","Components/TreeColumnAction","Constants","Components/PublishedArtifactsView","Components/ContainerImageDetails","Components/PublishedArtifactsTabService","Components/ArtifactsTabView","Components/ConsumedArtifactsComponent/ConsumedArtifactsResources","Components/ConsumedArtifactsComponent/ConsumedContainerResourcesCard","Components/ConsumedArtifactsComponent/ConsumedPipelineResourcesCard","Components/ConsumedArtifactsComponent/ConsumedRepositoryResourcesCard","Components/ConsumedArtifactsComponent/ConsumedBuildResourcesCard","Components/ConsumedArtifactsComponent/ConsumedArtifactsView","Components/ConsumedArtifactsComponent/ConsumedArtifactsTabService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.artifacts-view"}}));