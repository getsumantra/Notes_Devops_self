"use strict";define("Run/Extensions",["require","exports","react","VSS/Legacy/Legacy","VSSUI/Card","VSS/Platform/Fetch","Build/Shared/Components/Timeline/index","VSSUI/Table","VSS/Core/Observable","VSS/Platform/Context","VSS/Platform/Feature","VSSUI/Observer","VSSUI/Utilities/Provider","VSSUI/TooltipEx"],(function(e,t,a,r,n,s,l,i,o,c,d,m,u,b){var p,h,v,S;p=t[S="Resources"]={},t[S].TabName="Extensions",function(e){t[e]={},t[e].LegacySection=function(e){const t=[],[s,l]=a.useState([]);a.useEffect((()=>{l(e.contributions)}),[e.contributions]),a.useEffect((()=>{t.forEach((t=>t(e.build)))}),[e.build]);const i=e=>{console.error("Not supported")},o=a=>{t.push(a),a(e.build)};return a.createElement("div",null,s.map((e=>{const t={onBuildChanged:o,onViewDisplayed:i,selectTab:i,setSectionVisibility:i};return a.createElement(n.Card,{key:e.id,className:"build-ext-card"},a.createElement("div",null,a.createElement("h3",{className:"body-xl"},e.name),a.createElement(r.LegacyComponent,{modules:["Build/Scripts/LoadSecuredKnockout","VSSPreview/Providers/ContentHost"],wrappedType:"vssLegacyContributionContentHost",wrappedProps:{className:"content body-m",context:t,contribution:e.id},expectRegisteredInstance:!0})))})))}}("ComponentsLegacySection"),function(e){function l(e){const t=e.trim().toLowerCase();return!/^(vbscript|javascript|file|data):/.test(t)}h=t[e]={},t[e].validateLinkProtocol=l;const i={breaks:!0,html:!0,validateLink:l};t[e].MarkdownCard=function(e){const[t,l]=a.useState([]);return a.useEffect((()=>{const t=[],a=[];(e.data||[]).forEach((e=>{e.name=e.name.replace(".md","");const r=e._links.self;r&&r.href&&(t.push((0,s.issueRequest)(r.href).then((async e=>{const t=await e.arrayBuffer();let a=new Uint8Array(t);a.length>=3&&239===a[0]&&187===a[1]&&191===a[2]&&(a=a.slice(3,a.length-1));return(new TextDecoder).decode(a)}),(e=>(console.error(e),"")))),a.push(e.name))})),Promise.all(t).then((e=>{l(e.map(((e,t)=>({name:a[t],content:e}))))}))}),[e.data]),a.createElement(a.Fragment,null,t.sort(((e,t)=>e.name.localeCompare(t.name,navigator.language))).map(((e,t)=>a.createElement(n.Card,{key:e.name+t,className:"build-ext-card"},a.createElement("div",null,a.createElement("div",{"aria-level":2,className:"body-xl",role:"heading"},e.name),a.createElement(r.LegacyComponent,{modules:["DistributedTaskControls/Components/MarkdownRenderer"],wrappedType:"dtMarkdownRenderer",wrappedProps:{cssClass:"content body-m",markdownRendererOptions:i,markdown:e.content}}))))))}}("ComponentsMarkdownCard"),function(e){v=t[e]={};const r=l.Timeline;t[e].Region="buildSummaryTimeline",t[e].RunTimeline=function(n){return a.createElement(r,{resource:n.build,className:"flex",projectId:n.projectId,regionForSnapshots:t[e].Region,showAllContributedItemsAtOnce:!0})}}("ComponentsTimeline"),function(){t.ParametersTabService={};class e extends c.VssService{constructor(){super(...arguments),this._dataProviderId="ms.vss-environments-web.environments-run-view-data-provider",this._tabs=new o.ObservableArray,this._renderParams=()=>a.createElement(m.Observer,{data:this._contextualData.templateParameters},(e=>a.createElement(n.Card,null,a.createElement(i.Table,{ariaLabel:"Triggers",className:"triggers-table",columns:this._tableColumns,itemProvider:new u.ArrayItemProvider(this._transformData(e.data)),scrollable:!0})))),this._tab={id:"parameters-tab",name:"Parameters",order:3,render:this._renderParams},this._tableColumns=[{id:"label",width:new o.ObservableValue(-40),name:"Label",renderCell:this._renderLabel},{id:"value",width:new o.ObservableValue(-60),name:"Value",renderCell:this._renderValue}]}getTabs(e,t){return(0,d.isFeatureFlagEnabled)(this.pageContext,"Pipelines.ShowParametersTab",!1)?(t&&(this._contextualData=t),t&&t.templateParameters.value&&Object.keys(t.templateParameters.value).length>0?[this._tab]:[]):[]}_transformData(e){if(!e)return[];let t=[];return Object.entries(e).map((([e,a])=>t.push({label:e,value:a}))),t}_renderLabel(e,t,r,n){return a.createElement(i.SimpleTableCell,{columnIndex:t,tableColumn:r,key:"col-"+t},a.createElement("div",{className:"parameters-tab-styles flex-row scroll-hidden"},a.createElement("span",{className:"text-ellipsis text-selectable"},a.createElement(b.Tooltip,{text:n.label,overflowOnly:!0},a.createElement("span",{className:"flex-row","aria-label":n.label},n.label)))))}_renderValue(e,t,r,n){return a.createElement(i.SimpleTableCell,{columnIndex:t,tableColumn:r,key:"col-"+t},a.createElement("div",{className:"parameters-tab-styles flex-row scroll-hidden"},a.createElement("span",{className:"text-ellipsis text-selectable"},a.createElement(b.Tooltip,{text:n.value,overflowOnly:!0},a.createElement("span",{className:"flex-row","aria-label":n.value},n.value)))))}}c.Services.add("pipelines-parameters-tab-provider-service",{serviceFactory:e})}(),function(e){t[e]={};class r extends c.VssService{constructor(){super(...arguments),this._tabs=new o.ObservableArray,this._tab={id:"ms.vss-build-web.run-extensions-tab",name:p.TabName,order:100},this._fetch=async()=>{if(this._data){const e=this._data.runId.value,t=this._data.projectId.value,r=this.pageContext.getRestClient("IBuildRestClient"),n=await r.getBuild(t,e),s=await r.getAttachments(t,e,"DistributedTask.Core.Summary")||[],l=await r.getAttachments(t,e,"Distributedtask.Core.Summary")||[],i=s.concat(l),o=this.pageContext.getService("IVssLayoutManager").getComponentsForRegion(v.Region);(i.length>0||o.length>0)&&(this._tab.render=()=>a.createElement(a.Fragment,null,a.createElement(v.RunTimeline,{build:n,projectId:t}),a.createElement(h.MarkdownCard,{data:i})),0==this._tabs.length&&this._tabs.push(this._tab))}}}getTabs(e,t){return this._data=t,this._data&&(this._fetch(),this._data.status.subscribe(this._fetch)),this._tabs}_serviceEnd(e){this._data&&this._data.status.unsubscribe(this._fetch)}}t[e].RunTabService=r,c.Services.add("run-ext-tab-service",{serviceFactory:r})}("RunTabService")}),["Resources","Components/LegacySection","Components/MarkdownCard","Components/Timeline","ParametersTabService","RunTabService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.run-extensions"}}));