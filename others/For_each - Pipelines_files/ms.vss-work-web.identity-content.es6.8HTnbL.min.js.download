"use strict";define("Wit/Identity",["require","exports","VSS/Core/Util/String","VSS/Platform/Identity","VSS/Platform/Location","VSSUI/Utilities/PersonaHelper"],(function(t,e,i,n,r,a){var s,d;e[d="ConstantsConstants"]={},(s=e[d].SubjectType||(e[d].SubjectType={})).AadUser="aad",s.AadGroup="aadgp",s.AadServicePrincipal="aadsp",e.InterfacesWorkItemInterfaces={},function(t){e[t]={};e[t].getUniquefiedIdentityName=t=>(0,a.getUniquefiedIdentityName)(t);let s={},d={},I={};function o(t){var e;if(!t)return"";var n="",r=t.lastIndexOf(a.IdentitySeparators.IDENTITY_UNIQUENAME_SEPARATOR);if(e=-1===r?t:t.substr(0,r),i.startsWith(e,a.IdentitySeparators.TFS_GROUP_PREFIX)){var s=e.substr(3).trim();n=i.isGuid(s)?s:""}return n}function y(t){if(!t)return null;var e=t.lastIndexOf(a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),n=t.lastIndexOf(a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END),r=!1,s=!1,d=!1,I=t;e>=0&&n>e&&(d=!0,I=I.replace(a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START).replace(a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)),e=I.lastIndexOf(a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),n=I.lastIndexOf(a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END);var y=I,u="",l="";let E="";var N,f="";if(e>=0&&n>e)if(y=I.substr(0,e).trim(),d){0===(f=I.substr(e+1,n-e-1).trim()).indexOf(a.IdentitySeparators.AAD_IDENTITY_USER_PREFIX)?f=f.substr(a.IdentitySeparators.AAD_IDENTITY_USER_PREFIX.length):0===f.indexOf(a.IdentitySeparators.AAD_IDENTITY_GROUP_PREFIX)&&(r=!0,f=f.substr(a.IdentitySeparators.AAD_IDENTITY_GROUP_PREFIX.length));var m=f.lastIndexOf("\\");m>0&&(-1!==(l=f.substr(m+1).trim()).indexOf("@")?(u=l,f=f.substr(0,m).trim()):(y=t,f="",d=!1,r=!1))}else{var c=o(l=I.substr(e+1,n-e-1).trim());E=(N=l)?0!=N.indexOf(a.IdentitySeparators.DESCRIPTOR_PREFIX)?"":N.replace(/desc:/i,""):"",-1!==l.indexOf("@")||-1!==l.indexOf("\\")||-1!==l.indexOf(a.IdentitySeparators.DESCRIPTOR_PREFIX)||c||i.isGuid(l)?(u=l,""!=c&&(f=c,r=!0,s=!0,u="")):y=t}return{id:null!=f?f:y,displayName:y,uniqueName:E||u||y,isAadIdentity:d,isContainer:r,isTfsGroup:s}}function u(t,e,i){var n;const r=l(e),a=E(e);if(i&&!r&&!a)return N(t,e);if(r){const t=e;return i?t.identityRef:t.distinctDisplayName||t.identityRef.displayName}if(a){const t=e;return t.uniqueName=null!==(n=t.uniqueName)&&void 0!==n?n:t.displayName,i?t:t.displayName}return e}function l(t){if(t&&void 0!==t.identityRef){const e=t;return e.distinctDisplayName&&!s[e.distinctDisplayName]&&(e.identityRef&&!e.identityRef.uniqueName&&(e.identityRef.uniqueName=e.identityRef.displayName),s[e.distinctDisplayName]=e),e.identityRef&&e.identityRef.descriptor&&!d[e.identityRef.descriptor]&&(d[e.identityRef.descriptor]=e),!0}return!1}function E(t){return!(!t||void 0===t.displayName)}function N(t,e,i){if(s[e])return s[e].identityRef;const n=y(e),r=t.getService("IVssIdentityService");return i=i||r.getIdentityImageUrl(n?n.id:""),n&&n.isAadIdentity?{displayName:e}:n&&{displayName:n.displayName,uniqueName:n.uniqueName,imageUrl:i,_links:{avatar:{href:i}}}}function f(t){let e=Object.assign({},t);return t.identityRef.displayName&&(e.identityRef.displayName=y(e.identityRef.displayName).displayName),e}function m(t,e){return t&&e?i.format("{0} {1}{2}{3}",t,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,e,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function c(t,e){return t&&e?i.format("{0} {1}{2}{3}{4}",t,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,a.IdentitySeparators.TFS_GROUP_PREFIX,e,a.IdentitySeparators.IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function p(i,n,r){const a=(0,e[t].getUniquefiedIdentityName)(n),s=N(i,a,r);return void 0===s.id&&void 0!==(null==n?void 0:n.localId)&&(s.id=n.localId),void 0===s.descriptor&&void 0!==(null==n?void 0:n.subjectDescriptor)&&(s.descriptor=n.subjectDescriptor),{distinctDisplayName:a,identityRef:s}}function R(t,e){const i=t.getService("IVssIdentityService").getIdentityImageUrl(e);return{displayName:e.displayName,entityId:e.id,entityType:"User",image:i}}e[t].getVsIdFromGroupUniqueName=o,e[t].parseUniquefiedIdentityName=y,e[t].setResolvedByDescriptorIfWorkItemIdentityRef=function(t){l(t)&&t.identityRef&&t.identityRef.descriptor&&(I[t.identityRef.descriptor]=!0)},e[t].convertPotentialIdentityRefFromFieldValue=u,e[t].convertPotentialIdentityRefFromFieldValueNotAsIdentityRef=function(t){return l(t)?t.distinctDisplayName||t.identityRef.displayName:E(t)?t.displayName:t},e[t].isWorkItemIdentityRef=l,e[t].isIdentityRef=E,e[t].createIdentityRefFromDistinctDisplayName=N,e[t].convertWorkItemIdentityRefFromFieldValue=function(t,e){var i;if(l(e))return f(e);if(function(t){const e=t&&"string"==typeof t.displayName&&void 0!==t.entityId;return e}(e)){return f(p(t,e,e.image))}let n=u(t,e,!0);return n||(n={displayName:e}),f({distinctDisplayName:null!==(i=n.displayName)&&void 0!==i?i:e,identityRef:n})},e[t].uniqueSortWorkItemIdentityRefObjects=function(t){if(!t||0===t.length)return t;const e={};return t.forEach((t=>e[t.distinctDisplayName]=t)),Object.keys(e).sort(i.localeIgnoreCaseComparer).map((t=>e[t]))},e[t].getFriendlyDistinctDisplayName=function(t){return t.displayName&&t.uniqueName&&!t.isTfsGroup?t.isContainer?c(t.displayName,t.id):m(t.displayName,t.uniqueName):t.displayName||""},e[t].getDistinctDisplayName=m,e[t].getDistinctGroupDisplayName=c,e[t].convertIIdentityToWorkItemIdentityRef=p,e[t].convertWorkItemIdentityRefToIIdentity=function(t,e){const i=null==e?void 0:e.identityRef;if(i)return R(t,i)},e[t].convertIdentityRefToIIdentity=R,e[t].getIIdentityObject=function(t,e,a){if(!e)return;const s="@me";if(0===(0,i.localeIgnoreCaseComparer)(e,s))return{displayName:s,entityId:s,entityType:"User",originDirectory:"",originId:"",image:(0,r.getAssetLocation)(t,"ms.vss-work-web/common-content/Content/memacro-user.svg")};const d=e.substring(0,e.indexOf("<")).trim(),I=-1!==e.indexOf("<id:");let o;return o=I?e.substring(e.indexOf(":")+1,e.length-1).trim():e.substring(e.indexOf("<")+1,e.length-1).trim(),{displayName:d,entityId:null!=a?a:"",entityType:I?"Group":"User",localId:I?o:"",mail:I?"":o,originId:I?o:"",samAccountName:I?"":o,signInAddress:I?"":o,image:(0,n.getIdentityImageUrl)(t,N(t,e))}};const T=/.*\<[0-9\-\@a-f]+\>$/i;e[t].stripIdPartFromDisplayName=function(t){return T.test(t)?t.substr(0,t.lastIndexOf("<")).trim():t},e[t].isAADGroupIdentity=function(t){return!!t&&((0,a.isEntraIDIdentity)(t)&&i.equals(t.entityType,"Group",!0))},e[t].getAADGroupName=function(t){return t.displayName&&t.originId?i.format("{0} {1}{2}{3}{4}",t.displayName,a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,a.IdentitySeparators.AAD_IDENTITY_GROUP_PREFIX,t.originId,a.IdentitySeparators.AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}}("UtilitiesWorkItemIdentityHelper")}),["Constants/Constants","Interfaces/WorkItemInterfaces","Utilities/WorkItemIdentityHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.identity-content"}}));