"use strict";define("Build/ApprovalsPanel",["require","exports","VSS/Core/Util/String","react","VSS/Core/Observable","VSS/Features/Identities/IdentityPickerProvider","VSSUI/Dialog","VSSUI/Icon","VSSUI/IdentityPicker","VSS/Platform/Layout","VSSUI/Observer","VSSUI/Spinner","VSSUI/TextField","VSS/Platform/Location","VSSUI/Status","VSS/Platform/Identity","VSSUI/Button","VSSUI/DatePicker","VSSUI/SplitButton","VSSUI/Link","VSSUI/Menu","VSSUI/MessageCard","VSSUI/Panel","VSSUI/Util","VSSUI/Utilities/Date","VSSUI/VssPersona","PipelinesUI/LogViewer","VSS/Platform/Feature","VSSUI/Pill","Build/Common/Library/Components/CommandComponent","VSSUI/ButtonGroup","VSSUI/List","VSSUI/TooltipEx","VSSUI/Utilities/Provider","VSS/Platform/Context","Build/Common/Library/Indicator","VSS/Platform/Fetch","VSS/Platform/Components/Format","VSS/Features/PlatformUI/FPSLink","VSSUI/TreeEx","VSSUI/Utilities/TreeItemProvider","VSSUI/Components/Time/Time/Time","VSSUI/Resources.Core"],(function(e,t,a,s,n,i,o,r,l,c,p,u,d,m,g,h,v,k,C,f,y,b,E,S,P,A,R,w,x,I,N,T,D,M,V,O,F,L,B,U,j,q,_){var W,z,G,H,Q,$,J,X,Y,Z,K,ee,te;W=t[te="Resources"]={},t[te].AgentPool="Agent pool",t[te].AgentQueue="Queue",t[te].AllPendingPanelTitle="Waiting for review",t[te].Approval="Approval",t[te].PreApproval="Pre-approval",t[te].PostApproval="Post-approval",t[te].ApprovalInSequence="All approvers must approve in sequence",t[te].Approve="Approve",t[te].ApproveAll="Approve all",t[te].ApproveAndDefer="Approve and defer",t[te].Approved="Approved",t[te].Approver="Approver",t[te].ApprovedFormat="Approved • {0}",t[te].ApproveWithComment="Approve with comment",t[te].Approvers="Approvers",t[te].AttemptFormat="Attempt {0}",t[te].BypassCheck="Bypass check",t[te].Bypassed="Bypassed",t[te].BypassedBy="Bypassed by {0}",t[te].Cancel="Cancel",t[te].Canceled="Canceled",t[te].CanceledFormat="Canceled • {0}",t[te].CompletedBy="Completed by {0}",t[te].CheckReevaluateStatusString="{0} • {1}",t[te].CheckRowToolTip="{0} {1} on {2} {3}",t[te].CheckRowToolTipWithResult="{0} on {1} {2}",t[te].Comment="Comment (optional)",t[te].CommentHeader="Comment:",t[te].Date="Date",t[te].DefaultApproval="All approvers must approve",t[te].DefaultPanelTitle="Checks",t[te].DeferApproval="Defer approval",t[te].DeferredApproval="Approval deferred",t[te].DeferredTo="Deferred to",t[te].Edit="Edit",t[te].Environment="Environment",t[te].ExclusiveLock="Exclusive lock",t[te].ExclusiveLockAcquired="Lock acquired",t[te].ExclusiveLockHeldBy="Lock held by",t[te].ExclusiveLockDidNotObtain="Did not obtain the lock",t[te].ExclusiveLockQueued="Waiting on other checks",t[te].ExclusiveLockWaiting="Waiting on lock",t[te].Expired="Expired",t[te].Failed="Failed",t[te].FailedFormat="Failed • {0}",t[te].GenericCheckLogFormat="{0} • {1}",t[te].Grant="Grant",t[te].GrantSecondary="Anyone with a valid account can provide proof of presence. ",t[te].Hours="Hours",t[te].Job="Job",t[te].InstructionsLabel="Instructions",t[te].InProgress="In progress",t[te].InProgressFormat="In progress • {0}",t[te].LearnMore="Learn More",t[te].LearnMoreAbout="Learn more about {0}",t[te].LearnMoreAboutShort="About {0}",t[te].ProductionReadinessCheckLearnLink="https://aka.ms/azdo-prc",t[te].ManualValidation="Manual Validation",t[te].Minutes="Minutes",t[te].MoreTooltip="More options",t[te].MinApproversApproval="At least {0} approvers must approve",t[te].SingleMinApproversApproval="At least 1 approver must approve",t[te].OnBehalfOfFormat=" on behalf of {0}",t[te].Others="Others",t[te].PersistedStage="Persisted stage",t[te].PRCFailedMessage="PRC encountered an error. Please queue another run.",t[te].ProductionReadinessCheck="Production readiness",t[te].RetryString="Reevaluating",t[te].Reject="Reject",t[te].RejectAll="Reject all",t[te].Rejected="Rejected",t[te].RejectedFormat="Rejected • {0}",t[te].RejectedDescription="At least 1 approver rejected this deployment",t[te].RejectWithComment="Reject with comment",t[te].RequiredByPipelineDefinition="Required by pipeline definition",t[te].RequiredTemplate="Required template",t[te].Save="Save",t[te].TimeZone="Time zone",t[te].Timeout="Timeout",t[te].TimedOut="Timed out",t[te].TimedOutFormat="Timed out • {0}",t[te].TimedOutFormatLog="Timed out • {0}",t[te].Resource="Resource",t[te].ResourceName="Resource name : {0}",t[te].ResourceType="Resource type : {0}",t[te].Resume="Resume",t[te].ResumeAll="Resume all",t[te].Resumed="Resumed",t[te].ResumedFormat="Resumed • {0}",t[te].Requirement="Requirement",t[te].Passed="Passed",t[te].PassedFormat="Passed • {0}",t[te].Permission="Permission",t[te].PermissionSecondary="Permission needed",t[te].Permit="Permit",t[te].Reassign="Reassign",t[te].Reassigned="{0} (reassigned)",t[te].ReassignMessage="You are reassigning approval for 1 resource",t[te].ReassignMessageMultipleResource="You are reassigning approval for {0} resources",t[te].ReassignSpinnerLabel="Reassigning...",t[te].PermitConfirmDialogTitle="Permit access?",t[te].PermitConfirmDialogDescription="Granting permission here will permit the use of {0} '{1}' for all waiting and future runs of this pipeline.",t[te].Queued="Queued",t[te].QueuedFormat="Queued • {0}",t[te].QueueBuildPermissionHoldersCanResume="Queue Build permission holders can resume",t[te].Repository="Repository",t[te].Running="Running",t[te].SecureFile="Secure file",t[te].SeeReviewOptions="See review options",t[te].ServiceConnection="Service connection",t[te].StagePanelTitleCommon="Checks and manual validations for {0}",t[te].StagePanelTitleChecks="Checks for {0}",t[te].StagePanelTitleManualValidation="Manual validations for {0}",t[te].StageTimeoutMessageToolTipWithSingleCheck="Timeout configured on {0} check",t[te].StageTimeoutMessageToolTipWithMultipleChecks="Timeout configured on {0} check and {1} others",t[te].VariableGroup="Variable group",t[te].Version="Version   : {0}",t[te].Waiting="Waiting",t[te].WaitingApproval="Waiting for approval",t[te].WaitingApprovalFormat="Waiting for approval • {0}",t[te].WaitingFormat="Waiting • {0}",t[te].WaitingInSequence="Waiting on sequence",t[te].WaitingMultipleApprovers="Waiting on {0} approvers",t[te].WaitingOnMe="Waiting on me",t[te].WaitingOnQueueBuildPermissionHolders="Waiting on queue build permission holders",t[te].WaitingSingleApprover="Waiting on 1 approver",t[te].CurrentUserCannotApproveMessage="Configurations on one or more approvals prevent you from approving your own run.",t[te].CurrentUserCannotApproveOwnRunMessage="Configurations on this approval prevent you from approving your own run.",t[te].RemainingTimeInDays="{0} in {1}d",t[te].RemainingTimeInHours="{0} in {1}h",t[te].RemainingTimeInMinutes="{0} in {1}m",t[te].ApprovalTimeForTimeoutFormat="{0} • {1}",t[te].ViewAll="View all",t[te].ProofOfPresenceApprovalFailed="Failed to provide proof of presence",t[te].ProofOfPresenceLink="https://aka.ms/adopop-pipelines",t[te].PolicyNotSatisfied="Policy not satisfied",t[te].AllPoliciesSatisfied="All policies satisfied",t[te].EvaluatingPolicy="Evaluating policy",t[te].ViolationsAlreadyReviewedAndApproved="Violations already reviewed and approved",t[te].AuditModeViolationsReviewedAndApproved="Audit mode: violations automatically approved",t[te].ViolationsReviewedAndRejected="Violations reviewed and rejected",t[te].Review="Review",t[te].ViewApproval="View approval",t[te].ViewRejection="View rejection",t[te].ProductionReadinessReviewPanelTitle="Review policy requirements",t[te].ProductionReadinessApprovedPanelTitle="Approved policy requirements",t[te].ProductionReadinessRejectedPanelTitle="Rejected policy requirements",t[te].ProductionReadinessStageRunningFirstTime="Caution: this pipeline stage may be running for the first time. There are no previous successful runs of this stage. Assess the risk thoroughly.",t[te].ProductionReadinessStageRunningFirstTimeNoStageName="Specify an identifier for the stage to restrict violations computation to last successful run.",t[te].CodeChangeBypassedProofOfPresenceTitle="The following PRs are missing Proof of Presence with accepted tenants.",t[te].MinimumRequiredApproversViolationTitle="The following PRs don't have the minimum required number of reviewers.",t[te].DoesNotExtendApprovedTemplateViolationTitle="The pipeline run doesn’t extend from the set of approved 1ES and OneBranch templates.",t[te].CommitWithoutPullRequestTitle="The following commits were not merged into the used branch using a pull request.",t[te].PreviouslyApproved="Previously approved",t[te].ApproveWithProductionTenant="Approve with {0}",t[te].Expanded="Expanded",t[te].Collapsed="Collapsed",t[te].OnlyUserAndAdminCanApproveTitle="Only users with Administrator or User role can approve violations.",t[te].ViolationsTree="Violations Tree",t[te].ViolationsTreeColumn="ViolationsTreeColumn",t[te].OnlyUserWithDefinitionPermissionCanApproveTitle="Only users with the following pipeline permission(s) can approve violations: {0}.",t[te].OnlyUserWithDefinitionPermissionAndNoViolationsCanApproveTitle="You cannot initiate the approval process for the listed PRC violations. Only users who either are not responsible for any outstanding violations and have {0} pipeline permission(s) or are Project Collection Administrators can start it.",t[te].CommitsExceededLimit="There are more than {0} new commits in this repository. Results may be incomplete.",t[te].ViolationsExceededLimit="Only top {0} violations are shown. Results may be incomplete.",t[te].CommitsAndViolationsExceededLimit="There are more than {0} new commits in this repository. Only top {1} violations are shown. Results may be incomplete.",t[te].CommitsExceededLimitRepoNames="The following repositories have more than {0} new commits: {1}. Policy evaluation may be incomplete.",t[te].ComparedToFormat="Compared to {0}",t[te].ThisBranch="this branch",function(e){z=t[e]={};class s{}t[e].TelemetryConstants=s,s.Area="Checks";class n{}t[e].Features=n,n.ApprovalReassign="ApprovalReassign",t[e].publishEvent=function(e,t,n){const i=e.getService("IVssTelemetryService");try{i.publishEvent(s.Area,t,n)}catch(e){console.error(a.format("[TelemetryService.logProperties]: Error in logging Customer Intelligence data. Error: {0}",e.message))}}}("ChecksTelemetryService"),function(e){G=t[e]={};t[e].ApprovalReassignDialog=e=>{const t=new n.ObservableValue(""),a=new n.ObservableValue(void 0),m=new n.ObservableValue(!0),g=new n.ObservableValue(!1),h=new n.ObservableValue(""),v=(0,c.useComponentContext)(),k=e=>{a.value=e,m.value=!e},C=()=>{if(a.value){let s=a.value,n={displayName:s.displayName,id:s.localId,descriptor:s.subjectDescriptor,imageUrl:s.image,uniqueName:s.mail};g.value=!0,e.onReassign(e.approvalDetails,e.approvalStep,n,t.value).then((()=>{z.publishEvent(v.pageContext,z.Features.ApprovalReassign,{ApprovalId:e.approvalDetails.id,AssignedApprover:e.approvalStep.assignedApprover.id,ReassignTo:n.id})}),(e=>{h.value=e&&e.message||e,g.value=!1}))}},f=new i.PeoplePickerProvider(v.pageContext,{identityTypes:["user","group"],options:{MinResults:1,MaxResults:20}},(e=>e&&e.filter((e=>null!==e.localId))));return e.showDialog?s.createElement(p.Observer,{isReassignDisabled:m,showSpinner:g,error:h},(n=>s.createElement(o.Dialog,{titleProps:{text:W.Reassign},footerButtonProps:[{text:W.Cancel,onClick:e.onCloseDialog,disabled:n.showSpinner},{text:W.Reassign,onClick:C,disabled:n.isReassignDisabled||n.showSpinner,primary:!0}],onDismiss:e.onCloseDialog},!!n.error&&s.createElement("div",{className:"reassign-error-message-section",tabIndex:0},s.createElement(r.Icon,{ariaLabel:"Error icon",iconName:"ErrorBadge",className:"reassign-error-icon"}),n.error),W.ReassignMessage,s.createElement("div",{className:"reassign-approver-header"},W.Approver),s.createElement(l.IdentityPickerDropdown,{onChange:k,pickerProvider:f,value:a,disabled:n.showSpinner}),s.createElement("div",{className:"reassign-comment-header"},W.Comment),s.createElement(d.TextField,{ariaLabel:W.Comment,disabled:n.showSpinner,value:t,onChange:(e,a)=>t.value=a,multiline:!0,rows:4,width:"auto"}),n.showSpinner?s.createElement(u.Spinner,{className:"pipeline-reassign-spinner",label:W.ReassignSpinnerLabel}):s.createElement("div",null)))):s.createElement("div",null)}}("ApprovalReassignDialog"),function(e){H=t[e]={},t[e].Resource_Environment="environment",t[e].Resource_Queue="queue",t[e].Resource_Repository="repository",t[e].Resource_ServiceEndPoint="endpoint",t[e].Resource_VariableGroup="variablegroup",t[e].Resource_AgentPool="agentpool",t[e].Resource_SecureFile="securefile",t[e].Resource_PersistedStage="persistedstage",t[e].PreApprovalDefTypeId="0F52A19B-C67E-468F-B8EB-0AE83B532C99",t[e].MainApprovalDefTypeId="26014962-64A0-49F4-885B-4B874119A5CC",t[e].PostApprovalDefTypeId="06441319-13FB-4756-B198-C2DA116894A4",function(e){e[e.System=0]="System",e[e.SanityChecks=10]="SanityChecks",e[e.PreChecks=20]="PreChecks",e[e.ProductionReadinessCheck=24]="ProductionReadinessCheck",e[e.ProofOfPresence=25]="ProofOfPresence",e[e.ProductionReadinessCheckDeprecated=26]="ProductionReadinessCheckDeprecated",e[e.Main=30]="Main",e[e.PostChecks=40]="PostChecks",e[e.ProofOfPresenceTemp=45]="ProofOfPresenceTemp",e[e.Final=50]="Final"}(t[e].EvaluationOrder||(t[e].EvaluationOrder={})),t[e].MaxDeferralDurationInDays=30,t[e].BuildHubRoute="ms.vss-build-web.ci-results-hub-route"}("Constants"),function(e){function a(e,t,a){const s=function(e){return e.getService("IVssNavigationService").getCurrentRoute().routeValues}(e);let n=Object.assign({project:s.project},a);return s.team&&(n.team=s.team),(0,m.routeUrl)(e,t,n)}Q=t[e]={},t[e].getResourceUrl=function(e,t,r=!1){let l={},c="";const p=r?"checks":"";switch(t.type){case H.Resource_Environment:l={environmentId:t.id,view:p},c=a(e,s,l);break;case H.Resource_Queue:l={adminPivot:"agentqueues",queueId:t.id,view:p},c=a(e,n,l);break;case H.Resource_ServiceEndPoint:l={adminPivot:"adminservices",resourceId:t.id,view:p},c=a(e,n,l);break;case H.Resource_VariableGroup:l={itemType:"VariableGroups",view:"VariableGroupView",variableGroupId:t.id},c=a(e,i,l);break;case H.Resource_SecureFile:l={itemType:"SecureFiles",view:"SecureFileView",secureFileId:t.id},c=a(e,i,l);break;case H.Resource_Repository:const r={};r.project=t.id.split(".",1)[0],r["vc.GitRepositoryName"]=t.name,c=a(e,o,r);case H.Resource_PersistedStage:}return c},t[e].getBuildUrl=function(e,t,a){const s={};return s.project=t,s.buildId=a.toString(),(0,m.routeUrl)(e,r,s)};const s="ms.vss-environments-web.environments-route-with-id",n="ms.vss-admin-web.project-admin-hub-route",i="ms.vss-distributed-task.hub-library-default-route",o="ms.vss-code-web.files-route-git",r="ms.vss-build-web.ci-results-hub-route"}("ResourceLinks"),function(e){var s;function n(e){let t={statusProps:g.Statuses.Waiting,label:W.Waiting};switch(e){case 8:case 56:t.statusProps=g.Statuses.Failed,t.label=W.Failed;break;case 16:t.statusProps=g.Statuses.Canceled,t.label=W.Canceled;break;case 4:t.statusProps=g.Statuses.Success,t.label=W.Passed;break;case 1:t.statusProps=g.Statuses.Queued,t.label=W.Queued;break;case 2:t.statusProps=g.Statuses.Running,t.label=W.InProgress;break;case 32:t.statusProps=g.Statuses.Queued,t.label=W.TimedOut;break;case 128:t.statusProps=g.Statuses.Skipped,t.label=W.Bypassed;break;case 256:t.statusProps=g.Statuses.Success,t.label=W.DeferredApproval}return t}function i(e){switch(e){case 8:case 64:return 0;case 2:return 1;case 4:case 16:case 128:return 2;default:return 3}}$=t[e]={},function(e){e[e.Default=0]="Default",e[e.Warning=1]="Warning"}(s=t[e].StatusIndicatorMessageStyle||(t[e].StatusIndicatorMessageStyle={})),t[e].getProductionReadinessStatusIndicatorData=function(e,t=!1,a,i,o){let r;switch(r=n(e),e){case 2:r.statusProps=t?g.Statuses.Waiting:g.Statuses.Running,r.label=t?W.WaitingApproval:W.InProgress,r.statusIndicatorMessage=t?W.PolicyNotSatisfied:W.EvaluatingPolicy,r.statusIndicatorMessageStyle=t?s.Warning:s.Default,r.hoverMessage=o;break;case 8:r.label=W.Rejected,r.statusIndicatorMessage=t?W.ViolationsReviewedAndRejected:void 0,r.statusIndicatorMessageStyle=s.Default;break;case 4:r.statusIndicatorMessage=a?t?W.AuditModeViolationsReviewedAndApproved:W.AllPoliciesSatisfied:t?i||W.ViolationsAlreadyReviewedAndApproved:W.AllPoliciesSatisfied,r.statusIndicatorMessageStyle=s.Default,r.hoverMessage=o;break;case 56:r.statusIndicatorMessage=W.PRCFailedMessage}return r},t[e].getApprovalStatusIndicatorData=function(e,t=!1){let a={statusProps:g.Statuses.Waiting,label:W.WaitingApproval};switch(e){case 8:a.statusProps=g.Statuses.Failed,a.label=W.Rejected;break;case 32:a.statusProps=g.Statuses.Canceled,a.label=W.Canceled;break;case 4:a.statusProps=g.Statuses.Success,a.label=t?W.Resumed:W.Approved;break;case 1:a.statusProps=g.Statuses.Queued,a.label=W.WaitingInSequence;break;case 64:a.statusProps=g.Statuses.Queued,a.label=W.TimedOut;break;case 16:a.statusProps=g.Statuses.Skipped,a.label=W.Bypassed;break;case 128:a.statusProps=g.Statuses.Success,a.label=W.DeferredApproval}return a},t[e].getExclusiveLockStatusIndicatorData=function(e){let t={statusProps:g.Statuses.Waiting,label:W.Waiting};switch(e){case 8:case 16:t.statusProps=g.Statuses.Canceled,t.label=W.ExclusiveLockDidNotObtain;break;case 56:t.statusProps=g.Statuses.Failed,t.label=W.Failed;break;case 4:t.statusProps=g.Statuses.Success,t.label=W.ExclusiveLockAcquired;break;case 1:t.statusProps=g.Statuses.Queued,t.label=W.ExclusiveLockQueued;break;case 2:t.statusProps=g.Statuses.Waiting,t.label=W.ExclusiveLockWaiting;break;case 32:t.statusProps=g.Statuses.Queued,t.label=W.TimedOut;break;case 256:t.statusProps=g.Statuses.Success,t.label=W.DeferredApproval;break;case 128:t.statusProps=g.Statuses.Skipped,t.label=W.Bypassed}return t},t[e].checksToApprovalStatus=function(e){switch(e){case 8:return 8;case 16:return 32;case 4:return 4;case 2:return 2;case 32:return 64;case 128:return 16;case 0:return 0;case 256:return 128}return 1},t[e].getApprovalStatus=function(e,t=!1){let a="";switch(e){case 2:a=W.Waiting;break;case 4:a=t?W.ResumedFormat:W.ApprovedFormat;break;case 8:a=W.RejectedFormat;break;case 64:a=W.TimedOutFormat;break;case 1:a=W.WaitingInSequence;break;case 32:a=W.Canceled;break;case 16:a=W.Bypassed;break;case 128:a=W.DeferredApproval}return a},t[e].getCheckRunStatusIndicatorData=n,t[e].getCheckRunUpdateModifiedByIdentity=function(e,t){if(t&&(null==t?void 0:t.length)>0){let a=t.find((t=>t.status===e));if(a)return a.modifiedBy}},t[e].getResourceTypeIcons=function(e){let t="";switch(e){case H.Resource_Environment:t=o;break;case H.Resource_Queue:t=r;break;case H.Resource_ServiceEndPoint:t=l;break;case H.Resource_SecureFile:t=u;break;case H.Resource_VariableGroup:t=c;break;case H.Resource_AgentPool:t=p;break;case H.Resource_Repository:t=d;break;case H.Resource_PersistedStage:t=m}return t},t[e].getResourceTypeString=function(e){let t="";switch(e){case H.Resource_Environment:t=W.Environment;break;case H.Resource_Queue:t=W.AgentPool;break;case H.Resource_ServiceEndPoint:t=W.ServiceConnection;break;case H.Resource_SecureFile:t=W.SecureFile;break;case H.Resource_VariableGroup:t=W.VariableGroup;break;case H.Resource_AgentPool:t=W.AgentPool;break;case H.Resource_Repository:t=W.Repository;break;case H.Resource_PersistedStage:t=W.PersistedStage}return t},t[e].approvalSort=function(e,t){const a=i(e.status),s=i(t.status);return a<s?-1:a>s?1:0},t[e].stepSort=function(e,t){const a=e.id,s=t.id;return a<s?-1:a>s?1:0},t[e].getRemainingMinutesForCheckTimeout=function(e,t){const a=new Date;return e*h-(a.getTime()-t.getTime())},t[e].getCheckTimeoutOrReevaluationString=function(e,t){let s="";const n=Math.floor(t/k),i=Math.floor(t%k/v),o=Math.floor(t%v/h);return s=t<v?(0,a.format)(W.RemainingTimeInMinutes,e,o):t<k?(0,a.format)(W.RemainingTimeInHours,e,i):(0,a.format)(W.RemainingTimeInDays,e,n),s},t[e].approversSort=function(e,t){const a=e.assignedApprover.isContainer,s=t.assignedApprover.isContainer;return a&&s||void 0===a&&void 0===s?e.assignedApprover.displayName.localeCompare(t.assignedApprover.displayName,navigator.language):void 0===a?1:void 0===s?-1:0},t[e].myApprovalsSort=function(e,t){const a=e.assignedApprover.isContainer,s=t.assignedApprover.isContainer;return void 0===a?-1:void 0===s?1:a&&s?e.assignedApprover.displayName.localeCompare(t.assignedApprover.displayName,navigator.language):0},t[e].isInternalTaskCheck=function(a){if(a&&a.taskCheckConfigSettings&&a.taskCheckConfigSettings.definitionRef&&a.taskCheckConfigSettings.definitionRef.id)switch(a.taskCheckConfigSettings.definitionRef.id.toLowerCase()){case t[e].EvaluateArtifactPolicyCheckTypeIdString:case t[e].BranchProtectionPolicyCheckTypeIdString:case t[e].BusinessHoursPolicyCheckTypeIdString:return!0}return!1},t[e].isCheckPermissionUpdate=function(e){return 1===e||2===e};const o="ServerEnviroment",r="Server",l="PlugDisconnected",c="AzureKeyVault",p="Server",u="Server",d="GitLogo",m="Rocket";t[e].AuthorizationCheckTypeIdString="E1A1FC6C-C278-4492-AE1C-C42F8697612C",t[e].EvaluateArtifactPolicyCheckTypeIdString="1b4fdd02-b979-480d-9a7e-0b7af7fe471f",t[e].BranchProtectionPolicyCheckTypeIdString="86b05a0c-73e6-4f7d-b3cf-e38f3b39a75b",t[e].BusinessHoursPolicyCheckTypeIdString="445fde2f-6c39-441c-807f-8a59ff2e075f",t[e].ExtendsCheckTypeIdString="4020E66E-B0F3-47E1-BC88-48F3CC59B5F3",t[e].ExclusiveLockCheckTypeIdString="2EF31AD6-BAA0-403A-8B45-2CBC9B4E5563",t[e].ApprovalCheckTypeIdString="8C6F20A7-A545-4486-9777-F762FAFE0D4D",t[e].TaskCheckTypeIdString="fe1de3ee-a436-41b4-bb20-f6eb4cb879a7",t[e].ManualValidationTaskTypeId="2003AD3A-104A-451A-9238-60474AB294E6",t[e].ProofOfPresenceCheckTypeIdString="2CBB7D1F-4AD5-408D-BE44-ABC26BAAB7F8",t[e].ProductionReadinessCheckTypeIdString="222A620E-FE5F-4875-9D3C-3BE30FB91A34";const h=6e4,v=60*h,k=24*v}("Utilities"),function(e){J=t[e]={};t[e].ApprovalPanel=o=>{const l=o.approval.resource?o.approval.resource.name:"",u=$.checksToApprovalStatus(o.approval.status),d=$.getApprovalStatusIndicatorData(u),m=o.approval.resource?$.getResourceTypeIcons(o.approval.resource.type):"Server";let g,h=!1,v=new n.ObservableValue(!1);const k=(0,c.useComponentContext)();let C=function(e){const t=(0,c.useComponentContext)(),a=t.pageContext.getService("IChecksPanelService");let s=new Array;return s.push(e),a.isCurrentUserBlockedFromApproving(s)}(o.approval),y=d.label;if(2===u){const e=$.getRemainingMinutesForCheckTimeout(o.approval.timeout,o.approval.createdDate);y=(0,a.format)(W.ApprovalTimeForTimeoutFormat,y,$.getCheckTimeoutOrReevaluationString(W.Timeout,e))}const S=()=>{v.value=!1};return s.createElement(E.Panel,{backButtonProps:{onClick:o.onBackClick},contentClassName:"no-h-padding",description:y,lightDismiss:!0,modal:!1,onDismiss:o.onDismiss,titleProps:{text:W.Approval}},s.createElement("div",{className:"flex-column flex-grow"},s.createElement("div",{className:"flex-column rhythm-vertical-24 v-scroll-auto flex-grow"},s.createElement(t[e].PanelSection,{title:W.Resource},s.createElement("div",{className:"flex-row flex-center pipelines-checks-section-header-details"},s.createElement(r.Icon,{className:"pipelines-resource-icon primary-text",iconName:m}),s.createElement("div",{className:"flex-column flex-grow h-scroll-hidden"},s.createElement("span",{className:"body-m text-ellipsis checks-resource-name"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(k.pageContext,o.approval.resource,!0),target:"_blank"},l))))),C&&s.createElement(t[e].PanelSection,null,s.createElement(b.MessageCard,{className:"currentUser-blocked-card",severity:"Warning"},W.CurrentUserCannotApproveOwnRunMessage)),s.createElement(t[e].PanelSection,{title:W.Requirement},s.createElement("div",{className:"pipelines-checks-section-header-details"},0===(P=o.approval).minRequiredApprovers||P.minRequiredApprovers===(null===(A=P.steps)||void 0===A?void 0:A.length)?1===(null===(R=P.steps)||void 0===R?void 0:R.length)?W.DefaultApproval:P.steps&&P.steps[0].order!==P.steps[1].order?(h=!0,W.ApprovalInSequence):W.DefaultApproval:1===P.minRequiredApprovers?W.SingleMinApproversApproval:(0,a.format)(W.MinApproversApproval,P.minRequiredApprovers)),s.createElement("div",{className:"flex-column rhythm-vertical-16"},s.createElement(i,{approvalSteps:o.approval.steps,submitApprovals:(e,t,a)=>{let s=new Array;s.push(o.approval),o.onSubmitApprovals(e,s,t,a)},isApprovalInSequence:h,resourceApprovalStatus:u,onReassignMenuClick:e=>{g=e,v.value=!0}}))),o.approval.instructions&&s.createElement(t[e].PanelSection,{title:W.InstructionsLabel},s.createElement("span",{className:"approval-instructions"},o.approval.instructions)),s.createElement(p.Observer,{isDialogOpen:v},(e=>s.createElement(G.ApprovalReassignDialog,{approvalDetails:o.approval,approvalStep:g,onCloseDialog:S,showDialog:e.isDialogOpen,onReassign:o.onReassignStep}))))));var P,A,R};t[e].PanelSection=e=>s.createElement("div",{className:"flex-column bolt-default-horizontal-spacing"},e.title&&s.createElement("span",{className:"pipelines-checks-section-header body-m font-weight-semibold"},e.title),e.children);const i=a=>{if(!a.approvalSteps)return s.createElement(s.Fragment,null);let i=new n.ObservableArray([]),r=new n.ObservableArray([]),l=new n.ObservableArray([]),c=new n.ObservableArray([]),p=new n.ObservableArray([]),u=new n.ObservableArray([]),d=new n.ObservableArray([]),m=new n.ObservableArray([]);const g=a.approvalSteps.sort($.approversSort);var h;h=g,!a.isApprovalInSequence&&h.map((e=>{2===e.permissions&&2===e.status?i.value.push(e):128===e.status?l.value.push(e):4===e.status?r.value.push(e):8===e.status?c.value.push(e):64===e.status?p.value.push(e):32===e.status?u.value.push(e):16===e.status?d.value.push(e):1!==e.permissions&&4!==e.permissions||m.value.push(e)}));const v=(e=>{let t=e;return 8!==a.resourceApprovalStatus&&16!==a.resourceApprovalStatus||(t=e.filter((e=>4===e.status||8===e.status||16===e.status))),t})(a.isApprovalInSequence?a.approvalSteps.sort($.stepSort):[]),k=i.value.sort($.myApprovalsSort),C=(e,t,s)=>{a.submitApprovals(e,t,s)};return s.createElement("div",null,!a.isApprovalInSequence&&s.createElement("div",null,k.length>0&&2===a.resourceApprovalStatus&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:k,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick},s.createElement("div",{className:"flex-row secondary-text checks-group-header-row"},W.WaitingOnMe),s.createElement(t[e].ApprovalOptionsGroup,{isApprovalInSequence:a.isApprovalInSequence,myApprovalsCount:k.length,onSubmit:C})),m.value.length>0&&2===a.resourceApprovalStatus&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:m.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick},s.createElement("div",{className:"flex-row secondary-text checks-group-header-row"},W.Others)),c.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:c.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}),r.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:r.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}),l.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:l.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}),p.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:p.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}),u.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:u.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}),d.length>0&&s.createElement(t[e].CategorizedApprovals,{approvalSteps:d.value,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick})),a.isApprovalInSequence&&s.createElement("div",null,v.length>0&&s.createElement("div",null,v.map((n=>2===n.permissions&&2===n.status&&2===a.resourceApprovalStatus?s.createElement(t[e].ApprovalOptionsGroup,{isApprovalInSequence:a.isApprovalInSequence,approver:n.assignedApprover,approvalStatus:n.status,myApprovalsCount:1,onSubmit:C,onReassignMenuClick:a.onReassignMenuClick}):s.createElement(o,{approvalStep:n,isApprovalInSequence:a.isApprovalInSequence,onReassignMenuClick:a.onReassignMenuClick}))))))};t[e].CategorizedApprovals=e=>s.createElement("div",null,e.children,e.approvalSteps.map((t=>s.createElement(o,{approvalStep:t,isApprovalInSequence:e.isApprovalInSequence,onReassignMenuClick:e.onReassignMenuClick}))));t[e].ApprovalOptionsGroup=a=>{const n=(0,c.useComponentContext)(),[i,o]=s.useState(""),r=a.approver?a.approver.displayName:void 0,[l,p]=s.useState(!1),[m,k]=s.useState(!1);let f=a.approver?a.approver.imageUrl:void 0;!f&&a.approver&&(f=(0,h.getIdentityImageUrl)(n.pageContext,a.approver));const b=[{id:"reassign",text:W.Reassign,onActivate:()=>{let e={assignedApprover:a.approver};a.onReassignMenuClick&&a.onReassignMenuClick(e)}}];let E=a.isApprovalInSequence;const P=[{id:"defer",text:W.DeferApproval,onActivate:()=>{k(!0)}}];return s.createElement("div",{className:(0,S.css)("flex-column","approval-options-group")},s.createElement("div",{className:(0,S.css)("flex-row",a.useUpdatedChecksFormat?"approval-options":a.isApprovalInSequence?"approval-options-sequence-case":"approval-options-default")},a.isApprovalInSequence&&a.approvalStatus&&s.createElement("div",{className:"flex-row flex-center"},s.createElement(g.Status,Object.assign({},$.getApprovalStatusIndicatorData(a.approvalStatus).statusProps,{className:"pipelines-user-approval-state",size:"16"})),s.createElement(A.VssPersona,{suppressPersonaCard:!0,isTabStop:!1,className:"pipelines-user-approval-persona",displayName:r,imageUrl:f,size:"small"})),s.createElement("div",{className:"flex-row flex-center"},s.createElement(d.TextField,{className:a.useUpdatedChecksFormat?a.myApprovalsCount>1?"approval-comment-box-multiple-defer":"approval-comment-box-defer":a.myApprovalsCount>1?"approval-comment-box-width-default-defer":a.isApprovalInSequence?"approval-comment-box-width-sequence-defer":"approval-comment-box-width-many-defer",rows:1,disabled:l,multiline:!0,onChange:(e,t)=>{o(t)},value:i,placeholder:W.Comment}),l?s.createElement(u.Spinner,{className:"pipeline-approval-spinner"}):s.createElement("div",null)),s.createElement("div",{className:"approval-reject-button"},s.createElement(v.Button,{disabled:l,text:a.myApprovalsCount>1?W.RejectAll:W.Reject,onClick:()=>{p(!0),a.onSubmit(8,i)}})),!m&&s.createElement("div",{className:"approval-approve-splitbutton"},s.createElement(C.SplitButton,{disabled:l,buttonProps:{text:a.myApprovalsCount>1?W.ApproveAll:W.Approve,onClick:()=>{p(!0),a.onSubmit(4,i)}},menuButtonProps:{contextualMenuProps:{menuProps:{id:"1",items:P}}},primary:!0})),E&&s.createElement(y.MoreButton,{className:"approval-more-button",role:"menuitem",contextualMenuProps:{menuProps:{id:"header-submenu",items:b}}})),m&&s.createElement("div",{className:(0,S.css)("flex-row",a.useUpdatedChecksFormat?"approval-options":"approval-defer-options")},s.createElement(t[e].DeferApprovalArea,{onDefer:e=>{p(!0),a.onSubmit(128,i,e)},onCancel:()=>k(!1)})))};t[e].DeferApprovalArea=e=>{var t;const[a,i]=s.useState(new n.ObservableValue(null!==(t=e.deferredTo)&&void 0!==t?t:new Date)),o=new n.ObservableValue(a.value.getHours().toString()),r=new n.ObservableValue(a.value.getMinutes().toString()),l=new Date;let c=new Date;c.setDate(c.getDate()+H.MaxDeferralDurationInDays);return s.createElement("div",{className:(0,S.css)("flex-column")},s.createElement("div",{className:(0,S.css)("flex-row","approval-defer-date-row")},s.createElement("div",{className:(0,S.css)("flex-column","approval-defer-date-column")},s.createElement("label",null,W.Date),s.createElement(k.DatePicker,{className:"approval-defer-date",value:a,onChange:e=>{null!=a&&(e.setHours(a.value.getHours()),e.setMinutes(a.value.getMinutes()),i(new n.ObservableValue(e)))},minDate:l,maxDate:c,ariaLabel:W.Date})),s.createElement("div",{className:(0,S.css)("flex-column","approval-defer-date-column")},s.createElement("label",null,W.Hours),s.createElement(d.TextField,{className:"approval-defer-hours",onChange:(e,t)=>{const s=t.match(/\d+/);let n=s?parseInt(s[0]):0;n>=0&&n<=23&&(a.value.setHours(n),i(a),o.value=n.toString())},value:o,inputType:"number",ariaLabel:W.Hours})),s.createElement("div",{className:(0,S.css)("flex-column","approval-defer-date-column")},s.createElement("label",null,W.Minutes),s.createElement(d.TextField,{className:"approval-defer-minutes",onChange:(e,t)=>{const s=t.match(/\d+/);let n=s?parseInt(s[0]):0;n>=0&&n<=59&&(a.value.setMinutes(n),i(a),r.value=n.toString())},value:r,inputType:"number",ariaLabel:W.Minutes}))),s.createElement("div",{className:(0,S.css)("flex-column","time-zone-title")},W.TimeZone,": ",(()=>{let e=(new Date).getTimezoneOffset()/60,t=((new Date).getTimezoneOffset()%60).toString();return"0"==t&&(t="00"),"(UTC"+(0==e?"":e>0?"-":"+")+Math.abs(e)+":"+t+") "+Intl.DateTimeFormat().resolvedOptions().timeZone})()),s.createElement("div",{className:"flex-row"},s.createElement("div",{className:"approval-defer-button"},s.createElement(v.Button,{text:e.deferredTo?W.Save:W.ApproveAndDefer,onClick:()=>{e.onDefer(a.value)},primary:!0})),s.createElement("div",{className:"approval-cancel-deferral-button"},s.createElement(v.Button,{text:W.Cancel,onClick:()=>{e.onCancel()}}))))};const o=e=>{const t=(0,c.useComponentContext)(),n=e.approvalStep,i=$.getApprovalStatusIndicatorData(n.status),o=$.getApprovalStatus(n.status),r=2===n.status||1===n.status||32===n.status||64===n.status?n.assignedApprover:n.actualApprover;let l=r&&r.displayName;l&&n.assignedApprover&&n.assignedApprover.id!=r.id&&(l+=(0,a.format)(W.OnBehalfOfFormat,n.assignedApprover.displayName)),l&&n.isStepReassigned&&(l=(0,a.format)(W.Reassigned,l));let p=r&&r.imageUrl;!p&&r&&(p=(0,h.getIdentityImageUrl)(t.pageContext,r));const u=[{id:"reassign",text:W.Reassign,onActivate:()=>{e.onReassignMenuClick(e.approvalStep)}}];let d=2===n.permissions&&128!=n.status||4===n.permissions;return s.createElement("div",{className:"flex-column"},s.createElement("div",{className:"pipelines-user-approval-row flex-row flex-center"},s.createElement(g.Status,Object.assign({},i.statusProps,{className:"pipelines-user-approval-state",size:"16"})),r&&s.createElement(A.VssPersona,{suppressPersonaCard:!0,isTabStop:!1,className:"pipelines-user-approval-persona",displayName:r.displayName,imageUrl:p,size:"small"}),s.createElement("div",{className:(0,S.css)("flex-column flex-grow","pipelines-user-approval-text")},s.createElement("span",{className:"body-m text-ellipsis"},l),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},2===n.status?o:(0,a.format)(o,(0,P.ago)(n.lastModifiedOn)))),d&&s.createElement(y.MoreButton,{contextualMenuProps:{menuProps:{id:"header-submenu",items:u}}})),e.approvalStep.comment&&s.createElement("div",{className:"pipelines-approval-comment-row flex-row"},s.createElement("span",{className:"body-m"},e.approvalStep.comment)))}}("ApprovalPanel"),function(e){X=t[e]={};t[e].LogsViewPanel=e=>{const t=(0,c.useComponentContext)(),a=t.pageContext.getService("IVssThemeService");a.createThemedSelector(".dark-run-logs",(e=>e.isDark?e:a.getTheme("ms.vss-web.vsts-theme-dark")));const n=t.pageContext.getService("ILogsViewPanelService");n.initialize();const i=n.fetchData(e.check,e.projectId),o=(0,w.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1BuildCheckIssues",!1);let l=(0,$.getCheckRunStatusIndicatorData)(e.check.status),p=l.label;if(e.arePendingChecksPresent&&!(0,$.isInternalTaskCheck)(e.check)){const t=(0,$.getRemainingMinutesForCheckTimeout)(e.check.timeout,e.check.createdDate);p=t>0?(0,$.getCheckTimeoutOrReevaluationString)(W.Timeout,t):l.label}const u=s.createElement("div",{className:"flex-row"},s.createElement("div",{className:"checks-description"},p),o&&!!e.check.issue&&s.createElement("div",{className:"checks-issue-pill"},s.createElement(x.Pill,{className:(0,S.css)(2===e.check.issue.type&&"warning",1===e.check.issue.type&&"error"),size:1,variant:1},e.check.issue.message))),d=e.check.resource?(0,$.getResourceTypeIcons)(e.check.resource.type):"Server",m=e.check.resource?e.check.resource.name:"";return s.createElement(E.Panel,{className:"checks-logs-view-panel themed dark-run-logs",backButtonProps:{onClick:e.onBackClick},size:2,lightDismiss:!0,onDismiss:e.onDismiss,description:p,descriptionItem:o&&e.check.issue?u:void 0,titleProps:{text:e.check.taskCheckConfigSettings.displayName}},s.createElement("div",{className:"flex-column flex-grow"},s.createElement("div",{className:"flex-column rhythm-vertical-24 v-scroll-auto flex-grow"},s.createElement("div",{className:"flex-column bolt-default-horizontal-spacing"},s.createElement("span",{className:"pipelines-checks-section-header body-m font-weight-semibold"},W.Resource),s.createElement("div",{className:"flex-row flex-center pipelines-checks-section-header-details"},s.createElement(r.Icon,{className:"pipelines-resource-icon primary-text",iconName:d}),s.createElement("div",{className:"flex-column flex-grow h-scroll-hidden"},s.createElement("span",{className:"body-m text-ellipsis checks-resource-name"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(t.pageContext,e.check.resource,!0),target:"_blank"},m))))),s.createElement("div",{className:"logs"},s.createElement(R.LogViewer,{sections:i,className:"logs-view custom-scrollbar v-scroll-auto h-scroll-auto",showTimestamps:!0})))))}}("LogsViewPanel"),function(e){Y=t[e]={};t[e].ManualValidationPanel=e=>{const t=$.checksToApprovalStatus(e.manualValidation.status);let n=$.getApprovalStatusIndicatorData(t,!0).label;if(2===t){const t=$.getRemainingMinutesForCheckTimeout(e.manualValidation.timeout,e.manualValidation.createdDate);n=(0,a.format)(W.ApprovalTimeForTimeoutFormat,n,$.getCheckTimeoutOrReevaluationString(W.Timeout,t))}return s.createElement(E.Panel,{backButtonProps:{onClick:e.onBackClick},contentClassName:"no-h-padding",description:n,lightDismiss:!0,modal:!1,onDismiss:e.onDismiss,titleProps:{text:W.ManualValidation}},s.createElement("div",{className:"flex-column flex-grow"},s.createElement("div",{className:"flex-column rhythm-vertical-24 v-scroll-auto flex-grow"},e.manualValidation.jobName&&s.createElement(J.PanelSection,{title:W.Job},s.createElement("span",{className:"manual-validation-jobname"},e.manualValidation.jobName)),s.createElement(J.PanelSection,null,s.createElement("div",{className:"flex-column rhythm-vertical-16"},s.createElement(i,{approvalSteps:e.manualValidation.steps,submitManualValidations:(t,a)=>{let s=new Array;s.push(e.manualValidation),e.onSubmitManualValidations(t,s,a)},manualValidationStatus:e.manualValidation.status}))),e.manualValidation.instructions&&s.createElement(J.PanelSection,{title:W.InstructionsLabel},s.createElement("span",{className:"manual-validation-instructions"},e.manualValidation.instructions)))))};const i=a=>{let i=new n.ObservableArray([]),o=new n.ObservableArray([]),r=new n.ObservableArray([]),l=new n.ObservableArray([]),c=new n.ObservableArray([]),p=new n.ObservableArray([]);a.approvalSteps.map((e=>{2===e.permissions&&2===e.status?i.value.push(e):4===e.status?o.value.push(e):8===e.status?r.value.push(e):64===e.status?l.value.push(e):32===e.status?c.value.push(e):1===e.permissions&&p.value.push(e)}));return s.createElement("div",null,i.length>0&&2===a.manualValidationStatus&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:i.value},s.createElement("div",{className:"flex-row secondary-text checks-group-header-row"},W.Waiting),s.createElement(t[e].ManualValidationOptionsGroup,{myManualValidationsCount:i.value.length,onSubmit:(e,t)=>{a.submitManualValidations(e,t)}})),p.value.length>0&&2===a.manualValidationStatus&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:p.value},s.createElement("div",{className:"flex-row secondary-text checks-group-header-row"},W.Waiting)),r.length>0&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:r.value}),o.length>0&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:o.value}),l.length>0&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:l.value}),c.length>0&&s.createElement(t[e].CategorizedManualValidations,{approvalSteps:c.value}))};t[e].CategorizedManualValidations=e=>s.createElement("div",null,e.children,e.approvalSteps.map((e=>s.createElement(o,{approvalStep:e}))));t[e].ManualValidationOptionsGroup=e=>{const t=new n.ObservableValue(""),[a,i]=s.useState(!1);return s.createElement("div",{className:"manual-validation-options-group"},s.createElement("div",{className:(0,S.css)("flex-row",e.useUpdatedChecksFormat?"manual-validation-options":"manual-validation-options-default")},e.manualValidationStatus&&s.createElement("div",{className:"flex-row flex-center"},s.createElement(g.Status,Object.assign({},$.getApprovalStatusIndicatorData(e.manualValidationStatus,!0).statusProps,{className:"pipelines-user-manual-validation-state",size:"16"}))),s.createElement("div",{className:"flex-row flex-center"},s.createElement(d.TextField,{className:e.useUpdatedChecksFormat?e.myManualValidationsCount>1?"manual-validation-comment-box-multiple":"manual-validation-comment-box":e.myManualValidationsCount>1?"manual-validation-comment-box-width-default":"manual-validation-comment-box-width-many",rows:1,disabled:a,multiline:!0,onChange:(e,a)=>{t.value=a},value:t,placeholder:W.Comment}),a?s.createElement(u.Spinner,{className:"pipeline-manual-validation-spinner"}):s.createElement("div",null)),s.createElement("div",{className:"manual-validation-reject-button"},s.createElement(v.Button,{disabled:a,text:e.myManualValidationsCount>1?W.RejectAll:W.Reject,onClick:()=>{i(!0),e.onSubmit(8,t.value,null,!0)}})),s.createElement("div",{className:"manual-validation-resume-button"},s.createElement(v.Button,{disabled:a,text:e.myManualValidationsCount>1?W.ResumeAll:W.Resume,onClick:()=>{i(!0),e.onSubmit(4,t.value,null,!0)},primary:!0}))))};const o=e=>{const t=(0,c.useComponentContext)(),n=e.approvalStep,i=$.getApprovalStatusIndicatorData(n.status,!0),o=$.getApprovalStatus(n.status,!0),r=4===n.status||8===n.status?n.actualApprover:null;let l=r&&r.displayName;l=(0,a.format)(W.CompletedBy,l);let p=null!=r?r.imageUrl:"";return!p&&r&&(p=(0,h.getIdentityImageUrl)(t.pageContext,r)),s.createElement("div",{className:"flex-column"},s.createElement("div",{className:"pipelines-user-manual-validation-row flex-row flex-center"},!(2===n.status)&&s.createElement(g.Status,Object.assign({},i.statusProps,{className:"pipelines-user-manual-validation-state",size:"16"})),r&&s.createElement(A.VssPersona,{isTabStop:!0,className:"pipelines-user-approval-persona",displayName:r.displayName,imageUrl:p,size:"small"}),s.createElement("div",{className:(0,S.css)("flex-column flex-grow","pipelines-user-manual-validation-text")},l&&s.createElement("span",{className:"body-m text-ellipsis"},l),!(2===n.status)&&s.createElement("span",{className:"body-s text-ellipsis secondary-text"},(0,a.format)(o,(0,P.ago)(n.lastModifiedOn))))),e.approvalStep.comment&&s.createElement("div",{className:"pipelines-manual-validation-comment-row flex-row"},s.createElement("span",{className:"body-m"},e.approvalStep.comment)))}}("ManualValidationPanel"),function(e){t[e]={};const i="__default";t[e].ChecksListPanelView=r=>{const[d,m]=s.useState(!1),[g,h]=s.useState(!1),[v,k]=s.useState(void 0),[C,f]=s.useState(void 0),[y,b]=s.useState(void 0),[S,P]=s.useState(!1),[A,R]=s.useState(void 0),[x,I]=s.useState(!1),[N,T]=s.useState(""),[D,M]=s.useState(!1),[V,O]=s.useState(""),L=r.componentContext||(0,c.useComponentContext)(),B=L.pageContext.getService("IChecksPanelService"),j=(0,w.isFeatureFlagEnabled)(L.pageContext,"Pipelines.Checks.EnableOrderingChecks",!1),q=(e,t)=>{k(e),b(t),m(!0)},_=(e,t)=>{f(e),b(t),h(!0)},z=(e,t)=>{P(!0),R(e),M(t)};let G=W.DefaultPanelTitle;if(0===r.reviewMode)G=W.AllPendingPanelTitle;else if(1===r.reviewMode&&r.stages&&r.stages[0]&&r.stages[0].name!==i)switch(r.checkListItemType){case 3:G=(0,a.format)(W.StagePanelTitleCommon,r.stages[0].name);break;case 1:G=(0,a.format)(W.StagePanelTitleChecks,r.stages[0].name);break;case 2:G=(0,a.format)(W.StagePanelTitleManualValidation,r.stages[0].name)}const H=new n.ObservableValue(!1),Q=new n.ObservableValue({status:4,approvals:[]}),Z=(e,t)=>{H.value=!0,Q.value={status:e,approvals:t}},K=(e,t,a,s)=>{const n=t.map((t=>({approvalId:t.id,status:e,comment:a||"",deferredTo:s})));I(!0),r.onSubmitBulkApproval(n)},ee=(e,t,a,s)=>{let n=new Array,i={approvalId:e.id,assignedApprover:t.assignedApprover,reassignTo:a,comment:s||""};return n.push(i),r.onReassignApprovals(n)};return s.createElement(E.Panel,{onDismiss:r.onDismiss,titleProps:{text:G},description:N,overlayContent:x?s.createElement(u.Spinner,null):void 0},s.createElement(p.Observer,{stages:B.data},(n=>{const i=[];let c=!1;const p=n.stages.filter((e=>e.approvals&&e.approvals.some((e=>$.isCheckPermissionUpdate(e.permissions))))),u=n.stages.filter((e=>e.approvals&&e.approvals.length>0&&e.approvals.every((e=>0===e.permissions))));p.concat(u).forEach((e=>i.push(e)));const d=n.stages.filter((e=>e.manualValidations&&e.manualValidations.some((e=>$.isCheckPermissionUpdate(e.permissions))))),m=n.stages.filter((e=>e.manualValidations&&e.manualValidations.length>0&&e.manualValidations.every((e=>0===e.permissions)))),g=d.concat(m);for(let e of g){e.approvals&&e.approvals.length>0||i.push(e)}for(let e of n.stages){const t=e.approvals&&e.approvals.length>0,s=e.manualValidations&&e.manualValidations.length>0,n=e.taskChecks&&e.taskChecks.length>0,o=e.exclusiveLockChecks&&e.exclusiveLockChecks.length>0,r=e.checks&&e.checks.filter((e=>!(0,a.equals)(e.typeId,$.AuthorizationCheckTypeIdString,!0))).length>0;(n||o||r)&&(t||s||i.push(e),c=!0)}O(n.stages&&n.stages.length>0?n.stages[0].projectId:"");const h=n.stages.filter((e=>e.checks&&e.checks.length>0&&e.checks.every((e=>(0,a.equals)(e.typeId,$.AuthorizationCheckTypeIdString,!0))))),v=h.filter((e=>e.checks.some((e=>$.isCheckPermissionUpdate(e.permissions))))),k=h.filter((e=>e.checks.length>0&&e.checks.every((e=>0===e.permissions)))),C=v.concat(k),f=U(i,C,c);if(1===i.length){let{stageTimeoutMessage:e,stageTimeoutMessageToolTip:t}=F(i[0]);T(e)}return s.createElement("div",{className:"flex-column rhythm-vertical-16 pipelines-checks-container"},!f&&i.map((a=>j?s.createElement(t[e].ChecksStageGroupOrdered,{stageData:a,key:"StageGroup"+a.stageId,onSelectTaskCheck:z,onSelectApproval:q,onSelectManualValidation:_,reviewMode:r.reviewMode,submitApprovals:K,openReviewDialog:Z,isOrderedChecksEnabled:j}):s.createElement(l,{stageData:a,key:"StageGroup"+a.stageId,onSelectTaskCheck:z,onSelectApproval:q,onSelectManualValidation:_,reviewMode:r.reviewMode,submitApprovals:K,openReviewDialog:Z,isOrderedChecksEnabled:j}))),C.map((e=>e.checks.length>0&&s.createElement(o,{key:"StageGroup"+e.stageId,pipelineId:r.pipelineId,stageData:e,onPermitResource:r.onPermitResource,reviewMode:r.reviewMode}))),f&&i[0].approvals&&s.createElement(J.ApprovalPanel,{approval:i[0].approvals[0],stageName:i[0].stageName,onBackClick:r.onDismiss,onDismiss:r.onDismiss,onSubmitApprovals:K,onReassignStep:ee}),f&&i[0].manualValidations&&s.createElement(Y.ManualValidationPanel,{manualValidation:i[0].manualValidations[0],stageName:i[0].stageName,onBackClick:r.onDismiss,onDismiss:r.onDismiss,onSubmitManualValidations:K}),f&&i[0].taskChecks&&s.createElement(X.LogsViewPanel,{check:i[0].taskChecks[0],arePendingChecksPresent:2===i[0].taskChecks[0].status,projectId:V,onBackClick:r.onDismiss,onDismiss:r.onDismiss}))})),d&&s.createElement(J.ApprovalPanel,{approval:v,stageName:y,onBackClick:e=>{k(void 0),m(!1)},onDismiss:r.onDismiss,onSubmitApprovals:K,onReassignStep:ee}),g&&s.createElement(Y.ManualValidationPanel,{manualValidation:C,stageName:y,onBackClick:e=>{f(void 0),h(!1)},onDismiss:r.onDismiss,onSubmitManualValidations:K}),S&&s.createElement(X.LogsViewPanel,{check:A,arePendingChecksPresent:D,projectId:V,onBackClick:e=>{R(void 0),P(!1)},onDismiss:r.onDismiss}))};const o=e=>{const t=new M.ArrayItemProvider(e.stageData.checks),n=e.stageData.stageName,o=(0,c.useComponentContext)(),l=0===e.reviewMode&&n!==i;return s.createElement("div",null,l&&s.createElement("div",{className:"flex-row body-m checks-group-header"},s.createElement("div",{className:"flex-column flex-grow justify-end"},s.createElement("div",{className:"flex-row font-weight-semibold checks-group-header-row"},s.createElement("span",null,e.stageData.stageName)))),s.createElement(T.List,{className:"pipelines-checks-container",itemProvider:t,renderRow:(t,n,i)=>{const l=n.resource.name,c=(0,a.format)("pm-{0}-{1}-{2}",e.stageData.stageId,n.resource.type,n.resource.id),p=n.resource?$.getResourceTypeIcons(n.resource.type):"Server",u=n.resource?$.getResourceTypeString(n.resource.type):"";return s.createElement(T.ListItem,{key:"ci-"+t,index:t,details:i},s.createElement("div",{className:"flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(r.Icon,{className:"pipelines-resource-icon",iconName:"Lock"}),s.createElement("div",{className:"pipelines-approval-row-text flex-column flex-grow h-scroll-hidden"},s.createElement("span",{className:"body-m text-ellipsis"},W.Permission),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},W.PermissionSecondary)),s.createElement(r.Icon,{className:"pipelines-resource-icon",iconName:p}),s.createElement("div",{className:"pipelines-approval-row-text flex-column flex-grow h-scroll-hidden"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(o.pageContext,n.resource)},l),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},u)),$.isCheckPermissionUpdate(n.permissions)&&s.createElement(N.ButtonGroup,{className:"pipelines-permission-button"},s.createElement(v.Button,{id:c,primary:!0,text:W.Permit,onClick:()=>(t=>{const n={pipelines:[{id:e.pipelineId,authorized:!0}]},i=t.resource.type,r=()=>{e.onPermitResource(n,i,t.resource.id)};o.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const n={title:W.PermitConfirmDialogTitle,message:(0,a.localeFormat)(W.PermitConfirmDialogDescription,$.getResourceTypeString(i),t.resource.name),onClose:e,cancelLabel:W.Cancel,onConfirm:r,confirmLabel:W.Permit};return s.createElement(I.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},n),null)}))})(n)}))))}}))},l=e=>{let t=e.stageData.approvals&&V(e.stageData.approvals);const i=e.stageData.approvals?new n.ObservableArray(e.stageData.approvals.filter((e=>$.isCheckPermissionUpdate(e.permissions)&&e.steps.filter((e=>2===e.status&&2===e.permissions)).length>0))):new n.ObservableArray([]),o=e.stageData.approvals?new n.ObservableArray(R(e.stageData.approvals)):new n.ObservableArray([]),r=e.stageData.manualValidations?new n.ObservableArray(e.stageData.manualValidations.filter((e=>$.isCheckPermissionUpdate(e.permissions)))):new n.ObservableArray([]),l=e.stageData.manualValidations?new n.ObservableArray(x(e.stageData.manualValidations)):new n.ObservableArray([]),c=e.stageData.taskChecks?new n.ObservableArray(e.stageData.taskChecks):new n.ObservableArray([]),p=e.stageData.checks?e.stageData.checks.filter((e=>(0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))):null,u=p?new n.ObservableArray(p):new n.ObservableArray([]),d=e.stageData.exclusiveLockChecks?new n.ObservableArray(e.stageData.exclusiveLockChecks):new n.ObservableArray([]),g=B(e.stageData),{stageTimeoutMessage:v,stageTimeoutMessageToolTip:C}=F(e.stageData),f=(t,a,s,n=!1)=>{n?e.submitApprovals(t,r.value,a):e.submitApprovals(t,i.value,a,s)};return s.createElement("div",null,s.createElement(y,{myApprovalsCount:i.length,myManualValidationsCount:r.length,otherChecksCount:o.length+l.length,stageName:e.stageData.stageName,stageTimeoutString:v,stageTimeoutStringToolTip:C,reviewMode:e.reviewMode,openReviewDialog:t=>{e.openReviewDialog(t,i.value)}}),i.length>0&&s.createElement(J.ApprovalOptionsGroup,{isApprovalInSequence:!1,myApprovalsCount:i.length,onSubmit:f}),i.length>0&&s.createElement(m,{itemProvider:i,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}),t&&s.createElement(b.MessageCard,{className:"requester-blocked-message-card",severity:"Warning"},W.CurrentUserCannotApproveMessage),o.length>0&&s.createElement(m,{headerText:W.Others,itemProvider:o,onSelectApproval:e.onSelectApproval,hideHeader:0===i.length,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}),c.length>0&&s.createElement(P,{headerText:W.Others,checks:c,onSelectCheck:e.onSelectTaskCheck,arePendingChecksPresent:g,hideHeader:0===i.length||o.length>0}),u.length>0&&s.createElement(h,{headerText:W.Others,checks:u,hideHeader:0===i.length||o.length>0}),d.length>0&&s.createElement(k,{headerText:W.Others,checks:d,hideHeader:0===i.length||o.length>0}),r.length>0&&s.createElement(Y.ManualValidationOptionsGroup,{myManualValidationsCount:r.length,onSubmit:f}),r.length>0&&s.createElement(m,{itemProvider:r,onSelectApproval:e.onSelectManualValidation,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}),l.length>0&&s.createElement(m,{headerText:W.Others,itemProvider:l,onSelectApproval:e.onSelectManualValidation,hideHeader:0===r.length,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}))};t[e].ChecksStageGroupOrdered=e=>{const t=e=>e.reduce(((e,t)=>{var a=e.get(t.evaluationOrder)||[];return a.push(t),e.set(t.evaluationOrder,a),e}),new Map),i=e.stageData.approvals?e.stageData.approvals.filter((e=>$.isCheckPermissionUpdate(e.permissions)&&e.steps.filter((e=>2===e.status&&2===e.permissions)).length>0)):[],o=e.stageData.approvals?R(e.stageData.approvals):[],r=e.stageData.manualValidations?e.stageData.manualValidations.filter((e=>$.isCheckPermissionUpdate(e.permissions))):[],l=e.stageData.manualValidations?x(e.stageData.manualValidations):[],c=e.stageData.taskChecks||[],p=e.stageData.checks?e.stageData.checks.filter((e=>(0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))):[],u=e.stageData.exclusiveLockChecks||[],m=t(i),g=t(o),h=t(r),v=t(l),k=t(c),C=t(p),f=t(u),{stageTimeoutMessage:b,stageTimeoutMessageToolTip:E}=F(e.stageData),S=Object.values(H.EvaluationOrder).filter((e=>Number.isInteger(Number(e))));let P=!0;const A=S.map((t=>{const a=t;var i=m.get(a)||[],o=h.get(a)||[],r=g.get(a)||[],l=v.get(a)||[],c=k.get(a)||[],p=C.get(a)||[],u=f.get(a)||[];if(i.length<=0&&o.length<=0&&r.length<=0&&l.length<=0&&c.length<=0&&p.length<=0&&u.length<=0)return;let y=!0;return P&&(y=!1,P=!1),s.createElement(d,Object.assign({},e,{evaluationOrder:a,myApprovals:new n.ObservableArray(i),myManualValidations:new n.ObservableArray(o),otherApprovals:new n.ObservableArray(r),otherManualValidations:new n.ObservableArray(l),taskChecks:new n.ObservableArray(c),extendsChecks:new n.ObservableArray(p),exclusiveLockChecks:new n.ObservableArray(u),renderSeperator:y,key:"phase_"+a}))}));return s.createElement("div",null,s.createElement(y,{myApprovalsCount:i.length,myManualValidationsCount:r.length,otherChecksCount:o.length+l.length,stageName:e.stageData.stageName,stageTimeoutString:b,stageTimeoutStringToolTip:E,reviewMode:e.reviewMode,openReviewDialog:t=>((t,a)=>{e.openReviewDialog(t,a)})(t,i)}),A)};const d=e=>{const t=e.stageData.approvals&&V(e.stageData.approvals),a=B(e.stageData),n=(t,a,s,n=!1)=>{n?e.submitApprovals(t,e.myManualValidations.value,a):e.submitApprovals(t,e.myApprovals.value,a,s)};return s.createElement("div",{className:(0,S.css)(e.renderSeperator&&"stage-checks-ordered")},e.myApprovals.length>0&&s.createElement(J.ApprovalOptionsGroup,{isApprovalInSequence:!1,myApprovalsCount:e.myApprovals.length,onSubmit:n}),e.myApprovals.length>0&&s.createElement(m,{itemProvider:e.myApprovals,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}),t&&s.createElement(b.MessageCard,{className:"requester-blocked-message-card",severity:"Warning"},W.CurrentUserCannotApproveMessage),e.otherApprovals.length>0&&s.createElement(m,{headerText:W.Others,itemProvider:e.otherApprovals,onSelectApproval:e.onSelectApproval,hideHeader:0===e.myApprovals.length,stageName:e.stageData.stageName,isOrderedChecksEnabled:e.isOrderedChecksEnabled}),e.taskChecks.length>0&&s.createElement(P,{headerText:W.Others,checks:e.taskChecks,onSelectCheck:e.onSelectTaskCheck,arePendingChecksPresent:a,hideHeader:0===e.myApprovals.length||e.otherApprovals.length>0}),e.extendsChecks.length>0&&s.createElement(h,{headerText:W.Others,checks:e.extendsChecks,hideHeader:0===e.myApprovals.length||e.otherApprovals.length>0}),e.exclusiveLockChecks.length>0&&s.createElement(k,{headerText:W.Others,checks:e.exclusiveLockChecks,hideHeader:0===e.myApprovals.length||e.otherApprovals.length>0}),e.myManualValidations.length>0&&s.createElement(Y.ManualValidationOptionsGroup,{myManualValidationsCount:e.myManualValidations.length,onSubmit:n}),e.myManualValidations.length>0&&s.createElement(m,{itemProvider:e.myManualValidations,onSelectApproval:e.onSelectManualValidation,isOrderedChecksEnabled:e.isOrderedChecksEnabled,stageName:e.stageData.stageName}),e.otherManualValidations.length>0&&s.createElement(m,{headerText:W.Others,itemProvider:e.otherManualValidations,onSelectApproval:e.onSelectManualValidation,hideHeader:0===e.myManualValidations.length,isOrderedChecksEnabled:e.isOrderedChecksEnabled,stageName:e.stageData.stageName}))},m=e=>{const t=t=>!e.isOrderedChecksEnabled||16!==t.status&&32!==t.status&&1!==t.status&&0!==t.status;return s.createElement("div",null,!e.hideHeader&&!!e.headerText&&A(e.headerText),s.createElement(T.List,{itemProvider:e.itemProvider,renderRow:(a,n,i)=>{const o=$.checksToApprovalStatus(n.status),r=$.getApprovalStatusIndicatorData(o),l=O(n);return e.isOrderedChecksEnabled&&(i.listProps=Object.assign(Object.assign({},i.listProps),{singleClickActivation:t(n)})),s.createElement(C,{rowIndex:a,check:n,details:i,checkName:l,statusIndicator:r})},singleClickActivation:!0,width:"100%",onActivate:(t,a)=>{t.defaultPrevented||e.onSelectApproval(a.data,e.stageName)}}))},h=e=>s.createElement("div",null,!e.hideHeader&&!!e.headerText&&A(e.headerText),s.createElement(T.List,{itemProvider:e.checks,renderRow:(e,t,a)=>s.createElement(C,{check:t,resultMessage:t.resultMessage,checkName:W.RequiredTemplate,details:a,rowIndex:e}),singleClickActivation:!1,width:"100%"})),k=e=>{const t=(0,c.useComponentContext)();return s.createElement("div",null,!e.hideHeader&&!!e.headerText&&A(e.headerText),s.createElement(T.List,{itemProvider:e.checks,renderRow:(e,a,n)=>{const i=$.getExclusiveLockStatusIndicatorData(a.status);let o=i.label;return a.lockInUse&&a.buildName&&2==a.status&&(o=s.createElement("div",null,s.createElement("span",null,W.ExclusiveLockHeldBy+" "),s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getBuildUrl)(t.pageContext,a.projectId,a.buildId)},a.buildName))),s.createElement(C,{check:a,resultMessage:a.resultMessage,checkName:W.ExclusiveLock,details:n,rowIndex:e,statusIndicator:i,statusLabel:o})},singleClickActivation:!1,width:"100%"}))},C=e=>{const t=e.statusIndicator||$.getCheckRunStatusIndicatorData(e.check.status),n=e.statusLabel||t.label;if((0,a.equals)(e.check.typeId,$.ManualValidationTaskTypeId,!0)){const t=$.getApprovalStatusIndicatorData(e.check.status,!0),a=t.label;return s.createElement("div",null,s.createElement(T.ListItem,{key:"manual-validation-item"+e.rowIndex,index:e.rowIndex,details:e.details},s.createElement("div",{className:"pipelines-approval-row flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(g.Status,Object.assign({},t.statusProps,{size:"16"})),s.createElement("div",{className:"pipelines-approval-text flex-column h-scroll-hidden"},s.createElement("span",{className:"body-m text-ellipsis"},e.checkName),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},a)),s.createElement("span",{className:"body-s flex-column flex-grow font-weight-semibold h-scroll-hidden"}," ",e.check.jobName," "))))}const i=e.check.resource?e.check.resource.name:"",o=e.check.resource?$.getResourceTypeIcons(e.check.resource.type):"Server",l=e.check.resource?$.getResourceTypeString(e.check.resource.type):"",p=(0,c.useComponentContext)();return s.createElement(T.ListItem,{key:"approval-item"+e.rowIndex,index:e.rowIndex,details:e.details},s.createElement("div",{className:"pipelines-approval-row flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(g.Status,Object.assign({},t.statusProps,{size:"16"})),s.createElement("div",{className:"pipelines-approval-text flex-column h-scroll-hidden"},s.createElement("span",{className:"body-m text-ellipsis"},e.checkName),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},n)),s.createElement("div",{className:"pipeline-resource-group flex-row flex-center"},s.createElement(r.Icon,{className:"pipelines-resource-icon-1 primary-text",iconName:o}),s.createElement("div",{className:"pipelines-approval-row-text flex-column flex-grow h-scroll-hidden"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(p.pageContext,e.check.resource,!0)},i),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},l)))))},y=e=>{const t=0===e.reviewMode&&e.stageName&&e.stageName!==i;return s.createElement("div",{className:"flex-row body-m checks-group-header"},s.createElement("div",{className:"flex-column flex-grow justify-end"},t&&s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row font-weight-semibold checks-group-header-row"},s.createElement(D.Tooltip,{overflowOnly:!0,text:e.stageName},s.createElement("span",{className:"text-ellipsis stage-header"},e.stageName))),s.createElement(D.Tooltip,{text:e.stageTimeoutStringToolTip},s.createElement("span",{className:"body-m text-ellipsis secondary-text stage-timeout-string"},e.stageTimeoutString))),(e.myApprovalsCount>0||e.myManualValidationsCount>0)&&(!t||e.otherChecksCount>0)&&s.createElement("div",{className:"flex-row secondary-text checks-group-header-row"},s.createElement("span",null,W.Waiting))))},P=e=>s.createElement("div",null,!e.hideHeader&&!!e.headerText&&A(e.headerText),s.createElement(T.List,{itemProvider:e.checks,renderRow:(t,a,n)=>{const i=$.getCheckRunStatusIndicatorData(a.status);return s.createElement(C,{check:a,details:n,rowIndex:t,arePendingChecksPresent:e.arePendingChecksPresent,checkName:a.taskCheckConfigSettings.displayName,statusLabel:L(a,i.label,e.arePendingChecksPresent)})},singleClickActivation:!0,width:"100%",onActivate:(t,a)=>{t.defaultPrevented||e.onSelectCheck(a.data,e.arePendingChecksPresent)}}));function A(e){return s.createElement("div",{className:"checks-group-header"},s.createElement("div",{className:"body-m secondary-text checks-group-header-row"},s.createElement("span",null,e)))}function R(e){let t=e.filter((e=>0===e.permissions||function(e){let t=e.steps.filter((e=>1===e.status&&2===e.permissions)),a=e.steps.filter((e=>2===e.status&&2===e.permissions));return t.length>0&&0===a.length}(e)));return t.sort($.approvalSort),t}function x(e){return e.filter((e=>0===e.permissions))}function V(e){return(0,c.useComponentContext)().pageContext.getService("IChecksPanelService").isCurrentUserBlockedFromApproving(e)}function O(e){if((0,a.equals)(e.typeId,$.ApprovalCheckTypeIdString,!0)){let t=e;return t&&t.definitionRef?(0,a.equals)(H.MainApprovalDefTypeId,t.definitionRef.id,!0)?W.Approval:(0,a.equals)(H.PreApprovalDefTypeId,t.definitionRef.id,!0)?W.PreApproval:(0,a.equals)(H.PostApprovalDefTypeId,t.definitionRef.id,!0)?W.PostApproval:W.Approval:W.Approval}if((0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))return W.RequiredTemplate;if((0,a.equals)(e.typeId,$.ExclusiveLockCheckTypeIdString,!0))return W.ExclusiveLock;if((0,a.equals)(e.typeId,$.ManualValidationTaskTypeId,!0))return W.ManualValidation;if((0,a.equals)(e.typeId,$.TaskCheckTypeIdString,!0)){return null!==e?e.taskCheckConfigSettings.displayName:""}return""}function F(e){let t=Number.MAX_SAFE_INTEGER,s={},n=0,i=0,o="",r="";if(!B(e))return{};let l=[];return e.approvals&&(l=l.concat(e.approvals)),e.manualValidations&&(l=l.concat(e.manualValidations)),e.checks&&(l=l.concat(e.checks)),l.length>0&&l.map((e=>{2===e.status&&(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e))})),e.taskChecks&&e.taskChecks.map((e=>{(0,a.equals)($.EvaluateArtifactPolicyCheckTypeIdString,e.taskCheckConfigSettings.definitionRef.id,!0)?2===e.status&&(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e)):2!==e.status&&4!==e.status||(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e))})),t===Number.MAX_SAFE_INTEGER?{}:(o=$.getCheckTimeoutOrReevaluationString(W.Timeout,t),r=1===i?(0,a.format)(W.StageTimeoutMessageToolTipWithSingleCheck,O(s)):(0,a.format)(W.StageTimeoutMessageToolTipWithMultipleChecks,O(s),i-1),{stageTimeoutMessage:o,stageTimeoutMessageToolTip:r})}function L(e,t,s){let n=t;if((0,a.equals)(e.typeId,$.TaskCheckTypeIdString,!0)){let i=e;if(null!==i&&!(0,a.equals)(i.taskCheckConfigSettings.definitionRef.id,$.EvaluateArtifactPolicyCheckTypeIdString,!0)&&i.taskCheckConfigSettings&&i.taskCheckConfigSettings.retryInterval>0&&(4===e.status||2===e.status)){let e=i.taskCheckData.attemptToTaskCheckTimelineRecordDataMap,o=e?Object.keys(e):[];if(o.length>0&&s){const s=o.sort()[o.length-1],r=e[parseInt(s)].finishTime;if(r){const e=new Date,s=r.getTime()+6e4*i.taskCheckConfigSettings.retryInterval-e.getTime();n=s>=0?(0,a.format)(W.CheckReevaluateStatusString,t,$.getCheckTimeoutOrReevaluationString(W.RetryString,s)):t}}}}return n}function B(e){return e.approvals&&e.approvals.some((e=>2===e.status))||e.manualValidations&&e.manualValidations.some((e=>2===e.status))||e.checks&&e.checks.some((e=>2===e.status))||e.taskChecks&&e.taskChecks.some((e=>2===e.status))}function U(e,t,a){let s=!1;return 1!==e.length||0!==t.length||a||(e[0].approvals&&e[0].taskChecks?s=!1:e[0].approvals&&1===e[0].approvals.length?e[0].manualValidations&&0===e[0].manualValidations.length&&(s=!0):(e[0].taskChecks&&1===e[0].taskChecks.length||e[0].manualValidations&&1===e[0].manualValidations.length)&&(s=!0)),s}t[e].getCheckName=O,t[e].getStageTimeoutDetails=F,t[e].getTaskCheckStatusString=L,t[e].arePendingChecksPresent=B,t[e].shouldBypassChecksPanel=U,c.Components.add("ms.tfs-build.approvals-list-panel",(a=>{const n=(0,c.useComponentContext)().pageContext.getService("IChecksPanelService");return n.initialize(),n.fetchData(a.runId,a.stages.map((e=>e.id)),a.checkListItemType),s.createElement(t[e].ChecksListPanelView,Object.assign({},a))}))}("ChecksListPanel"),function(e){t[e]={};class a extends V.VssService{get data(){return this._stages}initialize(){this._stages=new n.ObservableArray;const e=this.pageContext.getService("IVssPageService").getData();this._currentUserId=e?e.user.id:""}fetchData(e,t,a){const s=this.pageContext.getService("IVssContributionService"),n={buildId:e.toString(),stageIds:t.join(","),checkListItemType:a};s.getDataAsync("ms.vss-build-web.checks-panel-data-provider",n,!0).then((e=>{e&&(this._stages.value=e)}))}isCurrentUserBlockedFromApproving(e){for(let t=0;t<e.length;t++)if(2===e[t].status){let a=e[t];for(let e=0;e<a.blockedApprovers.length;e++)if(a.blockedApprovers[e].id.toLowerCase()===this._currentUserId.toLowerCase()&&a.steps.find((e=>4===e.permissions)))return!0}return!1}}t[e].ChecksPanelService=a,V.Services.add("IChecksPanelService",{serviceFactory:a})}("ChecksPanelService"),function(e){t[e]={};class s extends V.VssService{initialize(){this._sections=new n.ObservableArray}fetchData(e,t){return this._getCheckEvaluationSections(e,t).map((e=>{this._sections.push(e)})),this._sections}_getCheckEvaluationSections(e,t){let s=[],n=e.taskCheckData.attemptToTaskCheckTimelineRecordDataMap;if(null!=e.taskCheckData.hubName&&n){const i=Object.keys(n).map((e=>{let t=n[parseInt(e)];return{attempt:parseInt(e),logId:t.logId,state:t.state,result:t.result}}));i.sort(((e,t)=>t.attempt-e.attempt));let o=!0;i.map((n=>{s.push({key:"check-evaluation"+n.attempt,title:(0,a.format)(W.AttemptFormat,n.attempt.toString()),hasData:!0,statusProps:(0,$.isInternalTaskCheck)(e)?(0,$.getCheckRunStatusIndicatorData)(e.status).statusProps:(0,O.getTimelineStatusIndicatorData)(n.state,n.result).statusProps,isExpanded:o,getData:()=>this._getEvaluationLogs(e,n.logId,t)}),o=!1}))}return s}async _getEvaluationLogs(e,t,a){return(await(0,F.issueRequest)(this._getUrl(e.taskCheckData,t,a)).then((e=>e.json()),(e=>""))).value.join("\n")}_getUrl(e,t,a){return(0,m.routeUrl)(this.pageContext,"ms.vss-build-web.check-logsapi-route",{projectId:a,hubName:e.hubName.toLowerCase(),planId:e.planId,logId:t.toString()})}}t[e].LogsViewPanelService=s,V.Services.add("ILogsViewPanelService",{serviceFactory:s})}("LogsViewPanelService"),function(e){Z=t[e]={},function(e){e.EnableChecksScalabilityPhase1Warnings="Pipelines.Checks.EnableChecksScalabilityPhase1Warnings",e.EnableChecksScalabilityPhase2Errors="Pipelines.Checks.EnableChecksScalabilityPhase2Errors",e.EnableChecksScalabilityPhase3FailCheckRuns="Pipelines.Checks.EnableChecksScalabilityPhase3FailCheckRuns",e.EnableChecksScalabilityResourceIssues="Pipelines.Checks.EnableChecksScalabilityResourceIssues",e.ResourceListOptimizations="Pipelines.Policy.ResourceListOptimizations",e.EnableBypassTaskChecks="Pipelines.Checks.EnableBypassTaskChecks",e.EnableBypassApprovals="Pipelines.Checks.EnableBypassApprovals",e.EnableRerunChecks="Pipelines.Checks.EnableRerunChecks",e.FixTimeoutJobWhenOrderingIsEnabled="Pipelines.Checks.FixTimeoutJobWhenOrderingIsEnabled",e.AllowChangingApprovalOrder="Pipelines.Checks.AllowChangingApprovalOrder",e.EnableOrderingChecks="Pipelines.Checks.EnableOrderingChecks",e.EnableCheckUpdatedHook="Pipelines.Checks.EnableCheckUpdatedHook",e.DoNotAllowChangingPoPCheckType="Pipelines.Checks.DoNotAllowChangingPoPCheckType",e.FixBranchCheckWhenPipelineIsNotCheckedOut="Pipelines.Checks.FixBranchCheckWhenPipelineIsNotCheckedOut",e.EnableProductionReadinessCheck="ProductionReadiness.EnableProductionReadinessCheck",e.EnableProductionReadinessCheckInShadowMode="ProductionReadiness.EnableProductionReadinessCheckInShadowMode",e.HandleMultipleExclusiveLocksInPeristedStages="Pipelines.Checks.HandleMultipleExclusiveLocksInPeristedStages",e.TimeoutAuthorizationCheckIn7Days="Pipelines.Checks.TimeoutAuthorizationCheckIn7Days",e.BetterTelemetryForPipelineLog="Pipelines.Checks.BetterTelemetryForPipelineLog",e.FixNotificationSentToExOrgMember="Pipelines.Checks.FixNotificationSentToExOrgMember",e.EnableViolationCreatorCannotApprove="ProductionReadinessEngine.EnableViolationCreatorCannotApprove"}(t[e].FeatureFlagConstants||(t[e].FeatureFlagConstants={})),function(e){e.ServiceEndpoint="endpoint",e.Queue="queue",e.SecureFile="securefile",e.VariableGroup="variablegroup",e.Environment="environment",e.AgentPool="agentpool",e.Repository="repository",e.PersistedStage="persistedstage"}(t[e].ResourceTypeNames||(t[e].ResourceTypeNames={}))}("GeneratedConstants"),function(e){K=t[e]={};t[e].ProductionReadinessLearnMoreFooter=()=>s.createElement("div",{className:"production-readiness-footer relative separator-line-top"},s.createElement("div",{className:"flex-row"},s.createElement(r.Icon,{iconName:"Info",className:"secondary-text margin-right-16 margin-left-8 padding-0 flex-self-center"}),s.createElement(L.FormatComponent,{className:"secondary-text fontSizeS",elementType:"div",format:W.LearnMoreAbout},s.createElement(f.Link,{href:W.ProductionReadinessCheckLearnLink,target:"_blank"},W.ProductionReadinessCheck))))}("ProductionReadinessLearnMoreFooter"),function(e){var n;ee=t[e]={},function(e){e[e.WaitingForApproval=0]="WaitingForApproval",e[e.Approved=1]="Approved",e[e.Rejected=2]="Rejected",e[e.AlreadyApproved=3]="AlreadyApproved"}(n=t[e].ProductionReadinessPanelType||(t[e].ProductionReadinessPanelType={}));const i={},o=(e,t)=>{const a=e.filter((e=>t.includes(e.violationStatus))),s=new Map;return a.forEach((e=>{s.has(e.violationType)||s.set(e.violationType,[]),s.get(e.violationType).push(e)})),s};class l extends c.VssComponent{constructor(a,i){super(a,i),this.getPanelTitle=e=>{switch(e){case n.WaitingForApproval:return W.ProductionReadinessReviewPanelTitle;case n.Approved:return W.ProductionReadinessApprovedPanelTitle;case n.Rejected:return W.ProductionReadinessRejectedPanelTitle;case n.AlreadyApproved:return W.ProductionReadinessApprovedPanelTitle}},this.renderPolicyViolations=(a,n,i)=>{const o=((e,t)=>{const a=new Map;for(const[t,s]of e.entries())a.set(t,s.map((e=>({originalViolationType:t,policyViolation:e}))));for(const s in t){const n=t[s],i=n[0],o=n.flatMap((t=>(e.get(t)||[]).map((e=>({originalViolationType:t,policyViolation:e})))));a.set(i,o);for(let e=1;e<n.length;e++)a.delete(n[e])}return a})(a,n),r=Array.from(o.entries()).sort((([e],[t])=>e-t));return s.createElement(s.Fragment,null,r.map((([a,n])=>n.length>0&&s.createElement(t[e].PolicyViolations,{key:`${i}-${a}`,violationType:a,violations:n,violationStatus:i,repositoryMap:this.state.repositoryMap,isNewPRCUIEnabled:this._isNewPRCUIEnabled,truncatedRepositories:this.props.productionReadinessCheck.truncatedRepositories||[],numberOfCommitsLimit:this.props.productionReadinessCheck.numberOfCommitsLimit||0,limitPerViolationType:this.props.productionReadinessCheck.limitPerViolationType||0}))))},this._panelTitle=this.getPanelTitle(a.panelType),this._stageName=a.stageName==y?void 0:a.stageName,this._violations=a.productionReadinessCheck.violations,this._notApprovedViolationsMap=o(this._violations,[1]),this._approvedViolationsMap=o(this._violations,[3,2]),this._rejectedViolationsMap=o(this._violations,[4]),this.state={repositoryMap:new Map};const r=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=r.getSourceProvider("TfsGit"),this._repoIconName=this._sourceProvider?this._sourceProvider.getRepoIconName():"",this._isPRCPopupMessageEnabled=(0,w.isFeatureFlagEnabled)(this.context.pageContext,"ProductionReadinessEngine.EnableUsageOfDeltaBuildForPopupMessage",!1),this._isNewPRCUIEnabled=(0,w.isFeatureFlagEnabled)(this.context.pageContext,"ProductionReadinessEngine.EnableUsageOfNewPRCUI",!1),this._isViolationCreatorCannotApproveEnabled=(0,w.isFeatureFlagEnabled)(this.context.pageContext,Z.FeatureFlagConstants.EnableViolationCreatorCannotApprove,!1),this._isPoPTenantValidationEnabled=(0,w.isFeatureFlagEnabled)(this.context.pageContext,"ProductionReadiness.PoPTenantValidation",!1)}componentDidMount(){super.componentDidMount();let e=new Map;this._violations.forEach((({violationData:t})=>{(null==t?void 0:t.RepositoryId)&&(null==t?void 0:t.RepositoryName)&&!e.has(t.RepositoryId)&&e.set(t.RepositoryId,{icon:this._repoIconName,id:t.RepositoryId,link:void 0,name:t.RepositoryName,project:void 0})})),e.forEach(((e,t)=>{this.trackPromise(this._sourceProvider.getProjectName(t)).promise.then((a=>this.trackPromise(this._sourceProvider.fetchRepositoryLink({repositoryName:e.name||t,repositoryUrl:"",repositoryId:t},a||void 0)).promise)).then((a=>{e.link=a,this.setState((a=>({repositoryMap:new Map(a.repositoryMap).set(t,e)})))}),(e=>{e.isCanceled||console.log(e)}))}))}shouldComponentUpdate(e,t){return!this._isNewPRCUIEnabled||(e.panelType!==this.props.panelType||t!==this.state)}render(){var e,t,o,l;return this._isNewPRCUIEnabled?s.createElement(E.Panel,{backButtonProps:{onClick:this.props.onBackClick},contentClassName:"no-h-padding",descriptionItem:p(this.context.pageContext,this._stageName,this.props.productionReadinessCheck.deltaBuildName,this.props.productionReadinessCheck.deltaBuildId),lightDismiss:!0,modal:!1,onDismiss:this.props.onDismiss,titleProps:{text:this._panelTitle}},s.createElement("div",{className:"production-readiness-panel-content flex-column flex-grow"},!!this.props.proofOfPresenceResult&&!this.props.proofOfPresenceResult.success&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20 bolt-default-horizontal-spacing"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Error"},this.props.proofOfPresenceResult.message||W.ProofOfPresenceApprovalFailed)),this.props.panelType==n.WaitingForApproval&&!(null===(e=this.props.productionReadinessCheck.allowedActions)||void 0===e?void 0:e.length)&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Info"},(null===(t=this.props.productionReadinessCheck.permissionNames)||void 0===t?void 0:t.length)>0?(0,a.format)(this._isViolationCreatorCannotApproveEnabled?W.OnlyUserWithDefinitionPermissionAndNoViolationsCanApproveTitle:W.OnlyUserWithDefinitionPermissionCanApproveTitle,this.props.productionReadinessCheck.permissionNames.join(", ")):W.OnlyUserAndAdminCanApproveTitle)),this._isPRCPopupMessageEnabled&&!this.props.productionReadinessCheck.deltaBuildFound&&this.props.panelType==n.WaitingForApproval&&(this.props.productionReadinessCheck.allowedActions.includes(1)||this.props.productionReadinessCheck.allowedActions.includes(2))&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20 bolt-default-horizontal-spacing"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Info"},this._stageName?W.ProductionReadinessStageRunningFirstTime:W.ProductionReadinessStageRunningFirstTimeNoStageName)),s.createElement("div",{className:"flex-column rhythm-vertical-24 v-scroll-auto flex-grow custom-scrollbar custom-scrollbar-hidden"},this._notApprovedViolationsMap.size>0&&s.createElement(u,null,this.renderPolicyViolations(this._notApprovedViolationsMap,i,1)),this._approvedViolationsMap.size>0&&s.createElement(u,{title:this.props.panelType==n.WaitingForApproval?W.PreviouslyApproved:void 0},this.renderPolicyViolations(this._approvedViolationsMap,i,3)),this._rejectedViolationsMap.size>0&&s.createElement(u,null,this.renderPolicyViolations(this._rejectedViolationsMap,i,4))),this.props.panelType==n.WaitingForApproval&&(this.props.productionReadinessCheck.allowedActions.includes(1)||this.props.productionReadinessCheck.allowedActions.includes(2))&&s.createElement("div",{className:"flex-column"},s.createElement(N.ButtonGroup,{className:"bolt-panel-footer-buttons production-readiness-panel-buttons separator-line-top"},s.createElement("div",{className:"flex-row full-width"},s.createElement(r.Icon,{iconName:"Info",className:"secondary-text margin-right-16 margin-left-8 padding-0 flex-self-center"}),s.createElement(L.FormatComponent,{className:"secondary-text fontSizeS margin-right-16 margin-left-8 padding-0 flex-self-center",elementType:"div",format:W.LearnMoreAboutShort},s.createElement(f.Link,{href:W.ProductionReadinessCheckLearnLink,target:"_blank"},W.ProductionReadinessCheck))),this.props.productionReadinessCheck.allowedActions.includes(1)&&s.createElement(v.Button,{text:W.Reject,onClick:()=>{}}),this.props.productionReadinessCheck.allowedActions.includes(2)&&s.createElement(v.Button,{text:this.props.productionReadinessCheck.tenantName?(0,a.format)(W.ApproveWithProductionTenant,this.props.productionReadinessCheck.tenantName):W.Approve,onClick:()=>{this.props.onGrantResourceForProductionReadiness(this.props.productionReadinessCheck)},primary:!0}))),!(this.props.panelType==n.WaitingForApproval&&(this.props.productionReadinessCheck.allowedActions.includes(1)||this.props.productionReadinessCheck.allowedActions.includes(2)))&&s.createElement("div",{className:"production-readiness-panel-content"},s.createElement(K.ProductionReadinessLearnMoreFooter,null)))):s.createElement(E.Panel,{backButtonProps:{onClick:this.props.onBackClick},contentClassName:"no-h-padding",description:this._stageName,lightDismiss:!0,modal:!1,onDismiss:this.props.onDismiss,titleProps:{text:this._panelTitle}},s.createElement("div",{className:"production-readiness-panel-content flex-column flex-grow bolt-default-horizontal-spacing"},!!this.props.proofOfPresenceResult&&!this.props.proofOfPresenceResult.success&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Error"},this.props.proofOfPresenceResult.message||W.ProofOfPresenceApprovalFailed)),this._isPRCPopupMessageEnabled&&!this.props.productionReadinessCheck.deltaBuildFound&&this.props.panelType==n.WaitingForApproval&&(this.props.productionReadinessCheck.allowedActions.includes(1)||this.props.productionReadinessCheck.allowedActions.includes(2))&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Info"},this._stageName?W.ProductionReadinessStageRunningFirstTime:W.ProductionReadinessStageRunningFirstTimeNoStageName)),s.createElement("div",{className:"flex-column rhythm-vertical-24 v-scroll-auto flex-grow custom-scrollbar custom-scrollbar-hidden"},this._notApprovedViolationsMap.size>0&&s.createElement(u,null,this.renderPolicyViolations(this._notApprovedViolationsMap,i,1)),this._approvedViolationsMap.size>0&&s.createElement(u,{title:this.props.panelType==n.WaitingForApproval?W.PreviouslyApproved:void 0},this.renderPolicyViolations(this._approvedViolationsMap,i,3)),this._rejectedViolationsMap.size>0&&s.createElement(u,null,this.renderPolicyViolations(this._rejectedViolationsMap,i,4))),this.props.panelType==n.WaitingForApproval&&(this.props.productionReadinessCheck.allowedActions.includes(1)||this.props.productionReadinessCheck.allowedActions.includes(2))&&s.createElement("div",{className:"flex-column"},s.createElement(N.ButtonGroup,{className:"bolt-panel-footer-buttons production-readiness-panel-buttons"},this.props.productionReadinessCheck.allowedActions.includes(1)&&s.createElement(v.Button,{text:W.Reject,onClick:()=>{}}),this.props.productionReadinessCheck.allowedActions.includes(2)&&s.createElement(v.Button,{text:this.props.productionReadinessCheck.tenantName?(0,a.format)(W.ApproveWithProductionTenant,this.props.productionReadinessCheck.tenantName):W.Approve,onClick:()=>{this.props.onGrantResourceForProductionReadiness(this.props.productionReadinessCheck)}}))),this.props.panelType==n.WaitingForApproval&&!(null===(o=this.props.productionReadinessCheck.allowedActions)||void 0===o?void 0:o.length)&&s.createElement("div",{className:"margin-vertical-8 padding-horizontal-20"},s.createElement(b.MessageCard,{className:"flex-noshrink",severity:"Warning"},(null===(l=this.props.productionReadinessCheck.permissionNames)||void 0===l?void 0:l.length)>0?(0,a.format)(this._isViolationCreatorCannotApproveEnabled?W.OnlyUserWithDefinitionPermissionAndNoViolationsCanApproveTitle:W.OnlyUserWithDefinitionPermissionCanApproveTitle,this.props.productionReadinessCheck.permissionNames.join(", ")):W.OnlyUserAndAdminCanApproveTitle))))}}function p(e,t,a,n){const i=e.getService("IBuildLinkingService");if(t&&-1!=n){const e=n?i.getBuildUrl(n):void 0,o=""!=a?a:W.ThisBranch;return s.createElement(s.Fragment,null,s.createElement("span",null,t),s.createElement(L.FormatComponent,{elementType:"div",format:W.ComparedToFormat},s.createElement(f.Link,{href:e,target:"_blank"},o)))}if(t&&-1==n)return s.createElement("span",null,t)}t[e].ProductionReadinessPanel=l;const u=({title:e,children:t})=>{const[a,n]=(0,s.useState)(!0);return s.createElement("div",{className:"flex-column rhythm-vertical-8"},e&&s.createElement("div",{className:"flex-row justify-space-between flex-center violations-title-padding"},s.createElement("span",{className:"padding-vertical-8 title-s"},e),s.createElement(v.Button,{ariaLabel:a?W.Expanded:W.Collapsed,iconProps:{iconName:a?"ChevronUp":"ChevronDown",size:"medium"},onClick:e=>{e.preventDefault(),n(!a)},subtle:!0})),a&&t)};t[e].PolicyViolations=a=>{const{repositoryMap:n,violationType:i,violations:o,violationStatus:l,isNewPRCUIEnabled:c,truncatedRepositories:p,numberOfCommitsLimit:u,limitPerViolationType:d}=a,m=()=>{switch(l){default:case 1:return"policy-violation-group-icon-warning ms-Icon--Warning";case 3:return"ms-Icon--Completed"}};if(c){const a=(0,t[e].getItemProvider)(n,i,o,l,p,u,d);return s.createElement(U.Tree,{ariaLabel:W.ViolationsTree,columns:[{hierarchical:!0,id:"violationsTreeColumn",name:W.ViolationsTreeColumn,renderCell:(e,t,a,n)=>{const i=n.underlyingItem.data;return s.createElement(U.ExpandableTreeCell,{columnIndex:t,contentClassName:"violations-tree-cell",key:t,treeColumn:a,treeItem:n},i.content.textNode)},width:-100}],itemProvider:a,onToggle:(e,t)=>{a.toggle(t.underlyingItem)},scrollable:!0,showHeader:!1})}return s.createElement("div",{key:`${l}-${i}`,className:"flex-column flex-grow"},s.createElement("div",{className:"flex-row font-size-m padding-vertical-8"},s.createElement(r.Icon,{className:(0,S.css)("ms-Icon font-size-ml padding-4",m())}),s.createElement("span",{className:"policy-violation-group-title"},(()=>{switch(i){case 1:case 2:return W.CodeChangeBypassedProofOfPresenceTitle;case 3:return W.MinimumRequiredApproversViolationTitle;case 4:return W.DoesNotExtendApprovedTemplateViolationTitle;default:return""}})())),o.map((({originalViolationType:e,policyViolation:t})=>{return s.createElement("div",{key:t.violationId,className:"flex-column flex-grow"},s.createElement("div",{className:"padding-horizontal-8"}),k((a=t.violationData.RepositoryId,n.get(a)),e,t.violationData));var a})))};t[e].getItemProvider=(e,t,a,n,i,o,l)=>{const c=t=>e.get(t),p=e=>{switch(e){default:case 1:return"policy-violation-group-icon-warning ms-Icon--AlertSolid";case 3:return"ms-Icon--Completed"}},u=[],g=[],h=(e=>{const t=new Map;for(const a of e)t.has(a.policyViolation.violationData.RepositoryId)||t.set(a.policyViolation.violationData.RepositoryId,[]),t.get(a.policyViolation.violationData.RepositoryId).push(a);return Array.from(t.entries()).sort((([e,t],[a,s])=>{var n,i;const o=(null===(n=t[0])||void 0===n?void 0:n.policyViolation.violationData.RepositoryName)||"",r=(null===(i=s[0])||void 0===i?void 0:i.policyViolation.violationData.RepositoryName)||"";return o.localeCompare(r)})).map((([e,t])=>t.sort(((e,t)=>{const a=e.policyViolation.violationData.CommitTimestamp||"";return(t.policyViolation.violationData.CommitTimestamp||"").localeCompare(a)}))))})(a);h.forEach((e=>{const t=[];e.forEach((e=>{const a=e.originalViolationType,s=e.policyViolation,n={content:{textNode:d(c(s.violationData.RepositoryId),a,s.violationData)}};null!=n.content.textNode&&t.push({data:n})}));const a={content:{textNode:m(c(e[0].policyViolation.violationData.RepositoryId),e[0].originalViolationType,e[0].policyViolation.violationData,t.length,i,o,l)}};t.length>0&&null!=a.content.textNode&&g.push({data:a,childItems:t})}));const v={content:{textNode:((e,t)=>s.createElement("div",{className:"font-size-m flex-row flex-center"},s.createElement(r.Icon,{className:(0,S.css)("ms-Icon font-size-l padding-4 center",p(t))}),s.createElement("span",{className:"policy-violation-group-title"},(e=>{switch(e){case 1:return W.CommitWithoutPullRequestTitle;case 2:return W.CodeChangeBypassedProofOfPresenceTitle;case 3:return W.MinimumRequiredApproversViolationTitle;case 4:return W.DoesNotExtendApprovedTemplateViolationTitle;default:return""}})(e))))(t,n)}};return u.push(g.length>0?{data:v,childItems:g}:{data:v}),new j.TreeItemProvider(u)};const d=(e,t,a)=>{const n={1:()=>s.createElement(h,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e}),2:()=>s.createElement(h,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,isPR:!0}),3:()=>s.createElement(h,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,isPR:!0}),4:()=>null}[t];return n?n():null},m=(e,t,a,n,i,o,r)=>{const l={1:()=>s.createElement(g,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,numberOfViolations:n,truncatedRepositories:i,numberOfCommitsLimit:o,limitPerViolationType:r}),2:()=>s.createElement(g,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,numberOfViolations:n,truncatedRepositories:i,numberOfCommitsLimit:o,limitPerViolationType:r}),3:()=>s.createElement(g,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,numberOfViolations:n,truncatedRepositories:i,numberOfCommitsLimit:o,limitPerViolationType:r}),4:()=>null}[t];return l?l():null},g=e=>{var t,n,i;const{repositoryName:o,repositoryDetails:l,numberOfViolations:c,truncatedRepositories:p,numberOfCommitsLimit:u,limitPerViolationType:d}=e,m=(null!=p?p:[]).map((e=>e.split(";")[0])).includes(null!==(t=null==l?void 0:l.id)&&void 0!==t?t:""),g=c&&c==(null!=d?d:-1),h={red:251,green:242,blue:236};return s.createElement(s.Fragment,null,s.createElement("div",{className:"production-readiness-repository-object-link flex-row"},s.createElement(B.FPSLink,{className:"scroll-hidden flex-row flex-baseline",href:null!==(n=null==l?void 0:l.link)&&void 0!==n?n:"",subtle:!0,ariaLabel:(0,a.format)("Repository {0}",o),removeUnderline:!0},s.createElement("span",{className:"flex-row text-ellipsis"},s.createElement(r.Icon,{iconName:null!==(i=null==l?void 0:l.icon)&&void 0!==i?i:"",className:"pipelines-icon-right-margin"}),o))),s.createElement("div",{className:"full-width"}),s.createElement("span",{className:"flex-row flex-center"},m&&!g?s.createElement(D.Tooltip,{overflowOnly:!1,text:(0,a.format)(W.CommitsExceededLimit,u)},s.createElement(x.Pill,{color:h,variant:2,children:s.createElement("div",{className:"flex-row flex-center"},s.createElement(r.Icon,{className:"policy-violation-group-icon-warning violations-pill-padding-warning font-size-ml ms-Icon--Warning"}),s.createElement("span",{className:"policy-violation-group-icon-warning"},c))})):null,!m&&g?s.createElement(D.Tooltip,{overflowOnly:!1,text:(0,a.format)(W.ViolationsExceededLimit,d)},s.createElement(x.Pill,{color:h,variant:2,children:s.createElement("div",{className:"flex-row flex-center"},s.createElement(r.Icon,{className:"policy-violation-group-icon-warning violations-pill-padding-warning font-size-ml ms-Icon--Warning"}),s.createElement("span",{className:"policy-violation-group-icon-warning"},c))})):null,m&&g?s.createElement(D.Tooltip,{overflowOnly:!1,text:(0,a.format)(W.CommitsAndViolationsExceededLimit,u,d)},s.createElement(x.Pill,{color:h,variant:2,children:s.createElement("div",{className:"flex-row flex-center"},s.createElement(r.Icon,{className:"policy-violation-group-icon-warning violations-pill-padding-warning font-size-ml ms-Icon--Warning"}),s.createElement("span",{className:"policy-violation-group-icon-warning"},c))})):null,m||g?null:s.createElement("div",{className:"padding-top-4 padding-bottom-4"},s.createElement(x.Pill,{children:s.createElement("div",null,c)}))))},h=e=>{const{message:t,repositoryObjectId:a,repositoryObjectUrl:n,isPR:i}=e;return s.createElement(D.Tooltip,{overflowOnly:!0,text:t},s.createElement("div",{className:"text-ellipsis production-readiness-repository-object-link"},i?s.createElement(B.FPSLink,{href:n,subtle:!0,className:"flex-row flex-center"},s.createElement(r.Icon,{iconName:"BranchPullRequest",className:"pipelines-icon-right-margin"}),s.createElement("span",{className:"production-readiness-repository-object-message"},a?a.substring(0,8):""," ",t)):s.createElement(B.FPSLink,{href:n,subtle:!0,className:"flex-row flex-center"},s.createElement(r.Icon,{iconName:"BranchCommit",className:"pipelines-icon-right-margin"}),s.createElement("span",{className:"production-readiness-repository-object-message text-ellipsis"},a?a.substring(0,8):""," ",t))))},k=(e,t,a)=>{const n={1:()=>s.createElement(C,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e}),2:()=>s.createElement(C,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,isPR:!0}),3:()=>s.createElement(C,{message:a.Message,repositoryName:a.RepositoryName,repositoryId:a.RepositoryId,repositoryObjectId:a.RepositoryObjectId,repositoryObjectUrl:a.RepositoryObjectUrl,repositoryDetails:e,isPR:!0}),4:()=>null}[t];return n?s.createElement("div",{className:"flex-row body-s"},n()):null},C=e=>{var t,n;const{message:i,repositoryName:o,repositoryId:l,repositoryDetails:c,repositoryObjectId:p,repositoryObjectUrl:u,isPR:d}=e;return s.createElement("div",{key:`${l}/${p}`,className:"flex-row flex-center production-readiness-repository-object full-width"},s.createElement("div",{className:"production-readiness-repository-object-link"},s.createElement(B.FPSLink,{className:"scroll-hidden flex-row flex-baseline",href:null!==(t=null==c?void 0:c.link)&&void 0!==t?t:"",subtle:!0,ariaLabel:(0,a.format)("Repository {0}",o),removeUnderline:!0},s.createElement("span",{className:"text-ellipsis "},s.createElement(r.Icon,{iconName:null!==(n=null==c?void 0:c.icon)&&void 0!==n?n:"",className:"pipelines-icon-right-margin"}),o))),s.createElement("div",{className:"text-ellipsis production-readiness-repository-object-link"},d?s.createElement(B.FPSLink,{href:u,subtle:!0},s.createElement("span",{className:"production-readiness-repository-object-message"},"!",p," ",i)):s.createElement(B.FPSLink,{href:u,subtle:!0},s.createElement(r.Icon,{iconName:"BranchCommit",className:"pipelines-icon-right-margin"}),s.createElement("span",{className:"production-readiness-repository-object-message text-ellipsis"},p))))},y="__default"}("ProductionReadinessPanel"),function(e){t[e]={};const i="__default",o=[$.BranchProtectionPolicyCheckTypeIdString,$.BusinessHoursPolicyCheckTypeIdString,$.EvaluateArtifactPolicyCheckTypeIdString],l=[$.BranchProtectionPolicyCheckTypeIdString,$.EvaluateArtifactPolicyCheckTypeIdString];t[e].StageChecksPanelView=e=>{const[t,o]=s.useState(!1),[r,l]=s.useState(!1),[g,v]=s.useState(!1),[k,C]=s.useState(ee.ProductionReadinessPanelType.WaitingForApproval),[f,y]=s.useState(void 0),[b,S]=s.useState(void 0),[P,A]=s.useState(void 0),[R,x]=s.useState(void 0),[I,N]=s.useState(!1),[T,D]=s.useState(void 0),[M,V]=s.useState(!1),[O,F]=s.useState(""),[L,B]=s.useState(!1),[U,j]=s.useState(""),q=e.componentContext||(0,c.useComponentContext)(),_=q.pageContext.getService("IChecksPanelService"),z=(0,w.isFeatureFlagEnabled)(q.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1BuildCheckIssues",!1),G=(0,w.isFeatureFlagEnabled)(q.pageContext,"Pipelines.Checks.EnableOrderingChecks",!1),H=(e,t,a)=>{y(e),x(t),C(a),v(!0)},Q=(e,t)=>{S(e),x(t),o(!0)},te=(e,t)=>{A(e),x(t),l(!0)},ae=(e,t)=>{N(!0),D(e),B(t)};let ne=W.DefaultPanelTitle;if(0===e.reviewMode)ne=W.AllPendingPanelTitle;else if(1===e.reviewMode&&e.stages&&e.stages[0]&&e.stages[0].name!==i)switch(e.checkListItemType){case 3:ne=(0,a.format)(W.StagePanelTitleCommon,e.stages[0].name);break;case 1:ne=(0,a.format)(W.StagePanelTitleChecks,e.stages[0].name);break;case 2:ne=(0,a.format)(W.StagePanelTitleManualValidation,e.stages[0].name)}const ie=new n.ObservableValue(!1),re=new n.ObservableValue({status:4,approvals:[]}),le=(e,t)=>{ie.value=!0,re.value={status:e,approvals:t}},ce=(t,a,s,n)=>{const i=a.map((e=>({approvalId:e.id,status:t,comment:s||"",deferredTo:n})));V(!0),e.onSubmitBulkApproval(i)},pe=t=>{e.onRerunCheck(t.resource.checkId,t.taskCheckData.planId)},ue=t=>{e.onBypassCheck(t.id,t.checkSuiteId)},de=(t,a,s,n)=>{let i=new Array,o={approvalId:t.id,assignedApprover:a.assignedApprover,reassignTo:s,comment:n||""};return i.push(o),e.onReassignApprovals(i)},me=1===e.reviewMode&&!!e.onStageBackClick,ge=(0,w.isFeatureFlagEnabled)(q.pageContext,"ProductionReadiness.EnableProductionReadinessCheck",!1);return s.createElement(E.Panel,{backButtonProps:me?{onClick:e.onStageBackClick}:void 0,onDismiss:e.onDismiss,contentClassName:"pipelines-checks-panel",titleProps:{text:ne},description:O,overlayContent:M?s.createElement(u.Spinner,null):void 0},s.createElement(p.Observer,{stages:_.data},(t=>{const n=[];let i=!1,o=!1;const r=t.stages.filter((e=>e.approvals&&e.approvals.some((e=>$.isCheckPermissionUpdate(e.permissions))))),l=t.stages.filter((e=>e.approvals&&e.approvals.length>0&&e.approvals.every((e=>0===e.permissions))));r.concat(l).forEach((e=>n.push(e)));const c=t.stages.filter((e=>e.manualValidations&&e.manualValidations.some((e=>$.isCheckPermissionUpdate(e.permissions))))),p=t.stages.filter((e=>e.manualValidations&&e.manualValidations.length>0&&e.manualValidations.every((e=>0===e.permissions)))),u=c.concat(p);for(let e of u){e.approvals&&e.approvals.length>0||n.push(e)}for(let e of t.stages){const t=e.approvals&&e.approvals.length>0,s=e.manualValidations&&e.manualValidations.length>0,r=e.taskChecks&&e.taskChecks.length>0,l=e.productionReadinessChecks&&e.productionReadinessChecks.length>0,c=e.proofOfPresenceChecks&&e.proofOfPresenceChecks.length>0,p=e.exclusiveLockChecks&&e.exclusiveLockChecks.length>0,u=e.checks&&e.checks.filter((e=>!(0,a.equals)(e.typeId,$.AuthorizationCheckTypeIdString,!0))).length>0;o=o||l,t||s||(c||l)&&n.push(e),(r||p||u)&&(t||s||c||l||n.push(e),i=!0)}j(t.stages&&t.stages.length>0?t.stages[0].projectId:"");const g=t.stages.filter((e=>e.checks&&e.checks.length>0&&e.checks.every((e=>(0,a.equals)(e.typeId,$.AuthorizationCheckTypeIdString,!0))))),v=g.filter((e=>e.checks.some((e=>$.isCheckPermissionUpdate(e.permissions))))),k=g.filter((e=>e.checks.length>0&&e.checks.every((e=>0===e.permissions)))),C=v.concat(k),f=oe(n,C,i);if(1===e.reviewMode&&1===n.length){let{stageTimeoutMessage:e,stageTimeoutMessageToolTip:t}=se(n[0]);F(e)}else if((0,w.isFeatureFlagEnabled)(q.pageContext,Z.FeatureFlagConstants.TimeoutAuthorizationCheckIn7Days,!1)&&1===e.reviewMode&&1===g.length){let{stageTimeoutMessage:e,stageTimeoutMessageToolTip:t}=se(g[0]);F(e)}else F("");return s.createElement("div",{className:"flex-column rhythm-vertical-32 pipelines-checks-container"},!f&&0===C.length&&n.map((t=>{const a=()=>{e.onViewStageClick&&e.onViewStageClick({id:t.stageId,name:t.stageName})};return G?s.createElement(h,{stageData:t,key:"StageGroup"+t.stageId,showCheckIssues:z,onSelectTaskCheck:ae,onSelectApproval:Q,onClickProductionReadinessButton:H,onSelectManualValidation:te,onViewStageChecksClicked:e.onViewStageClick?a:void 0,reviewMode:e.reviewMode,submitApprovals:ce,openReviewDialog:le,onRerunCheck:pe,onBypassCheck:ue,onGrantResource:e.onGrantResource,onGrantProductionReadinessResource:e.onGrantProductionReadinessResource,isChecksOrderingEnabled:G,checkResults:e.checkResults}):s.createElement(m,{stageData:t,key:"StageGroup"+t.stageId,showCheckIssues:z,onSelectTaskCheck:ae,onSelectApproval:Q,onClickProductionReadinessButton:H,onSelectManualValidation:te,onViewStageChecksClicked:e.onViewStageClick?a:void 0,reviewMode:e.reviewMode,submitApprovals:ce,openReviewDialog:le,onRerunCheck:pe,onBypassCheck:ue,onGrantResource:e.onGrantResource,onGrantProductionReadinessResource:e.onGrantProductionReadinessResource,isChecksOrderingEnabled:G,checkResults:e.checkResults})})),C.map((t=>t.checks.length>0&&s.createElement(d,{key:"StageGroup"+t.stageId,pipelineId:e.pipelineId,stageData:t,onPermitResource:e.onPermitResource,reviewMode:e.reviewMode}))),f&&n[0].approvals&&s.createElement(J.ApprovalPanel,{approval:n[0].approvals[0],stageName:n[0].stageName,onBackClick:e.onDismiss,onDismiss:e.onDismiss,onSubmitApprovals:ce,onReassignStep:de}),f&&n[0].manualValidations&&s.createElement(Y.ManualValidationPanel,{manualValidation:n[0].manualValidations[0],stageName:n[0].stageName,onBackClick:e.onDismiss,onDismiss:e.onDismiss,onSubmitManualValidations:ce}),f&&n[0].taskChecks&&s.createElement(X.LogsViewPanel,{check:n[0].taskChecks[0],arePendingChecksPresent:2===n[0].taskChecks[0].status,projectId:U,onBackClick:e.onDismiss,onDismiss:e.onDismiss}),ge&&o&&s.createElement(K.ProductionReadinessLearnMoreFooter,null))})),t&&s.createElement(J.ApprovalPanel,{approval:b,stageName:R,onBackClick:e=>{S(void 0),o(!1)},onDismiss:e.onDismiss,onSubmitApprovals:ce,onReassignStep:de}),r&&s.createElement(Y.ManualValidationPanel,{manualValidation:P,stageName:R,onBackClick:e=>{A(void 0),l(!1)},onDismiss:e.onDismiss,onSubmitManualValidations:ce}),I&&s.createElement(X.LogsViewPanel,{check:T,arePendingChecksPresent:L,projectId:U,onBackClick:e=>{D(void 0),N(!1)},onDismiss:e.onDismiss}),g&&s.createElement(ee.ProductionReadinessPanel,{productionReadinessCheck:f,onBackClick:e=>{y(void 0),v(!1)},onDismiss:e.onDismiss,stageName:R,panelType:k,onGrantResourceForProductionReadiness:e.onGrantProductionReadinessResource,proofOfPresenceResult:e.checkResults[f.checkSuiteId]}))};const d=e=>{const t=new M.ArrayItemProvider(e.stageData.checks),n=e.stageData.stageName,o=(0,c.useComponentContext)(),l=0===e.reviewMode&&n!==i;return s.createElement("div",null,l&&s.createElement("div",{className:"flex-row body-m"},s.createElement("div",{className:"flex-column flex-grow justify-end"},s.createElement("div",{className:"flex-row font-weight-semibold checks-group-header-title"},s.createElement("span",{className:"title-s text-ellipsis stage-header"},e.stageData.stageName)))),s.createElement(T.List,{className:"pipelines-checks-container",itemProvider:t,renderRow:(t,n,i)=>{const l=n.resource.name,c=(0,a.format)("pm-{0}-{1}-{2}",e.stageData.stageId,n.resource.type,n.resource.id),p=n.resource?$.getResourceTypeIcons(n.resource.type):"Server",u=n.resource?$.getResourceTypeString(n.resource.type):"";return s.createElement(T.ListItem,{key:"ci-"+t,index:t,details:i},s.createElement("div",{className:"pipelines-permission-group flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(r.Icon,{className:"pipelines-resource-icon",iconName:"Lock"}),s.createElement("div",{className:"pipelines-permission-row flex-column flex-grow h-scroll-hidden"},s.createElement("div",{className:"flex-row flex-center h-scroll-hidden"},s.createElement("span",{className:"checks-row-title body-m text-ellipsis"},W.Permission),s.createElement(r.Icon,{className:"pipelines-resource-icon secondary-text",iconName:p}),s.createElement("span",{className:"pipelines-resource body-s text-ellipsis secondary-text"},u),s.createElement("span",{className:"pipelines-resource body-s text-ellipsis"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(o.pageContext,n.resource)},l))),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},W.PermissionSecondary)),$.isCheckPermissionUpdate(n.permissions)&&s.createElement(N.ButtonGroup,{className:"flex-grow"},s.createElement(v.Button,{id:c,primary:!0,text:W.Permit,onClick:()=>(t=>{const n={pipelines:[{id:e.pipelineId,authorized:!0}]},i=t.resource.type,r=()=>{e.onPermitResource(n,i,t.resource.id)};o.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const n={title:W.PermitConfirmDialogTitle,message:(0,a.localeFormat)(W.PermitConfirmDialogDescription,$.getResourceTypeString(i),t.resource.name),onClose:e,cancelLabel:W.Cancel,onConfirm:r,confirmLabel:W.Permit};return s.createElement(I.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},n),null)}))})(n)}))))}}))},m=e=>{let t=e.stageData.approvals&&te(e.stageData.approvals);const i=e.stageData.approvals?new n.ObservableArray(e.stageData.approvals.filter((e=>$.isCheckPermissionUpdate(e.permissions)&&e.steps.filter((e=>2===e.status&&2===e.permissions)).length>0))):new n.ObservableArray([]),o=e.stageData.approvals?new n.ObservableArray(z(e.stageData.approvals).filter((e=>!i.value.includes(e)))):new n.ObservableArray([]),r=e.stageData.manualValidations?new n.ObservableArray(e.stageData.manualValidations.filter((e=>$.isCheckPermissionUpdate(e.permissions)))):new n.ObservableArray([]),l=e.stageData.manualValidations?new n.ObservableArray(G(e.stageData.manualValidations)):new n.ObservableArray([]),c=e.stageData.taskChecks?new n.ObservableArray(e.stageData.taskChecks):new n.ObservableArray([]),p=e.stageData.checks?e.stageData.checks.filter((e=>(0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))):null,u=p?new n.ObservableArray(p):new n.ObservableArray([]),d=e.stageData.proofOfPresenceChecks?new n.ObservableArray(e.stageData.proofOfPresenceChecks):new n.ObservableArray([]),m=e.stageData.productionReadinessChecks?new n.ObservableArray(e.stageData.productionReadinessChecks):new n.ObservableArray([]),g=e.stageData.exclusiveLockChecks?new n.ObservableArray(e.stageData.exclusiveLockChecks):new n.ObservableArray([]),h=ie(e.stageData),{stageTimeoutMessage:v,stageTimeoutMessageToolTip:k}=se(e.stageData),C=(t,a,s=null,n=!1)=>{n?e.submitApprovals(t,r.value,a,s):e.submitApprovals(t,i.value,a,s)};return s.createElement("div",null,s.createElement(U,{myApprovalsCount:i.length,myManualValidationsCount:r.length,otherChecksCount:o.length+l.length,stageName:e.stageData.stageName,stageTimeoutString:v,stageTimeoutStringToolTip:k,reviewMode:e.reviewMode,openReviewDialog:t=>{e.openReviewDialog(t,i.value)},onViewStageChecksClicked:e.onViewStageChecksClicked}),i.length>0&&s.createElement("div",null,s.createElement(A,{itemProvider:i,isManualValidation:!1,showOptions:!0,arePendingChecksPresent:h,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,onSubmit:C,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck})),t&&s.createElement(b.MessageCard,{className:"requester-blocked-message-card",severity:"Warning"},W.CurrentUserCannotApproveMessage),o.length>0&&s.createElement(A,{itemProvider:o,isManualValidation:!1,showOptions:!1,arePendingChecksPresent:h,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,onSubmit:C,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck}),c.length>0&&s.createElement(j,{checks:c,onSelectCheck:e.onSelectTaskCheck,arePendingChecksPresent:h,showCheckIssues:e.showCheckIssues,onRerunCheck:e.onRerunCheck,onBypassCheck:e.onBypassCheck}),u.length>0&&s.createElement(x,{checks:u}),d.length>0&&s.createElement(F,{checks:d,stageId:e.stageData.stageId,onGrantResource:e.onGrantResource,checkResults:e.checkResults}),m.length>0&&s.createElement(B,{checks:m,stageId:e.stageData.stageId,stageName:e.stageData.stageName,onClickProductionReadinessButton:e.onClickProductionReadinessButton}),g.length>0&&s.createElement(V,{checks:g}),r.length>0&&s.createElement("div",null,s.createElement(A,{itemProvider:r,isManualValidation:!0,showOptions:!0,onSelectApproval:e.onSelectManualValidation,stageName:e.stageData.stageName,onSubmit:C,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck})),l.length>0&&s.createElement(A,{itemProvider:l,isManualValidation:!0,showOptions:!1,onSelectApproval:e.onSelectManualValidation,stageName:e.stageData.stageName,onSubmit:C,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck}))},h=e=>{const t=e=>e.reduce(((e,t)=>{var a=e.get(t.evaluationOrder)||[];return a.push(t),e.set(t.evaluationOrder,a),e}),new Map),i=e.stageData.approvals?e.stageData.approvals.filter((e=>{var t;if((null===(t=e.steps)||void 0===t?void 0:t.some((e=>128===e.status&&2===e.permissions)))||$.isCheckPermissionUpdate(e.permissions))return e.steps.filter((e=>(2===e.status||128===e.status)&&2===e.permissions)).length>0})):[],o=e.stageData.approvals?z(e.stageData.approvals).filter((e=>!i.includes(e))):[],r=e.stageData.manualValidations?e.stageData.manualValidations.filter((e=>$.isCheckPermissionUpdate(e.permissions))):[],l=e.stageData.manualValidations?G(e.stageData.manualValidations):[],c=e.stageData.taskChecks||[],p=e.stageData.checks?e.stageData.checks.filter((e=>(0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))):[],u=e.stageData.proofOfPresenceChecks||[],d=e.stageData.productionReadinessChecks||[],m=e.stageData.exclusiveLockChecks||[],g=t(i),h=t(o),v=t(r),C=t(l),f=t(c),y=t(p),b=t(u),E=t(d),S=t(m),{stageTimeoutMessage:P,stageTimeoutMessageToolTip:A}=se(e.stageData),R=Object.values(H.EvaluationOrder).filter((e=>Number.isInteger(Number(e))));let w=!0;const x=R.map((t=>{const a=t;var i=g.get(a)||[],o=v.get(a)||[],r=h.get(a)||[],l=C.get(a)||[],c=f.get(a)||[],p=y.get(a)||[],u=b.get(a)||[],d=E.get(a)||[],m=S.get(a)||[];if(i.length<=0&&o.length<=0&&r.length<=0&&l.length<=0&&c.length<=0&&p.length<=0&&u.length<=0&&d.length<=0&&m.length<=0)return;let P=!0;return w&&(P=!1,w=!1),s.createElement(k,Object.assign({},e,{evaluationOrder:a,myApprovals:new n.ObservableArray(i),myManualValidations:new n.ObservableArray(o),otherApprovals:new n.ObservableArray(r),otherManualValidations:new n.ObservableArray(l),taskChecks:new n.ObservableArray(c),extendsChecks:new n.ObservableArray(p),proofOfPresenceChecks:new n.ObservableArray(u),productionReadinessChecks:new n.ObservableArray(d),exclusiveLockChecks:new n.ObservableArray(m),renderSeperator:P,key:"phase_"+a}))}));return s.createElement("div",null,s.createElement(U,{myApprovalsCount:i.length,myManualValidationsCount:r.length,otherChecksCount:o.length+l.length,stageName:e.stageData.stageName,stageTimeoutString:P,stageTimeoutStringToolTip:A,reviewMode:e.reviewMode,openReviewDialog:t=>((t,a)=>{e.openReviewDialog(t,a)})(t,i),onViewStageChecksClicked:e.onViewStageChecksClicked}),x)},k=e=>{const t=e.stageData.approvals&&te(e.stageData.approvals),a=ie(e.stageData),n=(t,a,s,n=!1)=>{n?e.submitApprovals(t,e.myManualValidations.value,a,s):e.submitApprovals(t,e.myApprovals.value,a,s)};return s.createElement("div",{className:(0,S.css)(e.renderSeperator&&"stage-checks-ordered")},e.myApprovals.length>0&&s.createElement("div",null,s.createElement(A,{itemProvider:e.myApprovals,isManualValidation:!1,showOptions:!0,arePendingChecksPresent:a,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,onSubmit:n,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck})),t&&s.createElement(b.MessageCard,{className:"requester-blocked-message-card",severity:"Warning"},W.CurrentUserCannotApproveMessage),e.otherApprovals.length>0&&s.createElement(A,{itemProvider:e.otherApprovals,isManualValidation:!1,showOptions:!1,arePendingChecksPresent:a,onSelectApproval:e.onSelectApproval,stageName:e.stageData.stageName,onSubmit:n,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck}),e.taskChecks.length>0&&s.createElement(j,{checks:e.taskChecks,onSelectCheck:e.onSelectTaskCheck,arePendingChecksPresent:a,showCheckIssues:e.showCheckIssues,onRerunCheck:e.onRerunCheck,onBypassCheck:e.onBypassCheck}),e.extendsChecks.length>0&&s.createElement(x,{checks:e.extendsChecks}),e.exclusiveLockChecks.length>0&&s.createElement(V,{checks:e.exclusiveLockChecks}),e.proofOfPresenceChecks.length>0&&s.createElement(F,{checks:e.proofOfPresenceChecks,stageId:e.stageData.stageId,onGrantResource:e.onGrantResource,checkResults:e.checkResults}),e.productionReadinessChecks.length>0&&s.createElement(B,{checks:e.productionReadinessChecks,stageId:e.stageData.stageId,stageName:e.stageData.stageName,onClickProductionReadinessButton:e.onClickProductionReadinessButton}),e.myManualValidations.length>0&&s.createElement("div",null,s.createElement(A,{itemProvider:e.myManualValidations,isManualValidation:!0,showOptions:!0,onSelectApproval:e.onSelectManualValidation,stageName:e.stageData.stageName,onSubmit:n,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck})),e.otherManualValidations.length>0&&s.createElement(A,{itemProvider:e.otherManualValidations,isManualValidation:!0,showOptions:!1,onSelectApproval:e.onSelectManualValidation,stageName:e.stageData.stageName,onSubmit:n,isChecksOrderingEnabled:e.isChecksOrderingEnabled,onBypassCheck:e.onBypassCheck}))};function C(e){if(256===(null==e?void 0:e.status)||2===(null==e?void 0:e.status)){const t=e&&e.steps&&e.steps.length>0?e.steps.filter((e=>128===e.status&&null!=e.deferredTo&&2===e.permissions)):[];if(t.length>0)return t[0]}return null}t[e].getDeferredToItemForEditing=C;const A=e=>{const t=t=>!e.isChecksOrderingEnabled||16!==t.status&&32!==t.status&&1!==t.status&&0!==t.status;return s.createElement("div",{className:e.showOptions?"approval-group":""},s.createElement(T.List,{itemProvider:e.itemProvider,renderRow:(n,i,o)=>{const r=$.checksToApprovalStatus(i.status),l=ae(i),c=$.getApprovalStatusIndicatorData(r);if(c.label===W.WaitingApproval&&i.instructions)c.label=(0,a.format)(W.WaitingApprovalFormat,'"'+i.instructions+'"');else if(16===r){let e=$.getCheckRunUpdateModifiedByIdentity(128,i.resultUpdates);e&&(c.label=(0,a.format)(W.BypassedBy,e.displayName))}e.isChecksOrderingEnabled&&(o.listProps=Object.assign(Object.assign({},o.listProps),{singleClickActivation:t(i)}));const p=C(i),u=!!p&&(null==p?void 0:p.deferredTo);return s.createElement(s.Fragment,null,s.createElement(O,{rowIndex:n,check:i,details:o,checkName:l,statusIndicator:c,onBypassCheck:e.onBypassCheck,arePendingChecksPresent:e.arePendingChecksPresent}),s.createElement("li",null,!u&&e.showOptions&&n===e.itemProvider.length-1&&!e.isManualValidation&&s.createElement(J.ApprovalOptionsGroup,{isApprovalInSequence:!1,myApprovalsCount:e.itemProvider.length,useUpdatedChecksFormat:!0,onSubmit:e.onSubmit}),e.showOptions&&n===e.itemProvider.length-1&&e.isManualValidation&&s.createElement(Y.ManualValidationOptionsGroup,{myManualValidationsCount:e.itemProvider.length,useUpdatedChecksFormat:!0,onSubmit:e.onSubmit}),u&&s.createElement(R,{deferredTo:p.deferredTo,comment:p.comment,onSubmit:e.onSubmit})))},singleClickActivation:!0,width:"100%",onActivate:(a,s)=>{!a.defaultPrevented&&t(s.data)&&e.onSelectApproval(s.data,e.stageName)}}))},R=e=>{const[t,n]=s.useState(!1);return s.createElement("div",{className:(0,S.css)("flex-column","approval-options")},s.createElement("div",{className:"defer-deployment-title"},W.DeferredTo),!t&&s.createElement("div",{className:"flex-row"},s.createElement(q.Time,{dateTime:e.deferredTo,getNextInterval:()=>-1,getTimeString:()=>{let t=e.deferredTo.toLocaleString(void 0,{weekday:"long",month:"short",day:"numeric"}),s=new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric"}).format(e.deferredTo);return(0,a.format)(_.DayAtTimeFormat,t,s)},tooltipProps:{renderContent:()=>P.tooltipString(e.deferredTo)}}),s.createElement(f.Link,{className:"approval-edit-defer-date",onClick:()=>n(!0)},W.Edit)),t&&s.createElement(J.DeferApprovalArea,{deferredTo:e.deferredTo,onCancel:()=>{n(!1)},onDefer:t=>{e.onSubmit(128,e.comment,t)}}))},x=e=>s.createElement("div",null,s.createElement(T.List,{itemProvider:e.checks,renderRow:(e,t,a)=>s.createElement(O,{check:t,resultMessage:t.resultMessage,checkName:W.RequiredTemplate,details:a,rowIndex:e}),singleClickActivation:!1,width:"100%"})),V=e=>{const t=(0,c.useComponentContext)();return s.createElement("div",null,s.createElement(T.List,{itemProvider:e.checks,renderRow:(e,a,n)=>{const i=$.getExclusiveLockStatusIndicatorData(a.status);let o=i.label;return a.lockInUse&&a.buildName&&2==a.status&&(o=s.createElement("div",null,s.createElement("span",null,W.ExclusiveLockHeldBy+" "),s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getBuildUrl)(t.pageContext,a.projectId,a.buildId)},a.buildName))),s.createElement(O,{check:a,resultMessage:a.resultMessage,checkName:W.ExclusiveLock,details:n,rowIndex:e,statusIndicator:i,statusLabel:()=>Promise.resolve(o)})},singleClickActivation:!1,width:"100%"}))},O=e=>{const t=e.statusIndicator||$.getCheckRunStatusIndicatorData(e.check.status),n=(0,a.equals)(e.check.typeId,$.ManualValidationTaskTypeId,!0),[i,p]=s.useState();if(e.statusLabel&&e.statusLabel().then((e=>{p(e)})),n){const t=$.getApprovalStatusIndicatorData(e.check.status,!0);let n=t.label;return n===W.Waiting&&e.check.instructions&&(n=(0,a.format)(W.WaitingFormat,'"'+e.check.instructions+'"')),s.createElement("div",null,s.createElement(T.ListItem,{key:"manual-validation-item"+e.rowIndex,index:e.rowIndex,details:e.details,className:e.children?"check-list-item":void 0},s.createElement("div",{className:"checks-row flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(g.Status,Object.assign({},t.statusProps,{size:"16"})),s.createElement("div",{className:"checks-row-details flex-column flex-grow h-scroll-hidden"},s.createElement("div",{className:"flex-row flex-center h-scroll-hidden"},s.createElement("span",{className:"checks-row-title body-m text-ellipsis"},e.checkName),s.createElement("span",{className:"pipelines-resource body-s text-ellipsis secondary-text"},e.check.jobName)),s.createElement("span",{className:"body-s text-ellipsis secondary-text"},n))),e.children))}const u=e.check.resource?e.check.resource.name:"",d=e.check.resource?$.getResourceTypeIcons(e.check.resource.type):"Server",m=e.check.resource?$.getResourceTypeString(e.check.resource.type):"",h=(0,c.useComponentContext)();var v=function(e){const t=[];e.arePendingChecksPresent&&e.onRerunCheck&&function(e){const t=(0,c.useComponentContext)();if(!(0,w.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableRerunChecks",!1))return!1;if(2!==e.permissions)return!1;if(null===e||!(0,a.equals)(e.typeId,$.TaskCheckTypeIdString,!0))return!1;let s=e;return!o.includes(s.taskCheckConfigSettings.definitionRef.id)&&0==s.taskCheckConfigSettings.retryInterval&&4==s.status}(e.check)&&t.push({id:"rerun-check",onActivate:()=>e.onRerunCheck&&e.onRerunCheck(e.check),text:"Rerun check"});e.arePendingChecksPresent&&e.onBypassCheck&&function(e){const t=(0,c.useComponentContext)();let s=(0,w.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableBypassTaskChecks",!1),n=(0,w.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableBypassApprovals",!1),i=s||n;const o=(0,w.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableOrderingChecks",!1);if(!i||2!==e.permissions)return!1;if(o&&1===e.status)return!1;if(s&&(0,a.equals)($.TaskCheckTypeIdString,e.typeId,!0)){let t=e,a=!l.includes(t.taskCheckConfigSettings.definitionRef.id),s=!(t.taskCheckConfigSettings.definitionRef.id===$.BusinessHoursPolicyCheckTypeIdString)&&0===t.taskCheckConfigSettings.retryInterval&&4===e.status;return a&&!s&&128!==e.status}if(n&&(0,a.equals)($.ApprovalCheckTypeIdString,e.typeId,!0))return!(188&e.status);return!1}(e.check)&&t.push({id:"bypass-check",onActivate:()=>e.onBypassCheck&&e.onBypassCheck(e.check),text:W.BypassCheck});return t}(e);return s.createElement(T.ListItem,{key:"approval-item"+e.rowIndex,index:e.rowIndex,details:e.details,className:e.children?"check-list-item":void 0},s.createElement("div",{className:"checks-row flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(g.Status,Object.assign({},t.statusProps,{size:"16"})),s.createElement("div",{className:"checks-row-details flex-column flex-grow h-scroll-hidden"},s.createElement("div",{className:"flex-row flex-center h-scroll-hidden"},s.createElement("span",{className:"checks-row-title body-m text-ellipsis"},e.checkName),!!e.showCheckIssues&&!!e.check.issue&&s.createElement("div",{className:"checks-issue-icon"},s.createElement(r.Icon,{className:(0,S.css)(2===e.check.issue.type&&"warning",1===e.check.issue.type&&"error"),iconName:1===e.check.issue.type?"ErrorBadge":"Warning",tooltipProps:{text:e.check.issue.message}})),s.createElement(r.Icon,{className:"pipelines-resource-icon-1 secondary-text",iconName:d}),s.createElement("span",{className:"pipelines-resource body-s text-ellipsis secondary-text"},m===W.PersistedStage?W.RequiredByPipelineDefinition:m),s.createElement("span",{className:"pipelines-resource body-s text-ellipsis"},s.createElement(f.Link,{className:"pipelines-resource-link",href:(0,Q.getResourceUrl)(h.pageContext,e.check.resource,!0)},u))),i||t.label&&null==t.statusIndicatorMessage?s.createElement("span",{className:"body-s text-ellipsis secondary-text"},i||t.label):s.createElement("span",{className:"body-s text-ellipsis secondary-text flex-row"},t.label,s.createElement("span",{className:"padding-left-4 padding-right-4"},"•"),(k=t.statusIndicatorMessage,s.createElement("span",{className:"flex-row"},s.createElement("span",{className:(0,S.css)(t.statusIndicatorMessageStyle==$.StatusIndicatorMessageStyle.Warning&&"status-indicator-message-warning")},k),t.hoverMessage&&t.hoverMessage.length>0&&s.createElement(D.Tooltip,{overflowOnly:!1,text:t.hoverMessage},s.createElement("span",{onMouseEnter:e=>e.stopPropagation(),onMouseLeave:e=>e.stopPropagation(),className:"flex-row"},s.createElement(r.Icon,{iconName:"Info",className:"secondary-text flex-self-center padding-left-4",size:"small"}))))))),(null==v?void 0:v.length)>0&&s.createElement("div",{className:"check-actions"},s.createElement(y.MoreButton,{ariaLabel:W.MoreTooltip,className:"check-more-button",excludeTabStop:!0,hideDropdownIcon:!0,contextualMenuProps:{menuProps:{id:"header-submenu",items:v}},tooltipProps:{text:W.MoreTooltip}}))),e.children);var k},F=e=>s.createElement("div",null,s.createElement(T.List,{itemProvider:e.checks,renderRow:(t,a,n)=>s.createElement(s.Fragment,null,s.createElement(L,{check:a,details:n,stageId:e.stageId,rowIndex:t,onGrantResource:e.onGrantResource,result:e.checkResults[a.tenantId]})),singleClickActivation:!1,width:"100%"})),L=e=>{const t=$.getCheckRunStatusIndicatorData(e.check.status),n=2==e.check.status;return s.createElement(T.ListItem,{key:"pop-"+e.rowIndex,index:e.rowIndex,details:e.details},s.createElement("div",{className:"pipelines-proof-of-presence-group flex-row flex-grow flex-center h-scroll-hidden"},s.createElement(g.Status,Object.assign({},t.statusProps,{size:"16"})),s.createElement("div",{className:"pipelines-proof-of-presence-row flex-column flex-grow h-scroll-hidden"},s.createElement("div",{className:"flex-row flex-center h-scroll-hidden"},s.createElement("span",{className:"checks-row-title body-m text-ellipsis"},e.check.displayName)),s.createElement("div",{className:"body-s pipelines-proof-of-presence-description secondary-text"},n&&s.createElement("div",null,s.createElement("span",null,W.GrantSecondary),s.createElement(f.Link,{target:"_blank",href:W.ProofOfPresenceLink},W.LearnMore)),!n&&!e.check.resultMessage&&s.createElement("span",null,t.label),!n&&!!e.check.resultMessage&&s.createElement("span",null,e.check.resultMessage)),!!e.result&&!e.result.success&&s.createElement("span",{className:"pipelines-proof-of-presence-error body-s"},e.result.message||W.ProofOfPresenceApprovalFailed)),n&&s.createElement(N.ButtonGroup,{className:"flex-grow"},s.createElement(v.Button,{id:(0,a.format)("g-{0}-{1}",e.stageId,e.check.tenantId),primary:!0,text:W.Grant,onClick:()=>e.onGrantResource(e.check)}))))},B=e=>s.createElement("div",null,s.createElement(T.List,{itemProvider:e.checks,renderRow:(t,n,i)=>{const o=(n.truncatedRepositories||[]).map((e=>e.split(";")[1])),r=0===(l=o).length?"":1===l.length?l[0]:l.join(", ");var l;const c=n.numberOfCommitsLimit||0,p=(0,a.format)(W.CommitsExceededLimitRepoNames,c,r),u=ae(n),d=$.getProductionReadinessStatusIndicatorData(n.status,n.violations.length>0,n.isProjectInAuditMode,n.resultMessage,o.length>0?p:void 0);return s.createElement(O,{check:n,checkName:u,details:i,rowIndex:t,statusIndicator:d},(t=>{const a=t.violations.length>0,n=4===t.status&&a&&t.violations.every((e=>2===e.violationStatus||3===e.violationStatus)),i=2===t.status&&a&&t.violations.some((e=>1===e.violationStatus)),o=8===t.status&&a&&t.violations.every((e=>4===e.violationStatus));let r="",l=!1,c=()=>{};if(i)r=W.Review,l=!0,c=()=>e.onClickProductionReadinessButton(t,e.stageName,ee.ProductionReadinessPanelType.WaitingForApproval);else if(n)r=W.ViewApproval,c=()=>e.onClickProductionReadinessButton(t,e.stageName,ee.ProductionReadinessPanelType.Approved);else{if(!o)return null;r=W.ViewRejection,c=()=>e.onClickProductionReadinessButton(t,e.stageName,ee.ProductionReadinessPanelType.Rejected)}return s.createElement(N.ButtonGroup,{className:"flex-grow production-readiness-button-group padding-bottom-8"},s.createElement(v.Button,{primary:l,text:r,onClick:c}))})(n))},singleClickActivation:!1,width:"100%"})),U=e=>{const t=0===e.reviewMode&&e.stageName&&e.stageName!==i;return s.createElement("div",{className:"flex-row body-m"},s.createElement("div",{className:"flex-column flex-grow justify-end"},t&&s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row checks-group-header-title"},s.createElement(D.Tooltip,{overflowOnly:!0,text:e.stageName},s.createElement("span",{className:"title-s text-ellipsis stage-header"},e.stageName)),!!e.onViewStageChecksClicked&&0===e.myManualValidationsCount&&s.createElement(f.Link,{className:"body-s checks-view-link",onClick:e.onViewStageChecksClicked},W.ViewAll)),1===e.reviewMode&&s.createElement(D.Tooltip,{text:e.stageTimeoutStringToolTip},s.createElement("span",{className:"body-m text-ellipsis secondary-text stage-timeout-string"},e.stageTimeoutString)))))},j=e=>s.createElement("div",null,s.createElement(T.List,{itemProvider:e.checks,renderRow:(t,n,i)=>{const o=$.getCheckRunStatusIndicatorData(n.status);if(128===n.status){let e=$.getCheckRunUpdateModifiedByIdentity(n.status,n.resultUpdates);e&&(o.detailedLabel=(0,a.format)(W.BypassedBy,e.displayName))}return s.createElement(O,{check:n,details:i,rowIndex:t,arePendingChecksPresent:e.arePendingChecksPresent,showCheckIssues:e.showCheckIssues,checkName:n.taskCheckConfigSettings.displayName,statusLabel:()=>ne(n,o,e.arePendingChecksPresent),onRerunCheck:e.onRerunCheck,onBypassCheck:e.onBypassCheck})},singleClickActivation:!0,width:"100%",onActivate:(t,a)=>{t.defaultPrevented||e.onSelectCheck(a.data,e.arePendingChecksPresent)}}));function z(e){let t=e.filter((e=>0===e.permissions||function(e){if($.isCheckPermissionUpdate(e.permissions))return!0;let t=e.steps.filter((e=>1===e.status&&2===e.permissions)),a=e.steps.filter((e=>2===e.status&&2===e.permissions));return t.length>0&&0===a.length}(e)));return t.sort($.approvalSort),t}function G(e){return e.filter((e=>0===e.permissions))}function te(e){return(0,c.useComponentContext)().pageContext.getService("IChecksPanelService").isCurrentUserBlockedFromApproving(e)}function ae(e){if((0,a.equals)(e.typeId,$.ApprovalCheckTypeIdString,!0)){let t=e;return t&&t.definitionRef?(0,a.equals)(H.MainApprovalDefTypeId,t.definitionRef.id,!0)?W.Approval:(0,a.equals)(H.PreApprovalDefTypeId,t.definitionRef.id,!0)?W.PreApproval:(0,a.equals)(H.PostApprovalDefTypeId,t.definitionRef.id,!0)?W.PostApproval:W.Approval:W.Approval}if((0,a.equals)(e.typeId,$.ExtendsCheckTypeIdString,!0))return W.RequiredTemplate;if((0,a.equals)(e.typeId,$.ExclusiveLockCheckTypeIdString,!0))return W.ExclusiveLock;if((0,a.equals)(e.typeId,$.ManualValidationTaskTypeId,!0))return W.ManualValidation;if((0,a.equals)(e.typeId,$.TaskCheckTypeIdString,!0)){return null!==e?e.taskCheckConfigSettings.displayName:""}return(0,a.equals)(e.typeId,$.ProductionReadinessCheckTypeIdString,!0)?W.ProductionReadinessCheck:""}function se(e){let t=Number.MAX_SAFE_INTEGER,s={},n=0,i=0,o="",r="";if(!ie(e))return{};let l=[];return e.approvals&&(l=l.concat(e.approvals)),e.manualValidations&&(l=l.concat(e.manualValidations)),e.checks&&(l=l.concat(e.checks)),e.proofOfPresenceChecks&&(l=l.concat(e.proofOfPresenceChecks)),e.productionReadinessChecks&&(l=l.concat(e.productionReadinessChecks)),l.length>0&&l.map((e=>{2===e.status&&(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e))})),e.taskChecks&&e.taskChecks.map((e=>{(0,a.equals)($.EvaluateArtifactPolicyCheckTypeIdString,e.taskCheckConfigSettings.definitionRef.id,!0)?2===e.status&&(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e)):(2===e.status||64===e.status||4===e.status&&e.taskCheckConfigSettings.retryInterval>0)&&(i++,n=$.getRemainingMinutesForCheckTimeout(e.timeout,e.createdDate),n<t&&(t=n,s=e))})),t===Number.MAX_SAFE_INTEGER?{}:(o=$.getCheckTimeoutOrReevaluationString(W.Timeout,t),r=1===i?(0,a.format)(W.StageTimeoutMessageToolTipWithSingleCheck,ae(s)):(0,a.format)(W.StageTimeoutMessageToolTipWithMultipleChecks,ae(s),i-1),{stageTimeoutMessage:o,stageTimeoutMessageToolTip:r})}async function ne(e,t,s){var n,i;const o=(0,c.useComponentContext)(),r=(0,w.isFeatureFlagEnabled)(o.pageContext,"Pipelines.Checks.DisableUpdatedChecksLogs",!1),l=(0,w.isFeatureFlagEnabled)(o.pageContext,"Pipelines.Checks.EnableUpdatedChecksLogsAsync",!1),p=o.pageContext.getService("ITfsPageService"),u=o.pageContext.getService("ITaskCheckLogLineService"),d=p.getData(),m=(null===(n=null==d?void 0:d.project)||void 0===n?void 0:n.id)||"";let g=null!==(i=t.detailedLabel)&&void 0!==i?i:t.label;if((0,a.equals)(e.typeId,$.TaskCheckTypeIdString,!0)){let n=e;if(null!==n){let i=n.taskCheckData.attemptToTaskCheckTimelineRecordDataMap,c=i?Object.keys(i):[];if(c.length>0){let p=c.sort()[c.length-1];if(!(0,a.equals)(n.taskCheckConfigSettings.definitionRef.id,$.EvaluateArtifactPolicyCheckTypeIdString,!0)&&n.taskCheckConfigSettings&&n.taskCheckConfigSettings.retryInterval>0&&(4===e.status||2===e.status)){const e=i[parseInt(p)].finishTime;if(s&&e){const t=new Date,s=e.getTime()+6e4*n.taskCheckConfigSettings.retryInterval-t.getTime();if(s>=0)return(0,a.format)(W.CheckReevaluateStatusString,g,$.getCheckTimeoutOrReevaluationString(W.RetryString,s))}}if(!r){const s=i[parseInt(p)];if(l&&((!s.currentLogLine||""===s.currentLogLine)&&2===e.status||8===e.status||32===e.status)){const e=await u.getLastCheckLogLine(o.pageContext,s.planId,s.logId,m,s.lineCount);s.currentLogLine=e,i[parseInt(p)]=s}let n=s.currentLogLine;if(n&&""!==n)switch(n='"'+n+'"',t.label){case W.Failed:g=(0,a.format)(W.FailedFormat,n);break;case W.Canceled:g=(0,a.format)(W.CanceledFormat,n);break;case W.Passed:g=(0,a.format)(W.PassedFormat,n);break;case W.Queued:g=(0,a.format)(W.QueuedFormat,n);break;case W.InProgress:g=(0,a.format)(W.InProgressFormat,n);break;case W.TimedOut:g=(0,a.format)(W.TimedOutFormatLog,n);break;case W.Bypassed:g=(0,a.format)(W.GenericCheckLogFormat,g,n)}}}else t.label===W.Failed&&n.resultMessage&&(g=(0,a.format)(W.FailedFormat,n.resultMessage))}}return g}function ie(e){return e.approvals&&e.approvals.some((e=>2===e.status))||e.approvals&&e.approvals.some((e=>256===e.status))||e.manualValidations&&e.manualValidations.some((e=>2===e.status))||e.checks&&e.checks.some((e=>2===e.status))||e.taskChecks&&e.taskChecks.some((e=>2===e.status))||e.proofOfPresenceChecks&&e.proofOfPresenceChecks.some((e=>2===e.status))||e.productionReadinessChecks&&e.productionReadinessChecks.some((e=>2===e.status))}function oe(e,t,a){let s=!1;return 1!==e.length||0!==t.length||a||(e[0].approvals&&e[0].taskChecks?s=!1:e[0].approvals&&1===e[0].approvals.length?e[0].manualValidations&&0===e[0].manualValidations.length&&(s=!0):(e[0].taskChecks&&1===e[0].taskChecks.length||e[0].manualValidations&&1===e[0].manualValidations.length)&&(s=!0)),s}t[e].getCheckName=ae,t[e].getStageTimeoutDetails=se,t[e].getTaskCheckStatusString=ne,t[e].arePendingChecksPresent=ie,t[e].shouldBypassChecksPanel=oe,c.Components.add("ms.tfs-build.stage-checks-panel",(a=>{const n=(0,c.useComponentContext)().pageContext.getService("IChecksPanelService");return n.initialize(),n.fetchData(a.runId,a.stages.map((e=>e.id)),a.checkListItemType),s.createElement(t[e].StageChecksPanelView,Object.assign({},a))}))}("StageChecksPanel")}),["Resources","ChecksTelemetryService","ApprovalReassignDialog","Constants","ResourceLinks","Utilities","ApprovalPanel","LogsViewPanel","ManualValidationPanel","ChecksListPanel","ChecksPanelService","LogsViewPanelService","Generated/Constants","ProductionReadinessLearnMoreFooter","ProductionReadinessPanel","StageChecksPanel"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.approvals-panel"}}));