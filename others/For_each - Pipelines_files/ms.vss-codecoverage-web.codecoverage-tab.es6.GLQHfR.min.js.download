"use strict";define("CodeCoverage/CodeCoverageTab",["require","exports","VSS/Reflux/Action","CodeCoverage/Common/Constants","CodeCoverage/Common/Sources/CodeCoverageSource","Tfs/Platform/Page","VSS/Core/Util/String","VSS/Platform/Location","VSS/Platform/Feature","CodeCoverage/Common/Common","VSS/Core/Observable","VSSUI/Table","CodeCoverage/Common/RunViewArtifact","VSS/Platform/Context","react","VSS/Platform/Layout","OfficeFabric/DetailsList","VSSUI/Link","Test/TestSummary/Components/ResultSummaryDetailsChart","VSS/Reflux/Store","VSSUI/PickList","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/FilterBar","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","VSSUI/Utilities/TreeItemProvider","VSSUI/TreeEx","VSSUI/Spinner","Build/Run/Components/IssuesCard","VSSUI/Components/MessageCard/MessageCard","VSSUI/Components/ZeroData/index","VSSUI/Toggle","VSSUI/Util"],(function(e,t,o,a,r,i,s,n,l,d,c,C,u,g,v,h,m,p,S,b,f,T,_,L,F,E,w,B,y,x,I,M,D,V){var N,A,P,U,k,R,H,O,K,W,j,G,z,J,q,$,Q,Z;N=t[Z="Resources"]={},t[Z].LineCoverageText="Line Coverage",t[Z].ModuleCoverageText="Modules",t[Z].TotalCoverageLinesText="Total Lines",t[Z].CoveredLinesText="Covered Lines",t[Z].CoverageVisualText="Coverage Chart",t[Z].CoverageModuleFilterPlaceholder="Filter by module name",t[Z].BuildConfigurationText="Build configuration",t[Z].BuildPlatformText="Build platform",t[Z].EmptyLiteralText="empty",t[Z].DownloadCodeCoverageResults="Download code coverage results",t[Z].BuildDetailsSummaryNoCodeCoverageNoLink="No code coverage data available.",t[Z].UpgradeToModernBrowser="Please upgrade to a newer version of your browser to view Code Coverage data.",t[Z].NoBuildArtifactsFound='Code coverage report cannot be rendered as report HTML was not found. Please verify that "Report Directory" containing an HTML report was specified when [publishing code coverage](https://go.microsoft.com/fwlink/?linkid=2081549).',t[Z].BuildCodeCoverageNoResults="( Coverage results unavailable to download )",t[Z].CodeCoverage="Code Coverage",t[Z].BuildFailed="Pipeline failed to complete. Please review the errors and warnings provided in Summary tab.",t[Z].BuildQueued="Build pipeline is queued. Results will be generated once build is complete.",t[Z].BuildInProgress="Build pipeline is in-progress. Results will be generated once build is complete.",t[Z].CodeCoverageNotConfigured="Code coverage is not configured for this build.",t[Z].ErrorWhileCalculatingCodeCoverage="Failed to generate results. Please try again later.",t[Z].CodeCoverageInProgress="Code coverage calculation is in progress.",t[Z].NoCodeCoverageFound="The code coverage data is not found. Please review the Errors and warnings.",t[Z].CoverageMergeJobFailed="There is an internal server error. The code coverage job has failed.",t[Z].NumberOfFilesExceeded="The number of files in the Pull Request have exceeded the threshold of 100.",t[Z].NoInputFiles="No coverage input files are provided. Please review the Errors and warnings.",t[Z].BuildCancelled="Build got cancelled by the user. Please requeue or run a new build.",t[Z].ModuleMergeJobTimeout="Internal server error.",t[Z].InvalidCoverageInput="Invalid Coverage input file provided. Please review the Errors and warnings.",t[Z].FailedToRequeue="Failed to requeue the build.",t[Z].MonitorJobTimeout="Internal Server Error. The Coverage Job has timed out.",t[Z].ModuleMergeInvokerJobTimeout="Internal Server Error.The Code Coverage Job has timed out.",t[Z].CodeCoverageInformativeMessage="Code coverage helps you increase the confidence in your code changes and guards you effectively from the bugs.",t[Z].LearnMoreText="Learn More",t[Z].Folderview="Folder view",t[Z].FolderviewTooltip="Use this to toggle between Folder view and Module view",t[Z].BuildConfigSelectedFromDropdownMenu="Build configuration selected from dropdown menu is {0}",t[Z].CodeCoverageTable="Code Coverage Table",t[Z].CoveredBranches="Covered Branches",t[Z].TotalBranches="Total Branches",t[Z].BranchCoverage="Branch Coverage",function(e){A=t[e]={};class a{constructor(){this.updateModuleFilterText=new o.Action,this.updateBuildConfigSelection=new o.Action,this.updateBuildCodeCoverage=new o.Action,this.updateCodeCoverageSummary=new o.Action,this.updateNoCodeCoverageMessage=new o.Action,this.updateCodeCoverageFailureMessage=new o.Action,this.updateEnableFolderViewState=new o.Action,this.updateFolderViewBuildCodeCoverage=new o.Action,this.updateFolderViewBuildConfigSelection=new o.Action}static getInstance(){return a._instance||(a._instance=new a),a._instance}}t[e].CodeCoverageTabActionHub=a}("ActionsCodeCoverageTabActionHub"),function(e){P=t[e]={};class o{}t[e].CodeCoverageMessagesMap=o,o.codeCoverageFailureMap=new Map([["5",N.NoCodeCoverageFound],["6",N.NumberOfFilesExceeded],["7",N.NoInputFiles],["8",N.BuildCancelled],["10",N.ModuleMergeJobTimeout],["14",N.FailedToRequeue],["16",N.CodeCoverageNotConfigured],["18",N.CoverageMergeJobFailed],["20",N.ModuleMergeInvokerJobTimeout],["21",N.MonitorJobTimeout],["22",N.InvalidCoverageInput]])}("StoresCodeCoverageMessagesMap"),function(e){U=t[e]={};class o{constructor(e){this.pageContext=e,this._actions=A.CodeCoverageTabActionHub.getInstance(),this._source=r.CodeCoverageSource.getInstance(e),this._perfService=this.pageContext.pageContext.getService("IVssPerformanceService"),this.externalService=this.pageContext.pageContext.getService("IRunExternalService"),this._telemetryService=this.pageContext.pageContext.getService("IVssTelemetryService")}static getInstance(e){return o._instance||(o._instance=new o(e)),o._instance}updateModuleFilter(e){this._actions.updateModuleFilterText.invoke(e)}updateBuildConfigSelection(e){this._actions.updateBuildConfigSelection.invoke(e)}updateEnableFolderViewState(e){this._actions.updateEnableFolderViewState.invoke(e)}fetchBuildCodeCoverage(e){this._perfService.startScenario(a.PerfScenarios.APICall,!1,void 0,{Call:"getBuildCodeCoverage"}),this._source.getBuildCodeCoverage(e).then((t=>{t&&t.length?this._actions.updateBuildCodeCoverage.invoke(this._getCodeCoverageDetails(t)):this.fetchCodeCoverageHTMLSummary(e),this._perfService.endScenario(a.PerfScenarios.Area,a.PerfScenarios.APICall,!1,void 0,{Call:"getBuildCodeCoverage"})}))}fetchEnhancedBuildCodeCoverage(e){this._source.getBuildArtifacts(e).then((t=>{let o=null;null!=t&&(o=t.filter((t=>s.equals(t.name,s.format("Code Coverage Report_{0}",e.buildId))))),null!=o&&o.length>0?this.fetchCodeCoverageHTMLSummary(e):this.fetchBuildCodeCoverage(e)}))}fetchFolderViewBuildCodeCoverage(e){this._source.getFolderViewBuildCodeCoverage(e).then((e=>{e&&e.length&&this._actions.updateFolderViewBuildCodeCoverage.invoke(this._getFolderViewCodeCoverageDetails(e))}))}fetchGetCodecoverageSummary(e){this._perfService.startScenario(a.PerfScenarios.APICall,!1,void 0,{Call:"getCodeCoverageSummary"}),this.externalService.getCodeCoverageSummary(e.buildId,-10).then((e=>{e&&(this.coverageDetailedStatus=e.coverageDetailedSummaryStatus),this._perfService.endScenario(a.PerfScenarios.Area,a.PerfScenarios.APICall,!1,void 0,{Call:"getCodeCoverageSummary"}),this.fetchCoverageFailureMessages()}))}fetchCoverageFailureMessages(){if(""!=this.coverageDetailedStatus)try{let e=P.CodeCoverageMessagesMap.codeCoverageFailureMap.get(this.coverageDetailedStatus);e?this._actions.updateCodeCoverageFailureMessage.invoke(e):this._actions.updateNoCodeCoverageMessage.invoke(N.CodeCoverageInProgress)}catch(e){throw this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageFailureMessage,{error:e}),new Error(e)}}fetchCodeCoverageHTMLSummary(e){this._perfService.startScenario(a.PerfScenarios.APICall,!1,void 0,{Call:"getBuildArtifacts"}),this._source.getBuildArtifacts(e).then((t=>{if(t&&t.length>0){const o=this._getHTMLSummaryLinkFromArtifact(t,e.buildId);o?this._actions.updateCodeCoverageSummary.invoke(o):this._actions.updateNoCodeCoverageMessage.invoke(N.NoBuildArtifactsFound)}else(0,l.isFeatureFlagEnabled)(this.pageContext.pageContext,"WebAccess.TestManagement.CodeCoverage.EnableTabByDefault",!1)?this.fetchGetCodecoverageSummary(e):this._actions.updateNoCodeCoverageMessage.invoke(N.BuildDetailsSummaryNoCodeCoverageNoLink);this._perfService.endScenario(a.PerfScenarios.Area,a.PerfScenarios.APICall,!1,void 0,{Call:"getBuildArtifacts"})}))}_getHTMLSummaryLinkFromArtifact(e,t){let o=e.filter((e=>s.equals(e.name,s.format("Code Coverage Report_{0}",t))));if(o.length>=1&&o[0].resource&&o[0].resource._links&&o[0].resource._links.web&&o[0].resource._links.web.href&&o[0].resource._links.web.href.length&&o[0].resource.data&&o[0].resource.data.length){const e=(0,i.getTFSPageData)(this.pageContext.pageContext);if(e){let t=this._getCollectionUrl(),a=e.project.id,r=o[0].resource.data;"#"===r.charAt(0)&&(r=r.substring(1)),"/"!==r.charAt(0)&&(r="/"+r);let i=t.lastIndexOf("/")===t.length-1?t:t+"/";return i=i+a+"/_apis/test/CodeCoverage/browse"+r+"/index.html",i}console.log(N.NoBuildArtifactsFound)}else console.log(N.NoBuildArtifactsFound);return null}_getFolderViewCodeCoverageDetails(e){return{folderViewCoverages:e.map((e=>{const t=0|e.folderCoverageData.coverageStatistics.linesCovered,o=t+(0|e.folderCoverageData.coverageStatistics.linesNotCovered)+(0|e.folderCoverageData.coverageStatistics.linesPartiallyCovered),a=0|e.folderCoverageData.coverageStatistics.branchesCovered,r=a+e.folderCoverageData.coverageStatistics.branchesNotCovered|0,i={moduleCount:0,totalLines:o,totalCoveredLines:t,coveragePercent:s.localeFormat("{0}%",(o?t/o*100:0).toFixed(2)),totalBranches:r,totalCoveredBranches:a,branchCoveragePercent:s.localeFormat("{0}%",(r?a/r*100:0).toFixed(2))};return{folderCoverageData:e.folderCoverageData,summaryViewProps:i}})),buildConfigurations:e.map((e=>e.configuration))}}_getCodeCoverageDetails(e){return{buildCoverages:e.map((e=>{const t=[];let o=0,a=0,r=0,i=0;return e.modules.forEach((e=>{const n=0|e.statistics.linesCovered,c=n+(0|e.statistics.linesNotCovered)+(0|e.statistics.linesPartiallyCovered);if(o+=c,a+=n,(0,l.isFeatureFlagEnabled)(this.pageContext.pageContext,d.FeatureFlagConstants.EnableBranchCoverageUI,!1)){const o=0|e.statistics.branchesCovered,a=o+(0|e.statistics.branchesNotCovered),l=s.localeFormat("{0}%",(a?o/a*100:0).toFixed(2));r+=a,i+=o,t.push({moduleName:e.name,moduleUrl:e.fileUrl,coveredLines:n,totalLines:c,lineCoverage:s.localeFormat("{0}%",(c?n/c*100:0).toFixed(2)),totalBranches:a,coveredBranches:o,branchCoverage:l})}else t.push({moduleName:e.name,moduleUrl:e.fileUrl,coveredLines:n,totalLines:c,lineCoverage:s.localeFormat("{0}%",(c?n/c*100:0).toFixed(2))})})),(0,l.isFeatureFlagEnabled)(this.pageContext.pageContext,d.FeatureFlagConstants.EnableBranchCoverageUI,!1)?{codeCoverageModuleList:t,summaryViewProps:{moduleCount:e.modules.length,totalLines:o,totalCoveredLines:a,coveragePercent:s.localeFormat("{0}%",(o?a/o*100:0).toFixed(2)),totalBranches:r,totalCoveredBranches:i,branchCoveragePercent:s.localeFormat("{0}%",(r?i/r*100:0).toFixed(2))},coverageDownloadLink:e.codeCoverageFileUrl||""}:{codeCoverageModuleList:t,summaryViewProps:{moduleCount:e.modules.length,totalLines:o,totalCoveredLines:a,coveragePercent:s.localeFormat("{0}%",(o?a/o*100:0).toFixed(2))},coverageDownloadLink:e.codeCoverageFileUrl||""}})),buildConfigurations:this._getBuildConfigurations(e)}}_getBuildConfigurations(e){return e.map((e=>e.configuration))}_getCollectionUrl(){return(0,n.routeUrl)(this.pageContext.pageContext,"ms.vss-tfs-web.project-overview-route")}}t[e].CodeCoverageTabActionCreator=o}("ActionsCodeCoverageTabActionCreator"),function(e){k=t[e]={},t[e].COVERAGE_VISUAL_WIDTH=280,t[e].NUMBER_COLUMN_WIDTH_PERCENTAGE=20,t[e].MODULE_COLUMN_WIDTH_PERCENTAGE=80,t[e].VISUAL_COLUMN_WIDTH_PERCENTAGE=50;var o;t[e].numberComparer=(e,t)=>e-t,function(e){e[e.Modules=0]="Modules",e[e.CoveredLines=1]="CoveredLines",e[e.TotalLines=2]="TotalLines",e[e.LineCoverage=3]="LineCoverage",e[e.CoveredBranches=4]="CoveredBranches",e[e.TotalBranches=5]="TotalBranches",e[e.BranchCoverage=6]="BranchCoverage",e[e.CoverageVisual=7]="CoverageVisual"}(o=t[e].ColumnKeys||(t[e].ColumnKeys={})),t[e].ColumnIdToKeyMap={module:"Modules",coveredLines:"CoveredLines",totalLines:"TotalLines",lineCoverage:"LineCoverage",coveredBranches:"CoveredBranches",totalBranches:"TotalBranches",branchCoverage:"BranchCoverage",coverageVisual:"CoverageVisual"};t[e].generateItemList=e=>e.filter((e=>e instanceof Object));t[e].getFilteredList=(e,t)=>""===t.trim()?e:e.filter((e=>e.moduleName.toLocaleLowerCase().indexOf(t.toLocaleLowerCase().trim())>=0));t[e].getComparer=a=>{switch(a){case o[o.Modules]:return(e,t)=>(0,s.localeIgnoreCaseComparer)(e.moduleName,t.moduleName);case o[o.CoveredLines]:return(o,a)=>(0,t[e].numberComparer)(o.coveredLines,a.coveredLines);case o[o.TotalLines]:return(o,a)=>(0,t[e].numberComparer)(o.totalLines,a.totalLines);case o[o.LineCoverage]:case o[o.CoveredBranches]:return(o,a)=>(0,t[e].numberComparer)(o.coveredBranches,a.coveredBranches);case o[o.TotalBranches]:return(o,a)=>(0,t[e].numberComparer)(o.totalBranches,a.totalBranches);case o[o.BranchCoverage]:return(o,a)=>(0,t[e].numberComparer)(parseFloat(o.branchCoverage),parseFloat(a.branchCoverage));case o[o.CoverageVisual]:default:return(o,a)=>(0,t[e].numberComparer)(parseFloat(o.lineCoverage),parseFloat(a.lineCoverage))}};t[e].sortItems=(e,t,o)=>{const a=o?(e,o)=>t(o,e):t;return e.slice().sort(a)};t[e].createColumnForTable=(e,t,o,a,r)=>({id:e,name:t,width:new c.ObservableValue(-o),renderCell:C.renderSimpleCell,className:"code-coverage-details-list-cell",sortProps:{sortOrder:a},onSize:(e,t,o,a)=>{a.width.value=o},readonly:!0,minWidth:null!=r?r:100})}("ComponentsCodeCoverageTablemodel"),function(e){t[e]={};class o extends g.VssService{getCodeCoverageData(e,t){const o=new u.RunViewArtifact(e,t,2),a=r.CodeCoverageSource.getInstance({pageContext:this.pageContext});return d.GetCodeCoverageTimelineSummaryData(o,a)}}t[e].CodeCoverageDataService=o,g.Services.add("CC.CodeCoverageDataService",{serviceFactory:o})}("ServicesCodeCoverageDataService"),function(e){R=t[e]={};class o extends h.VssComponent{render(){const e=this.props.coveredPercentage/100*this.props.width;return v.createElement("div",{className:"bar-chart-container"},v.createElement("div",{className:"covered-bar",style:{width:e+"px"}}),v.createElement("div",{className:"not-covered-bar",style:{width:this.props.width-e+"px"}}))}}t[e].CoveredBarChart=o}("ComponentsCoveredBarChart"),function(e){H=t[e]={};const o=(e,t)=>e-t;var r;!function(e){e[e.Modules=0]="Modules",e[e.CoveredLines=1]="CoveredLines",e[e.TotalLines=2]="TotalLines",e[e.LineCoverage=3]="LineCoverage",e[e.CoveredBranches=4]="CoveredBranches",e[e.TotalBranches=5]="TotalBranches",e[e.BranchCoverage=6]="BranchCoverage",e[e.CoverageVisual=7]="CoverageVisual"}(r||(r={}));class i extends h.VssComponent{constructor(e,t){super(e,t),this._renderColumn=(e,t,o)=>{switch(o.key){case r[r.Modules]:return e.moduleUrl?v.createElement(p.Link,{className:"coverage-module-link",href:e.moduleUrl},e.moduleName):v.createElement("span",null,e.moduleName);case r[r.CoveredLines]:return v.createElement("span",null,e.coveredLines);case r[r.TotalLines]:return v.createElement("span",null,e.totalLines);case r[r.LineCoverage]:return v.createElement("span",null,e.lineCoverage);case r[r.CoveredBranches]:return v.createElement("span",null,e.coveredBranches);case r[r.TotalBranches]:return v.createElement("span",null,e.totalBranches);case r[r.BranchCoverage]:return v.createElement("span",null,e.branchCoverage);case r[r.CoverageVisual]:return v.createElement(R.CoveredBarChart,{coveredPercentage:e.totalLines?100*e.coveredLines/e.totalLines:0,width:280})}return v.createElement("div",null)},this._onColumnClick=(e,t)=>{const o=this._getComparer(t.key);if(!o)return;const r=this.state.sortedColumnKey===t.key&&!t.isSortedDescending;this.setState({sortedColumnKey:t.key,isSortedDescending:r,listItems:this._sortItems(this.state.listItems,o,r)}),this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.DetailsListSortClicked,{Column:t.key,Order:r?"Descending":"Ascending"})};const o=this._sortItems(this._generateItemList(),this._getComparer(r[r.Modules]),!1);this.state={sortedColumnKey:r[r.LineCoverage],isSortedDescending:!1,listItems:o},this._telemetryService=this.context.pageContext.getService("IVssTelemetryService"),this._codecoveragemoduleDetails=this.state.listItems}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),this.props.codeCoverageModuleList!==e.codeCoverageModuleList){const e=this._sortItems(this._generateItemList(),this._getComparer(r[r.Modules]),!1);this.setState({sortedColumnKey:r[r.Modules],isSortedDescending:!1,listItems:e})}}_generateItemList(){return this.props.codeCoverageModuleList.filter((e=>e instanceof Object))}_getFilteredList(){const e=this.state.listItems,t=this.props.moduleFilterText;return""===t.trim()?e:e.filter((e=>e.moduleName.toLocaleLowerCase().indexOf(t.toLocaleLowerCase().trim())>=0))}_getColumnList(){var e;e=this._codecoveragemoduleDetails.reduce(((e,t)=>e+t.totalBranches),0);const t=[this._createColumn(r[r.Modules],N.ModuleCoverageText),this._createColumn(r[r.CoveredLines],N.CoveredLinesText),this._createColumn(r[r.TotalLines],N.TotalCoverageLinesText),this._createColumn(r[r.LineCoverage],N.LineCoverageText)];return(0,l.isFeatureFlagEnabled)(this.context.pageContext,d.FeatureFlagConstants.EnableBranchCoverageUI,!1)&&e>0?[...t,this._createColumn(r[r.CoveredBranches],N.CoveredBranches),this._createColumn(r[r.TotalBranches],N.TotalBranches),this._createColumn(r[r.BranchCoverage],N.BranchCoverage),this._createColumn(r[r.CoverageVisual],N.CoverageVisualText,this._renderColumn,280)]:[...t,this._createColumn(r[r.CoverageVisual],N.CoverageVisualText,this._renderColumn,280)]}_createColumn(e,t,o=this._renderColumn,a){return{fieldName:e,key:e,name:t,onRender:o,onColumnClick:this._onColumnClick,minWidth:a||100,isResizable:!0,isSorted:this.state.sortedColumnKey===e,isSortedDescending:this.state.isSortedDescending,isPadded:!0,columnActionsMode:m.ColumnActionsMode.clickable,isRowHeader:!1,className:"code-coverage-details-list-cell"}}_sortItems(e,t,o){const a=o?(e,o)=>t(o,e):t;return e.slice().sort(a)}_getComparer(e){switch(e){case r[r.Modules]:return(e,t)=>(0,s.localeIgnoreCaseComparer)(e.moduleName,t.moduleName);case r[r.CoveredLines]:return(e,t)=>o(e.coveredLines,t.coveredLines);case r[r.TotalLines]:return(e,t)=>o(e.totalLines,t.totalLines);case r[r.LineCoverage]:case r[r.CoveredBranches]:return(e,t)=>o(e.coveredBranches,t.coveredBranches);case r[r.TotalBranches]:return(e,t)=>o(e.totalBranches,t.totalBranches);case r[r.BranchCoverage]:return(e,t)=>o(parseFloat(e.branchCoverage),parseFloat(t.branchCoverage));case r[r.CoverageVisual]:default:return(e,t)=>o(parseFloat(e.lineCoverage),parseFloat(t.lineCoverage))}}render(){const e={items:this._getFilteredList(),columns:this._getColumnList(),selectionMode:m.SelectionMode.none,className:"code-coverage-details-list"};return v.createElement("div",{className:"coverage-details-list-container"},v.createElement(m.DetailsList,Object.assign({},e)))}}t[e].CodeCoverageDetailsList=i}("ComponentsCodeCoverageDetailsList"),function(e){O=t[e]={};const o={dataType:S.DataType.String,difference:{value:"",valueType:S.ValueType.Unchanged,shouldShowIcon:!1,diffType:S.DifferenceType.Unchanged}};class a extends h.VssComponent{constructor(e){super(e),this.state={moduleCount:this.props.moduleCount,totalLines:this.props.totalLines,totalCoveredLines:this.props.totalCoveredLines,coveragePercent:this.props.coveragePercent,totalBranches:this.props.totalBranches,totalCoveredBranches:this.props.totalCoveredBranches,branchCoveragePercent:this.props.branchCoveragePercent}}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.props!==e&&this.setState({moduleCount:this.props.moduleCount,totalLines:this.props.totalLines,totalCoveredLines:this.props.totalCoveredLines,coveragePercent:this.props.coveragePercent,totalBranches:this.props.totalBranches,totalCoveredBranches:this.props.totalCoveredBranches,branchCoveragePercent:this.props.branchCoveragePercent})}render(){if(0==this.props.moduleCount)return v.createElement("div",{className:"code-coverage-summary-container"},v.createElement(S.ResultSummaryNumberChartComponent,Object.assign({title:N.LineCoverageText,value:this.props.coveragePercent},o)),v.createElement(S.ResultSummaryNumberChartComponent,Object.assign({title:N.TotalCoverageLinesText,value:this.props.totalLines},o)),v.createElement(S.ResultSummaryNumberChartComponent,Object.assign({title:N.CoveredLinesText,value:this.props.totalCoveredLines},o)));const e=[{title:N.LineCoverageText,value:this.props.coveragePercent},{title:N.ModuleCoverageText,value:this.props.moduleCount},{title:N.TotalCoverageLinesText,value:this.props.totalLines},{title:N.CoveredLinesText,value:this.props.totalCoveredLines}],t=[...e,{title:N.BranchCoverage,value:this.props.branchCoveragePercent},{title:N.CoveredBranches,value:this.props.totalCoveredBranches},{title:N.TotalBranches,value:this.props.totalBranches}];return(0,l.isFeatureFlagEnabled)(this.context.pageContext,d.FeatureFlagConstants.EnableBranchCoverageUI,!1)&&this.props.totalBranches>0?v.createElement("div",{className:"code-coverage-summary-container"},t.map(((e,t)=>v.createElement(S.ResultSummaryNumberChartComponent,Object.assign({key:t,title:e.title,value:e.value},o))))):v.createElement("div",{className:"code-coverage-summary-container"},e.map(((e,t)=>v.createElement(S.ResultSummaryNumberChartComponent,Object.assign({key:t,title:e.title,value:e.value},o)))))}}t[e].CodeCoverageSummaryView=a}("ComponentsCodeCoverageSummaryView"),function(e){K=t[e]={};class o extends h.VssComponent{Linkyfy(e){const t=[];let o=e;const a=/\[(.*?)\]\((.*?)\)/;let r=o.match(a);for(;r;)t.push(o.slice(0,r.index)),t.push(v.createElement(p.Link,{key:t.length,href:r[2]},r[1])),o=o.slice(r.index+r[0].length),r=o.match(a);return o&&t.push(o),t}render(){return v.createElement("div",null,this.Linkyfy(this.props.text))}}t[e].MessageArea=o}("ComponentsMessageArea"),function(e){W=t[e]={};class o extends b.Store{constructor(e,t,o){super(e),this.changeEvent=e,this._actionsHub=t,this._defaultState=o,this._updateConfigSelectorState=e=>{this._state={buildConfigurationList:this._state.buildConfigurationList,selectedConfiguration:this._state.buildConfigurationList[e]},this.emitChanged()},this._initialize()}getState(){return this._state}_initialize(){this._state=this._defaultState,this._actionsHub.updateBuildConfigSelection.addListener(this._updateConfigSelectorState)}}t[e].BuildConfigSelectorStore=o}("StoresBuildConfigSelectorStore"),function(e){j=t[e]={};class o extends h.VssComponent{constructor(e,t){super(e),this._actionHub=A.CodeCoverageTabActionHub.getInstance(),this.ConfigSelectionChangeEvent="configSelectionChangeEvent",this._onBuildConfigDropdownSelect=(e,t)=>{this._actionCreator.updateBuildConfigSelection(Number(t.id))},this._mapBuildConfigItemToListBoxItem=e=>e.map((e=>({id:e.index.toString(),text:e.name}))),this._onStoreStateChanged=()=>{this.setState(this._buildSelectorStore.getState())};const o=this._generatePickListItems();this._actionCreator=U.CodeCoverageTabActionCreator.getInstance(t),this.state={buildConfigurationList:o,selectedConfiguration:o[0]},this._NWPMigrationForPickList=(0,l.isFeatureFlagEnabled)(t.pageContext,d.FeatureFlagConstants.NWPMigrationForPickList,!1),this._NWPMigrationForPickList&&(this._buildConfigDropdownSelection=new _.DropdownSelection,this._buildConfigDropdownSelection.select(0))}componentWillMount(){this._buildSelectorStore=new W.BuildConfigSelectorStore(this.ConfigSelectionChangeEvent,this._actionHub,this.state),this._buildSelectorStore.addChangedListener(this._onStoreStateChanged)}componentDidUpdate(e){if(this.props.configurations!==e.configurations){const e=this._generatePickListItems();this.state={buildConfigurationList:e,selectedConfiguration:e[0]}}}componentWillUnmount(){this._buildSelectorStore.removeChangedListener(this._onStoreStateChanged)}_generatePickListItems(){return this.props.configurations.length?this.props.configurations.map(((e,t)=>this._getIBuildConfigItem(t,e.flavor,e.platform))):[this._getIBuildConfigItem(0)]}_getIBuildConfigItem(e,t,o){return{index:e,name:`${`${N.BuildConfigurationText}:  ${t||N.EmptyLiteralText}`} | ${`${N.BuildPlatformText}:  ${o||N.EmptyLiteralText}`}`}}render(){return v.createElement("div",{className:"build-config-selector"},this._NWPMigrationForPickList?v.createElement(T.Dropdown,{ariaLabel:s.format(N.BuildConfigSelectedFromDropdownMenu,this.state.selectedConfiguration.name),className:"build-config-picklist",items:this._mapBuildConfigItemToListBoxItem(this.state.buildConfigurationList),selection:this._buildConfigDropdownSelection,onSelect:this._onBuildConfigDropdownSelect}):v.createElement(f.PickListDropdown,{className:"build-config-picklist",getListItem:e=>({key:e.index.toString(),name:e.name}),initiallySelectedItems:[this.state.selectedConfiguration],getPickListItems:()=>this.state.buildConfigurationList,onSelectionChanged:e=>{this._updateSelectionInBuildCodeCoverage(e)}}))}_updateSelectionInBuildCodeCoverage(e){this._actionCreator.updateBuildConfigSelection(e.selectedItems[0].index)}}t[e].BuildConfigSelector=o}("ComponentsBuildConfigSelector"),function(e){G=t[e]={};class o extends h.VssComponent{render(){return v.createElement("div",{className:"code-coverage-summary-part"},this.props.modernBrowserAvailable?v.createElement("div",{className:"code-coverage-frame-part"},v.createElement("iframe",{sandbox:"",src:this.props.codeCoverageSummaryLink,className:"code-coverage-summary-frame"})):"")}}t[e].CodeCoverageHtmlSummary=o}("ComponentsCodeCoverageHtmlSummary"),function(e){z=t[e]={};class o extends h.VssComponent{constructor(e,t){super(e),this._onFilterChanged=()=>{const e=this.state.filter.getState();this.actionCreator.updateModuleFilter(e.moduleFilter?e.moduleFilter.value:"")},this.actionCreator=U.CodeCoverageTabActionCreator.getInstance(t),this.state={filter:new E.Filter}}componentDidMount(){this.state.filter.subscribe(this._onFilterChanged,E.FILTER_CHANGE_EVENT)}componentWillUnmount(){this.state.filter.unsubscribe(this._onFilterChanged,E.FILTER_CHANGE_EVENT)}render(){return v.createElement("div",{className:"module-filterbar-container"},v.createElement(L.FilterBar,{filter:this.state.filter},v.createElement(F.KeywordFilterBarItem,{filterItemKey:"moduleFilter",placeholder:N.CoverageModuleFilterPlaceholder})))}}t[e].CodeCoverageModuleFilterBar=o}("ComponentsCodeCoverageModuleFilterBar"),function(e){J=t[e]={};class o extends b.Store{constructor(e,t){super(e),this.changeEvent=e,this._actionsHub=t,this._updateBuildCodeCoverage=e=>{this._state.buildCodeCoverageDetails=e,this._state.showCodeCoverageDetails=!0,this._state.showCodeCoverageHTMLSummary=!1,this.emitChanged()},this._updateFolderViewBuildCodeCoverage=e=>{this._state.folderViewBuildCodeCoverageDetails=e,this.emitChanged()},this._updateModuleFilterText=e=>{this._state.moduleFilterText=e,this.emitChanged()},this._updateCodeCoverageSummary=e=>{this._state.modernBrowserAvailable?(this._state.showCodeCoverageHTMLSummary=!0,this._state.showCodeCoverageDetails=!1,this._state.codeCoverageSummaryLink=e,this.emitChanged()):this._updateNoCodeCoverageMessage(N.UpgradeToModernBrowser)},this._updateConfigSelectorState=e=>{this._state.folderViewEnabled?this._state.selectedFolderViewBuildConfiguration=e:this._state.selectedBuildConfiguration=e,this.emitChanged()},this._updateFolderViewConfigSelectorState=e=>{this._state.selectedFolderViewBuildConfiguration=e,this.emitChanged()},this._updateNoCodeCoverageMessage=e=>{this._state.showCodeCoverageHTMLSummary=!1,this._state.showCodeCoverageDetails=!1,this._state.messageAreaText=e,this.emitChanged()},this._updateEnableFolderViewState=e=>{this._state.folderViewEnabled=e,this.emitChanged()},this._updateCodeCoverageFailureMessage=e=>{this._state.showCodeCoverageHTMLSummary=!1,this._state.showCodeCoverageDetails=!1,this._state.codeCoverageFailureMessage=e,this.emitChanged()},this._initialize()}getState(){return this._state}_initialize(){this._state=this._getDefaultState(),this._actionsHub.updateBuildConfigSelection.addListener(this._updateConfigSelectorState),this._actionsHub.updateBuildCodeCoverage.addListener(this._updateBuildCodeCoverage),this._actionsHub.updateCodeCoverageSummary.addListener(this._updateCodeCoverageSummary),this._actionsHub.updateModuleFilterText.addListener(this._updateModuleFilterText),this._actionsHub.updateNoCodeCoverageMessage.addListener(this._updateNoCodeCoverageMessage),this._actionsHub.updateCodeCoverageFailureMessage.addListener(this._updateCodeCoverageFailureMessage),this._actionsHub.updateEnableFolderViewState.addListener(this._updateEnableFolderViewState),this._actionsHub.updateFolderViewBuildCodeCoverage.addListener(this._updateFolderViewBuildCodeCoverage),this._actionsHub.updateFolderViewBuildConfigSelection.addListener(this._updateFolderViewConfigSelectorState)}_getDefaultState(){return{showCodeCoverageHTMLSummary:!1,codeCoverageSummaryLink:"",buildCodeCoverageDetails:null,moduleFilterText:"",showCodeCoverageDetails:!1,selectedBuildConfiguration:0,modernBrowserAvailable:this._isSandboxAvailable(),messageAreaText:"",codeCoverageFailureMessage:"",folderViewEnabled:!1,folderViewBuildCodeCoverageDetails:null,selectedFolderViewBuildConfiguration:0}}_isSandboxAvailable(){return"sandbox"in document.createElement("iframe")}}t[e].BuildCodeCoverageStore=o}("StoresBuildCodeCoverageStore"),function(e){q=t[e]={};class o extends h.VssComponent{constructor(e){super(e),this.onToggle=(e,t)=>{this.treeItemProvider.toggle(t.underlyingItem)};const t=[];t.push(this.processFolderCoverageData(e.folderCoverageData)),this.state={listItems:t},this.treeItemProvider=new w.TreeItemProvider(this.state.listItems),this.columns=[{id:"moduleName",width:-100,name:"Name",renderCell:B.renderExpandableTreeCell},{id:"coveredLines",width:300,name:"Covered Lines",renderCell:B.renderTreeCell},{id:"totalLines",width:300,name:"Total Lines",renderCell:B.renderTreeCell},{id:"lineCoverage",width:300,name:"Line Coverage",renderCell:B.renderTreeCell}]}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),this.props.folderCoverageData!==e.folderCoverageData){console.log("Previous state : ",e.folderCoverageData),console.log("Current state :",this.props.folderCoverageData),this.treeItemProvider.clear();const t=[];t.push(this.processFolderCoverageData(this.props.folderCoverageData)),this.setState({listItems:t}),t.forEach((e=>this.treeItemProvider.add(e)))}}render(){return v.createElement("div",{className:"diag-dialog-full-height-width v-scroll-auto"},v.createElement(B.Tree,{containerClassName:"diag-dialog-full-height-width",columns:this.columns,itemProvider:this.treeItemProvider,onToggle:this.onToggle,scrollable:!1}))}processFolderCoverageData(e){if(null==e||null==e)return{};var t=e.name,o=0|e.coverageStatistics.linesCovered,a=o+(0|e.coverageStatistics.linesNotCovered)+(0|e.coverageStatistics.linesPartiallyCovered),r=s.localeFormat("{0}%",(a?o/a*100:0).toFixed(2)),i=[];return e.folders&&e.folders.length&&e.folders.forEach((e=>{var t=this.processFolderCoverageData(e);0!=Object.keys(t).length&&i.push(t)})),e.files&&e.files.length&&e.files.forEach((e=>{var t=this.processFileCoverageData(e);0!=Object.keys(t).length&&i.push(t)})),{childItems:i,expanded:!1,data:{moduleName:t,coveredLines:o,totalLines:a,lineCoverage:r}}}processFileCoverageData(e){if(null==e||null==e)return{};var t=e.name,o=0|e.coverageStatistics.linesCovered,a=o+(0|e.coverageStatistics.linesNotCovered)+(0|e.coverageStatistics.linesPartiallyCovered);return{childItems:[],expanded:!1,data:{moduleName:t,coveredLines:o,totalLines:a,lineCoverage:s.localeFormat("{0}%",(a?o/a*100:0).toFixed(2))}}}}t[e].CodeCoverageFolderViewTree=o}("ComponentsCodeCoverageFolderViewTree"),function(e){$=t[e]={};class o extends h.VssComponent{constructor(e,t){super(e,t),this._onColumnClick=(e,t)=>{const o=k.ColumnIdToKeyMap[t.id],r=(0,k.getComparer)(o);if(!r)return;const i=this.state.sortedColumnKey===o&&!this.state.isSortedDescending;this.setState({sortedColumnKey:o,isSortedDescending:i,listItems:(0,k.sortItems)(this.state.listItems,r,i)}),this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.DetailsListSortClicked,{Column:o,IsDescending:i})};const o=(0,k.sortItems)((0,k.generateItemList)(this.props.codeCoverageModuleList),(0,k.getComparer)(k.ColumnKeys[k.ColumnKeys.Modules]),!1);this.state={sortedColumnKey:k.ColumnKeys[k.ColumnKeys.LineCoverage],isSortedDescending:!1,listItems:o},this._telemetryService=this.context.pageContext.getService("IVssTelemetryService"),this._codecoveragemoduleDetails=this.state.listItems}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),this.props.codeCoverageModuleList!==e.codeCoverageModuleList){const e=(0,k.sortItems)((0,k.generateItemList)(this.props.codeCoverageModuleList),(0,k.getComparer)(k.ColumnKeys[k.ColumnKeys.Modules]),!1);this.setState({sortedColumnKey:k.ColumnKeys[k.ColumnKeys.Modules],isSortedDescending:!1,listItems:e})}}_getFilteredListForTable(){return(0,k.getFilteredList)(this.state.listItems,this.props.moduleFilterText).map((e=>({module:{text:e.moduleName,href:e.moduleUrl},coveredLines:e.coveredLines,totalLines:e.totalLines,lineCoverage:e.lineCoverage,coveredBranches:e.coveredBranches,totalBranches:e.totalBranches,branchCoverage:e.branchCoverage,coverageVisual:{textNode:v.createElement(R.CoveredBarChart,{coveredPercentage:e.totalLines?100*e.coveredLines/e.totalLines:0,width:k.COVERAGE_VISUAL_WIDTH})}})))}_getColumnListForTable(){var e=this._codecoveragemoduleDetails.reduce(((e,t)=>e+t.totalBranches),0);const t=[(0,k.createColumnForTable)("module",N.ModuleCoverageText,k.MODULE_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.module?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("coveredLines",N.CoveredLinesText,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.coveredLines?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("totalLines",N.TotalCoverageLinesText,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.totalLines?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("lineCoverage",N.LineCoverageText,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.lineCoverage?void 0:this.state.isSortedDescending?1:0)];return(0,l.isFeatureFlagEnabled)(this.context.pageContext,d.FeatureFlagConstants.EnableBranchCoverageUI,!1)&&e>0?[...t,(0,k.createColumnForTable)("coveredBranches",N.CoveredBranches,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.coveredBranches?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("totalBranches",N.TotalBranches,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.totalBranches?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("BranchCoverage",N.BranchCoverage,k.NUMBER_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.BranchCoverage?void 0:this.state.isSortedDescending?1:0),(0,k.createColumnForTable)("coverageVisual",N.CoverageVisualText,k.VISUAL_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.coverageVisual?void 0:this.state.isSortedDescending?1:0,k.COVERAGE_VISUAL_WIDTH)]:[...t,(0,k.createColumnForTable)("coverageVisual",N.CoverageVisualText,k.VISUAL_COLUMN_WIDTH_PERCENTAGE,this.state.sortedColumnKey!==k.ColumnIdToKeyMap.coverageVisual?void 0:this.state.isSortedDescending?1:0,k.COVERAGE_VISUAL_WIDTH)]}render(){const e=new c.ObservableArray(this._getFilteredListForTable()),t=new C.ColumnSorting(((e,t,o)=>{this._onColumnClick(o,this._getColumnListForTable()[e])})),o={ariaLabel:N.CodeCoverageTable,behaviors:[t],className:"code-coverage-details-list",columns:this._getColumnListForTable(),containerClassName:"h-scroll-auto",itemProvider:e,role:"table",scrollable:!0,showScroll:!0};return v.createElement("div",{className:"coverage-details-list-container"},v.createElement(C.Table,Object.assign({},o)))}}t[e].CodeCoverageTable=o}("ComponentsCodeCoverageTable"),function(e){Q=t[e]={};class o extends h.VssComponent{constructor(e,t){super(e,t),this.BuildCodeCoverageChangeEvent="buildCodeCoverageChangeEvent",this.NewUIForDotCoverageFeatureFlag="TestManagement.Server.ModuleDetailsUIForDotCoverage",this.folderViewCodeCoverageFF=(0,l.isFeatureFlagEnabled)(this.context.pageContext,"TestManagement.Server.FolderViewUICodeCoverage",!1),this.enhancedCodeCoverageHtmlView=(0,l.isFeatureFlagEnabled)(this.context.pageContext,"TestManagement.Server.EnhancedCodeCoverageHtmlView",!1),this.defaultCodeCoverageTab=(0,l.isFeatureFlagEnabled)(this.context.pageContext,"WebAccess.TestManagement.CodeCoverage.EnableTabByDefault",!1),this._NWPMigrationForDetailsList=(0,l.isFeatureFlagEnabled)(this.context.pageContext,d.FeatureFlagConstants.NWPMigrationForDetailsList,!1),this.getCodeCoverageLearnLink=()=>(this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.NoCodeCoverageConfiguredClicked,{state:this.state.codeCoverageFailureMessage}),v.createElement("div",null,N.CodeCoverageInformativeMessage,v.createElement(p.Link,{className:"margin-16",href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/test/review-code-coverage-results?view=azure-devops"},N.LearnMoreText))),this._getSpinner=()=>v.createElement(y.Spinner,{className:"flex flex-grow absolute-fill",size:"large"}),this._onStoreChanged=()=>{this.setState(this._store.getState())},this._perfService=this.context.pageContext.getService("IVssPerformanceService"),this._telemetryService=this.context.pageContext.getService("IVssTelemetryService")}componentWillMount(){this._actionHub=A.CodeCoverageTabActionHub.getInstance(),this._store=new J.BuildCodeCoverageStore(this.BuildCodeCoverageChangeEvent,this._actionHub),this._actionCreator=U.CodeCoverageTabActionCreator.getInstance(this.context),this.setState(this._store.getState()),this.enhancedCodeCoverageHtmlView?this._actionCreator.fetchEnhancedBuildCodeCoverage(this.props.runViewArtifact):this._actionCreator.fetchBuildCodeCoverage(this.props.runViewArtifact),this.folderViewCodeCoverageFF&&this._actionCreator.fetchFolderViewBuildCodeCoverage(this.props.runViewArtifact),this._store.addChangedListener(this._onStoreChanged),this._codeCoverageSignalRHubNotificationSync=new r(this._actionCreator,this.props.runViewArtifact),this.watchForCodeCoverageUpdates()}componentDidMount(){this._perfService.endScenario(a.PerfScenarios.Area,a.PerfScenarios.CodeCoverageTab,!0)}componentWillUnmount(){this.unwatchForCodeCoverageUpdates(),this._store.removeChangedListener(this._onStoreChanged)}componentDidUpdate(){(this.state.showCodeCoverageHTMLSummary||this.state.showCodeCoverageDetails||this.state.codeCoverageFailureMessage)&&this.unwatchForCodeCoverageUpdates()}render(){return this.defaultCodeCoverageTab?this.state&&(this.state.showCodeCoverageHTMLSummary||this.state.showCodeCoverageDetails||this.state.messageAreaText||this.state.codeCoverageFailureMessage||2!=this.props.runViewArtifact.buildStatus)?v.createElement("div",{className:"code-coverage-details"},this._getCodeCoverageUI()):this._getSpinner():this.state&&(this.state.showCodeCoverageHTMLSummary||this.state.showCodeCoverageDetails||this.state.messageAreaText)?v.createElement("div",{className:"code-coverage-details"},this._getCodeCoverageUI()):this._getSpinner()}_callFolderViewApi(e){this._actionHub.updateEnableFolderViewState.invoke(e)}_getCodeCoverageUI(){const e=(0,V.getSafeId)("code-coverage-folder-view-toggle");if(this.state.showCodeCoverageHTMLSummary)return v.createElement(G.CodeCoverageHtmlSummary,{modernBrowserAvailable:this.state.modernBrowserAvailable,codeCoverageSummaryLink:this.state.codeCoverageSummaryLink});if(this.state.folderViewEnabled&&this.folderViewCodeCoverageFF&&null!=this.state.folderViewBuildCodeCoverageDetails){const t=this.state.folderViewBuildCodeCoverageDetails.buildConfigurations,o=this.state.folderViewBuildCodeCoverageDetails.folderViewCoverages[this.state.selectedFolderViewBuildConfiguration];return this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.FolderViewCodeCoverageViewed,{}),v.createElement("div",null,v.createElement("div",{className:"toggle-container"},v.createElement(D.Toggle,{ariaLabel:N.Folderview,ariaDescribedBy:e,text:N.Folderview,checked:this.state.folderViewEnabled,tooltipProps:{text:N.FolderviewTooltip},onChange:(e,t)=>this._callFolderViewApi(t)}),v.createElement("div",{hidden:!0,id:e,className:"visually-hidden"},N.FolderviewTooltip),v.createElement(j.BuildConfigSelector,{configurations:t}),v.createElement(O.CodeCoverageSummaryView,Object.assign({},o.summaryViewProps)),v.createElement(q.CodeCoverageFolderViewTree,{folderCoverageData:o.folderCoverageData})))}if(this.state.showCodeCoverageDetails){const t=this.state.buildCodeCoverageDetails.buildConfigurations,o=this.state.buildCodeCoverageDetails.buildCoverages[this.state.selectedBuildConfiguration],a=this._getCodeCoverageDownloadLink(o);return this.folderViewCodeCoverageFF&&null!=this.state.folderViewBuildCodeCoverageDetails?v.createElement("div",null,v.createElement("div",null,v.createElement("div",{className:"toggle-container"},v.createElement(D.Toggle,{ariaLabel:N.Folderview,ariaDescribedBy:e,text:N.Folderview,checked:this.state.folderViewEnabled,tooltipProps:{text:N.FolderviewTooltip},onChange:(e,t)=>this._callFolderViewApi(t)}),v.createElement("div",{hidden:!0,id:e,className:"visually-hidden"},N.FolderviewTooltip))),v.createElement(j.BuildConfigSelector,{configurations:t}),v.createElement(O.CodeCoverageSummaryView,Object.assign({},o.summaryViewProps)),a,v.createElement(z.CodeCoverageModuleFilterBar,null),v.createElement("div",{className:"toolbar-grid-separator"}),this._NWPMigrationForDetailsList?v.createElement($.CodeCoverageTable,{codeCoverageModuleList:o.codeCoverageModuleList,moduleFilterText:this.state.moduleFilterText}):v.createElement(H.CodeCoverageDetailsList,{codeCoverageModuleList:o.codeCoverageModuleList,moduleFilterText:this.state.moduleFilterText})):v.createElement("div",null,v.createElement(j.BuildConfigSelector,{configurations:t}),v.createElement(O.CodeCoverageSummaryView,Object.assign({},o.summaryViewProps)),a,v.createElement(z.CodeCoverageModuleFilterBar,null),v.createElement("div",{className:"toolbar-grid-separator"}),this._NWPMigrationForDetailsList?v.createElement($.CodeCoverageTable,{codeCoverageModuleList:o.codeCoverageModuleList,moduleFilterText:this.state.moduleFilterText}):v.createElement(H.CodeCoverageDetailsList,{codeCoverageModuleList:o.codeCoverageModuleList,moduleFilterText:this.state.moduleFilterText}))}if(this.defaultCodeCoverageTab){if(this.state.codeCoverageFailureMessage==N.CodeCoverageNotConfigured||this.state.codeCoverageFailureMessage==N.NoCodeCoverageFound)return this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageFailureMessage,{state:this.state.codeCoverageFailureMessage}),v.createElement(M.ZeroData,{imagePath:(0,n.getAssetLocation)(this.context.pageContext,"ms.vss-codecoverage-ci-web/view-common/Content/no-results-image.png"),imageAltText:"",primaryText:N.CodeCoverageNotConfigured,secondaryText:this.getCodeCoverageLearnLink()});if(this.state.codeCoverageFailureMessage)return this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageFailureMessage,{state:this.state.codeCoverageFailureMessage}),v.createElement("div",{className:"flex-column"},v.createElement(I.MessageCard,{severity:"Error"},this.state.codeCoverageFailureMessage),v.createElement("br",null),v.createElement(x.IssuesCard,null));if(32==this.props.runViewArtifact.buildStatus.valueOf()||1==this.props.runViewArtifact.buildStatus.valueOf()){let e="";switch(this.props.runViewArtifact.buildStatus.valueOf()){case 32:e=N.BuildQueued;break;case 1:e=N.BuildInProgress}return v.createElement("div",{className:"flex-column"},v.createElement(I.MessageCard,null,e))}}return v.createElement("div",null,v.createElement("div",{className:"code-coverage-download-link"},v.createElement("span",{className:"empty-results-message-bar"},v.createElement(K.MessageArea,{text:this.state.messageAreaText}))))}_getCodeCoverageDownloadLink(e){if(""!==e.coverageDownloadLink)return v.createElement("div",{className:"code-coverage-download-link"},v.createElement(p.Link,{href:e.coverageDownloadLink,onClick:()=>{this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.DownloadLinkClicked,{})}},N.DownloadCodeCoverageResults))}async watchForCodeCoverageUpdates(){if(this._codeCoverageHub)return;if((0,l.isFeatureFlagEnabled)(this.context.pageContext,"WebAccess.TestManagement.CodeCoverage.SignalRUpdatesForCodeCoverage",!1))try{const e=this.context.pageContext.getService("IVssContributionService");if(await e.getContributionAsync("ms.vss-codecoverage-web.codecoverage-signalr"),this._codeCoverageHub=this.context.pageContext.getService("ICodeCoverageSignalRHub"),this._codeCoverageHub){const e=this._getProjectId();await this._codeCoverageHub.initialize(this.context.pageContext,e,this._codeCoverageSignalRHubNotificationSync),await this._codeCoverageHub.watchBuild(this.props.runViewArtifact.buildId),console.log("CodeCoverageHub: Successfully connected to Server")}}catch(e){console.warn(`Error occurred while subscribing to codecoverage signals : ${e}`)}}unwatchForCodeCoverageUpdates(){this._codeCoverageHub&&this._codeCoverageHub.unwatchBuild(this.props.runViewArtifact.buildId).then((()=>{this._codeCoverageHub&&(this._codeCoverageHub.dispose(),this._codeCoverageHub=void 0),console.log("codeCoverageHub: Disconnected from server")})).catch((e=>{console.error(`Error occurred while un-watching build : ${e}`)}))}_getProjectId(){const e=this.context.pageContext.getService("ITfsPageService");if(e){const t=e.getData();if(t&&t.project)return t.project.id}return""}}t[e].BuildCodeCoverage=o,h.Components.add("CC.BuildCodeCoverage",o);class r{constructor(e,t){this._actionCreator=e,this._runViewArtifact=t}codeCoverageStatsChangedForBuild(e){this._actionCreator.fetchBuildCodeCoverage(this._runViewArtifact),console.log("code coverage hub signal received from server")}}}("ComponentsBuildCodeCoverage"),function(e){t[e]={};class o extends g.VssService{constructor(){super(...arguments),this.codeCoverageTabEnabled=!1,this.onBuildStatusChanged=()=>{if((0,l.isFeatureFlagEnabled)(this.pageContext,"WebAccess.TestManagement.CodeCoverage.EnableTabByDefault",!1)&&this.tcmServiceContributionLoaded&&this.buildContext){this.currentrunViewArtifact=new u.RunViewArtifact(this.buildContext.runId.value,this.buildContext.projectId.value,this.buildContext.status.value);const e=this.pageContext.getService("IRunDetailsService");this.codeCoverageResults=e.codeCoverageResults,this.codeCoverageResults.subscribe((()=>{this.createDefaultCodeCoverageTab()})),this.codeCoverageResults.value&&this.createDefaultCodeCoverageTab()}else if(this.tcmServiceContributionLoaded&&!this.codeCoverageTabEnabled&&this.buildContext&&2===this.buildContext.status.value){const e=new u.RunViewArtifact(this.buildContext.runId.value,this.buildContext.projectId.value,this.buildContext.status.value),t=this.pageContext.getService("IRunDetailsService");this.codeCoverageResults=t.codeCoverageResults,this.codeCoverageResults.subscribe((()=>{this.createCodeCoverageTab(e)})),this.codeCoverageResults.value&&this.createCodeCoverageTab(e)}}}_serviceStart(e){super._serviceStart(e),this._telemetryService=this.pageContext.getService("IVssTelemetryService"),this.tabs=new c.ObservableArray,this.contributionService=this.pageContext.getService("IVssContributionService"),this.getTcmContribution().then((()=>{this.tcmServiceContributionLoaded||(this.tcmServiceContributionLoaded=!0,this.onBuildStatusChanged())}))}getTabs(e,t){return t&&(this.buildContext=t,(0,l.isFeatureFlagEnabled)(this.pageContext,"WebAccess.TestManagement.CodeCoverage.EnableTabByDefault",!1)?t.status?t.status.subscribe(this.onBuildStatusChanged):this.onBuildStatusChanged():t.status&&2!==t.status.value?t.status.subscribe(this.onBuildStatusChanged):this.onBuildStatusChanged()),this.tabs}createCodeCoverageTab(e){!this.codeCoverageTabEnabled&&this.codeCoverageResults.value&&"coverage"in this.codeCoverageResults.value&&this.codeCoverageResults.value.coverage&&(this.codeCoverageTabEnabled=!0,this.tabs.push({id:"codecoverage-tab",render:()=>v.createElement(Q.BuildCodeCoverage,{runViewArtifact:e}),name:N.CodeCoverage,onBeforeTabChange:()=>(this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageTabClicked,{}),!0)}))}createDefaultCodeCoverageTab(){this.codeCoverageTabEnabled||(this.codeCoverageTabEnabled=!0,this.tabs.push({id:"codecoverage-tab",render:()=>v.createElement(Q.BuildCodeCoverage,{runViewArtifact:this.currentrunViewArtifact}),name:N.CodeCoverage,onBeforeTabChange:()=>(this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageTabClicked,{}),!0)}))}getTcmContribution(){return this.tcmContribution||(this.tcmContribution=this.contributionService.getContributionAsync("ms.vss-codecoverage-web.tcm-service-location")),this.tcmContribution}}t[e].CodeCoveragePipelineTabService=o,t[e].CodeCoveragePipelineTabServiceName="codecoverage-pipeline-tab-service",g.Services.add(t[e].CodeCoveragePipelineTabServiceName,{serviceFactory:o})}("ServicesCodeCoveragePipelineTabService"),function(e){t[e]={};class o extends g.VssService{constructor(){super(...arguments),this.codeCoverageTabEnabled=!1}_serviceStart(e){super._serviceStart(e),this._telemetryService=this.pageContext.getService("IVssTelemetryService"),this._perfService=this.pageContext.getService("IVssPerformanceService")}loadItems(e,t){t?t.onBuildChanged((t=>{const o=u.RunViewArtifact.GetArtifactDataFromBuild(t);this.onBuildChanged(o,e)})):console.error("itemContext should've been present.")}onBuildChanged(e,t){if(!this.codeCoverageTabEnabled&&2==e.buildStatus){const o=this.pageContext.getService("IRunDetailsService");this.codeCoverageResults=o.codeCoverageResults,this.codeCoverageResults.subscribe((()=>{this.createCodeCoverageTab(e,t)})),this.codeCoverageResults.value&&this.createCodeCoverageTab(e,t)}}createCodeCoverageTab(e,t){0==this.codeCoverageTabEnabled&&this.codeCoverageResults.value&&"coverage"in this.codeCoverageResults.value&&this.codeCoverageResults.value.coverage&&(this.codeCoverageTabEnabled=!0,t([{id:"codecoverage-tab",render:()=>(this._perfService.startScenario(a.PerfScenarios.CodeCoverageTab,!0),v.createElement(Q.BuildCodeCoverage,{runViewArtifact:e},null)),text:N.CodeCoverage,onBeforePivotChange:()=>(this._telemetryService.publishEvent(a.TelemetryEvents.Area,a.TelemetryEvents.CodeCoverageTabClicked,{}),!0)}]))}}t[e].CodeCoverageTabProviderService=o,t[e].CodeCoverageTabProviderServiceName="codecoverage-tab-provider-service",g.Services.add(t[e].CodeCoverageTabProviderServiceName,{serviceFactory:o})}("ServicesCodeCoverageTabProviderService")}),["Resources","Actions/CodeCoverageTabActionHub","Stores/CodeCoverageMessagesMap","Actions/CodeCoverageTabActionCreator","Components/CodeCoverageTable.model","Services/CodeCoverageDataService","Components/CoveredBarChart","Components/CodeCoverageDetailsList","Components/CodeCoverageSummaryView","Components/MessageArea","Stores/BuildConfigSelectorStore","Components/BuildConfigSelector","Components/CodeCoverageHtmlSummary","Components/CodeCoverageModuleFilterBar","Stores/BuildCodeCoverageStore","Components/CodeCoverageFolderViewTree","Components/CodeCoverageTable","Components/BuildCodeCoverage","Services/CodeCoveragePipelineTabService","Services/CodeCoverageTabProviderService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-codecoverage-web.codecoverage-tab"}}));