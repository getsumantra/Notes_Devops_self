"use strict";define("CodeCoverage/Common",["require","exports","VSS/Reflux/Action","Test/Client/TestManagementServices","VSS/Core/Util/String"],(function(e,o,t,a,r){var i,n;!function(e){o[e]={};o[e].CodeCoverageActionHub=class{constructor(){this.initializeCodeCodeCoverageSummary=new t.Action}};o[e].CodeCoverageSummaryData=class{}}("ActionsCodeCoverageActionHub"),function(e){o[e]={};class t{constructor(e,o,t){this.buildId=e,this.projectId=o,this.buildStatus=t}static GetArtifactDataFromBuild(e){return new t(e.id,e.project.id,e.status)}}o[e].RunViewArtifact=t}("RunViewArtifact"),function(e){i=o[e]={};class t{constructor(e){this.pageContext=e,this.apiCallCache={}}static getInstance(e){return t._instance||(t._instance=new t(e)),t._instance}getBuildCodeCoverage(e){return this.getTcmService().getBuildCodeCoverage(e.buildId,1)}getFolderViewBuildCodeCoverage(e){return this.getTcmService().getFolderViewCodeCoverage(e.buildId)}getBuildArtifacts(e){return this.pageContext.pageContext.getRestClient("IBuildRestClient").getArtifacts(e.projectId,e.buildId)}getCodeCoverageSummary(e){let o=this.getTcmService();if(this.apiCallCache[e.buildId])return this.apiCallCache[e.buildId].complete?Promise.resolve(this.apiCallCache[e.buildId].value):this.apiCallCache[e.buildId].promise;const t=o.getCodeCoverageSummary(e.buildId);this.apiCallCache[e.buildId]={promise:t,complete:!1,value:null};const a=o=>{this.apiCallCache[e.buildId].complete=!0,this.apiCallCache[e.buildId].value=o};return t.then(a,a),t}getTcmService(){return this.tcmService||(this.tcmService=this.pageContext.pageContext.getService(a.TestManagementServiceName)),this.tcmService}}o[e].CodeCoverageSource=t}("SourcesCodeCoverageSource"),function(e){n=o[e]={};o[e].GetCodeCoverageTimelineSummaryData=(e,o)=>2==e.buildStatus?o.getCodeCoverageSummary(e).then((e=>{if(e){return a(e.coverageData)||[]}return console.warn("getCodeCoverageSummary promise returned null"),[]}),(e=>(console.error(e),[]))):Promise.resolve([]);class t{}o[e].FeatureFlagConstants=t,t.NWPMigrationForPickList="WebAccess.TestManagement.EnableNWPMigrationInTCMForPickListToDropdown",t.NWPMigrationForDetailsList="WebAccess.TestManagement.EnableNWPMigrationInTCMForDetailsListToTable",t.EnableBranchCoverageUI="WebAccess.TestManagement.CodeCoverage.EnableBranchCoverageUI";const a=e=>{const o=[];return e?(e.forEach((e=>{const t=e.coverageStats.filter((e=>e.label&&(!r.localeIgnoreCaseComparer(e.label,"Lines")||!r.localeIgnoreCaseComparer(e.label,"Line"))));if(t.length){const a=t[0].covered||0,r=t[0].total||t[0].covered;o.push({buildConfiguration:e.buildFlavor,buildPlatform:e.buildPlatform,coveredPercentage:r?a/r*100:0})}})),o):[]}}("Common"),function(e){o[e]={};o[e].CodeCoverageActionCreator=class{constructor(e,o){this._actionHub=e,this.pageContext=o,this._source=i.CodeCoverageSource.getInstance(o)}fetchCodeCoverageSummary(e){(0,n.GetCodeCoverageTimelineSummaryData)(e,this._source).then((e=>{e&&e.length&&this._actionHub.initializeCodeCodeCoverageSummary.invoke({timelineSummaryData:e})}))}}}("ActionsCodeCoverageActionCreator"),function(e){o[e]={};class t{}o[e].PerfScenarios=t,t.Area="CodeCoverage",t.CodeCoverageTab="CodeCoverage.Tab",t.TimelineSummary="CodeCoverage.TimelineSummary",t.APICall="CodeCoverage.ApiCall";class a{}o[e].TelemetryEvents=a,a.Area="CodeCoverage",a.DownloadLinkClicked="DownloadLinkClicked",a.DetailsListSortClicked="DetailsListSortClicked",a.CodeCoverageTabClicked="CodeCoverageTabClicked",a.CodeCoverageTabInProgress="CodeCoverageTabInProgress",a.CodeCoverageFailureMessage="CodeCoverageFailureMessage",a.CodeCoverageSummaryCalled="CodeCoverageSummaryCalled",a.FolderViewCodeCoverageViewed="FolderViewCodeCoverageViewed",a.NoCodeCoverageConfiguredClicked="NoCodeCoverageConfiguredClicked"}("Constants")}),["Actions/CodeCoverageActionHub","RunViewArtifact","Sources/CodeCoverageSource","Common","Actions/CodeCoverageActionCreator","Constants"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-codecoverage-web.common"}}));