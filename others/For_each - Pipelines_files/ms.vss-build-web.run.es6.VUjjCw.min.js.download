"use strict";define("Build/Run",["require","exports","react","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Location","VSS/Platform/Layout","VSSUI/Icon","VSS/Core/Util/String","VSSUI/Button","VSSUI/Observer","VSSUI/MessageCard","VSS/Core/Observable","VSSUI/Link","VSSUI/Panel","VSSUI/Table","Build/Common/Library/Constants","VSS/Platform/FPS","Build/Common/Library/Indicator","VSS/Platform/Feature","VSSUI/Card","VSSUI/Status","VSSUI/Surface","VSSUI/Tabs","VSSUI/TooltipEx","VSSUI/Util","VSSUI/Duration","VSS/Core/Util/Promise","VSS/Platform/Util/Array","VSS/Platform/Context","Tfs/Platform/Page","Test/Client/RestClient/TestResults","Test/common-util/TestSummaryReport.Utils","Test/common-util/Common.Utils","VSSUI/TreeEx","VSSUI/Utilities/TreeItemProvider","Build/Common/Library/Components/CommandComponent","VSSUI/FocusGroup","VSSUI/FocusZone","VSSUI/Utilities/Date","VSSUI/SplitButton","Traceability/StageChanges/UpcomingChangesPanel","VSSUI/Utilities/ScreenSize","VSSUI/Page","VSSUI/List","VSSUI/Utilities/Provider","Build/Common/Library/Identity","VSS/Platform/Identity","Build/Common/Library/Components/BuildPersona","VSSUI/Ago","Build/SourceProviders/Common","VSSUI/Spinner","Build/Common/Library/Components/RepoLink","Build/SourceProviders/Resources","Build/Common/Library/Components/BranchLink","Build/Common/Library/Components/CommitLink","Build/SourceProviders/GitHub","VSSUI/Checkbox","VSSUI/Header","Build/Common/Library/ErrorHandler","VSSUI/Image","VSSUI/Pill","VSSUI/ResponsiveViewport","VSSUI/Dialog","VSSUI/TagPicker","Build/Common/Library/SignalRHubProxies","DistributedTask/Common/SignalR/SignalRHubProxies","VSS/Features/SignalR/Hub","Build/Client/RestClient/Approval","Build/Client/RestClient/PipelinePermissions","Build/Client/RestClient/PipelinesChecks","Build/Common/Library/Security","Build/Common/Library/Stores/Permissions","VSS/Core/TimerManagement","Build/Common/Library/Components/RetentionPanel","Build/Common/Library/Navigation","Build/Common/Library/PipelineRunNameFormatter","Build/Common/Library/StateHandler","Build/Flux/Sources/Contribution","VSS/Features/PlatformUI/ContributedIcon","VSS/Features/PlatformUI/ContributedMenu","VSS/Features/PlatformUI/ContributedTab","VSSUI/HeaderCommandBar","VSSUI/PillGroup","VSS/Features/PlatformUI/ContributedItemUtil","DistributedTask/Client/RestClient/TaskAgent","PipelinesUI/Utilities/Parser","VSS/Platform/Fetch","PipelinesUI/LogViewer","VSS/Core/Util/Accessibility","VSSUI/MasterDetails","VSSUI/TextField"],(function(e,t,s,a,i,n,r,o,l,c,d,u,h,m,p,g,_,v,b,C,f,S,y,k,w,I,R,x,T,N,E,D,P,A,L,M,B,V,F,O,j,U,H,z,W,J,G,q,Y,Q,K,$,X,Z,ee,te,se,ae,ie,ne,re,oe,le,ce,de,ue,he,me,pe,ge,_e,ve,be,Ce,fe,Se,ye,ke,we,Ie,Re,xe,Te,Ne,Ee,De,Pe,Ae,Le,Me,Be){var Ve,Fe,Oe,je,Ue,He,ze,We,Je,Ge,qe,Ye,Qe,Ke,$e,Xe,Ze,et,tt,st,at,it,nt,rt,ot,lt,ct,dt,ut,ht,mt,pt,gt,_t,vt,bt,Ct,ft,St,yt,kt,wt,It;Ve=t[It="Resources"]={},t[It].AboutHostedImage="About hosted agent image",t[It].AboutTask="About this task",t[It].AddTags="Add tags",t[It].AddTagsDialogTitle="Tags of the run",t[It].Analysis="View analysis",t[It].ApprovalReassigned="Approval reassigned",t[It].AriaDownloadLog="View raw log",t[It].ArtifactCount="{0} artifact",t[It].ArtifactsCount="{0} artifacts",t[It].ArtifactsCountFormat="{0} produced",t[It].ArtifactsHeader="Artifacts:",t[It].ArtifactsView_Header="Artifacts",t[It].ArtifactsFormat="{0} published; {1} consumed",t[It].ArtifactsPublishedFormat="{0} published",t[It].ArtifactsConsumedFormat="{0} consumed",t[It].AssociatedChanges="Associated changes",t[It].AttemptNumber="Attempt #{0}",t[It].AuthoredFormat="{0} authored",t[It].AuthorizedResourcesButtonText="Resources authorized",t[It].AuthorizeResourcesButtonText="Authorize resources",t[It].AuthorizeResourcesErrorMessage="An error occurred while auto-authorizing resources",t[It].AuthorizeResourcesSuccessMessage="Resources were successfully authorized",t[It].AzureContainerRepository="Azure Container Repository",t[It].By="by",t[It].ByFormat="{0} by {1}",t[It].Cancel="Cancel",t[It].Run="Run",t[It].CancelBuild="Cancel",t[It].Cancelling="Cancelling",t[It].Canceled="Canceled",t[It].CancelingBuild="Canceling",t[It].CancelStage="Cancel Stage",t[It].ChangesFormat="{0} commits",t[It].ChangesHeader="Changes:",t[It].ChecksCard_Log="{0} • {1}",t[It]._ChecksCard_Log="{0} = check name, {1} = current log line from check",t[It].ChecksCard_LogWithStage="{0} • {1} • {2}",t[It]._ChecksCard_LogWithStage="{0} = stage name, {1} = check name, {2} = current log line from check",t[It].ChecksCard_Message_ChecksNeedReviewStage="{0} checks need review before this run can continue to {1}",t[It].ChecksCard_Message_CheckWithSingleManualValidationNeedReviewStage="1 check and 1 manual validation need review before this run can continue to {0}",t[It].ChecksCard_Message_ChecksWithSingleManualValidationNeedReviewStage="{0} checks and 1 manual validation need review before this run can continue to {1}",t[It].ChecksCard_Message_CheckWithManualValidationsNeedReviewStage="1 check and {0} manual validations need review before this run can continue to {1}",t[It].ChecksCard_Message_ChecksWithManualValidationsNeedReviewStage="{0} checks and {1} manual validations need review before this run can continue to {2}",t[It].ChecksCard_Message_ChecksNeedReview="{0} checks need review before this run can continue",t[It].ChecksCard_Message_CheckWithSingleManualValidationNeedReview="1 check and 1 manual validation need review before this run can continue",t[It].ChecksCard_Message_ChecksWithSingleManualValidationNeedReview="{0} checks and 1 manual validation need review before this run can continue",t[It].ChecksCard_Message_CheckWithManualValidationsNeedReview="1 check and {0} manual validations need review before this run can continue",t[It].ChecksCard_Message_ChecksWithManualValidationsNeedReview="{0} checks and {1} manual validations need review before this run can continue",t[It].ChecksCard_Message_NeedReview="{0} checks need to pass before this run can continue",t[It].ChecksCard_Message_ApprovalNeedReview="{0} approvals need review before this run can continue",t[It].ChecksCard_Message_ManualValidationsNeedReview="{0} manual validations need review before this run can continue",t[It].ChecksCard_Message_NeedReviewStage="{0} checks need to pass before this run can continue to {1}",t[It].ChecksCard_Message_ApprovalNeedReviewStage="{0} approvals need review before this run can continue to {1}",t[It].ChecksCard_Message_ManualValidationsNeedReviewStage="{0} manual validations need review before this run can continue to {1}",t[It].ChecksCard_Message_NeedYourReview="{0} checks need your review before this run can continue",t[It].ChecksCard_Message_CheckWithSingleManualValidationNeedYourReview="1 check and 1 manual validation need your review before this run can continue",t[It].ChecksCard_Message_CheckWithManualValidationNeedYourReview="1 check and {0} manual validations need your review before this run can continue",t[It].ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReview="{0} checks and 1 manual validation need your review before this run can continue",t[It].ChecksCard_Message_ChecksWithManualValidationNeedYourReview="{0} checks and {1} manual validations need your review before this run can continue",t[It].ChecksCard_Message_ApprovalNeedYourReview="{0} approvals need your review before this run can continue",t[It].ChecksCard_Message_ManualValidationNeedYourReview="{0} manual validations need your review before this run can continue",t[It].ChecksCard_Message_NeedYourReviewStage="{0} checks need your review before this run can continue to {1}",t[It].ChecksCard_Message_CheckWithSingleManualValidationNeedYourReviewStage="1 check and 1 manual validation need your review before this run can continue to {0}",t[It].ChecksCard_Message_CheckWithManualValidationNeedYourReviewStage="1 check and {0} manual validations need your review before this run can continue to {1}",t[It].ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReviewStage="{0} checks and 1 manual validation need your review before this run can continue to {1}",t[It].ChecksCard_Message_ChecksWithManualValidationNeedYourReviewStage="{0} checks and {1} manual validations need your review before this run can continue to {2}",t[It].ChecksCard_Message_ApprovalNeedYourReviewStage="{0} approvals need your review before this run can continue to {1}",t[It].ChecksCard_Message_ManualValidationNeedYourReviewStage="{0} manual validations need your review before this run can continue to {1}",t[It].ChecksCard_Message_SingleNeedReview="1 check need to pass review before this run can continue",t[It].ChecksCard_Message_SingleApprovalNeedReview="1 approval needs review before this run can continue",t[It].ChecksCard_Message_SingleManualValidationNeedReview="1 manual validation needs review before this run can continue",t[It].ChecksCard_Message_SingleNeedReviewStage="1 check need to pass before this run can continue to {0}",t[It].ChecksCard_Message_SingleApprovalNeedReviewStage="1 approval needs review before this run can continue to {0}",t[It].ChecksCard_Message_SingleManualValidationNeedReviewStage="1 manual validation needs review before this run can continue to {0}",t[It].ChecksCard_Message_SingleNeedYourReview="1 check needs your review before this run can continue",t[It].ChecksCard_Message_SingleApprovalNeedYourReview="1 approval needs your review before this run can continue",t[It].ChecksCard_Message_SingleManualValidationNeedYourReview="1 manual validation needs your review before this run can continue",t[It].ChecksCard_Message_SingleNeedYourReviewStage="1 check needs your review before this run can continue to {0}",t[It].ChecksCard_Message_SingleApprovalNeedYourReviewStage="1 approval needs your review before this run can continue to {0}",t[It].ChecksCard_Message_SingleManualValidationNeedYourReviewStage="1 manual validation needs your review before this run can continue to {0}",t[It].ChecksCard_Message_SomeNeedYourReview="{0} of {1} checks need your review before this run can continue",t[It].ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReview="1 check and 1 manual validation need your review before this run can continue",t[It].ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReview="{0} of {1} checks and 1 manual validation need your review before this run can continue",t[It].ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReview="1 check and {0} manual validations need your review before this run can continue",t[It].ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReview="{0} of {1} checks and {2} manual validations need your review before this run can continue",t[It].ChecksCard_Message_SomeApprovalsNeedYourReview="{0} of {1} approvals need your review before this run can continue",t[It].ChecksCard_Message_SomeManualValidationsNeedYourReview="{0} of {1} manual validations need your review before this run can continue",t[It].ChecksCard_Message_SomeNeedYourReviewStage="{0} of {1} checks need your review before this run can continue to {2}",t[It].ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReviewStage="1 check and 1 manual validation need your review before this run can continue to {0}",t[It].ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReviewStage="{0} of {1} checks and 1 manual validation need your review before this run can continue to {2}",t[It].ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReviewStage="1 check and {0} manual validations need your review before this run can continue to {1}",t[It].ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReviewStage="{0} of {1} checks and {2} manual validations need your review before this run can continue to {3}",t[It].ChecksCard_Message_SomeApprovalsNeedYourReviewStage="{0} of {1} approvals need your review before this run can continue to {2}",t[It].ChecksCard_Message_SomeManualValidationsNeedYourReviewStage="{0} of {1} manual validations need your review before this run can continue to {2}",t[It].ChecksCard_Message_SinglePermissionNeedYourReview="This pipeline needs permission to access a resource before this run can continue",t[It].ChecksCard_Message_SinglePermissionNeedYourReviewStage="This pipeline needs permission to access a resource before this run can continue to {0}",t[It].ChecksCard_Message_PermissionNeedYourReview="This pipeline needs permission to access {0} resources before this run can continue",t[It].ChecksCard_Message_PermissionNeedYourReviewStage="This pipeline needs permission to access {0} resources before this run can continue to {1}",t[It].ChecksCard_Message_SingleFailedCheck="Pipeline run failed due to 1 failed check.",t[It].ChecksCard_Message_FailedChecks="Pipeline run failed due to {0} failed checks.",t[It]._ChecksCard_Message_FailedChecks="{0} is the number of failed checks",t[It].ChecksCard_Review="Review",t[It].ChecksCard_View="View",t[It].ChecksFailedInfo="{0} checks failed",t[It].ChecksStatusRejected="{0} checks rejected",t[It].CheckStatusRejected="{0} check rejected",t[It].ChecksStatusInfo="{0} checks passed",t[It].ChecksCard_ApproveStage="Approve {0}",t[It].ChecksCard_RejectStage="Reject {0}",t[It].CollapseStage="Collapse stage",t[It].CommitsFormat="{0} commit(s)",t[It].ConfirmCancelBuild="Are you sure you want to cancel '{0}'?",t[It].ConfirmCancelStage="Are you sure you want to cancel '{0}' stage?",t[It].ConfirmDeleteRun="Are you sure you want to delete everything in run '{0}', including its logs, artifacts, test results, symbols, and label?",t[It].ConfirmRerunStage="Are you sure you want to rerun the stage '{0}'?",t[It].ConfirmRerunStageAndDependents="Are you sure you want to rerun the stage '{0}' and its dependents?",t[It].ConfirmRerunStageFailedJobs="Are you sure you want to rerun failed jobs in the stage '{0}'?",t[It].ConfirmRetryStage="Are you sure you want to retry the stage '{0}'?",t[It].ConfirmRetryStageAndDependents="Are you sure you want to retry the stage '{0}' and its dependents?",t[It].ConfirmRetryStageFailedJobs="Are you sure you want to retry failed jobs in the stage '{0}'?",t[It].ConfirmRerunPipeline="Are you sure you want to rerun the pipeline's failed jobs?",t[It].CopyLogsLocation="Copy logs location",t[It].CoverageFormat="{0}% covered",t[It].DeleteRun="Delete Run",t[It].DeleteRunActionName="Delete",t[It].DownloadAllLogs="Download logs",t[It].DurationColumnName="Duration",t[It].DurationHeader="Duration:",t[It].EditPipeline="Edit pipeline",t[It].EditTags="Edit tags",t[It].EmptyTestTabText="--",t[It].Errors="Errors",t[It].ErrorAnalysis="Error analysis",t[It].ExpandStage="Expand stage",t[It].Failed="Failed",t[It].GetStarted="Get started",t[It].GotoEnd="Scroll to the end",t[It].GotoRun="Go to #{0}",t[It].GotoTop="Scroll to the top",t[It].HelfpulLinks="Helpful links",t[It].ImageView_Header="Image",t[It].RunNext="Run next",t[It].RunNextTooltip="Bump this job to the top of the queue",t[It].Issues="Issues",t[It].IssuesMessage='<b>{0}:</b> "{1}"',t[It].Jenkins="Jenkins",t[It].JobColumnName="Name",t[It].JobDidNotRun="Job did not run.",t[It].JobHasNotStarted="Job has not started.",t[It].JobInformation="Job information",t[It].JobInfoAgent="Agent: {0}",t[It].JobInfoDuration="Duration: {0}",t[It].JobInfoImage="Image: {0}",t[It].JobInfoPool="Pool: {0}",t[It].JobInfoQueued="Queued: {0} [{1}]",t[It].JobInfoQueuedOnPrem="Queued: {0}",t[It].JobLiveData="Job live console data:",t[It].JobInfoStart="Started: {0}",t[It].JobsInRun="Jobs in run #{0}",t[It].JobsTitle="Jobs",t[It].JobsNameMobileFormat="{0}: {1}",t[It].Loading="Loading",t[It].ManualValidationsFailedInfo="{0} manual validations failed",t[It].ManualValidationsStatusInfo="{0} manual validations passed",t[It].ManyChecksFailed="{0} checks failed",t[It].MultipleChecksInProgress="{0} checks in progress",t[It].MultipleChecksBypassed="{0} checks bypassed",t[It].MultipleJobsCompleted="{0} jobs completed",t[It].NoLogs="Job is pending...",t[It].NoLogsToastMessage="No logs available for this run",t[It].NoMessageForIssue="No message found for this issue",t[It].None="None",t[It].NotStarted="Not started",t[It].NoBuildData="Build not found.",t[It].NoTask="Task not found.",t[It].OldJobAttempt="This job didn't run in this attempt. Logs shown are from a previous attempt",t[It].OneChange="1 commit",t[It].OneCheckFailed="1 check failed",t[It].OneCheckInProgress="1 check in progress",t[It].OneCheckPassed="1 check passed",t[It].OneCheckBypassed="1 check bypassed",t[It].OneManualValidationFailed="1 manual validation failed",t[It].OneManualValidationPassed="1 manual validation passed",t[It].QueueTimeVariableGroup="{0} queue time variable used",t[It].QueueTimeVariablesGroup="{0} queue time variables used",t[It].ParallelJobsLinkText="manage parallel jobs",t[It].PercentComplete="{0}%",t[It].PermissionGranted="Permission granted",t[It].PermissionNeeded="Permission needed",t[It].Pipeline="Pipeline",t[It].PipelinePaused="This pipeline is currently paused. All runs will begin executing once the pipeline is unpaused.",t[It].PipelineTabName="Summary",t[It].PrepareJob="Job preparation parameters",t[It].RuntimeParameterGroup="Parent pipeline used these runtime parameters",t[It].Property="Property",t[It].ReasonBatchedCI="Rolling build triggered",t[It].ReasonBuildCompletion="Build completion triggered",t[It].ReasonCheckInShelveset="Check-in shelveset",t[It].ReasonCI="Individual CI ",t[It].ReasonCIFor="Individual CI for ",t[It].ReasonManual="Manually run",t[It].ReasonAutomaticTrigger="Automatically triggered",t[It].ReasonPullRequest="Pull request",t[It].ReasonScheduled="Scheduled",t[It].ReasonValidate="Validate shelveset",t[It].RelatedHeader="Related",t[It].RepositoryVersionHeader="Repository and version",t[It].RepositoriesHeader="Repositories",t[It].ResourceAuthIssue="There was a resource authorization issue",t[It].RetainBuild="Retain",t[It].Retained="Retained",t[It].RetainedByLease="Retained by one or more leases",t[It].RetainedByLeaseBegin_Exact="This run has been retained for",t[It].RetainedByLeaseBegin_MoreThan="This run has been retained for more than",t[It].RetainedByLeaseEnd=" by {0} ({1}).",t[It].RetainedByLeaseForDays=" {0} days",t[It].RetainedByLeaseForMonths=" {0} months",t[It].RetainedByLeaseForYears=" {0} years",t[It].RetainedByLeaseForOneMonth=" 1 month",t[It].RetainedByLeaseForOneDay=" 1 day",t[It].RetainedByLeaseForOneYear=" 1 year",t[It].RetainedByLeaseForever="This run has been retained forever by {0} ({1})",t[It].RetainedByProtectBranchRecentRuns="This run is being retained as one of {0} recent runs by {1} (Branch).",t[It].RetainedByPipelineRecentRuns="This run is being retained as one of {0} recent runs by pipeline.",t[It].RetainedByNobody="This run will be cleaned up after {0} based on your project settings.",t[It].RetainedByNobodyNextRun="This run is scheduled to be cleaned up the next time the cleanup job executes.",t[It].RetryAll="Rerun all jobs",t[It].RetryFromFailed="Rerun failed jobs",t[It].RetrySucceeded="Retry Stage",t[It].RetrySucceededWithDependents="Retry stage and its dependents",t[It].RetrySucceededWithoutDependents="Retry just this stage",t[It].RetryPipeline="Retry Pipeline",t[It].RetryStage="Retry Stage",t[It].RerunAll="Rerun all jobs",t[It].RerunFromFailed="Rerun failed jobs",t[It].RerunSucceeded="Rerun Stage",t[It].RerunSucceededWithDependents="Rerun stage and its dependents",t[It].RerunSucceededWithoutDependents="Rerun just this stage",t[It].RerunPipeline="Rerun Pipeline",t[It].RerunStage="Rerun Stage",t[It].Review="Review",t[It].RunDetailsSubtitle="on {0}",t[It].RunPipeline="Run new",t[It].RunQueued="{0} queued",t[It].RunTimeDetails="Run-time details",t[It].Save="Save",t[It].SearchLabel="Find",t[It].SearchMatch="{0} of {1}",t[It].SearchNext="Next",t[It].SearchNone="No results",t[It].SearchPrev="Previous",t[It].SearchClose="Close",t[It].SetupCoverage="Setup code coverage",t[It].ShowAdditionalIssues="Show {0} additional {1}",t[It].ShowMoreErrors="Show more errors",t[It].ShowMoreWarnings="Show more warnings",t[It].ShowPreviousAttempts="Show Previous Attempts",t[It].SingleJobCompleted="1 job completed",t[It].Skipped="Skipped",t[It].SkippedJobLogs="The job was skipped.",t[It].SourceCardTitle="Sources",t[It].SourceCardChangesColumnTitle="Changes",t[It].SourceCardRelatedColumnTitle="Related",t[It].SourceCardRepositoryColumnTitle="Repository",t[It].SourceCardVersionColumnTitle="Version",t[It].SourceCardNoneLabel="None",t[It].ResourceCardTitle="Resources",t[It].ConsumedPipelineArtifacts="Consumed Pipeline Artifacts",t[It].ResourceName="Resource Name",t[It].PipelineRun="Pipeline Run",t[It].ArtifactsPublished="Artifacts Count",t[It].Repositories="Repositories",t[It].Repository="Repository",t[It].BranchTag="Branch/Tag",t[It].Version="Version",t[It].Related="Related",t[It].ContainerName="Resource Name",t[It].ContainerImage="Container Image",t[It].ContainerType="Container Type",t[It].Containers="Containers",t[It].Build="Build",t[It].ResourceCardLink="See Resources card for details",t[It].SourceCardLink="See Sources card for details",t[It].SourceCardCommitLabel="1 commit",t[It].SourceCardCommitsLabel="{0} commits",t[It].SourceCardBranchColumnTitle="Branch / tag",t[It].StageDescription="{0}, {1}, {2}",t[It].StageDescriptionWithStartTime="{0}, {1}, {2}, {3}",t[It].StageColumnName="Stage",t[It].StageInProgress="{0}/{1} completed",t[It].StagesTitle="Stages",t[It].StatusColumnName="Status",t[It].StopRetainingBuild="Stop retaining run",t[It].SummaryTitle="Summary",t[It].TagsDialogPlaceholder="Add tag",t[It].TaskName="{0} task",t[It].TestsHeader="Tests and coverage",t[It].TestResultsFormat="{0}% passed",t[It].TestResultTestsFormat="{0}% tests",t[It].TestResultPassedFormat="{0} passed",t[It].TimeElapsedHeader="Time started and elapsed",t[It].TitleSummary="Pipelines - Run {0}",t[It].TitleLogs="Pipelines - Run {0} logs",t[It].ToggleTimestamps="Toggle timestamps",t[It].Troubleshoot="View documentation for troubleshooting failed runs",t[It].UnnamedStage="Stage",t[It].Value="Value",t[It].ViewAgent="View agent",t[It].ViewChange="View change",t[It].ViewChanges="View {0} changes",t[It].ViewLog="View log",t[It].ViewLogForMoreErrors="View the log to see the remaining {0} errors for this task",t[It].ViewLogForMoreWarnings="View the log to see the remaining {0} warnings for this task",t[It].ViewPipeline="View pipeline",t[It].ViewRetentionLeasesMenuItem="View retention leases",t[It].Warnings="Warnings",t[It].WaitingForApproval="Waiting",t[It].WebHook="WebHook",t[It].WorkItemsFormat="{0} work items",t[It].WorkItemsMoreThanThresholdFormat="{0}+ linked",t[It].WorkItemsHeader="Work items:",t[It].NoLogsToShow="Nothing to show. Final logs are missing. This can happen when the job is cancelled or times out.",t[It].ConfirmRunStage="Are you sure you want to run stage '{0}'?",t[It].ConfirmRunStageOutOfOrder="Are you sure you want to run stage '{0}'? If stage depends on not yet ran stages, its behavior may differ from your expectations.",t[It].RunStageDisabledTooltip="Cannot run stage because at least one of the stages it depends on is not skippable and has not successfully ran yet.",t[It].RunStageQuestion="Run stage?",t[It].RunStage="Run stage",t[It].ManuallyQueued="Manually queued",t[It].DependentOnManualQueue="Dependent on manual queue",t[It].InformationalRunCIMessage="This is an informational run. It was automatically generated because Azure Pipelines failed to determine if the pipeline should run. This can happen when Azure Pipeline fails to retrieve the pipeline YAML source code and check its triggering conditions. See error details below.",t[It].LearnMoreButton="Learn more",t[It].InformationalRunHref="https://aka.ms/Pipelines/InformationalRuns",t[It].CommitsStageLabel="Show changes (commits and workitems)",t[It].SeeFullYAML="See full YAML",t[It].ATPAnnoucementFullTitle="Associate your automated tests to Test Cases",t[It].ATPAnnoucementMessage="You can now associate your automated tests to manual test cases, directly from the Tests Tab in Azure Devops Pipelines.",t[It].ExpandStagesPanel="Expand stages panel",t[It].CollapseStagesPanel="Collapse stages panel",t[It].ParametersPanelTitle="View Parameters and Stages",t[It].ParametersPanelParametersTabTitle="Parameters",t[It].ParametersPanelStagesTabTitle="Stages to run",t[It].Parameters="Parameters",t[It].Variables="Variables",t[It].ParametersPanelParametersColumn="Parameter label",t[It].ParametersPanelVariablesColumn="Variable label",t[It].ParametersPanelVariablesRuntimeVarsTitle="Pipeline Variables Defined in the UI",t[It].NoDependencies="No dependencies",t[It].DependsOn="Depends on:",t[It].CopyToClipboard="Copy to clipboard ",t[It].CopiedToClipboard="Copied to clipboard!",t[It].StageRunning="stage skipped",t[It].StageSkipped="stage running",t[It].NoParametersFound="There are no parameters in this pipeline.",t[It].NoRuntimeVariablesFound="There are no runtime variables in this pipeline.",t[It].ParametersPanelPipelineVariableTable="Pipeline variables table",t[It].ParametersPanelParametersTable="Parameters table",function(e){Fe=t[e]={};class o extends n.VssComponent{constructor(e,t){super(e,t)}render(){const e={};this._initializeRouteValues(this.context.pageContext,e);let t=(0,i.routeUrl)(this.context.pageContext,this.props.routeId,e);return s.createElement(a.FPSLink,{supportsFPS:!0,telemetryProperties:this.props.telemetryProperties||{},telemetrySource:"RunSummary",ariaDescribedBy:this.props.linkDescribedBy,className:this.props.linkClassName,href:t,subtle:this.props.subtle,removeUnderline:!0},s.createElement("span",{className:"text-ellipsis"},s.createElement(r.Icon,{iconName:this.props.iconName,className:"pipelines-icon-right-margin"}),this.props.urlDisplayText))}_initializeRouteValues(e,t){let s="";const a=e.getService("ITfsPageService").getData();a&&!s&&a.project&&(s=a.project.name),s&&(t.project=s),this.props.currentRunId&&(t.currentRunId=this.props.currentRunId.toString())}}t[e].RunSummaryBaseLinkComponent=o}("ComponentsRunSummaryBaseLinkComponent"),function(e){Oe=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t)}render(){const e={};return this._initializeRouteValues(this.context.pageContext,e),s.createElement(c.Observer,{traceabilityChangesCount:this.props.traceabilityChangesCount},(t=>{const a=t.traceabilityChangesCount,n="text-ellipsis flex-row flex-baseline";let r=(0,i.routeUrl)(this.context.pageContext,"ms.vss-traceability-web.traceability-run-changes-hub-default-route",e);if(a&&a>0){const e=1==a?Ve.ViewChange:(0,o.localeFormat)(Ve.ViewChanges,a.toString());return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:n,href:r,onClick:this._onClick},e)}if(a){const e=1==a?Ve.ViewChange:(0,o.localeFormat)(Ve.ViewChanges,a.toString());return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:n},e)}return null}))}_initializeRouteValues(e,t){let s="";const a=e.getService("ITfsPageService").getData();a&&!s&&a.project&&(s=a.project.name),s&&(t.project=s),this.props.currentRunId&&(t.currentRunId=this.props.currentRunId.toString())}_onClick(){this.context.pageContext.getService("IVssTelemetryService").publishEvent("WebPlatform","Link",Object.assign({clickedOn:"RunViewChanges"},{source:"RunSummary"}))}}t[e].RunSummaryChangesLink=a}("ComponentsRunSummaryChangesLinkComponent"),function(e){je=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t)}render(){return s.createElement(c.Observer,{traceabilityWorkItemsCountData:this.props.traceabilityWorkItemsCount},(e=>{const t=e.traceabilityWorkItemsCountData;if(t&&t>0){var a="";return a=t>50?(0,o.localeFormat)(Ve.WorkItemsMoreThanThresholdFormat,50..toString()):(0,o.localeFormat)(Ve.WorkItemsFormat,t.toString()),s.createElement(Fe.RunSummaryBaseLinkComponent,{currentRunId:this.props.currentRunId,linkClassName:"text-ellipsis flex-row flex-baseline ",iconName:"WorkItem",routeId:"ms.vss-traceability-web.traceability-run-workitems-hub-default-route",urlDisplayText:a,subtle:!0,telemetryProperties:{clickedOn:"RunViewWorkItems"},linkDescribedBy:this.props.linkDescribedBy})}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link-work-item-link"},s.createElement(r.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),(0,o.localeFormat)(Ve.WorkItemsFormat,"0"))}))}}t[e].RunSummaryWorkItemsLink=a}("ComponentsRunSummaryWorkItemsLinkComponent"),function(e){Ue=t[e]={},function(e){e.Area="Build",e.RunArtifacts="Pipelines.RunArtifacts",e.RunDetails="Pipelines.RunDetails",e.RunLogs="Pipelines.RunLogs",e.RunChangesPerStage="Pipelines.RunChangesPerStage"}(t[e].Telemetry||(t[e].Telemetry={})),t[e].NavTestTabId="ms.vss-test-web.build-test-results-tab",t[e].ATPAnnoucementLearnMoreLink="https://learn.microsoft.com/en-us/azure/devops/test/associate-automated-test-with-test-case",t[e].CodeCoverageCiTabId="codecoverage-tab",t[e].AuthorizationCheckTypeIdString="E1A1FC6C-C278-4492-AE1C-C42F8697612C",t[e].ManualValidationTaskTypeIdString="2003AD3A-104A-451A-9238-60474AB294E6",t[e].TaskCheckTypeIdString="fe1de3ee-a436-41b4-bb20-f6eb4cb879a7",t[e].ApprovalCheckTypeId="8C6F20A7-A545-4486-9777-F762FAFE0D4D",t[e].RetentionSettingDataContributionId="ms.vss-build-web.pipelines-retention-data-provider",function(e){e.Pipeline="Pipeline",e.Branch="Branch",e.User="User",e.ReleaseManagment="RM"}(t[e].LeaseType||(t[e].LeaseType={}))}("Constants"),function(e){He=t[e]={};const a="__default";t[e].ChecksCard=e=>{const t=e.pageContext.getService("ITaskCheckLogLineService"),[i,n]=s.useState([]),[r,l]=s.useState([]),[c,u]=s.useState(0),[h,m]=s.useState(0),[p,g]=s.useState(0),[_,v]=s.useState(0),[b,C]=s.useState(0),[f,S]=s.useState(0),[y,k]=s.useState(0),[w,I]=s.useState(0),[R,x]=s.useState(""),[T,N]=s.useState(""),[E,D]=s.useState("");s.useEffect((()=>{let s=0,a=0,i=0,r=0,c=0,d=0,h=0,p=0,_=[],b=[],f=new Date(0);for(const n of e.stages){let l=!1,u=!1;for(const m of n.checks||[]){switch(1===m.permissions&&(s++,(0,o.equals)(m.typeId,Ue.ManualValidationTaskTypeIdString,!0)&&2===m.status&&d++),m.status){case 2:switch(a++,l=!0,!0){case(0,o.equals)(m.typeId,Ue.ApprovalCheckTypeId,!0):r++;break;case(0,o.equals)(m.typeId,Ue.AuthorizationCheckTypeIdString,!0):h++;break;case(0,o.equals)(m.typeId,Ue.ManualValidationTaskTypeIdString,!0):c++;break;case(0,o.equals)(m.typeId,Ue.TaskCheckTypeIdString,!0):p++}break;case 56:i++,u=!0;break;case 8:(0,o.equals)(m.typeId,Ue.TaskCheckTypeIdString,!0)&&(i++,u=!0)}!e.isChecksLogsDisabled&&(0,o.equals)(m.typeId,Ue.TaskCheckTypeIdString,!0)&&(e.isAsyncCheckLogsFlowEnabled?m.lastChanged>f&&(f=m.lastChanged,x(n.name),N(m.name),t.getLastCheckLogLine(e.pageContext,m.planId,m.logId,e.projectId,m.lineCount).then((e=>{D(e)}))):m.lastChanged>f&&""!=m.currentLogLine&&(f=m.lastChanged,x(n.name),N(m.name),D(m.currentLogLine)))}l&&_.push(n),u&&b.push(n)}n(_),v(a),S(s),k(h),u(r),m(c),g(d),l(b),C(i),I(p)}),[e.stages]);const P=i[0],A=e.useUpdatedChecksFormat&&r.length>0;if(P||A){const t=()=>{P?e.onReviewClicked(i):e.onReviewClicked(r)};let n=P?function(e,t,s,i,n,r,l){let c="";const d=1===e.length&&e[0].name!==a;if(s>0)c=s===t?1===s?1===i?d?(0,o.format)(Ve.ChecksCard_Message_SingleApprovalNeedYourReviewStage,e[0].name):Ve.ChecksCard_Message_SingleApprovalNeedYourReview:1===n?d?(0,o.format)(Ve.ChecksCard_Message_SinglePermissionNeedYourReviewStage,e[0].name):Ve.ChecksCard_Message_SinglePermissionNeedYourReview:1===r?Ve.ChecksCard_Message_SingleManualValidationNeedYourReview:d?(0,o.format)(Ve.ChecksCard_Message_SingleNeedYourReviewStage,e[0].name):Ve.ChecksCard_Message_SingleNeedYourReview:i===t?d?(0,o.format)(Ve.ChecksCard_Message_ApprovalNeedYourReviewStage,s.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ApprovalNeedYourReview,s.toString()):n===t?d?(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReview,t.toString()):r===t?(0,o.format)(Ve.ChecksCard_Message_ManualValidationNeedYourReview,s.toString()):1===l?1===s?Ve.ChecksCard_Message_SingleManualValidationNeedYourReview:s-1==1?d?(0,o.format)(Ve.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReviewStage,e[0].name):(0,o.format)(Ve.ChecksCard_Message_CheckWithSingleManualValidationNeedYourReview):d?(0,o.format)(Ve.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReviewStage,(s-1).toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ChecksWithSingleManualValidationNeedYourReview,(s-1).toString()):l>1?s-l==1?d?(0,o.format)(Ve.ChecksCard_Message_CheckWithManualValidationNeedYourReviewStage,l.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_CheckWithManualValidationNeedYourReview,l.toString()):d?(0,o.format)(Ve.ChecksCard_Message_ChecksWithManualValidationNeedYourReviewStage,(s-l).toString(),l.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ChecksWithManualValidationNeedYourReview,(s-l).toString(),l.toString()):d?(0,o.format)(Ve.ChecksCard_Message_NeedYourReviewStage,s.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_NeedYourReview,s.toString()):i===t?d?(0,o.format)(Ve.ChecksCard_Message_SomeApprovalsNeedYourReviewStage,s.toString(),t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeApprovalsNeedYourReview,s.toString(),t.toString()):n===t?d?(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReview,t.toString()):r===t?(0,o.format)(Ve.ChecksCard_Message_SomeManualValidationsNeedYourReview,s.toString(),t.toString()):1===l?s-1==1?d?(0,o.format)(Ve.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReviewStage,e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeCheckWithSingleManualValidationNeedYourReview):d?(0,o.format)(Ve.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReviewStage,(s-1).toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeChecksWithSingleManualValidationNeedYourReview,(s-1).toString()):l>1?s-l==1?d?(0,o.format)(Ve.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReviewStage,l.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeCheckWithManualValidationsNeedYourReview,l.toString()):d?(0,o.format)(Ve.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReviewStage,(s-l).toString(),l.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeChecksWithManualValidationsNeedYourReview,(s-l).toString(),l.toString()):d?(0,o.format)(Ve.ChecksCard_Message_SomeNeedYourReviewStage,s.toString(),t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_SomeNeedYourReview,s.toString(),t.toString());else if(1===t)c=1===i?d?(0,o.format)(Ve.ChecksCard_Message_SingleApprovalNeedReviewStage,e[0].name):Ve.ChecksCard_Message_SingleApprovalNeedReview:1===n?d?(0,o.format)(Ve.ChecksCard_Message_SinglePermissionNeedYourReviewStage,e[0].name):Ve.ChecksCard_Message_SinglePermissionNeedYourReview:1===r?Ve.ChecksCard_Message_SingleManualValidationNeedReview:d?(0,o.format)(Ve.ChecksCard_Message_SingleNeedReviewStage,e[0].name):Ve.ChecksCard_Message_SingleNeedReview;else if(i===t)c=d?(0,o.format)(Ve.ChecksCard_Message_ApprovalNeedReviewStage,t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ApprovalNeedReview,t.toString());else if(n===t)c=d?(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReviewStage,t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_PermissionNeedYourReview,t.toString());else if(r===t)c=(0,o.format)(Ve.ChecksCard_Message_ManualValidationsNeedReview,t.toString());else{let s=r-l;c=1===s?t-1==1?d?(0,o.format)(Ve.ChecksCard_Message_CheckWithSingleManualValidationNeedReviewStage,e[0].name):(0,o.format)(Ve.ChecksCard_Message_CheckWithSingleManualValidationNeedReview):d?(0,o.format)(Ve.ChecksCard_Message_ChecksWithSingleManualValidationNeedReviewStage,(t-1).toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ChecksWithSingleManualValidationNeedReview,(t-1).toString()):r-l>1?t-s==1?d?(0,o.format)(Ve.ChecksCard_Message_CheckWithManualValidationsNeedReviewStage,(r-l).toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_CheckWithManualValidationsNeedReview,(r-l).toString()):d?(0,o.format)(Ve.ChecksCard_Message_ChecksWithManualValidationsNeedReviewStage,(t-r).toString(),(r-l).toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ChecksWithManualValidationsNeedReview,(t-l).toString(),(r-l).toString()):d?(0,o.format)(Ve.ChecksCard_Message_ChecksNeedReviewStage,t.toString(),e[0].name):(0,o.format)(Ve.ChecksCard_Message_ChecksNeedReview,t.toString())}return c}(i,_,f,c,y,h,p):function(e){let t="";t=1===e?Ve.ChecksCard_Message_SingleFailedCheck:(0,o.format)(Ve.ChecksCard_Message_FailedChecks,e.toString());return t}(b);const l=[{onClick:t,primary:!!(f>0),text:f>0||A?Ve.ChecksCard_Review:Ve.ChecksCard_View}],u=e.useUpdatedChecksFormat&&!e.isChecksLogsDisabled&&""!=E&&(w>0||A);let m="";return u&&(m=R==a?(0,o.format)(Ve.ChecksCard_Log,T,E):(0,o.format)(Ve.ChecksCard_LogWithStage,R,T,E)),s.createElement(d.MessageCard,{buttonProps:l,className:"pipelines-run-checks-message",severity:y>0?"Warning":P?"Info":A?"Error":"Info"},s.createElement("div",{className:"flex-column"},s.createElement("span",null,n),u&&s.createElement("span",{className:"pipelines-run-checks-log body-s secondary-text"},m)))}return null}}("ComponentsChecksCard"),function(e){ze=t[e]={};class a extends s.Component{constructor(e){super(e),this._hasError=new u.ObservableValue(!1),this._inputs={},this._loading=new u.ObservableValue(!0),this._snippetInputs=new u.ObservableArray,this._taskLink=new u.ObservableArray,this._renderPropertyCell=(e,t,s,a)=>this._renderCommon(e,t,s,a.label),this._renderValueCell=(e,t,s,a)=>{const i=this._inputs[a.name];return this._renderCommon(e,t,s,null!=i?i:a.defaultValue)},this._renderCommon=(e,t,a,i)=>s.createElement(p.TableCell,{key:"item"+e+"-"+t,columnIndex:t,className:"issue-task-table-padding task-value-cell"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement("span",{className:"primary-text"},i)))),this._renderTaskLink=(e,t,a,i)=>s.createElement(p.TableCell,{key:"task-link"+e,columnIndex:t,className:"issue-task-table-padding"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement(h.Link,{href:i},s.createElement("span",{className:"flex-row"},s.createElement(r.Icon,{className:"padding-right-8",iconName:"Unknown",size:"medium"}),Ve.AboutTask))))),this._contributionService=this.props.pageContext.getService("IVssContributionService")}componentDidMount(){const e=this.props.taskVersion.split(".")[0];this._inputs=JSON.parse(this.props.inputs),this._getTaskSnippet(this.props.taskType,e).then((e=>{e?(e.documentationUrl&&this._taskLink.push(e.documentationUrl),this._snippetInputs.value=e.inputs,this._hasError.value=!1):this._hasError.value=!0,this._loading.value=!1}))}render(){const e=[{id:Ve.Property,className:"padding-horizontal-20",width:-100,name:Ve.Property,renderCell:this._renderPropertyCell},{id:Ve.Value,className:"padding-horizontal-20",width:-100,name:Ve.Value,renderCell:this._renderValueCell}],t=[{id:Ve.HelfpulLinks,className:"padding-horizontal-20",width:-100,name:Ve.HelfpulLinks,renderCell:this._renderTaskLink}];return s.createElement(m.Panel,{backButtonProps:{onClick:this.props.onDismiss},contentClassName:"no-h-padding",description:this.props.taskName,escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:(0,o.format)(Ve.TaskName,this.props.taskType)}},s.createElement(c.Observer,{hasError:this._hasError,loading:this._loading},(a=>a.hasError||a.loading?a.loading?s.createElement(s.Fragment,null):s.createElement(d.MessageCard,{severity:"Error",className:"flex-grow "},s.createElement("span",{className:"body-l"},Ve.NoTask)):s.createElement("div",{className:"flex-column"},s.createElement(p.Table,{className:"task-table",columns:e,itemProvider:this._snippetInputs,role:"table",scrollable:!0}),this._taskLink.length>0&&s.createElement(m.PanelFooter,{className:"no-padding help-col-panel-footer"},s.createElement(p.Table,{className:"task-table",columns:t,itemProvider:this._taskLink,role:"table"}))))))}async _getTaskSnippet(e,t){return this._contributionService.getDataAsync("ms.vss-build-web.yaml-assistant-data-provider",{taskName:e,taskVersion:t})}}t[e].TaskControllerView=a}("ComponentsTaskControllerView"),function(e){We=t[e]={};class a extends s.Component{constructor(e){super(e),this._onLogsClick=e=>{const t={};t[g.NavConstants.job]=this.props.issue.jobId,this.props.issue.taskId&&(t[g.NavConstants.task]=this.props.issue.taskId),this.props.issue.lineNumber&&(t[g.NavConstants.line]=this.props.issue.lineNumber.toString());const s=this.props.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.run.id,g.NavConstants.logs,void 0,void 0,t);(0,_.onClickFPS)(this.props.pageContext,s,!0,e)},this._onTaskSelected=(e,t)=>{if(t.data.props.taskVersion&&t.data.props.taskType){this.props.pageContext.getService("IVssLayoutManager").renderCallout((e=>s.createElement(ze.TaskControllerView,Object.assign(Object.assign({},t.data.props),{onDismiss:e}))))}},this._renderTaskCell=(e,t,a,i)=>s.createElement(p.TableCell,{key:"table-item"+e,columnIndex:t,className:"issue-task-table-padding cursor-pointer"},s.createElement("div",{className:"flex-grow flex-row"},s.createElement("div",{className:"flex-column flex-grow padding-vertical-8"},s.createElement("span",{className:"primary-text"},i.primaryText)),i.props.inputs&&s.createElement(r.Icon,{iconName:"ChevronRightMed",size:"medium"}))),this._renderTaskHeader=(e,t)=>s.createElement(p.TableHeaderCell,{key:"table-header"+e,column:t,columnIndex:e},s.createElement("div",{className:"text-ellipsis body-s"},s.createElement("span",null,t.name))),this._onDismiss=()=>{this.props.onDismiss()},this._taskItemProvider=new u.ObservableArray([{primaryText:(0,o.format)(Ve.TaskName,this.props.issue.taskType),props:{inputs:this.props.issue.inputs,pageContext:this.props.pageContext,taskName:this.props.issue.taskName,taskType:this.props.issue.taskType,taskVersion:this.props.issue.taskVersion,onDismiss:this.props.onDismiss}}]);const t=this.props.pageContext.getService("ITfsPageService").getData();this._agentUrl=c[this.props.issue.imageName],this._agentUrl||(this._agentUrl=c[n[this.props.issue.imageName]]),this._agentUrl&&(this._isHosted=!0),!this._agentUrl&&t&&t.project&&this.props.issue.queueId&&(this._agentUrl=(0,i.routeUrl)(this.props.pageContext,"ms.vss-build-web.run-pools-route",{project:t.project.id,queueId:this.props.issue.queueId.toString()}))}render(){const e=[{id:Ve.ErrorAnalysis,className:"padding-horizontal-20",renderCell:this._renderTaskCell,width:-100,name:Ve.RunTimeDetails,renderHeaderCell:this._renderTaskHeader}],t=this.props.issue.taskName&&this.props.issue.taskType?(0,o.format)("{0} ({1})",this.props.issue.taskName,this.props.issue.taskType):"",a=this.props.issue.message.replace(/\\n/g,"\n");return s.createElement(m.Panel,{contentClassName:"no-padding",titleProps:{text:Ve.ErrorAnalysis,className:"fontWeightSemiBold"},description:t,onDismiss:this._onDismiss},this.props.issue.taskName&&s.createElement("div",{className:"flex-column"},s.createElement("span",{className:"body-m padding-bottom-16 padding-horizontal-20 word-break"},s.createElement("code",null,a)),s.createElement(p.Table,{columns:e,itemProvider:this._taskItemProvider,role:"table",onSelect:this._onTaskSelected}),s.createElement(m.PanelFooter,null,s.createElement("div",{className:"flex-row"},this._isHosted&&s.createElement(h.Link,{href:this._agentUrl},Ve.AboutHostedImage),s.createElement("div",{className:"bolt-panel-footer-buttons flex-grow bolt-button-group flex-row rhythm-horizontal-8 flex-end"},this._agentUrl&&!this._isHosted&&s.createElement(l.Button,{text:Ve.ViewAgent,primary:!1,href:this._agentUrl}),s.createElement(l.Button,{text:Ve.ViewLog,primary:!0,onClick:this._onLogsClick}))))))}}t[e].IssueAnalysisPanel=a;const n={"macos-1013":"macOS-10.13","macos 1013":"macOS-10.13","macos 10.13":"macOS-10.13",macos:"macOS-10.14","macos 10.14":"macOS-10.14",ubuntu16:"ubuntu-16.04","ubuntu 16.04":"ubuntu-16.04",defaulthosted:"vs2015-win2012r2","vs2015 win2012r2":"vs2015-win2012r2",vs2017:"vs2017-win2016","vs2017 win2016":"vs2017-win2016",wincon:"win1803","windows-2019-vs2019":"windows-2019","windows 2019 vs2019":"windows-2019","windows 2019":"windows-2019",mac_int1013:"appcenter-macos-10.13","appcenter macos 10.13":"appcenter-macos-10.13",mac_int:"appcenter-macos-10.14","appcenter macos 10.14":"appcenter-macos-10.14","xcode9-macos1012":"internal-macos-10.12","xcode9 macos1012":"internal-macos-10.12","internal macos 10.12":"internal-macos-10.12",mac_internal:"internal-macos-10.13","internal macos 10.13":"internal-macos-10.13","internal-macos1014":"internal-macos-10.14","internal macos1014":"internal-macos-10.14","internal macos 10.14":"internal-macos-10.14",ubuntu18:"ubuntu-18.04","ubuntu 18.04":"ubuntu-18.04"},c={"windows-latest":"https://aka.ms/windows-latest-readme","windows-2022":"https://aka.ms/windows-2022-readme","windows-2019":"https://aka.ms/windows-2019-readme","ubuntu-latest":"https://aka.ms/ubuntu-latest-readme","ubuntu-22.04":"https://aka.ms/ubuntu-22.04-readme","ubuntu-20.04":"https://aka.ms/ubuntu-20.04-readme","macOS-13":"https://aka.ms/macOS-13-readme","macOS-latest":"https://aka.ms/macOS-latest-readme","macOS-12":"https://aka.ms/macOS-12-readme","macOS-11":"https://aka.ms/macOS-11-readme"}}("ComponentsIssueAnalysisPanel"),function(e){Je=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t),this._authorizeResources=()=>{this.setState({authorizingResources:!0}),this._pipelineResourcesService.autoAuthorizeResources(this.props.pipelineId,this.props.sourceBranch).then((()=>{this._addToast(Ve.AuthorizeResourcesSuccessMessage),this.setState({resourcesAuthorized:!0})}),(e=>{console.warn("Error while auto-authorizing resources: "+e&&e.message),this._addToast(e.message||Ve.AuthorizeResourcesErrorMessage),this.setState({authorizingResources:!1})}))},this._pipelineResourcesService=this.context.pageContext.getService("IPipelineResourcesService"),this._messageService=this.context.pageContext.getService("IGlobalMessagesService"),this.state={authorizingResources:!1,resourcesAuthorized:!1}}render(){const e=this.props.resourceAuthErrorMessages;if(e){const t=[{text:this.state.resourcesAuthorized?Ve.AuthorizedResourcesButtonText:Ve.AuthorizeResourcesButtonText,onClick:this._authorizeResources,disabled:this.state.authorizingResources||this.state.resourcesAuthorized}],a=(0,o.format)(Ve.IssuesMessage,Ve.ResourceAuthIssue,e);return s.createElement(d.MessageCard,{className:"margin-top-16",severity:"Error",buttonProps:t},s.createElement("span",{dangerouslySetInnerHTML:{__html:a}}))}return null}_addToast(e){this._messageService.addToast({message:e,duration:5e3,forceOverrideExisting:!0})}}t[e].PipelinePermissionsErrorCard=a}("ComponentsPipelinePermissionsErrorCard"),function(e){Ge=t[e]={};var a;!function(e){e.Errors="errors",e.Warnings="warnings"}(a||(a={}));class i extends n.VssComponent{constructor(e,t){super(e,t),this._onObservableChanged=e=>{this.setState(this._createNewState(e))},this._getIssueTableForGroup=(e,t)=>{let a=0,i=0;const n=e.reduce(((e,s)=>{const n=(1===t?this.state.maxVisibleErrors:this.state.maxVisibleWarnings)-a;if(!s||!s.issues||n<=0)return e;const r=this._getGroupName(s),l=s.issues.filter((e=>e.type===t)),c=l.slice(0,n).map((e=>Object.assign(Object.assign({},e),{groupName:r})));if(0===c.length)return e;if(a+=c.length,l.length===c.length){const e=1===t?s.additionalErrorCount:s.additionalWarningCount;e>0&&c.push({stageId:s.stageId,stageName:s.stageName,jobId:s.jobId,jobName:s.jobName,taskId:s.taskId,taskName:s.taskName,type:t,message:(0,o.format)(1==t?Ve.ViewLogForMoreErrors:Ve.ViewLogForMoreWarnings,e),renderRow:this._renderAdditionalIssuesRow}),i+=e}return e.concat(c)}),[]),r=1===t?this.state.run.errorCount:this.state.run.warningCount,l=a+i;l<r&&n.push({isShowMoreRow:!0,type:t,message:(0,o.format)(Ve.ShowAdditionalIssues,r-l,1===t?"errors":"warnings"),renderRow:this._renderAdditionalIssuesRow});const c=new u.ObservableArray(n),d=[{id:"issue-column",width:-100,renderCell:this._renderIssue},{id:"analysis-column",width:new u.ObservableValue(2.625),widthStyle:1,className:"pipelines-cell",renderCell:this._renderAnalysisCell,ariaLabel:Ve.Analysis}];return s.createElement(p.Table,{ariaLabel:Ve.Issues,className:"issue-table-border",columns:d,key:t,itemProvider:c,onActivate:this._onActivateRow,showHeader:!1,selectableText:!0})},this._onTabChanged=e=>{this._selectedTabId.value=e},this._renderAdditionalIssuesRow=(e,t,a)=>s.createElement(p.TableRow,{details:a,index:e,className:"view-more-issues-row",key:"row-"+e},s.createElement(p.SimpleTableCell,{columnIndex:0,tableColumn:void 0},s.createElement("div",{className:"view-more-issues-text"+(t.isShowMoreRow?" center":"")},t.message))),this._renderAnalysisCell=(e,t,a,i)=>(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ErrorAnalysisPanel",!1)&&i.jobId&&i.taskName&&i.taskType?s.createElement(p.TableCell,{className:"bolt-table-cell-side-action run-analysis-cell",columnIndex:t,tableColumn:a,key:"col-"+t},s.createElement("div",{className:(0,n.css)("flex-column","padding-right-4")},s.createElement("div",{className:"right-align flex-row"},s.createElement(l.Button,{className:"bolt-table-cell-side-action bolt-table-cell-content-reveal",primary:!1,subtle:!0,iconProps:{iconName:"Flashlight"},ariaLabel:Ve.Analysis,onClick:e=>{e.preventDefault(),this._renderIssueAnalysisPanel(i)},excludeTabStop:!0})))):s.createElement("div",null),this._renderIssueAnalysisPanel=e=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const a={run:this.state.run,issue:e,pageContext:this.context.pageContext,onDismiss:t};return s.createElement(We.IssueAnalysisPanel,Object.assign({},a),null)}))},this._renderIssue=(e,t,a,i)=>{let n=i.message;void 0!==n&&0!==n.length||(n=Ve.NoMessageForIssue);const r=(0,v.getTimelineStatusIndicatorData)(2,1===i.type?2:1),o=s.createElement(k.Tooltip,{overflowOnly:!0,text:n},s.createElement("span",{className:"body-m text-ellipsis"},n)),l=s.createElement(f.Status,Object.assign({},r.statusProps,{size:"16",className:"margin-right-8"}));return s.createElement(p.TwoLineTableCell,{columnIndex:t,iconProps:{render:()=>l},key:"col-"+t+" row-"+e,line1:o,line2:this._isInformationalRun?null:s.createElement("span",{className:"body-s secondary-text text-ellipsis"},i.groupName)})},this._onActivateRow=(e,t)=>{if(t.data&&t.data.jobId){const s={};s[g.NavConstants.job]=t.data.jobId,t.data.taskId&&(s[g.NavConstants.task]=t.data.taskId),t.data.lineNumber&&(s[g.NavConstants.line]=t.data.lineNumber.toString());const a=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,s);(0,_.onClickFPS)(this.context.pageContext,a,!0,e)}else if(t.data.isShowMoreRow&&t.data)1===t.data.type?this.setState({maxVisibleErrors:this.state.maxVisibleErrors+10}):this.setState({maxVisibleWarnings:this.state.maxVisibleWarnings+10});else{this.context.pageContext.getService("IGlobalMessagesService").addToast({duration:2e3,message:Ve.NoLogsToastMessage})}},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data;const i=this._service.data.value;this._selectedTabId=new u.ObservableValue(a.Errors),this.state=this._createNewState(i),this._isImproveInformationalRunFeedbackEnabled=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ImproveInformationalRunFeedback",!1),this._isInformationalRun=this._isImproveInformationalRunFeedbackEnabled&&!!i.triggerInfo["ci.isInformationalRun"],this._isFixWrongAuthMessageEnabled=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.FixWrongAuthMessagePopup",!1)}render(){return this._isFixWrongAuthMessageEnabled?this.state.issues&&this.state.issues.length>0?s.createElement("div",null,this._getGeneralIssueCard(this.state.issues)):this.state.resourceAuthErrors&&this.state.resourceAuthErrors.length>0?s.createElement("div",null,this._getResourceAuthErrorCard(this.state.resourceAuthErrors)):null:this.state.resourceAuthErrors&&this.state.resourceAuthErrors.length>0?s.createElement("div",null,this._getResourceAuthErrorCard(this.state.resourceAuthErrors)):this.state.issues&&this.state.issues.length>0?s.createElement("div",null,this._getGeneralIssueCard(this.state.issues)):null}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_createNewState(e){const t={run:e,issues:[],resourceAuthErrors:[],maxVisibleWarnings:10,maxVisibleErrors:10};return(e.issues||[]).forEach((e=>{(e.issues||[]).forEach((e=>{1===e.type&&e.message&&e.message.indexOf("https://aka.ms/yamlauthz")>0&&t.resourceAuthErrors.push(e)})),t.issues.push(e)})),t}_getResourceAuthErrorCard(e){return e&&e.length>0?s.createElement(Je.PipelinePermissionsErrorCard,{resourceAuthErrorMessages:this._getTopIssue(e).message,pipelineId:this.state.run.pipeline.id,sourceBranch:this.state.run.sourceBranch}):null}_getAdditionalLinks(e){const t=new u.ObservableArray,s=this.context.pageContext.getService("IVssContributionService"),a=s.getContributionsByType("ms.vss-build-web.build-results-issues-card-link-provider");for(const i in a)s.getService(i).then((s=>{if(s){const a=s.getLink({runId:e});a&&"function"==typeof a.then&&a.then((e=>{e&&t.push(e)}),(e=>{const t=`Failed to load additional links for the Issues Card from ${i} : ${JSON.stringify(e||"")}`;console.warn(t)}))}}));return t}_getGeneralIssueCard(e){if(e&&e.length>0){const t=this.state.run.errorCount,i=this.state.run.warningCount;return 0===t?this._selectedTabId.value=a.Warnings:0===i&&(this._selectedTabId.value=a.Errors),s.createElement(C.Card,{className:"margin-top-16 flex-grow bolt-table-card"},s.createElement(S.Surface,{background:0},s.createElement(c.Observer,{selectedTab:this._selectedTabId},(n=>s.createElement(y.TabProvider,{selectedTabId:n.selectedTab,providers:new u.ObservableArray([])},s.createElement("div",{className:"issues-card-content flex-column padding-top-16"},s.createElement(y.TabBar,{className:"padding-bottom-16",onSelectedTabChanged:this._onTabChanged,disableSticky:!0,tabSize:"large-link"},t>0&&s.createElement(y.Tab,{id:a.Errors,key:a.Errors,name:Ve.Errors,badgeCount:t}),i>0&&s.createElement(y.Tab,{id:a.Warnings,key:a.Warnings,name:Ve.Warnings,badgeCount:i})),s.createElement(y.TabContent,null,s.createElement("div",{className:"flex-column"},this._getIssueTableForGroup(e,n.selectedTab===a.Errors?1:2),s.createElement("div",{className:"flex-row flex-grow justify-end"},s.createElement(c.Observer,{items:this._getAdditionalLinks(this.state.run.id)},(e=>e.items.length>0?e.items.map((e=>s.createElement(h.Link,{className:"margin-16",href:e.url,target:"_blank"},e.displayValue))):null)),8===this.state.run.result&&s.createElement(h.Link,{className:"margin-16",href:"https://go.microsoft.com/fwlink/?linkid=2101318",target:"_blank"},Ve.Troubleshoot))))))))))}return null}_getGroupName(e){const t=this.state.run.stages.length>1,s=this.state.run.jobs.length>1;let a=this.state.run.number;return e.taskName?a=s?t?(0,o.format)("{0} • {1} • {2}",e.stageName,e.jobName,e.taskName):(0,o.format)("{0} • {1}",e.jobName,e.taskName):e.taskName:e.jobName&&s?a=t?(0,o.format)("{0} • {1}",e.stageName,e.jobName):e.jobName:e.stageName&&t&&(a=e.stageName),a}_getTopIssue(e){let t=0;for(let s=0;s<e.length;s++){const a=e[s];if(1===a.type&&2===a.jobResult){t=s;break}}return e[t]}}t[e].IssuesCard=i}("ComponentsIssuesCard"),function(e){qe=t[e]={},t[e].BaseStatus=function(e){return e.onData&&e.onData(!!e.text),e.text?s.createElement(a.FPSLink,{className:"body-m font-size",subtle:!0,onClick:e.onClick,href:e.href,removeUnderline:!0},s.createElement("span",{className:"flex-row"},s.createElement("span",{className:"flex-column"}," ",!e.warningStatus&&s.createElement(r.Icon,{iconName:e.iconName,className:"base-status-icon-margin"})),s.createElement("span",{className:(0,w.css)("flex-column",(e.warningStatus||e.rejectedChecks)&&"rejected-check-base-status")},s.createElement("span",null,e.text),s.createElement("span",null,e.extendedText)),!!e.item&&e.item)):null}}("ComponentsBaseStatus"),function(e){function a(){return s.useContext(n.VssComponentContext)}Ye=t[e]={},t[e].CheckStatus=function(e){const t=a();let i,n=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableBypassTaskChecks",!1),l=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableBypassApprovals",!1),c=null;if(n||l){const t=function(e,t){if(e.some((e=>(0,o.equals)(e.typeId,Ue.AuthorizationCheckTypeIdString,!0)&&4!==e.status)))return[Ve.PermissionNeeded,null];const s=e.length===e.filter((e=>(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))).length;if(0==e.length||s)return[null,null];const a=e.filter((e=>!(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))),i=a.length;if(t>0)return[(0,o.format)(Ve.ChecksFailedInfo,t===i?i:t+"/"+i),null];const n=a.filter((e=>128===e.status)).length,r=1===n?Ve.OneCheckBypassed:(0,o.format)(Ve.MultipleChecksBypassed,n),l=a.filter((e=>!(189&e.status))).length,c=1===l?Ve.OneCheckInProgress:(0,o.format)(Ve.MultipleChecksInProgress,l);if(l>0)return[c,n>0?r:null];if(n>0)return[r,null];const d=a.filter((e=>4===e.status)).length;return[(0,o.format)(Ve.ChecksStatusInfo,d),null]}(e.checks,e.rejectedChecks);i=t[0],c=t[1]}else{i=function(e,t){if(e.some((e=>(0,o.equals)(e.typeId,Ue.AuthorizationCheckTypeIdString,!0)&&4!==e.status)))return Ve.PermissionNeeded;const s=e.length===e.filter((e=>(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))).length;if(0==e.length||s)return null;const a=e.filter((e=>!(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))).length,i=e.filter((e=>4===e.status&&!(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))).length;if(1===a&&1===i)return Ve.OneCheckPassed;if(t>0)return(0,o.format)(Ve.ChecksFailedInfo,t===a?a:t+"/"+a);return(0,o.format)(Ve.ChecksStatusInfo,i===a?a:i+"/"+a)}(e.checks,e.rejectedChecks)}const d=i===Ve.PermissionNeeded;let u,h;if(e.showIssues){const t=e.checks.filter((e=>null!=e.issue));t.length>0&&(u=t[0].issue.type,h=t[0].issue.message)}const m=s.createElement("div",{className:"summary-checks-issue-icon"},!!e.showIssues&&!!u&&s.createElement(r.Icon,{className:(0,w.css)(2===u&&"warning",1===u&&"error"),iconName:1===u?"ErrorBadge":"Warning",tooltipProps:{text:h}}));return s.createElement(qe.BaseStatus,{text:i,extendedText:c,item:u?m:void 0,rejectedChecks:e.rejectedChecks>0,onClick:e.onClick,iconName:"WaitlistConfirm",onData:e.onData,warningStatus:d})},t[e].ManualValidationStatus=function(e){const t=function(e,t){if(0==e.length)return null;const s=e.filter((e=>(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0))).length;if(0===s)return null;const a=e.filter((e=>(0,o.equals)(e.typeId,Ue.ManualValidationTaskTypeIdString,!0)&&4===e.status)).length;if(1===s&&1===a)return Ve.OneManualValidationPassed;if(t>0)return(0,o.format)(Ve.ManualValidationsFailedInfo,t===s?s:t+"/"+s);return(0,o.format)(Ve.ManualValidationsStatusInfo,a===s?s:a+"/"+s)}(e.checks,e.rejectedManualValidations);return s.createElement(qe.BaseStatus,{text:t,rejectedChecks:e.rejectedManualValidations>0,onClick:e.onClick,iconName:"WaitlistConfirm",onData:e.onData})},t[e].useComponentContext=a}("ComponentsCheckStatus"),function(e){function s(e){return e.map((e=>({finishTime:e.finishTime,id:e.id,imageName:e.imageName,href:e.linkProps.href,name:e.name,queueId:e.queueId,result:e.result,stageId:e.stageId,stageName:e.stageName,startTime:e.startTime,state:e.state,stateData:e.stateData})))}function a(e){return void 0===e.name||0===e.name.length||"__default"===e.name}Qe=t[e]={},t[e].grantResourceHandler=function(e,t){return s=>{const a={projectId:s.projectId,tenantId:s.tenantId,checkSuiteId:s.checkSuiteId},i={authority:s.authority,domainHint:s.domainHint,tenantId:s.tenantId};e.pageContext.getService("IProofOfPresenceService").verifyProofOfPresence("pipelines-proof-of-presence",a,i).then((e=>{t(s.tenantId,e)})).catch((e=>{t(s.tenantId,{success:!1}),console.log(e)}))}},t[e].grantResourceHandlerForProductionReadinessCheck=function(e,t){return s=>{const a={projectId:s.projectId,checkSuiteId:s.checkSuiteId,checkRunId:s.id},i={authority:s.authority,domainHint:s.domainHint,tenantId:s.tenantId};e.pageContext.getService("IProofOfPresenceService").verifyProofOfPresence("pipelines-production-readiness",a,i).then((e=>{t(s.checkSuiteId,e)})).catch((e=>{t(s.checkSuiteId,{success:!1}),console.log(e)}))}},t[e].getInternalRunDetailsData=function(e){return{appendCommitMessageToRunName:e.appendCommitMessageToRunName,deleted:e.deleted,errorCount:e.errorCount,finishTime:e.finishTime,hasNonCompliantCheck:e.hasNonCompliantCheck,id:e.id,issues:e.issues,jobs:s(e.jobs),logs:e.logs,number:e.number,parameters:e.parameters,pipeline:e.pipeline,processType:e.processType,queueTime:e.queueTime,reason:e.reason,repositoryResources:e.repositoryResources,requestedById:e.requestedById,requestedFor:e.requestedFor,requestedForId:e.requestedForId,result:e.result,retainedFor:e.retainedFor,retentionLeases:e.retentionLeases,sourceBranch:e.sourceBranch,sourceEndpointId:e.sourceEndpointId,sourceRepositoryId:e.sourceRepositoryId,sourceRepositoryName:e.sourceRepositoryName,sourceRepositoryType:e.sourceRepositoryType,sourceRepositoryUrl:e.sourceRepositoryUrl,sourceVersion:e.sourceVersion,sourceVersionMessage:e.sourceVersionMessage,stages:e.stages,startTime:e.startTime,status:e.status,tags:e.tags,templateParameters:e.templateParameters,timelineId:e.timelineId,triggerInfo:e.triggerInfo,warningCount:e.warningCount}},t[e].getInternalRunJobData=s,t[e].isDefaultOrEmptyStageName=a,t[e].getSanitizedStageName=function(e){return a(e)?Ve.UnnamedStage:e.name}}("Utilities"),function(e){Ke=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t),this._onObservableChanged=e=>{this.setState({run:(0,Qe.getInternalRunDetailsData)(e)})},this._renderNameCell=(e,t,a,i)=>{const n=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontWeightSemiBold fontSizeM scroll-hidden"},s.createElement(k.Tooltip,{text:n.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},n.statusProps,{className:"icon-large-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden"},s.createElement(h.Link,{className:"bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:i.href,tooltipProps:{overflowOnly:!0},onClick:e=>{(0,_.onClickFPS)(this.context.pageContext,i.href,!0,e)}},i.name)))},this._renderNameMobileCell=(e,t,a,i)=>{const n=(0,o.format)(Ve.JobsNameMobileFormat,i.stageName,i.name);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontWeightSemiBold fontSizeM scroll-hidden"},s.createElement("div",{className:"flex-row scroll-hidden"},s.createElement(k.Tooltip,{overflowOnly:!0,text:n},s.createElement("span",{className:"text-ellipsis"},n))))},this._renderStatusCell=(e,t,a,i)=>{const n=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},s.createElement(k.Tooltip,{overflowOnly:!0,text:n.label},s.createElement("span",{className:"text-ellipsis"},n.label)))},this._renderStatusIconCell=(e,t,a,i)=>{const n=(0,v.getTimelineStatusIndicatorData)(i.state,i.result,i.stateData?i.stateData.pendingChecks:void 0,i.stateData?!i.stateData.pendingDependencies:void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t},s.createElement(k.Tooltip,{text:n.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},n.statusProps,{className:"icon-large-margin",size:"16"})))))},this._renderStageCell=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden"},s.createElement(k.Tooltip,{overflowOnly:!0,text:i.stageName},s.createElement("span",{className:"text-ellipsis"},i.stageName))),this._renderDurationCell=(e,t,a,i)=>{if(!i.startTime){let e=Ve.JobHasNotStarted;return 2===i.state&&(e=Ve.JobDidNotRun),s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden secondary-text",ariaLabel:e})}return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM scroll-hidden secondary-text"},s.createElement(r.Icon,{iconName:"Clock",className:"icon-margin fontSizeML jobs-table-icon"}),s.createElement(I.Duration,{startDate:i.startTime,endDate:i.finishTime}))},this._onJobClick=(e,t)=>{t.data&&(e.ctrlKey||e.metaKey?window.open(t.data.href,"_blank"):(0,_.onClickFPS)(this.context.pageContext,t.data.href,!0,e))},this._nameColumn={id:"name",width:new u.ObservableValue(-67),name:Ve.JobColumnName,className:"jobs-cell",renderCell:this._renderNameCell,columnStyle:2,onSize:this._onSize},this._nameMobileColumn={id:"name-mobile",width:new u.ObservableValue(-67),name:Ve.JobColumnName,className:"jobs-cell",renderCell:this._renderNameMobileCell,onSize:this._onSize},this._statusColumn={id:"status",width:new u.ObservableValue(132),name:Ve.StatusColumnName,className:"jobs-cell",renderCell:this._renderStatusCell},this._statusIconColumn={id:"status-icon",width:new u.ObservableValue(30),className:"jobs-cell",renderCell:this._renderStatusIconCell},this._durationColumn={id:"duration",width:new u.ObservableValue(-33),name:Ve.DurationColumnName,className:"jobs-cell",renderCell:this._renderDurationCell},this._stageColumn={id:"stage",width:new u.ObservableValue(132),name:Ve.StageColumnName,className:"jobs-cell",renderCell:this._renderStageCell},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data,this._showCheckIssues=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1BuildCheckIssues",!1),this._enableJobsSorting=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.SortJobsListAndLogsView",!1);let a=[this._nameColumn,this._statusColumn],i=[];this._service.data.value.stages.length>1?(a.push(this._statusIconColumn),a.push(this._nameMobileColumn),a.push(this._stageColumn),a.push(this._durationColumn),i=[{breakpoint:1,columnWidths:[0,0,30,-100,0,100]},{breakpoint:600,columnWidths:[-67,132,0,0,132,-33]}]):(a.push(this._durationColumn),i=[{breakpoint:1,columnWidths:[-100,0,120]},{breakpoint:600,columnWidths:[-67,132,-33]}]),this.state={run:this._service.internalData.value,columns:a,breakpoints:i,showApprovalStatus:1==this._service.data.value.stages.length,sortedJobs:this._sortJobNames(this._service.internalData.value)}}render(){let e=new u.ObservableArray(this._enableJobsSorting?this.state.sortedJobs:this.state.run.jobs);const t=this.state.run.stages[0];let a=0,i=0;return t.checks&&(a=t.checks.filter((e=>8===e.status&&!(0,o.equals)(Ue.ManualValidationTaskTypeIdString,e.typeId,!0))).length,i=t.checks.filter((e=>(0,o.equals)(Ue.ManualValidationTaskTypeIdString,e.typeId,!0)&&8===e.status)).length),s.createElement("div",null,this.state.showApprovalStatus&&s.createElement("div",{className:"flex-row margin-left-16 margin-top-4"},s.createElement(Ye.CheckStatus,{checks:t.checks||[],rejectedChecks:a,showIssues:this._showCheckIssues,onClick:e=>{this.props.onReviewStageClicked(t)}}),s.createElement(Ye.ManualValidationStatus,{checks:t.checks||[],rejectedManualValidations:i,onClick:e=>{this.props.onReviewManualValidationClicked(t)}})),s.createElement(p.Table,{ariaLabel:Ve.JobsTitle,itemProvider:e,tableBreakpoints:this.state.breakpoints,columns:this.state.columns,onActivate:this._onJobClick}))}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_sortJobNames(e){const t=e.jobs,s=e.stages,a=[],i=new Set,n=new Set,r=new Map;function o(e){if(i.has(e))return;if(n.has(e))throw new Error(`Circular dependency detected in stage: ${e}`);n.add(e);const s=r.get(e),l=s||[];for(const e of l)o(e);n.delete(e),i.add(e);const c=t.filter((t=>t.stageId===e));a.push(...c)}s.forEach((e=>r.set(e.id,e.dependsOn)));for(const e of s)i.has(e.id)||o(e.id);return a}_onSize(e,t,s,a){a.width.value=s}}t[e].JobsTable=a}("ComponentsJobsTable"),function(e){$e=t[e]={};function a(e,t){const s=e.filter((e=>-1!==t.indexOf(e))).length;return 1==s?(0,o.format)(Ve.ArtifactCount,s):s>1?(0,o.format)(Ve.ArtifactsCount,s):""}t[e].ArtifactStatus=e=>{const t=(0,n.useComponentContext)(),[i,r]=s.useState([]),{trackPromise:o}=(0,R.usePromise)(),l=t.pageContext.getService("IVssContributionService"),c=t.pageContext.getService("IBuildLinkingService");return s.useEffect((()=>{const t=e.rundata,s={};s[g.NavConstants.buildId]=t.buildId+"",o(l.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",s,!0)).then((e=>{e&&r(e.sources)}))}),[e.rundata]),s.createElement(qe.BaseStatus,{text:a(i,e.rundata.jobIds),href:c.getBuildUrl(e.rundata.buildId,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),iconName:"Package",onData:e.onData})}}("ComponentsArtifactStatus"),function(e){Xe=t[e]={};class s{}t[e].Constants=s,s.verticalDisplacement=30,s.svgRightMargin=20,s.svgBottomMargin=20,s.negativeNodeRank=-1,s.graphLeftMargin=80,s.edgeQuadraticBezierScaleDownFactor=2.5}("ComponentsCanvasTypes"),function(e){Ze=t[e]={};t[e].PathBuilder=class{constructor(){this._pathBuilder=""}start(e){return this._pathBuilder+=" "+(0,o.format)("M{0},{1}",e.x,e.y),this}line(e){return this._pathBuilder+=" "+(0,o.format)("L{0},{1}",e.x,e.y),this}quadraticBezier(e,t){return this._pathBuilder+=" "+(0,o.format)("Q {0} {1}, {2} {3}",t.x,t.y,e.x,e.y),this}arc(e,t,s,a,i){return this._pathBuilder+=" "+(0,o.format)("A {0} {1} {2} {3} {4} {5} {6}",t,s,0,a,i,e.x,e.y),this}toString(){return this._pathBuilder}}}("ComponentsCanvasPathHelpers"),function(e){et=t[e]={};class a extends n.VssComponent{render(){let{from:e,to:t}=this.props,a="",i=this.props.intermediate1,n=this.props.intermediate2;if(e.x>t.x&&console.error("Edge can only be drawn from left to right."),void 0!==i&&void 0!==n){let s=(new Ze.PathBuilder).start(e);this._addEdgeSegment(s,e,i),this._addEdgeSegment(s,i,n),this._addEdgeSegment(s,n,t),a=s.toString()}else{let s=(new Ze.PathBuilder).start(e);this._addEdgeSegment(s,e,t),a=s.toString()}return this.props.shouldHighlight?s.createElement(s.Fragment,null,null!=this.props.className&&s.createElement("path",{className:"dtc-canvas-path-highlighted-background",d:a}),s.createElement("path",{className:"dtc-canvas-path-dashed"==this.props.className?"dtc-canvas-path-highlighted-dashed":"dtc-canvas-path-highlighted",d:a}),s.createElement("circle",{className:"dtc-graph-connector",cx:e.x,cy:e.y}),s.createElement("circle",{className:"dtc-graph-connector",cx:t.x,cy:t.y})):s.createElement(s.Fragment,null,null!=this.props.className&&s.createElement("path",{className:"dtc-canvas-path-dashed-background",d:a}),s.createElement("path",{className:(0,w.css)("dtc-canvas-path",this.props.className),d:a}))}_addEdgeSegment(e,t,s){t.y===s.y||t.x===s.x?e.line(s):t.y>s.y?this._addUpwardCurve(e,t,s):this._addDownwardCurve(e,t,s)}_addUpwardCurve(e,t,s){let a=s.x-t.x,i=t.x+Math.min(a/2,a);e.quadraticBezier({x:i,y:t.y-this._getQuadraticBezierVerticalDisplacement()},{x:i,y:t.y}).line({x:i,y:s.y+this._getQuadraticBezierVerticalDisplacement()}).quadraticBezier({x:s.x,y:s.y},{x:i,y:s.y})}_addDownwardCurve(e,t,s){let a=s.x-t.x,i=t.x+Math.max(a/2,0);e.quadraticBezier({x:i,y:t.y+this._getQuadraticBezierVerticalDisplacement()},{x:i,y:t.y}).line({x:i,y:s.y-this._getQuadraticBezierVerticalDisplacement()}).quadraticBezier({x:s.x,y:s.y},{x:i,y:s.y})}_getQuadraticBezierVerticalDisplacement(){return this.props.quadraticBezierVerticalDisplacement?this.props.quadraticBezierVerticalDisplacement:Xe.Constants.verticalDisplacement}}t[e].Edge=a}("ComponentsCanvasEdge"),function(e){function s(e,t){if(e=t instanceof Array?e||[]:e||{},t)for(var a in t)t.hasOwnProperty(a)&&t[a]&&("object"==typeof t[a]?e[a]=s(e[a],t[a]):e[a]=t[a]);return e}tt=t[e]={};class a{static validateNodesAndEdges(e,t){let s=this._createNodeKeyToNodeMap(e),a="";for(let e in t)if(t.hasOwnProperty(e)){if(!s[e]&&(a=e,a))break;for(let i in t[e])if(t[e].hasOwnProperty(i)&&!s[i]&&(a=i,a))break}if(a)throw new Error((0,o.format)("Graph does not have node corresponding to edge end {0}. Please ensure that node and edge inputs to graph is proper",a))}static createStagingOrderAndDependencies(e,t){let s=this._createAndInitializeNodesForLayout(e),a=this._createNodeKeyToNodeMap(s),i=this._extractDependencies(s,t,a),{stagingOrder:n,layoutError:r}=this._getStagingOrder(s,i,a);return{stagingOrder:n,dependencies:i,layoutError:r}}static splitGraph(e,t){let s=this._createNodeKeyToNodeMap(e),a=this._extractDependencies(e,t,s),i=this.getDisjointTreeFromEdges(a),n=this._createNodeToGraphIndexMap(i),r=[],o=!1;for(const e of i){const t=this._getMinRankNodeKeyInFirstStage(e,a,s);if(!t){o=!0;break}r.push(t)}if(o)return[{nodes:e,edges:t}];{this._sortNodes(r,s);let e=[];for(const a of r){const r=n[a];e.push(this._createGraph(i[r],s,t))}return e}}static getDependencies(e,t){const s=this._createNodeKeyToNodeMap(e);return this._extractDependencies(e,t,s)}static getIncomingEdgeLayouts(e,t){let s=0,i=[];const n={x:0,y:e.nodeHeight/2},r=a.resolveGraphLeftMargin(e.leftMargin?e.leftMargin:0);for(const e of t){const t=e.getPositionOfIncomingNodes();for(const e of t){const t={x:e.x+r,y:e.y+s};i.push({from:n,to:t,fromDepth:0,key:t.y.toString()})}s+=e.getGraphSize().height}return i}static _getMinRankNodeKeyInFirstStage(e,t,s){let a=1/0,i="";return e.forEach((e=>{if(!t[e]||0===t[e].length){const t=s[e],n=t.nodeRankHint?t.nodeRankHint:0;n<a&&(a=n,i=t.key)}})),i}static _createGraph(e,t,s){return{nodes:e.map((e=>t[e])),edges:this._filterEdges(e,s)}}static _sortNodes(e,t){e.sort(((e,s)=>{const a=t[e],i=t[s];return(a.nodeRankHint?a.nodeRankHint:0)-(i.nodeRankHint?i.nodeRankHint:0)}))}static _createNodeToGraphIndexMap(e){let t={};return e.forEach(((e,s)=>{e.forEach((e=>t[e]=s))})),t}static _filterEdges(e,t){let s={},a={};e.forEach((e=>a[e]=!0));for(let e in t)if(t.hasOwnProperty(e))for(let i in t[e])t[e].hasOwnProperty(i)&&(a[e]||""===e)&&a[i]&&(s[e]||(s[e]={}),s[e][i]=!0);return s}static isFromNodeNotParentButAncestorOfToNode(e,t,s,a){let i=[],n=s[t];return n&&n.length>0&&n.forEach((t=>{t!==e&&(i=i.concat(this._getAncestors(t,s,a)))})),i.filter((t=>t===e)).length>0}static getNodeDataForLayout(e,t,s,a){let i=this._getMaxRowsInStagingOrder(e),n=[],r=0;for(let o=0;o<i;o++){const i=e.length;let l=0;for(let c=0;c<i;c++){let i=e[c][o];i&&((!i.nodeHeightHint||i.nodeHeightHint<0)&&(i.nodeHeightHint=t.nodeHeight),i.topLeftPosition={x:c*(t.nodeWidth+t.horizontalMargin)+s,y:o*t.verticalMargin+r},i.midPoints=this._getNodeMidPoints(i.topLeftPosition,t.nodeHeight,t.nodeWidth),n.push(i),a.x=Math.max(a.x,i.topLeftPosition.x+t.nodeWidth),a.y=Math.max(a.y,i.topLeftPosition.y+i.nodeHeightHint),i.nodeHeightHint>l&&(l=i.nodeHeightHint))}l||(l=t.nodeHeight),r+=l}return n}static _getMaxRowsInStagingOrder(e){let t=0;for(const s of e)s.length>t&&(t=s.length);return t}static getEdgeDataForLayout(e,t,i,n,r,o={}){const l=e.length;let c=[],d=[],u=[],h=[],m=[],p={},g=s({},i);for(let t=0;t<l-1;t++){let s=e[t],a=e[t+1],i=0;s.forEach((e=>{p[e.key]=e,a.forEach((t=>{if(p[t.key]=t,g[e.key]&&g[e.key][t.key]){const s={from:e.midPoints.right,to:t.midPoints.left,key:e.key+"."+t.key,fromDepth:i,cssClassName:t.edgeCssClassName,shouldHighlight:e.nodeExpanded||t.nodeExpanded};this._populateEdgeLists(h,d,m,u,s),g[e.key][t.key]=!1}})),i++}))}const _=e[0];return _&&_.forEach((e=>p[e.key]=e)),this._populateCrossStageEdges(h,d,m,u,g,p,t,n,o,r),a.resolveGraphLeftMargin(n.leftMargin)&&this._populateInputEdgesOfGraph(h,d,u,m,g,p,n),c.push(...h),c.push(...d),c.push(...m),c.push(...u),c}static getDisjointTreeFromEdges(e){const t=this._getAdjacencyList(e);let s={},a=[];if(t)for(const e in t)if(t.hasOwnProperty(e)&&!s[e]){const i=this._breadthFirstTraversal(e,t,s);a.push(i)}return a}static resolveGraphLeftMargin(e){return null==e?Xe.Constants.graphLeftMargin:e}static _getAdjacencyList(e){let t=s({},e),a={};if(t)for(const e in t)if(t.hasOwnProperty(e)){const s=t[e];s&&(a[e]?s.forEach((t=>{a[e].push(t)})):a[e]=s,s.forEach((t=>{a[t]?a[t].push(e):a[t]=[e]})))}return a}static _breadthFirstTraversal(e,t,s){let a=[],i=[];for(i.push(e),s[e]=!0;i.length>0;){e=i.shift(),a.push(e);t[e].forEach((e=>{s[e]||(i.push(e),s[e]=!0)}))}return a}static _populateCrossStageEdges(e,t,s,i,n,r,o,l,c,d){let u;for(let d in n)if(d&&n.hasOwnProperty(d)){let h=n[d];for(let m in h)if(h.hasOwnProperty(m)&&h[m]){if(!a.isFromNodeNotParentButAncestorOfToNode(d,m,o,c)&&r[d]&&r[m]){u||(u=this._getDisplacementOffsetMap(r));let a=r[d].midPoints.right,n=r[m].midPoints.left,o=r[d].nodeExpanded||r[m].nodeExpanded,c=r[m].edgeCssClassName,h=0;const p=this._getMaxHeightOfNodesInPath(a,n,l.nodeHeight,r);p>0&&(h=l.verticalMargin/2+(p-l.nodeHeight/2)+u[d].y);let g={x:Math.max(a.x+l.horizontalMargin-u[d].x,a.x),y:a.y+h};let _={x:Math.min(n.x-l.horizontalMargin+u[d].x,n.x),y:g.y},v=this._getCrossStageEdge(o,c,d+"."+m,a,g,_,n);this._populateEdgeLists(e,t,s,i,v)}n[d][m]=!1}}}static _populateInputEdgesOfGraph(e,t,s,a,i,n,r){let o=i[""];if(o){let i=r.nodeHeight/2;for(let r in o)if(o.hasOwnProperty(r)){const o=n[r];let l={from:{x:0,y:i},to:{x:o.midPoints.left.x,y:o.midPoints.left.y},key:"entry."+r,fromDepth:0,shouldHighlight:o.nodeExpanded,cssClassName:o.edgeCssClassName};this._populateEdgeLists(e,t,s,a,l)}}}static _populateEdgeLists(e,t,s,a,i){i.shouldHighlight&&"dtc-canvas-path-dashed"==i.cssClassName?s.push(i):"dtc-canvas-path-dashed"==i.cssClassName?t.push(i):i.shouldHighlight?a.push(i):e.push(i)}static _getMaxHeightOfNodesInPath(e,t,s,a){let i=this._getNodeListFromNodeKeyToNodeNameMap(a).filter((s=>function(t){return t.midPoints.left.y===e.y}(s)&&function(t){return t.midPoints.left.x>e.x}(s)&&function(e){return e.midPoints.left.x<t.x}(s)));if(i&&i.length>0){let e=0;for(let t=0;t<i.length;t++){const s=i[t].nodeHeightHint;void 0!==s&&s>e&&(e=s)}return 0==e?s:e}return 0}static _getDisplacementOffsetMap(e){let t=this._getNodeListFromNodeKeyToNodeNameMap(e);t.sort(((e,t)=>(e.topLeftPosition?e.topLeftPosition.x:0)-(t.topLeftPosition?t.topLeftPosition.x:0)));let s={},a=0,i=-1;return t.forEach((e=>{const t=e.topLeftPosition?e.topLeftPosition.x:0;t!==i&&(i=t),s[e.key]||(s[e.key]={x:0,y:0}),s[e.key].y=a})),a=0,i=-1,t.sort(((e,t)=>(e.topLeftPosition?e.topLeftPosition.y:0)-(t.topLeftPosition?t.topLeftPosition.y:0))),t.forEach((e=>{const t=e.topLeftPosition?e.topLeftPosition.y:0;t!==i&&(i=t),s[e.key].x=a})),s}static _getNodeListFromNodeKeyToNodeNameMap(e){let t=[];for(let s in e)e.hasOwnProperty(s)&&t.push(e[s]);return t}static _getCrossStageEdge(e,t,s,...a){return{from:a[0],intermediate1:a[1],intermediate2:a[2],to:a[3],key:s,fromDepth:0,shouldHighlight:e,cssClassName:t}}static _getNodeMidPoints(e,t,s){let a={};return a.left={x:e.x,y:e.y+t/2},a.right={x:e.x+s,y:e.y+t/2},a}static _getAncestors(e,t,s){let a=[],i=t[e];return s[e]?s[e]:(i&&i.length>0&&i.forEach((e=>{a=a.concat(e,this._getAncestors(e,t,s)),a=(0,x.uniqueSort)(a)})),s[e]=a,a)}static _getStagingOrder(e,t,s){let a=[],i={},n=0;for(;e.forEach((e=>{if(!i[e.key]){this._areAllDependenciesStaged(e.key,t,i)&&(a[n]||(a[n]=[]),a[n].push(e))}})),a[n];)if(a[n].forEach((e=>{i[e.key]=!0})),n++,n>this.c_maxIterationCount)throw new Error((0,o.format)("Could not layout graph in {0} iterations. There is a bug in the layout logic",this.c_maxIterationCount));let r=this._getNodesThatAreNotStaged(e,i),l="";return r&&r.length>0&&(l=this._getCyclicDependencyError(r),a[0]||(a[0]=[]),r.forEach((e=>{a[0].push(e)}))),this._sortNodesInStages(a),{stagingOrder:a,layoutError:l}}static _getNodesThatAreNotStaged(e,t){return e.filter((e=>!t[e.key]))}static _getCyclicDependencyError(e){if(e.length>0){e.map((e=>e.friendlyName||e.key));return""}return""}static _sortNodesInStages(e){for(let t=e.length-1;t>=0;t--)e[t].sort(((e,t)=>e.nodeRank-t.nodeRank))}static _areAllDependenciesStaged(e,t,s){let a=!0;return t[e]&&t[e].forEach((e=>{s[e]||(a=!1)})),a}static _createAndInitializeNodesForLayout(e){return e.map((e=>{let t=s({},e);return void 0!==e.nodeRankHint?t.nodeRank=e.nodeRankHint:t.nodeRank=0,t}))}static _createNodeKeyToNodeMap(e){let t={};return e.forEach((e=>{t[e.key]=e})),t}static _extractDependencies(e,t,s){let a={};return e.forEach((s=>{a[s.key]||(a[s.key]=[]),e.forEach((e=>{t[s.key]&&t[s.key][e.key]&&(a[e.key]||(a[e.key]=[]),a[e.key].push(s.key))}))})),a}}t[e].GraphLayoutHelper=a,a.c_maxIterationCount=1e4}("ComponentsCanvasGraphLayoutHelper"),function(e){st=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t),this._disjointGraphs=[],this._graphComponents=[],this.state={incomingEdges:[],incomingEdgesEvaluated:!1}}componentWillMount(){this._disjointGraphs=tt.GraphLayoutHelper.splitGraph(this.props.nodes,this.props.edges),this._graphComponents=[]}componentWillReceiveProps(e){this._disjointGraphs=tt.GraphLayoutHelper.splitGraph(e.nodes,e.edges),this.setState({incomingEdgesEvaluated:!1}),this._graphComponents=[]}getGraphComponents(){return this._graphComponents}render(){let e=[];this._disjointGraphs.forEach(((t,a)=>{e.push(s.createElement(i,Object.assign({ref:e=>e&&this._graphComponents.push(e),key:t.nodes[0].key},this.props,{nodes:t.nodes,edges:t.edges,leftMargin:0})))}));const t=this._getGraphLeftMargin(),a=this._getHeight();return s.createElement("div",{className:"dtc-graph-list-parent"},t&&t>0?s.createElement("div",{className:"dtc-incoming-edge-container",style:{width:t,height:a},"aria-hidden":"true"},s.createElement("svg",{className:"dtc-incoming-edge-canvas"},this.state.incomingEdges)):null,s.createElement("div",{className:"dtc-disjoint-graph-container"},e))}componentDidMount(){this._evaluateAndSetIncomingEdges()}componentDidUpdate(){this._evaluateAndSetIncomingEdges()}_evaluateAndSetIncomingEdges(){if(!this.state.incomingEdgesEvaluated){const e=tt.GraphLayoutHelper.getIncomingEdgeLayouts(this.props,this._graphComponents).map((e=>s.createElement(et.Edge,{from:e.from,to:e.to,fromDepth:e.fromDepth,quadraticBezierVerticalDisplacement:this._getQuadraticBezierVerticalDisplacement(),key:e.key,shouldHighlight:e.shouldHighlight})));this.setState({incomingEdgesEvaluated:!0,incomingEdges:e})}}_getQuadraticBezierVerticalDisplacement(){return this.props.nodeHeight/Xe.Constants.edgeQuadraticBezierScaleDownFactor}_getGraphLeftMargin(){return tt.GraphLayoutHelper.resolveGraphLeftMargin(this.props.leftMargin)}_getHeight(){let e=0;if(this._graphComponents)for(let t of this._graphComponents)e+=t.getGraphSize().height;return e}}t[e].GraphList=a;class i extends n.VssComponent{constructor(e,t){super(e,t),this._nodesComparer=(e,t)=>e.key===t.key&&e.nodeRankHint===t.nodeRankHint&&e.nodeHeightHint===t.nodeHeightHint&&e.friendlyName===t.friendlyName,this._identifiedAncestors={},this._incomingNodeRelativePositions=[],this._enableStageGraphDependencyHighlighting=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.EnableStageGraphDependencyHighlighting",!1)}componentWillMount(){this._validateNodesAndEdges(this.props.nodes,this.props.edges),this._stagingOrderAndDependencies=tt.GraphLayoutHelper.createStagingOrderAndDependencies(this.props.nodes,this.props.edges)}componentWillReceiveProps(e){this._validateNodesAndEdges(e.nodes,e.edges),this._stagingOrderAndDependencies=tt.GraphLayoutHelper.createStagingOrderAndDependencies(e.nodes,e.edges),this._identifiedAncestors={}}getStagingOrder(){return this._stagingOrderAndDependencies?this._stagingOrderAndDependencies.stagingOrder:[]}getGraphSize(){return{height:this._svgHeight,width:this._svgWidth}}getPositionOfIncomingNodes(){return this._incomingNodeRelativePositions}render(){const e=this._stagingOrderAndDependencies,t=e.stagingOrder;let a=e.dependencies,i=e.layoutError,n={x:0,y:0},r=this._getNodeElements(t,n),o=[];i||(o=this._getEdgeElements(t,a));const l=this._getGraphLeftMargin();return this._svgWidth=n.x+this.props.horizontalMargin+l,this._svgHeight=n.y+this.props.verticalMargin,i?this._incomingNodeRelativePositions=[]:this._populateIncomingNodeIndices(t[0]),s.createElement("div",{className:"dtc-canvas-container"},i&&s.createElement("div",null,i),s.createElement("div",{className:"dtc-graph-container"},r,this._enableStageGraphDependencyHighlighting?s.createElement("div",{className:"dtc-canvas-position"},s.createElement("svg",{className:"svg-surface",height:this._svgHeight+"px",width:this._svgWidth+"px",focusable:"false","aria-hidden":"true"},o)):s.createElement("svg",{className:"svg-surface",height:this._svgHeight+"px",width:this._svgWidth+"px",focusable:"false","aria-hidden":"true"},o)))}_populateIncomingNodeIndices(e){const t=this.props.edges[""];this._incomingNodeRelativePositions=[],t&&e.forEach(((e,s)=>{t[e.key]&&this._incomingNodeRelativePositions.push({x:e.midPoints.left.x,y:e.midPoints.left.y})}))}_validateNodesAndEdges(e,t){tt.GraphLayoutHelper.validateNodesAndEdges(e,t)}_getNodeElements(e,t){const s=this._getGraphLeftMargin();return tt.GraphLayoutHelper.getNodeDataForLayout(e,this.props,s,t).map((e=>this._getNodeElement(e,e.nodeHeightHint||this.props.nodeHeight,this.props.nodeWidth)))}_getEdgeElements(e,t){return tt.GraphLayoutHelper.getEdgeDataForLayout(e,t,this.props.edges,this.props,this.props.selectedNodeKey,this._identifiedAncestors).map((e=>s.createElement(et.Edge,{from:e.from,intermediate1:e.intermediate1,intermediate2:e.intermediate2,to:e.to,key:e.key,fromDepth:e.fromDepth,className:e.cssClassName,quadraticBezierVerticalDisplacement:this._getQuadraticBezierVerticalDisplacement(),shouldHighlight:e.shouldHighlight})))}_getNodeElement(e,t,a){const i={position:"absolute",height:t,width:a,top:e.topLeftPosition?e.topLeftPosition.y:0,left:e.topLeftPosition?e.topLeftPosition.x:0};return s.createElement("div",{className:"div-node",style:i,key:e.key},e.getNodeElement&&e.getNodeElement(e.key,e.data))}_getGraphLeftMargin(){return tt.GraphLayoutHelper.resolveGraphLeftMargin(this.props.leftMargin)}_getQuadraticBezierVerticalDisplacement(){return this.props.nodeHeight/Xe.Constants.edgeQuadraticBezierScaleDownFactor}}t[e].Graph=i,i.s_telemetryKeyTracker={}}("ComponentsCanvasGraph"),function(e){t[e]={};class s{constructor(e,t){this.testsCount=e,this.testsPassRate=t}}t[e].TestResults=s;class a extends T.VssService{_serviceStart(e){super._serviceStart(e);const t=(0,N.getTFSPageData)(e);this._projectId=t&&t.project&&t.project.id||"",this._projectName=t&&t.project?t.project.name:""}getTestTabLink(e){return this.pageContext.getService("IBuildLinkingService").getBuildUrl(e,Ue.NavTestTabId)}async getTestResultsForRun(e,t){await this._loadTcm();const s=(0,E.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,void 0,void 0,void 0,[2]);if(a){const e=this._getTestResults(a);return 2!==t&&(e.testsCount=-1),e}}async getTestsResultsForJob(e,t){await this._loadTcm();const s=(0,E.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,t.stageName,t.phaseName,t.jobName,[2]);if(a)return this._getTestResults(a)}async getTestsResultsForStage(e,t){await this._loadTcm();const s=(0,E.getTestResultsClient)(this.pageContext),a=await s.getTestPipelineMetrics(this._projectId,e,t,void 0,void 0,[2]);if(a)return this._getTestResults(a)}_getTestResults(e){let t=-1,a=-1;if(e&&e.resultSummary&&e.resultSummary){let s=D.TestSummaryReportUtils.getPassedTestStatisticsInPipeline(e.resultSummary);s&&s.totalTestCount>0?(t=s.passTestRate,a=s.totalTestCount,Number.isNaN(t)&&(t=0)):s&&0===s.totalTestCount&&s.totalNotReportedTestCount>0&&(t=-2)}return new s(a,t)}async getCodeCoverageSummary(e){await this._loadTcm();const t=(0,E.getTestResultsClient)(this.pageContext),s=await t.getCodeCoverageSummary(this._projectName,e,-10);let a=(0,b.isFeatureFlagEnabled)(this.pageContext,"WebAccess.TestManagement.CodeCoverage.EnableTabByDefault",!1),i="";a&&s.coverageDetailedSummaryStatus&&(i=s.coverageDetailedSummaryStatus.toString());let n=new Array;if(s&&s.coverageData&&s.coverageData.length>0){s.coverageData.forEach((e=>{const t=e.coverageStats.filter((e=>e.label&&(!o.localeIgnoreCaseComparer(e.label,"Lines")||!o.localeIgnoreCaseComparer(e.label,"Line"))));let s,a=0;t.length&&(a=t[0].covered||0,s=t[0].total||t[0].covered),n.push(s?a/s*100:0)}));return{coverage:(n.reduce(((e,t)=>e+t),0)/n.length).toFixed(2),coverageDetailedSummaryStatus:i}}if(a)return{coverage:"0",coverageDetailedSummaryStatus:i}}async _loadTcm(){const e=this.pageContext.getService("IVssContributionService");await e.getContributionAsync("ms.vss-build-web.tcm-service-location")}}t[e].RunExternalService=a,T.Services.add("IRunExternalService",{serviceFactory:a})}("RunExternalService"),function(e){at=t[e]={};t[e].TestStatus=e=>{const t=(0,n.useComponentContext)(),[a,i]=s.useState(""),{trackPromise:r}=(0,R.usePromise)(),l=t.pageContext.getService("IRunExternalService");return s.useEffect((()=>{const t=e.stageData;r(l.getTestsResultsForStage(t.buildId,t.stage).then((e=>{e&&e.testsCount>0&&i((0,o.format)(Ve.TestResultPassedFormat,(0,o.format)(Ve.TestResultTestsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(e.testsPassRate,1))))})))}),[e.stageData.buildId,e.stageData.stage,e.recordState]),s.createElement(qe.BaseStatus,{text:a,href:l.getTestTabLink(e.stageData.buildId),iconName:"TestBeaker",onData:e.onData})}}("ComponentsTestStatus"),function(e){it=t[e]={};class a extends n.VssComponent{constructor(e){super(e),this._renderStagesCell=(e,t,a,i)=>{const n=i.underlyingItem.data,r=(0,v.getTimelineStatusIndicatorData)(n.state,n.result),o={text:n.stageName,overflowOnly:!0},l=s.createElement(s.Fragment,null,s.createElement("div",{className:"padding-right-16"},s.createElement(f.Status,Object.assign({},r.statusProps,{size:"16"}))),n.stages&&0!==n.stages.length?s.createElement(h.Link,{className:"flex-row bolt-table-link bolt-link no-underline-link text-ellipsis",role:"button",href:"links",tooltipProps:o},n.displayName||n.stageName):s.createElement("div",{className:"flex-row flex-grow text-ellipsis"},n.displayName));return(0,A.ExpandableTreeCell)({children:l,columnIndex:t,treeColumn:a,treeItem:i,contentClassName:"stages-expandable-tree-cell-content"})},this._onToggle=(e,t)=>{const s=t.underlyingItem.data.stageName;this.setState((e=>{const t=new Set(e.expandedStageKeys);return t.has(s)?t.delete(s):t.add(s),{expandedStageKeys:t}}))},this._onRowClick=(e,t)=>{var s,a,i;const n=null!==(a=null===(s=t.underlyingItem)||void 0===s?void 0:s.data)&&void 0!==a?a:null===(i=t.data.underlyingItem)||void 0===i?void 0:i.data;this.props.onStageSelected&&n&&this.props.onStageSelected(n)},this._treeColumns=[{id:"stages",name:Ve.StagesTitle,renderCell:this._renderStagesCell,columnStyle:2,width:new u.ObservableValue(-40)}],this.state={expandedStageKeys:new Set}}buildTreeItemProvider(e){const t=[];for(const s of e){const e=s.groupName&&s.groupName.trim()?s.groupName.trim():"\\";if("\\"===e||"/"===e||""===e)t.push({data:s,childItems:void 0});else{const a=e.replace(/^\\|\\$/g,"").split("\\").filter(Boolean);this.insertNode(a,{children:t},s)}}const s=new L.TreeItemProvider(t);return this.state.expandedStageKeys.forEach((e=>{const t=s=>{for(const a of s){if(a.data.stageName===e)return a;if(a.childItems){const e=t(a.childItems);if(e)return e}}},a=t(s.roots);a&&s.expand(a)})),s}insertNode(e,t,s){if(0===e.length||1===e.length&&(""===e[0]||"\\"===e[0]||"/"===e[0]))return void t.children.push({data:s,childItems:void 0});const a=e.shift();let i=t.children.find((e=>e.data.stageName===a&&e.childItems));if(i||(i={data:{stageName:a,displayName:a,stageId:"",id:"",groupName:a,order:0,state:0,result:4},childItems:[]},t.children.push(i)),this.insertNode(e,{children:i.childItems},s),i.childItems&&i.childItems.length>0)if(1===i.childItems.length)i.data.state=i.childItems[0].data.state,i.data.result=i.childItems[0].data.result;else{const e=i.childItems.find((e=>0!==e.data.result));e?(i.data.state=e.data.state,i.data.result=e.data.result):(i.data.state=i.childItems[0].data.state,i.data.result=0)}}toTreeItems(e){return e.map((e=>({data:e,text:e.displayName,childItems:e.stages?this.toTreeItems(e.stages):[]})))}render(){const e=this.buildTreeItemProvider(this.props.stages);return s.createElement("div",{className:"stages-left-panel"},s.createElement(C.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1}},s.createElement(A.Tree,{className:"stages-table cursor-pointer",columns:this._treeColumns,ariaLabel:Ve.StagesTitle,itemProvider:e,onToggle:this._onToggle,scrollable:!0,onSelect:this._onRowClick})))}}t[e].MiniStagesTree=a}("StagesRunSummary"),function(e){nt=t[e]={};const i=e=>s.createElement("span",{className:"primary-message"},s.createElement("span",{className:"message"},e.text));class r extends n.VssComponent{constructor(e,t){super(e,t),this._cancelledStages=[],this._runningStages=[],this._stageMetadata={},this._stageMetadataFlags={},this._toggleLeftPanel=()=>{this.setState({isLeftCollapsed:!this.state.isLeftCollapsed})},this._getStageDependencyState=(e,t)=>{const s=new Map,a=e=>{for(const i of t)if(!i.stateData.ignoreDependencies&&i.dependsOn&&-1!==i.dependsOn.indexOf(e.id)){if(s.has(i.id))return s.get(i.id)?1:2;if(1===i.state||1===a(i))return s.set(i.id,!0),1;s.set(i.id,!1)}return 0!=s.size?2:0};return a(e)},this._onArtifactsData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasArtifacts!==e&&(a.hasArtifacts=e,s=!0):(this._stageMetadata[t]={hasArtifacts:e,hasChecks:!1,hasTests:!1},s=!0),s&&this.forceUpdate()},this._onChecksData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasChecks!==e&&(a.hasChecks=e,s=!0):(this._stageMetadata[t]={hasArtifacts:!1,hasChecks:e,hasTests:!1},s=!0),s&&this.forceUpdate()},this._onTestsData=(e,t)=>{let s=!1;const a=this._stageMetadata[t];a?a.hasTests!==e&&(a.hasTests=e,s=!0):(this._stageMetadata[t]={hasArtifacts:!1,hasChecks:!1,hasTests:e},s=!0),s&&this.forceUpdate()},this._onData=(e,t,s)=>{let a=!1,i=this._stageMetadataFlags[t];void 0!==i?(i&s)===s!==e&&(a=!0):(i=0,a=!0),a&&(e?i|=s:i&=~s,this._stageMetadataFlags[t]=i,this.forceUpdate())},this._cancelStage=(e,t)=>{e.preventDefault();const s=(0,o.format)(Ve.ConfirmCancelStage,t);this._confirmAction(Ve.CancelStage,s,(()=>{this._cancelledStages.push(t),this.setState({cancelledStages:this._cancelledStages}),this._service.cancelStage(t)}))},this._retryStage=(e,t,s,a,i=!1,n=!0)=>{e.preventDefault(),this._confirmAction(s,a,(()=>{this._runningStages.push(t),this.setState({retriedStages:this._runningStages}),this._service.retryStage(t,i,n)}))},this._runStage=(e,t,s,a)=>{e.preventDefault(),this._confirmAction(s,a,(()=>{this._runningStages.push(t),this.setState({retriedStages:this._runningStages}),this._service.runStage(t)}),Ve.Run,Ve.Cancel)},this._onObservableChanged=e=>{this._cancelledStages=this._cancelledStages.filter((t=>e.stages.find((e=>e.refName===t&&2===e.state)))),this._runningStages=this._runningStages.filter((t=>e.stages.find((e=>e.refName===t&&2!==e.state)))),this.setState({run:e})},this._showStageDetails=e=>{const t=this._minimized.indexOf(e);t>=0&&this._minimized.splice(t,1),this._expanded.push(e),this.setState({expanded:this._expanded.slice(),minimized:this._minimized.slice()})},this._hideStageDetails=e=>{const t=this._expanded.indexOf(e);t>=0&&this._expanded.splice(t,1),this._minimized.push(e),this.setState({expanded:this._expanded.slice(),minimized:this._minimized.slice()})},this._confirmAction=(e,t,a,i=void 0,n=void 0)=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((r=>{const o={title:e,message:t,onClose:r,onConfirm:a,confirmLabel:i,cancelLabel:n};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},o),null)}))},this._service=this.context.pageContext.getService("IRunDetailsService"),this._telemetryService=this.context.pageContext.getService("IVssTelemetryService"),this._observable=this._service.data,this._expanded=[],this._minimized=[],this._showCheckIssues=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1BuildCheckIssues",!1),this._allowRerunOnSingleStage=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.AllowRerunOnSingleStage",!1),this._allowRunningStagesOutOfOrder=(0,b.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.AllowRunStagesOutOfOrder",!1),this._allowRunningSkippedStagesOutOfOrder=(0,b.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.AllowRunSkippedStagesOutOfOrder",!1),this._allowRunningSkippedStagesOutOfOrderByRetrying=(0,b.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.AllowRunSkippedStagesOutOfOrderByRetrying",!1),this._allowManualRunOnSkippedStage=(0,b.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.AllowManualRunOnSkippedStage",!1),this._upcomingChangesPanelEnabled=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.UpcomingStageChangesPanelEnabled",!1),this._enableNewStageCardHeightCalculation=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.EnableNewStageCardHeightCalculation",!1),this._enableStageGraphDependencyHighlighting=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.EnableStageGraphDependencyHighlighting",!1),this._validatePendingChildStageBeforeRunningOutOfOrder=(0,b.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.ValidatePendingChildStageBeforeRunningOutOfOrder",!1),this._showStagesTree=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.ShowStagesTreeShortcut",!1),this._disableRunStageButtonWhenClicked=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.DisableRunStageButtonWhenClicked",!1);const a=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.ManageStageRunOrderPermission",!1),i=(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.ValidateManualStagePermission",!1);this._canManageStageRunOrder=!a||this._service.getPermissions().canManageStageRunOrder,this._canQueueManualStage=!i||this._service.getPermissions().canQueueManualStage,this.state={run:this._service.data.value,expanded:this._expanded,minimized:this._minimized,cancelledStages:this._cancelledStages,retriedStages:this._runningStages,isLeftCollapsed:!1}}render(){const e=this.state.run.stages,t=this.state.run.jobs;let a=!1;const n=[],r={},h=this.context.pageContext.getService("IBuildLinkingService");e.forEach((m=>{const v=[];let b=0;const S=[];t.forEach((e=>{if(e.stageId===m.id){2===e.state&&b++,v.push(e.id);const t={};t[g.NavConstants.stage]=m.id,t[g.NavConstants.job]=e.id;const a=h.getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,t);S.push(s.createElement(c,{job:e,jobUrl:a,key:e.id,status:m.stateData}))}}));const x=this._getStageCardStatus(this.state.run.id,e.length,m.refName,m.state,m.result,v,b,m.stateData,m.checks,this.state.cancelledStages,(e=>{e&&(e.stopPropagation(),e.preventDefault()),this.props.onReviewStageClicked(m)}),(e=>{e&&(e.stopPropagation(),e.preventDefault()),this.props.onReviewManualValidationClicked(m)})),T=v.length,N=x.message;let E=x.expanded;const D=x.status;this.state.expanded.indexOf(m.id)>=0&&T>0?E=!0:(this.state.minimized.indexOf(m.id)>=0||0==T)&&(E=!1);const P={};P[g.NavConstants.stage]=m.id;const A=h.getBuildUrl(this.state.run.id,g.NavConstants.logs,void 0,void 0,P),L=this._getMetadataCount(m.refName);let M,B,V,O=72+28*L;L>1&&(a=!0);let U=this._allowRerunOnSingleStage?(0,Qe.getSanitizedStageName)(m):m.refName;const H=this._runningStages.indexOf(m.refName)>=0;if(1===m.state){const e=this._cancelledStages.indexOf(m.refName)>=0;M=[{text:Ve.Cancel,disabled:e,onClick:e=>{this._cancelStage(e,m.refName)},className:"update-stage"}]}else if(function(e){return 2===e.state&&6==e.result}(m))this._canQueueManualStage&&(M=[{text:Ve.RunStage,disabled:H&&this._disableRunStageButtonWhenClicked,onClick:e=>{this._runStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStage,U))},className:"update-stage"}]);else if(!this._allowRunningStagesOutOfOrder&&this._allowManualRunOnSkippedStage&&p(m,e))M=[{text:Ve.RunStage,disabled:!1,onClick:e=>{this._retryStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStage,U),!0,!0)},className:"update-stage"}];else if(function(e){return 2===e.state&&7!==e.result&&4!==e.result||R(e)}(m)){const t=this._getStageDependencyState(m,e),s=0!==t;if(1!==t)if(function(e){return 0===e.result||1===e.result}(m)&&E)s?B={buttonProps:{text:Ve.RerunSucceededWithoutDependents,disabled:H,className:"update-stage-split",onClick:e=>{this._retryStage(e,m.refName,Ve.RerunStage,(0,o.format)(Ve.ConfirmRerunStage,U),!1,!1)}},menuButtonProps:{contextualMenuProps:{menuProps:{id:"retry-stage-menu",items:[{id:"update-stage-button",text:Ve.RerunSucceededWithDependents}],onActivate:(e,t)=>{this._retryStage(t,m.refName,Ve.RerunStage,(0,o.format)(Ve.ConfirmRerunStageAndDependents,U))}}}}}:M=[{text:Ve.RerunSucceeded,disabled:H,onClick:e=>{this._retryStage(e,m.refName,Ve.RerunStage,(0,o.format)(Ve.ConfirmRerunStage,U))},className:"update-stage"}];else if(function(e){const t=e.checks?e.checks.filter((e=>56===e.status||8===e.status)).length:0;return 2===e.result&&t>0}(m)){const e=s?(0,o.format)(Ve.ConfirmRetryStageAndDependents,U):(0,o.format)(Ve.ConfirmRetryStage,U);M=[{text:Ve.RetryStage,disabled:H,onClick:t=>{this._retryStage(t,m.refName,Ve.RetryStage,e,!1,s)},className:"update-stage"}]}else if(function(e){return 2===e.result||3===e.result}(m)){const e=s?(0,o.format)(Ve.ConfirmRerunStageAndDependents,U):(0,o.format)(Ve.ConfirmRerunStage,U);M=[{text:Ve.RerunFromFailed,disabled:H,onClick:e=>{this._retryStage(e,m.refName,Ve.RerunStage,(0,o.format)(Ve.ConfirmRerunStageFailedJobs,U))},className:"update-stage"},{text:Ve.RerunAll,disabled:H,onClick:t=>{this._retryStage(t,m.refName,Ve.RerunStage,e,!0)},className:"update-stage-secondary"}]}else if(R(m)){const e=s?(0,o.format)(Ve.ConfirmRetryStageAndDependents,U):(0,o.format)(Ve.ConfirmRetryStage,U);M=[{text:Ve.RetryStage,disabled:H,onClick:t=>{this._retryStage(t,m.refName,Ve.RetryStage,e,!1,s)},className:"update-stage"}]}}else if(this._allowRunningSkippedStagesOutOfOrder&&this._allowRunningStagesOutOfOrder&&this._canManageStageRunOrder&&E&&function(e,t,s){var a,i;if(e.skip)return!1;const n=!!e.checks&&e.checks.filter((e=>2===e.status||1===e.status)).length>0;if(0==e.state&&((null===(a=null==e?void 0:e.stateData)||void 0===a?void 0:a.pendingChecks)||(null===(i=null==e?void 0:e.stateData)||void 0===i?void 0:i.pendingDependencies))&&!n)return!0;if(!(2!=e.state||4!=e.result&&7!=e.result||s&&function(e,t){const s=new Map,a=e=>{for(const i of t)if(!i.stateData.ignoreDependencies&&i.dependsOn&&-1!=i.dependsOn.indexOf(e.id)){if(s.has(i.id))return s.get(i.id);if(0===i.state||a(i))return s.set(i.id,!0),!0}return s.set(e.id,!1),!1};return a(e)}(e,t)))return!0;return!1}(m,e,this._validatePendingChildStageBeforeRunningOutOfOrder)){const t=!y(m,e);M=this._allowRunningSkippedStagesOutOfOrderByRetrying&&C(m)?[{text:Ve.RunStage,disabled:H&&this._disableRunStageButtonWhenClicked,onClick:e=>{this._retryStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStageOutOfOrder,U),!0,!0)},className:"update-stage"}]:[{text:Ve.RunStage,disabled:t||H&&this._disableRunStageButtonWhenClicked,onClick:e=>{this._runStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStageOutOfOrder,U))},className:"update-stage"}],t&&(V=Ve.RunStageDisabledTooltip)}else if(!this._allowRunningSkippedStagesOutOfOrder&&this._allowRunningStagesOutOfOrder&&this._canManageStageRunOrder&&E&&!m.stateData.ignoreDependencies&&!m.skip&&("pending"===x.status.type||p(m,e))){const t=!y(m,e);M=this._allowRunningSkippedStagesOutOfOrderByRetrying&&C(m)?[{text:Ve.RunStage,disabled:H&&this._disableRunStageButtonWhenClicked,onClick:e=>{this._retryStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStageOutOfOrder,U),!0,!0)},className:"update-stage"}]:[{text:Ve.RunStage,disabled:t||H&&this._disableRunStageButtonWhenClicked,onClick:e=>{this._runStage(e,m.refName,Ve.RunStageQuestion,(0,o.format)(Ve.ConfirmRunStageOutOfOrder,U))},className:"update-stage"}],t&&(V=Ve.RunStageDisabledTooltip)}let z=!0===m.stateData.ignoreDependencies?"dtc-canvas-path-dashed":void 0;m.stateData.ignoreDependencies&&(O+=28),void 0!==M?(O+=58*M.length,a=1===M.length):a=!0,void 0!==B&&(O+=58),this._enableNewStageCardHeightCalculation&&a&&""!==N.text&&(O+=15);let W=!1;this._enableStageGraphDependencyHighlighting&&(W=E);let J=!this._allowRerunOnSingleStage||!(0,Qe.isDefaultOrEmptyStageName)(m);n.push({data:m,key:m.id,edgeCssClassName:z,nodeHeightHint:E?O+4+32*S.length+8:O,nodeExpanded:W,getNodeElement:()=>{let e=(0,Qe.getSanitizedStageName)(m);const t=s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row stage-title-row flex-center"},s.createElement(k.Tooltip,{text:D.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},D.statusProps,{className:"stage-icon-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden flex-grow body-m stage-title"},s.createElement(k.Tooltip,{overflowOnly:!0,text:e},s.createElement("span",{className:"text-ellipsis"},e))),this._upcomingChangesPanelEnabled&&J?s.createElement("div",{className:"stageExpandButton"},s.createElement(l.Button,{subtle:!0,id:m.id+"changes",iconProps:{iconName:"BranchCommit"},ariaLabel:Ve.CommitsStageLabel,onClick:e=>{null==e||e.preventDefault(),this._telemetryService.publishEvent(Ue.Telemetry.Area,Ue.Telemetry.RunChangesPerStage,{stageId:m.id,runId:this.state.run.id,pipelineId:this.state.run.pipeline.id}),this._showUpcomingPanel(j.UpcomingChangesPanelTabId.Commits,m)},tabIndex:0})):s.createElement(s.Fragment,null),s.createElement("div",{className:"flex-self-end fontWeightNormal fontSize stageExpandButton"},T>0&&s.createElement(l.Button,{subtle:!0,id:m.id+"expand",iconProps:{iconName:"ChevronUnfold10"},ariaLabel:E?Ve.CollapseStage:Ve.ExpandStage,onClick:e=>{e&&e.preventDefault(),E?this._hideStageDetails(m.id):this._showStageDetails(m.id)}}),T<=0&&s.createElement("div",{className:"stageExpandButtonPlaceholder"}))),this._allowRunningStagesOutOfOrder&&!0===m.stateData.ignoreDependencies&&s.createElement("div",{className:"flex-row scroll-hidden flex-grow body-s"},s.createElement("span",{className:"text-ellipsis stage-warning-message"},"run out of order")),s.createElement("div",{className:"flex-row secondary-text body-s stage-progress-row"},s.createElement("div",{className:"flex-grow"},N.type===u.Plain&&s.createElement("span",null,N.text),N.type===u.Primary&&s.createElement(i,{text:N.text}),N.type===u.Error&&s.createElement("span",{className:"error-text"},N.text)),m.startTime&&s.createElement(I.Duration,{startDate:m.startTime,endDate:m.finishTime})),s.createElement("div",{className:(0,w.css)("flex-row body-s stage-info-row",0===L&&"hidden")},s.createElement("div",{className:"flex-grow"},x.metadata))),a=s.createElement(s.Fragment,null,S);let n=(0,o.format)(Ve.StageDescription,e,D.label,N.text);return m.startTime&&(n=(0,o.format)(Ve.StageDescriptionWithStartTime,e,D.label,N.text,F.tooltipString(m.startTime))),s.createElement(d,{id:m.id,ariaLabel:n,key:m.id+"zone",primaryContent:t,secondaryContent:E?a:void 0,onActivate:e=>{(0,_.onClickFPS)(this.context.pageContext,A,!0,e)},footerButtonProps:M,footerSplitButtonProps:B,tooltipText:V})}}),m.dependsOn&&m.dependsOn.forEach((e=>{r[e]||(r[e]={}),r[e][m.id]=!0}))}));const{isLeftCollapsed:m}=this.state;return this._showStagesTree?s.createElement("div",{className:"stage-graph-ff"},s.createElement("div",{className:"stage-graph-left"+(m?" collapsed":"")},s.createElement("button",{className:"collapse-btn",onClick:this._toggleLeftPanel,"aria-label":m?Ve.ExpandStagesPanel:Ve.CollapseStagesPanel},m?"»»":"««"),!m&&s.createElement(it.MiniStagesTree,{definitionId:this.state.run.pipeline.id,stages:this.state.run.stages.map((e=>({stageName:e.refName,displayName:(0,Qe.getSanitizedStageName)(e),stageId:e.id,groupName:e.group,order:e.order,id:e.id,state:e.state,result:e.result}))),onStageSelected:e=>this._scrollToStage(e)})),s.createElement("div",{className:"stage-graph-right"},s.createElement(st.GraphList,{nodes:n,edges:r,horizontalMargin:32,verticalMargin:32,nodeWidth:224,nodeHeight:72,leftMargin:32}))):s.createElement("div",{className:"stage-graph"},s.createElement(st.GraphList,{nodes:n,edges:r,horizontalMargin:32,verticalMargin:32,nodeWidth:224,nodeHeight:72,leftMargin:32}))}_scrollToStage(e){const t=document.getElementById(`${e.id}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((()=>{const e=t.closest(".stage-graph-right");if(!e)return;const s=t.getBoundingClientRect(),a=e.getBoundingClientRect(),i=s.left-a.left+e.scrollLeft,n=s.right-a.left+e.scrollLeft;i-16<e.scrollLeft?e.scrollTo({left:i-16,behavior:"smooth"}):n+16>e.scrollLeft+e.clientWidth&&e.scrollTo({left:n+16-e.clientWidth,behavior:"smooth"})}),50))}_showUpcomingPanel(e,t){this.context.pageContext.getService("IVssLayoutManager").renderCallout((a=>{const i={onDismiss:a,buildId:this.state.run.id,stageId:t.id,stageName:(0,Qe.getSanitizedStageName)(t),buildName:`#${this.state.run.number} - ${this.state.run.sourceVersionMessage}`,pipelineName:this.state.run.pipeline.name,selectedTabId:e};return s.createElement(j.UpcomingChangesPanel,i)}))}componentDidMount(){this._observable.subscribe(this._onObservableChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged)}_getMetadataCount(e){if(this._enableNewStageCardHeightCalculation){return((this._stageMetadataFlags[e]||0).toString(2).match(/1/g)||[]).length}{const t=this._stageMetadata[e]||{};return(t.hasTests?1:0)+(t.hasArtifacts?1:0)+(t.hasChecks?1:0)}}_getStageCardStatus(e,t,a,i,n,r,l,c,d,h,p,g){const _=r.length,b={text:"",type:u.Plain};let C=!1;1==t&&(C=!0);const f=s.createElement(at.TestStatus,{stageData:{buildId:e,stage:a},onData:e=>this._enableNewStageCardHeightCalculation?this._onData(e,a,1):this._onTestsData(e,a),recordState:i}),S=s.createElement($e.ArtifactStatus,{rundata:{buildId:e,jobIds:r},onData:e=>this._enableNewStageCardHeightCalculation?this._onData(e,a,2):this._onArtifactsData(e,a)});let y=null;if(h.length>0&&h.indexOf(a)>=0&&2!==i)b.text=Ve.Cancelling,C=!0;else{const e=(d=d||[]).filter((e=>(0,o.equals)(Ue.ManualValidationTaskTypeIdString,e.typeId,!0))).length,t=d.filter((e=>8===e.status&&!(0,o.equals)(Ue.ManualValidationTaskTypeIdString,e.typeId,!0))).length,r=d.filter((e=>(0,o.equals)(Ue.ManualValidationTaskTypeIdString,e.typeId,!0)&&8===e.status)).length;if(d.length>0&&(y=s.createElement("div",null,d.length-e>0&&s.createElement(Ye.CheckStatus,{checks:d,rejectedChecks:t,showIssues:this._showCheckIssues,onClick:p,onData:e=>this._enableNewStageCardHeightCalculation?this._onData(e,a,4):this._onChecksData(e,a)}),e>0&&s.createElement(Ye.ManualValidationStatus,{checks:d,rejectedManualValidations:r,onClick:g,onData:e=>this._enableNewStageCardHeightCalculation?this._onData(e,a,8):this._onChecksData(e,a)}))),0===i)b.text=Ve.NotStarted,(null==c?void 0:c.pendingChecks)&&(b.type=u.Primary,b.text=Ve.WaitingForApproval);else if(1===i)b.text=(0,o.format)(Ve.StageInProgress,l,_),C=!0;else if(2===i)switch(b.text=1===l?Ve.SingleJobCompleted:(0,o.format)(Ve.MultipleJobsCompleted,l),n){case 2:C=!0,b.text=t>0?"":Ve.Failed;break;case 1:C=!0;break;case 4:b.text=Ve.Skipped;break;case 3:b.text=Ve.Canceled;break;case 6:b.text=Ve.ManuallyQueued;break;case 7:b.text=Ve.DependentOnManualQueue}}return{message:b,expanded:C,status:(0,v.getTimelineStatusIndicatorData)(i,n,null==c?void 0:c.pendingChecks,!(null==c?void 0:c.pendingDependencies)),metadata:s.createElement(m,null,f,S,y)}}}function c(e){const t=(0,v.getTimelineStatusIndicatorData)(e.job.state,e.job.result,e.status.pendingChecks,!e.status.pendingDependencies);return s.createElement(a.FPSLink,{className:"job-row can-activate-item flex-row fontSize",key:e.job.id,href:e.jobUrl},s.createElement(k.Tooltip,{text:t.label},s.createElement("span",{className:"flex-row"},s.createElement(f.Status,Object.assign({},t.statusProps,{className:"icon-large-margin",size:"16"})))),s.createElement("div",{className:"flex-row scroll-hidden flex-grow"},s.createElement(k.Tooltip,{overflowOnly:!0,text:e.job.name},s.createElement("span",{className:"text-ellipsis"},e.job.name))),e.job.startTime&&s.createElement(I.Duration,{className:"secondary-text",startDate:e.job.startTime,endDate:e.job.finishTime}))}function d(e){const t=t=>{t&&!t.defaultPrevented&&e.onActivate(t)},a=t=>{t&&!t.defaultPrevented&&13===t.which&&e.onActivate(t)};return s.createElement(V.FocusZone,{key:e.id,direction:2,focusGroupProps:{defaultElementId:e.id}},s.createElement("div",null,s.createElement(B.FocusGroupContext.Consumer,null,(i=>s.createElement(V.FocusZoneContext.Consumer,null,(n=>{var r;return s.createElement("div",{className:(0,w.css)("stage-card flex-column cursor-pointer",e.secondaryContent&&"stage-card-expanded"),role:"link","aria-label":e.ariaLabel,"data-focuszone":n.focuszoneId,tabIndex:i.focusedElementId===e.id?0:-1,id:e.id,onFocus:()=>i.onFocus(e.id),onClick:t,onKeyPress:a},s.createElement("div",{className:"stage-card-primary"},e.primaryContent),e.secondaryContent&&s.createElement("div",{className:"stage-card-secondary"},e.secondaryContent),e.footerButtonProps&&s.createElement("div",{className:"stage-card-footer"},e.footerButtonProps.map(((t,a)=>s.createElement(k.Tooltip,{text:e.tooltipText},s.createElement("span",{className:"flex-row"},s.createElement(l.Button,Object.assign({key:"stage-card-cancel-button-"+e.id+"-"+a},t))))))),e.footerSplitButtonProps&&s.createElement("div",{className:"stage-card-footer"},s.createElement(O.SplitButton,{buttonProps:null===(r=e.footerSplitButtonProps)||void 0===r?void 0:r.buttonProps,menuButtonProps:e.footerSplitButtonProps.menuButtonProps})))}))))))}var u,h;function m(e){return s.createElement("div",{className:"flex-column"},e.children)}function p(e,t){var s;if(e.skip)return!1;if(!(null==e?void 0:e.dependsOn))return!1;if(2!=e.state||4!=e.result)return!1;if(null===(s=e.dependsOn)||void 0===s?void 0:s.some(((e,s,a)=>{let i=t.find(((t,s,a)=>t.id===e));return 4===(null==i?void 0:i.result)&&2===(null==i?void 0:i.state)})))return!1;var a=S(e,t);return!!(null==a?void 0:a.some(((e,s,a)=>{let i=t.find(((t,s,a)=>t.id===e.id));return 2===(null==i?void 0:i.result)&&2===(null==i?void 0:i.state)})))}function C(e){return 2==e.state&&4==e.result}function S(e,t){var s;let a=[];if((null===(s=e.dependsOn)||void 0===s?void 0:s.length)>0)for(var i=[...e.dependsOn];i.length>0;){var n=i.pop();if(!a.find((e=>e.id==n))){var r=t.find((e=>e.id==n));r&&(a.push(r),i=[...i,...r.dependsOn||[]])}}return a}function y(e,t){let s=new Set(S(e,t).map((e=>e.id)));for(let e of t)if(s.has(e.id)&&(!e.isSkippable&&2!==e.state||!e.isSkippable&&2===e.state&&0!==e.result&&1!==e.result))return!1;return!0}function R(e){const t=e.checks||[];return 4===e.result&&t.filter((e=>32===e.status)).length>0}t[e].StageGraph=r,function(e){e[e.Plain=0]="Plain",e[e.Primary=1]="Primary",e[e.Error=2]="Error"}(u||(u={})),function(e){e[e.None=0]="None",e[e.FailedJobs=1]="FailedJobs",e[e.AllJobs=2]="AllJobs"}(h||(h={}))}("ComponentsStageGraph"),function(e){var a;rt=t[e]={},function(e){e.Jobs="jobs",e.Stages="stages"}(a||(a={}));class i extends n.VssComponent{constructor(e,t){super(e,t),this._tabExplicitlyChanged=!1,this._onTabChanged=e=>{this._tabExplicitlyChanged=!0,this._selectedTabId.value=e};const s=this.context.pageContext.getService("IRunDetailsService");this._run=s.data.value,this._selectedTabId=new u.ObservableValue(a.Stages),this._allowRerunOnSingleStage=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.AllowRerunOnSingleStage",!1)}render(){const e=this._run;if(0===e.stages.length&&0===e.jobs.length)return null;let t=1===e.stages.length;return this._allowRerunOnSingleStage&&(t=!e.pipeline.isYamlPipeline),t?s.createElement(C.Card,{className:"flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1},titleProps:{text:Ve.JobsTitle,size:0}},s.createElement(Ke.JobsTable,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked})):s.createElement(C.Card,{className:"flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1}},s.createElement(S.Surface,{background:0},s.createElement(c.Observer,{selectedTab:this._selectedTabId},(e=>s.createElement(U.ScreenSizeObserver,null,(t=>{const i=this._tabExplicitlyChanged?e.selectedTab:0===t.screenSize?a.Jobs:a.Stages;return s.createElement("div",{className:(0,w.css)("jobs-card-page flex-column",i===a.Stages?"h-scroll-auto":"h-scroll-hidden")},s.createElement(y.TabProvider,{selectedTabId:i,providers:new u.ObservableArray([])},s.createElement(y.TabBar,{onSelectedTabChanged:this._onTabChanged,disableSticky:!0,tabSize:"large-link"},s.createElement(y.Tab,{id:a.Stages,key:a.Stages,name:Ve.StagesTitle}),s.createElement(y.Tab,{id:a.Jobs,key:a.Jobs,name:Ve.JobsTitle})),s.createElement("div",{className:"jobs-card-content margin-top-16"},s.createElement(y.TabContent,null,i===a.Jobs&&s.createElement(Ke.JobsTable,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked}),i===a.Stages&&s.createElement(nt.StageGraph,{onReviewStageClicked:this.props.onReviewStageClicked,onReviewManualValidationClicked:this.props.onReviewManualValidationClicked})))))}))))))}}t[e].JobsCard=i}("ComponentsJobsCard"),function(e){ot=t[e]={},t[e].NoData=function(){return s.createElement(H.Page,{className:"run-no-data"},s.createElement(d.MessageCard,{severity:"Error"},Ve.NoBuildData))}}("ComponentsNoData"),function(e){t[e]={};class s extends T.VssService{get data(){return this._consumedArtifactsData}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e)}_initialize(){this._contributionService=this.pageContext.getService("IVssContributionService");const e=this._contributionService.getData("ms.vss-build-web.run-consumed-artifacts-data-provider");e&&(this._consumedArtifactsData=new u.ObservableValue(e))}}t[e].ConsumedArtifactsService=s,t[e].getConsumedArtifactsService=function(e){return e.getService("ConsumedArtifactsService")},T.Services.add("ConsumedArtifactsService",{serviceFactory:s})}("ConsumedArtifactsService"),function(e){lt=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this.tempSpan=null,this.getTextWidth=e=>{if(!this.spanRef.current||!e)return 0;try{this.tempSpan||(this.tempSpan=document.createElement("span"),this.tempSpan.style.visibility="hidden",this.tempSpan.style.position="absolute",this.tempSpan.style.whiteSpace="nowrap",document.body.appendChild(this.tempSpan));const t=getComputedStyle(this.spanRef.current);this.tempSpan.style.font=t.font||"",this.tempSpan.style.fontSize=t.fontSize||"14px",this.tempSpan.style.fontFamily=t.fontFamily||"inherit",this.tempSpan.style.fontWeight=t.fontWeight||"normal",this.tempSpan.textContent=e;return this.tempSpan.offsetWidth}catch(t){return console.warn("Failed to measure text width:",t),8*e.length}},this.updateMaxLength=()=>{var e;if(!this.spanRef.current||!this.props.linkText)return;const t=this.spanRef.current.parentElement;if(!t)return;const s=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement,a=s?s.offsetWidth:200,i=t.querySelector(".pipelines-icon-right-margin"),n=a-(i?i.offsetWidth:0)-20;if(n<=0)return;const r=this.getTextWidth(this.props.linkText);if(r<=n){const e=this.props.linkText.length;return void(e!==this.state.dynamicMaxLength&&this.setState({dynamicMaxLength:e}))}if(0===this.props.linkText.length)return;const o=r/this.props.linkText.length,l=Math.floor(n/o);l!==this.state.dynamicMaxLength&&l>0&&this.setState({dynamicMaxLength:Math.max(1,l-3)})},this.getLinkUrl=()=>{var e;if(!(null===(e=this.context)||void 0===e?void 0:e.pageContext))return"#";const t=this.context.pageContext.getService("IBuildLinkingService");if(!t)return"#";const s=Number(this.props.runId);return isNaN(s)?"#":t.getBuildUrl(s,"",this.props.projectId||void 0,void 0,{pathAsName:"false"})},this.renderLink=()=>{const e=this.getLinkUrl();let t=this.props.linkText;const i=this.state.dynamicMaxLength,n=this.truncateTextEnd(t,i),o="flex-row flex-baseline primary-text"+(this.props.className?" "+this.props.className:"");return s.createElement(a.FPSLink,{className:o,href:e,subtle:!0,telemetrySource:this.props.c_TelemetrySource,removeUnderline:!0},s.createElement(r.Icon,{iconName:"Rocket",className:"pipelines-icon-right-margin"}),s.createElement("span",{ref:this.spanRef,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"100%",textAlign:"right"},title:t},n))},this.spanRef=s.createRef(),this.state={dynamicMaxLength:32}}componentDidMount(){this.updateMaxLength(),window.addEventListener("resize",this.updateMaxLength)}componentWillUnmount(){window.removeEventListener("resize",this.updateMaxLength),this.tempSpan&&this.tempSpan.parentNode&&(this.tempSpan.parentNode.removeChild(this.tempSpan),this.tempSpan=null)}render(){return s.createElement(c.Observer,null,(()=>this.renderLink()))}truncateTextEnd(e="",t){return e.length<=t?e:"..."+e.slice(e.length-t)}}t[e].PipelineRunLink=i}("ComponentsPipelineRunLink"),function(e){ct=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this.getLinkUrl=()=>this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.run.id,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),this.renderLink=e=>{if(e&&(e.publishedArtifactsCount>0||e.consumedArtifactsCount>0)){const t=this.getLinkUrl();let i="";i=e.publishedArtifactsCount>0&&e.consumedArtifactsCount>0?(0,o.localeFormat)(Ve.ArtifactsFormat,e.publishedArtifactsCount,e.consumedArtifactsCount):e.publishedArtifactsCount>0?(0,o.localeFormat)(Ve.ArtifactsPublishedFormat,e.publishedArtifactsCount):(0,o.localeFormat)(Ve.ArtifactsConsumedFormat,e.consumedArtifactsCount);const n="flex-row flex-baseline primary-text";return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,className:n,href:t,subtle:!0,telemetrySource:"RunSummary",telemetryProperties:{clickedOn:"RunViewArtifacts"},removeUnderline:!0},s.createElement(r.Icon,{iconName:"Package",className:"pipelines-icon-right-margin"}),s.createElement("span",{style:{whiteSpace:"nowrap"}}," ",i," "))}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link"},s.createElement(r.Icon,{iconName:"Package",className:"pipelines-icon-right-margin"}),(0,o.localeFormat)(Ve.ArtifactsCount,"0"))}}render(){return s.createElement(c.Observer,{artifacts:this.props.artifactsData},(e=>this.renderLink(e.artifacts)))}}t[e].ArtifactsLink=i}("ComponentsArtifactsLink"),function(e){dt=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this.getLinkUrl=()=>this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(this.props.runId,g.NavConstants.artifacts,this.props.projectId||void 0,void 0,{pathAsName:"false"}),this.renderLink=()=>{const e=this.getLinkUrl();return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,className:"flex-row flex-baseline primary-text",href:e,subtle:!0,telemetrySource:this.props.c_TelemetrySource,removeUnderline:!0},s.createElement(r.Icon,{iconName:"Package",className:"pipelines-icon-right-margin"}),s.createElement("span",{style:{whiteSpace:"nowrap"},title:this.props.linkText}," ",this.props.linkText," "))}}render(){return s.createElement(c.Observer,null,(()=>this.renderLink()))}}t[e].PublishedArtifactsLink=i}("ComponentsPublishedArtifactsLink"),function(e){ut=t[e]={};class i extends s.PureComponent{constructor(e,t){super(e,t),this._renderRow=(e,t,a)=>{const i=this.props.changeLinks[e];return s.createElement(z.ListItem,{key:"list-item"+e,index:e,details:a},this._getChangeElement(t,i?i.commitLink:""))},this._getPrimaryElement=(e,t)=>s.createElement(l,{change:e,repositoryName:this.props.repositoryName,sourceProvider:this.props.sourceProvider,textToDisplay:e.message||e.id,ariaDescribedBy:"build-commit-desc",changeLink:t}),this._itemProvider=new W.ArrayItemProvider(this.props.changes)}render(){return s.createElement(m.Panel,{className:"changes-panel",description:(0,o.format)(Ve.CommitsFormat,this._itemProvider.length),escDismiss:!0,onDismiss:this.props.onDismiss,titleProps:{text:Ve.AssociatedChanges}},s.createElement(z.ScrollableList,{itemProvider:this._itemProvider,outerClassName:"custom-scrollbar flex-column",renderRow:this._renderRow,width:"100%"}))}_getChangeElement(e,t){const a=e.author;let i="",l="";a&&(i=(0,J.getAvatarUrl)(a),l=a.id,l||(l=a.uniqueName)),!i&&a&&(i=(0,G.getIdentityImageUrl)(this.context.pageContext,a));const c=e.id;let d="BranchCommit";this.props.sourceProvider&&(d=this.props.sourceProvider.getCommitIconName());const u=a?a.displayName:"";return s.createElement("div",{className:"changes-row flex-center flex-row"},s.createElement(n,{id:l,imageUrl:i,displayName:u,getPrimaryElement:this._getPrimaryElement,data:e,changeLink:t},s.createElement("span",{id:"build-commit-desc"},s.createElement("span",null,(0,o.format)(Ve.AuthoredFormat,u)," ",s.createElement(r.Icon,{iconName:d})," ",c," "),e.timestamp&&s.createElement(Y.Ago,{date:e.timestamp,format:0}))))}}t[e].ChangesPanel=i;class n extends s.PureComponent{render(){const e=this.props.sizeClassName?this.props.sizeClassName:"medium";let t=this.props.imageUrl;return!t&&this.props.id&&(t=(0,G.getIdentityImageUrl)(this.context.pageContext,this.props.id)),s.createElement("div",{className:"flex-grow flex-row rhythm-horizontal-8"},s.createElement(q.BuildPersona,{size:e,displayName:this.props.displayName,imageUrl:t}),s.createElement("div",{className:"flex-column justify-center margin-left-4"},s.createElement("span",{className:"primary-row primary-text"},s.createElement("div",{className:"message"},this.props.getPrimaryElement(this.props.data,this.props.changeLink)),s.createElement("span",null)),s.createElement("span",{className:"font-size padding-left-4 secondary-text"},this.props.children)))}}class l extends s.PureComponent{constructor(e){super(e)}render(){const e=this.props.textToDisplay;return this.props.change.location?s.createElement(a.FPSLink,{ariaDescribedBy:this.props.ariaDescribedBy,className:"bolt-table-link bolt-table-inline-link",href:this.props.changeLink,telemetrySource:"build-changes-panel"},e):s.createElement("span",null,e)}}}("ComponentsChangesPanel"),function(e){ht=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this._updateChanges=e=>{const t=256===this.props.reason;let s=0;e.changes&&(s=e.changes.length,s>1&&!t&&!e.previousSourceVersion&&!this._isTfvc&&(s-=1)),this.setState({changes:e.changes,changeDisplayCount:s}),e.changes&&this._sourceProvider&&(t?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((e=>this.trackPromise(this._sourceProvider.fetchPRCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,branchName:this.props.branch,repositoryUrl:this.props.repositoryUrl,links:{}},e||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):1===s?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{this._isTfvc?this.fetchTfvcChangesetLinks(t):this.trackPromise(this._sourceProvider.fetchCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,commitId:e.changes[0].id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))})):s>1&&this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{if(this._isTfvc)this.fetchTfvcChangesetLinks(t);else{const s=e.changes[e.changes.length-1],a=e.changes[0];this.trackPromise(this._sourceProvider.fetchCommitDiffLink({repositoryName:this.props.repositoryName||this.props.repositoryId,baseCommitId:e.previousSourceVersion||s.id,targetCommitId:a.id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))}})))},this._onActivateChangesPanel=()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const t={changes:this.state.changes,changeLinks:this.state.changeLinks,onDismiss:e,repositoryName:this.props.repositoryName,repositoryType:this.props.sourceType,sourceProvider:this._sourceProvider};return s.createElement(ut.ChangesPanel,t)}))},this.state={changes:this.props.associatedChangesData.value.changes,changeLinks:[],diffLink:"",changeDisplayCount:0};const a=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=a.getSourceProvider(e.sourceType||""),this._changeIconName=this._sourceProvider?this._sourceProvider.getCommitIconName():"",this._isTfvc=this._sourceProvider.getKey()===Q.RepositoryTypes.TfsVersionControl}render(){const e=this.state.changeDisplayCount;if(e){const t=1==e?Ve.OneChange:(0,o.format)(Ve.ChangesFormat,e),a="text-ellipsis flex-row flex-baseline ";if(this._isTfvc)return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,onClick:this._onActivateChangesPanel},t);if(this.state.diffLink){const t=1==e?Ve.ViewChange:(0,o.format)(Ve.ViewChanges,e);return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,href:this.state.diffLink},t)}return s.createElement(l.Button,{ariaDescribedBy:this.props.linkDescribedBy,className:a,disabled:!0,subtle:!0},t)}return null}componentDidMount(){super.componentDidMount(),this.props.associatedChangesData.subscribe(this._updateChanges),this._updateChanges(this.props.associatedChangesData.value)}componentWillUnmount(){super.componentWillUnmount(),this.props.associatedChangesData.unsubscribe(this._updateChanges)}async fetchTfvcChangesetLinks(e){this._sourceProvider.fetchLinks(this.state.changes.map((t=>({branchName:this.props.branch,repositoryName:this.props.repositoryName||this.props.repositoryId,repositoryUrl:this.props.repositoryUrl,commitId:t.id,displayUri:t.displayUri||"",projectName:e||void 0})))).then((e=>{e&&this.setState({changeLinks:e})}))}}t[e].ChangesLink=i;class r extends n.VssComponent{constructor(e,t){super(e,t),this._updateChanges=e=>{const t=256===this.props.reason;let s=0;e.changes&&(s=e.changes.length,s>1&&!t&&!e.previousSourceVersion&&(s-=1)),this.setState({changes:e.changes,changeDisplayCount:s}),e.changes&&this._sourceProvider&&(t?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((e=>this.trackPromise(this._sourceProvider.fetchPRCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,branchName:this.props.branch,repositoryUrl:"",links:{}},e||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):1===s?this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>this.trackPromise(this._sourceProvider.fetchCommitLink({repositoryName:this.props.repositoryName||this.props.repositoryId,commitId:e.changes[0].id,displayUri:""},t||void 0)).promise)).then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)})):s>1&&this.trackPromise(this._sourceProvider.getProjectName(this.props.repositoryId)).promise.then((t=>{const s=e.changes[e.changes.length-1],a=e.changes[0];this.trackPromise(this._sourceProvider.fetchCommitDiffLink({repositoryName:this.props.repositoryName||this.props.repositoryId,baseCommitId:e.previousSourceVersion||s.id,targetCommitId:a.id,displayUri:""},t||void 0)).promise.then((e=>{this.setState({diffLink:e})}),(e=>{e.isCanceled||console.log(e)}))})))},this.state={changes:this.props.associatedChangesData.value.changes,changeLinks:[],diffLink:"",changeDisplayCount:0};const s=this.context.pageContext.getService("ISourceProviderService");this._sourceProvider=s.getSourceProvider(e.sourceType||"")}render(){const e=this.state.changeDisplayCount;if(e){const t=1==e?Ve.SourceCardCommitLabel:(0,o.format)(Ve.SourceCardCommitsLabel,e),i="text-ellipsis flex-row flex-baseline ";return s.createElement(a.FPSLink,{className:i,href:this.state.diffLink,subtle:!0},s.createElement("span",{className:"text-ellipsis "},t))}return s.createElement(K.Spinner,{size:"xsmall"})}componentDidMount(){super.componentDidMount(),this.props.associatedChangesData.subscribe(this._updateChanges),this._updateChanges(this.props.associatedChangesData.value)}componentWillUnmount(){super.componentWillUnmount(),this.props.associatedChangesData.unsubscribe(this._updateChanges)}}t[e].SubtleChangesLink=r}("ComponentsChangesLink"),function(e){mt=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("IRunDetailsService");this._coverageResult=s.codeCoverageResults,this._testsRunResult=s.testRunResults}render(){return s.createElement(c.Observer,{coverageResult:this._coverageResult,testResults:this._testsRunResult},(e=>{if(e.testResults.testsCount<1)return s.createElement("span",{className:"empty-summary-row"}," ");if(e.coverageResult&&e.coverageResult.coverage){let t=(0,o.format)(Ve.CoverageFormat,e.coverageResult.coverage),i=this.props.coverageTabUrl,n=s.createElement(r.Icon,{iconName:"StackedBarChart",className:"icon-margin"}),l="text-ellipsis flex-row flex-baseline",c=!0;return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:i,className:l,subtle:c},s.createElement("span",{className:"text-ellipsis"},n,t))}return s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:"https://docs.microsoft.com/en-us/azure/devops/pipelines/test/review-code-coverage-results?view=azure-devops",className:"text-ellipsis flex-row flex-baseline pipeline-link"},s.createElement("span",{className:"text-ellipsis"},Ve.SetupCoverage))}))}}t[e].CoverageResultsLink=i}("ComponentsCoverageResultsLink"),function(e){pt=t[e]={};const i="https://go.microsoft.com/fwlink/?linkid=2086578";class l extends n.VssComponent{constructor(e,t){super(e,t);const s=this.context.pageContext.getService("IRunDetailsService");this._testsRunResult=s.testRunResults}render(){return s.createElement(c.Observer,{testsResult:this._testsRunResult},(e=>{if(e.testsResult.testsCount>-1){let t=(0,o.format)(Ve.TestResultsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(e.testsResult.testsPassRate,1)),n=this.props.testsTabUrl,l=s.createElement(r.Icon,{iconName:"Completed",className:"icon-margin"}),c=!0,d="text-ellipsis flex-row flex-baseline";return 0===e.testsResult.testsCount&&(-2===e.testsResult.testsPassRate?t=Ve.EmptyTestTabText:(t=Ve.GetStarted,n=i,l=s.createElement(r.Icon,{iconName:"TestBeaker",className:"icon-margin"}),c=!1,d+=" pipeline-link")),s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:n,className:d,subtle:c,removeUnderline:!0},s.createElement("span",{className:"text-ellipsis"},l,t))}return s.createElement(a.FPSLink,{ariaDescribedBy:"Get started with tests",href:i,className:"text-ellipsis flex-row flex-baseline pipeline-link",removeUnderline:!0},s.createElement("span",{className:"text-ellipsis"},s.createElement(r.Icon,{iconName:"TestBeaker",className:"icon-margin"}),Ve.GetStarted))}))}}t[e].TestResultsLink=l}("ComponentsTestResultsLink"),function(e){gt=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this._projectId="",this._createWiql=e=>{let t="";return(e||[]).forEach((e=>{""!==t&&(t+="or "),t+="System.Id = "+e.id+" "})),"SELECT System.Id, System.WorkItemType, System.Title, System.State, System.AssignedTo, System.CreatedDate, Microsoft.VSTS.Common.Priority, System.AreaPath FROM WorkItems where "+t};const s=t.pageContext.getService("ITfsPageService").getData();s&&s.project&&(this._projectId=s.project.id),this._linkService=t.pageContext.getService("IBuildLinkingService")}render(){const e=this.props.sourceType.toLocaleLowerCase(),t=e===Q.RepositoryTypes.TfsGit.toLocaleLowerCase()||e===Q.RepositoryTypes.TfsVersionControl.toLocaleLowerCase();return s.createElement(c.Observer,{associatedChanges:this.props.associatedChangesData},(e=>{const i=e.associatedChanges.workItems,n=t?this._linkService.getWorkItemQueryUrl(this._createWiql(i),this._projectId):"";if(i&&i.length>0){const e=(0,o.format)(Ve.WorkItemsFormat,i.length.toString());let l="text-ellipsis flex-row flex-baseline";return t?s.createElement(a.FPSLink,{ariaDescribedBy:this.props.linkDescribedBy,href:n,className:l,subtle:!0},s.createElement("span",{className:"text-ellipsis"},!1!==this.props.showIcon&&s.createElement(r.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),e)):(l+=" pipelines-icon-left-margin",s.createElement("div",{className:l},s.createElement("span",{className:"text-ellipsis"},!1!==this.props.showIcon&&s.createElement(r.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),e)))}return s.createElement("span",{className:"text-ellipsis secondary-text summary-line-non-link"},!1!==this.props.showIcon&&s.createElement(r.Icon,{iconName:"WorkItem",className:"pipelines-icon-right-margin"}),!1!==this.props.showIcon&&(0,o.format)(Ve.WorkItemsFormat,"0"),!1===this.props.showIcon&&s.createElement("span",{className:"secondary-text"},Ve.None))}))}}t[e].WorkItemsLink=i}("ComponentsWorkItemsLink"),function(e){_t=t[e]={};class i extends n.VssComponent{constructor(e,t){super(e,t),this.getLinkUrl=()=>this.context.pageContext.getService("IBuildLinkingService").getDefinitionUrl(Number(this.props.definitionId),"",this.props.projectId||void 0,void 0),this.renderLink=()=>{const e=this.getLinkUrl();let t=this.props.linkText;return s.createElement(a.FPSLink,{className:"flex-row flex-baseline primary-text",href:e,subtle:!0,telemetrySource:this.props.c_TelemetrySource,removeUnderline:!0},s.createElement("span",{style:{whiteSpace:"nowrap"},title:t}," ",t," "))}}render(){return s.createElement(c.Observer,null,(()=>this.renderLink()))}}t[e].PipelineDefinitionLink=i}("ComponentsPipelineDefinitionLink"),function(e){var a;vt=t[e]={},function(e){e.consumedPipelineArtifacts="consumedPipelineArtifacts",e.Repositories="Repositories"}(a||(a={}));class i extends n.VssComponent{constructor(e,t){super(e,t),this._onTabChanged=e=>{this._selectedTabId.value=e},this._onObservableArtifactChanged=e=>{this.setState({artifactsData:e})},this._onObservableRunChanged=e=>{this.setState({runData:e})},this._getPipelineArtifactsColumns=()=>this._pipelineArtifactsColumns,this._getRepositoriesColumns=()=>this._repositoriesColumns,this._showMenuForPipelineItem=e=>!1,this._getMenuForPipelineItem=e=>({id:"artifacts-menu",items:[]}),this._showMenuForRepositoryItem=e=>!1,this._getMenuForRepositoryItem=e=>({id:"repository-menu",items:[]}),this._setColumns=()=>{this._pipelineArtifactsColumns=[{id:"resource-name",width:-30,name:Ve.ResourceName,className:"pipelines-cell",renderCell:this._renderResourceNameColumn,columnStyle:2,onSize:this._onSizeArtifact},{id:"pipeline-run",width:-30,name:Ve.PipelineRun,className:"pipelines-cell",renderCell:this._renderPipelineRunColumn,columnStyle:2,onSize:this._onSizeArtifact},{id:"artifacts-published",width:-20,name:Ve.ArtifactsPublished,className:"pipelines-cell",renderCell:this._renderArtifactsPublishedColumn,columnStyle:2,onSize:this._onSizeArtifact},new p.ColumnMore(this._getMenuForPipelineItem,this._showMenuForPipelineItem)],this._repositoriesColumns=[{id:"resource-name",width:-30,name:Ve.ResourceName,className:"pipelines-resourcecard-repositorynamecolumn",renderCell:this._renderRepositoryNameColumn,columnStyle:2,onSize:this._onSizeRepository},{id:"repository",width:-30,name:Ve.Repository,className:"pipelines-resourcecard-repositorycolumn",renderCell:this._renderRepositoryColumn,onSize:this._onSizeRepository},{id:"branch-tag",width:-30,name:Ve.BranchTag,className:"pipelines-resourcecard-versioncolumn",renderCell:this._renderBranchTagColumn,columnStyle:2,onSize:this._onSizeRepository},{id:"version",width:-20,name:Ve.Version,className:"pipelines-resourcecard-changescolumn",renderCell:this._renderVersionColumn,columnStyle:2,onSize:this._onSizeRepository},{id:"related",width:-20,name:Ve.Related,className:"pipelines-resourcecard-relatedcolumn",renderCell:this._renderRelatedColumn,columnStyle:2,onSize:this._onSizeRepository},new p.ColumnMore(this._getMenuForRepositoryItem,this._showMenuForRepositoryItem)]},this._renderRepositoryNameColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t},s.createElement("div",null,"__designer_repo"===i.alias?"self":i.alias)),this._renderRepositoryColumn=(e,t,a,i)=>{const n=i.name,r=i.type;return s.createElement(p.TwoLineTableCell,{className:"resources-card-table-cell",key:"col-"+t,columnIndex:t,tableColumn:a,line1:s.createElement("span",{className:"flex-row scroll-hidden resourcecard-repositorylink"},s.createElement(k.Tooltip,{text:n,overflowOnly:!0},s.createElement($.RepoLink,{sourceRepositoryId:i.id,sourceRepositoryName:i.name,sourceRepositoryType:i.type,sourceRepositoryUrl:i.url,includeIcon:!1}))),line2:s.createElement(k.Tooltip,{text:r,overflowOnly:!0},s.createElement("span",{className:"fontSize secondary-text resources-card-repotype flex-row flex-center text-ellipsis"},s.createElement("span",{className:"text-ellipsis",key:"release-type-text"},l(r))))})},this._renderBranchTagColumn=(e,t,a,i)=>{const n=this._getRepositoryUrl(i,i.connectionId);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"resources-card-table-cell fontSizeM scroll-hidden"},s.createElement(Z.BranchLink,{excludeTabStop:!1,repositoryType:i.type,repositoryName:i.name,repositoryId:i.id,repositoryUrl:n,branch:i.refName,monospace:!1}))},this._renderVersionColumn=(e,t,a,i)=>{const n=this._getRepositoryUrl(i,void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"resources-card-table-cell fontSizeM scroll-hidden"},s.createElement(ee.CommitLink,{excludeTabStop:!1,repositoryName:i.name,repositoryId:i.id,repositoryType:i.type,repositoryUrl:n,commitId:i.version,monospace:!1,showIcon:!1}))},this._renderRelatedColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM size-m scroll-hidden"},s.createElement(r,{repository:i,associatedChanges:this._runDetailsService.associatedChanges})),this._renderResourceNameColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"resources-card-table-cell fontSizeM scroll-hidden"},s.createElement("div",{className:"link-wrapper"},s.createElement(_t.PipelineDefinitionLink,{linkText:i.artifactName,definitionId:i.properties&&i.properties.definitionId?Number(i.properties.definitionId):void 0,projectId:i.properties&&i.properties.projectId?i.properties.projectId:void 0,c_TelemetrySource:"ResourcesCard"}))),this._renderPipelineRunColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"resources-card-table-cell fontSizeM scroll-hidden"},s.createElement(lt.PipelineRunLink,{linkText:i.publisherPipelineName,runId:i.version,projectId:i.properties&&i.properties.projectId?i.properties.projectId:void 0,c_TelemetrySource:"ResourcesCard"})),this._renderArtifactsPublishedColumn=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"resources-card-table-cell fontSizeM scroll-hidden"},s.createElement(dt.PublishedArtifactsLink,{runId:Number(i.version),projectId:i.properties&&i.properties.projectId?i.properties.projectId:void 0,linkText:i.numberOfPublishedArtifacts,linkDescribedBy:"artifacts-label",c_TelemetrySource:"ResourcesCard"})),this._runDetailsService=this.context.pageContext.getService("IRunDetailsService"),this._observableRun=this._runDetailsService.data,this._consumedArtifactsService=this.context.pageContext.getService("ConsumedArtifactsService"),this._observableArtifact=this._consumedArtifactsService.data,this._isPipelinesProximaEnabled=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.GitHubProximaInstallationFlowEnabled",!1),this._selectedTabId=new u.ObservableValue(a.consumedPipelineArtifacts),this._setColumns(),this.state={selectedTab:a.consumedPipelineArtifacts,artifactsData:this._consumedArtifactsService.data.value,runData:this._runDetailsService.data.value}}componentDidMount(){this._observableArtifact.subscribe(this._onObservableArtifactChanged),this._observableRun.subscribe(this._onObservableRunChanged)}componentWillUnmount(){this._observableArtifact.unsubscribe(this._onObservableArtifactChanged),this._observableRun.unsubscribe(this._onObservableRunChanged)}_getRepositoryUrl(e,t){return this._isPipelinesProximaEnabled&&(0,o.equals)(e.type,Q.RepositoryTypes.GitHub,!0)&&(0,te.isProximaRepository)(this.context.pageContext,{repositoryName:e.name,repositoryUrl:e.url})?e.url:t}getPipelineArtifactsItemProvider(e){const t=e.map((e=>e.consumedArtifacts&&e.consumedArtifacts.length>0?{artifactName:e.alias,publisherPipelineName:e.alias+"/"+e.versionName,numberOfPublishedArtifacts:e.consumedArtifacts.length.toString(),version:e.versionId,properties:e.properties||{}}:{artifactName:"N/A",publisherPipelineName:"N/A",numberOfPublishedArtifacts:"0",version:"N/A",properties:{}}));return new u.ObservableArray(t)}_onSizeArtifact(e,t,s,a){a.width.value=s}_onSizeRepository(e,t,s,a){a.width.value=s}render(){if(this.state.artifactsData&&this.state.artifactsData.consumedSources){const e=this.state.artifactsData.consumedSources.filter((e=>"Pipeline"===e.artifactCategory)),t=this.state.artifactsData.consumedSources.filter((e=>"Repository"===e.artifactCategory));if(e.length>0||t.length>0)return this._selectedTabId=e.length>0?new u.ObservableValue(a.consumedPipelineArtifacts):new u.ObservableValue(a.Repositories),s.createElement(C.Card,{className:"resources-card flex-grow bolt-table-card margin-top-16"},s.createElement(S.Surface,{background:0},s.createElement(c.Observer,{selectedTab:this._selectedTabId,runData:this.state.runData},(i=>s.createElement(y.TabProvider,{selectedTabId:i.selectedTab,providers:new u.ObservableArray([])},s.createElement("div",{id:"ResourceCard",className:"resources-card-content flex-column padding-top-16"},s.createElement(y.TabBar,{className:"resources-card-tab-bar",onSelectedTabChanged:this._onTabChanged,disableSticky:!0,tabSize:"large-link"},e.length>0&&s.createElement(y.Tab,{name:Ve.ConsumedPipelineArtifacts,id:a.consumedPipelineArtifacts,key:a.consumedPipelineArtifacts}),t.length>0&&s.createElement(y.Tab,{name:Ve.Repositories,id:a.Repositories,key:a.Repositories})),s.createElement(y.TabContent,null,i.selectedTab===a.consumedPipelineArtifacts&&e.length>0&&s.createElement(p.Table,{ariaLabel:Ve.ConsumedPipelineArtifacts,columns:this._getPipelineArtifactsColumns(),itemProvider:this.getPipelineArtifactsItemProvider(e)}),i.selectedTab===a.Repositories&&t.length>0&&s.createElement(p.Table,{ariaLabel:Ve.Repositories,columns:this._getRepositoriesColumns(),itemProvider:new W.ArrayItemProvider(d(i.runData,this.context))}))))))))}return s.createElement(s.Fragment,null)}}t[e].ResourcesCard=i;class r extends s.PureComponent{render(){return"self"===this.props.repository.alias?s.createElement(gt.WorkItemsLink,{associatedChangesData:this.props.associatedChanges,sourceType:this.props.repository.type,showIcon:!1}):null}}function l(e){switch(e.toLowerCase()){case Q.RepositoryTypes.TfsGit:return X.TfsGit;case Q.RepositoryTypes.Bitbucket:return X.Bitbucket;case Q.RepositoryTypes.ExternalGit:return X.ExternalGit;case Q.RepositoryTypes.ExternalUnknown:return X.ExternalUnknown;case Q.RepositoryTypes.GitHub:return X.GitHub;case Q.RepositoryTypes.GitHubEnterprise:return X.GitHubEnterprise;case Q.RepositoryTypes.Svn:return X.Svn;case Q.RepositoryTypes.TfsVersionControl:return X.TfsVersionControl;default:return e}}function d(e,t){const s={};for(const a of e.repositoryResources||[]){const i=`${a.type}##${a.name}##${a.refName}##${a.version}`;if(!s[i]||"self"===a.alias){const n="self"!==a.alias||(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.SelectTriggeringRepositoriesBasedOnSHA")&&(256!==e.reason||e.triggerInfo["pr.triggerRepository"]!==a.id)?a.refName:e.sourceBranch;s[i]=Object.assign(Object.assign({},a),{refName:n})}}return Object.keys(s).map((e=>s[e]))}t[e].getRepositoryResourceItems=d}("ComponentsResourcesCard"),function(e){bt=t[e]={};class a extends s.Component{constructor(e){super(e),this._renderRow=(e,t,a)=>{const i=0===t.dependsOn.length?Ve.NoDependencies:`${Ve.DependsOn} ${t.dependsOn.join(", ")}`;return s.createElement(z.ListItem,{key:"stage-item-"+e,index:e,details:a},s.createElement("div",{className:"queue-panel-list-row flex-grow flex-row padding-4"},s.createElement("div",{className:"flex-column margin-right-8 justify-center"},s.createElement(se.Checkbox,{className:"no-h-padding",checked:!t.skip,disabled:!0,ariaLabel:t.skip?Ve.StageSkipped:Ve.StageRunning})),s.createElement("div",{className:"flex-column justify-center margin-left-4"},s.createElement("span",{className:"text-ellipsis primary-text","aria-label":t.name},t.name),s.createElement("span",{className:"font-size text-ellipsis secondary-text"},i))))},this._stageOptions=new u.ObservableArray(this._transformStages())}_transformStages(){const e=new Map;return this.props.stages.forEach((t=>{e.set(t.id,t.name)})),this.props.stages.map((t=>({name:(0,Qe.getSanitizedStageName)(t),refName:t.refName,dependsOn:(t.dependsOn||[]).map((t=>e.get(t)||t)),isSkippable:!1,skip:t.skip||!1})))}render(){return s.createElement("div",{className:"parameters-panel-stages-to-run-list v-scroll-auto custom-scrollbar padding-8"},s.createElement(z.ScrollableList,{itemProvider:this._stageOptions,renderRow:this._renderRow,width:"100%",singleClickActivation:!1}))}}t[e].StageViewer=a}("ComponentsStageViewer"),function(e){var a;Ct=t[e]={},function(e){e.Parameters="parameters",e.Variables="variables",e.Stages="stages"}(a||(a={}));class i extends n.VssComponent{constructor(e,t){super(e,t),this._onTabChanged=e=>{this.setState({selectedTab:e})},this._renderLabel=(e,t,a,i)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,className:"parameters-panel-table-cell"},s.createElement("div",{className:"flex-column padding-top-8 full-width"},s.createElement("span",{className:"body-s text-selectable flex-row flex-shrink full-width"},s.createElement(k.Tooltip,{overflowOnly:!0,text:i.label},s.createElement("code",{className:"full-width"},i.label))))),this._renderValue=(e,t,a,i)=>{const n=this.state.copiedItems.has(i.value)?Ve.CopiedToClipboard:Ve.CopyToClipboard;return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,className:"parameters-panel-table-cell"},s.createElement("div",{className:"flex-row pipeline-parameters-panel-minimum-row-height align-items-center parameter-row-hover-container"},s.createElement("span",{className:"body-s parameter-panel-cells text-selectable word-wrapping flex-grow margin-right-8 padding-top-8 padding-bottom-8"},s.createElement("code",null,i.value)),s.createElement("div",{className:"copy-button-container"},s.createElement(l.Button,{iconProps:{iconName:"Copy"},subtle:!0,tooltipProps:{text:n},onClick:()=>this._copyToClipboard(i.value),ariaLabel:"Copy to clipboard",className:"copy-button-hidden"}))))},this._copyToClipboard=e=>{navigator.clipboard&&window.isSecureContext&&navigator.clipboard.writeText(e).then((()=>{this._showCopiedFeedback(e)}))},this._showCopiedFeedback=e=>{const t=new Set(this.state.copiedItems);t.add(e),this.setState({copiedItems:t}),setTimeout((()=>{this.setState((t=>{const s=new Set(t.copiedItems);return s.delete(e),{copiedItems:s}}))}),2e3)},this._renderTab=e=>{switch(e){case a.Parameters:return this.props.templateParameters&&0!==Object.keys(this.props.templateParameters).length?s.createElement("div",{className:"flex-column"},s.createElement(p.Table,{ariaLabel:Ve.ParametersPanelParametersTable,columns:this._ParameterTableColumns,itemProvider:new W.ArrayItemProvider(this._transformParameterData(this.props.templateParameters)),role:"table",className:"flex-grow bolt-table-no-lines"})):s.createElement("div",{className:"flex-column flex-grow no-data-found"},Ve.NoParametersFound);case a.Variables:const e=this._transformRuntimeVariableData(this.props.runtimeVariables,this.props.definitionVariables);return 0===e.length?s.createElement("div",{className:"flex-column flex-grow no-data-found"},Ve.NoRuntimeVariablesFound):s.createElement("div",{className:"flex-column"},s.createElement(ae.Header,{className:"bolt-panel-header title-m padding-horizontal-8",title:Ve.ParametersPanelVariablesRuntimeVarsTitle}),s.createElement(p.Table,{ariaLabel:Ve.ParametersPanelPipelineVariableTable,columns:this._VariableTableColumns,itemProvider:new W.ArrayItemProvider(e),role:"table",className:"flex-grow bolt-table-no-lines"}));case a.Stages:return this.props.stages?s.createElement("div",{className:"flex-column flex-grow"},s.createElement(bt.StageViewer,{stages:this.props.stages})):s.createElement("div",null);default:return s.createElement("div",null)}},this._ParameterTableColumns=[{id:"label",width:new u.ObservableValue(-30),name:Ve.ParametersPanelParametersColumn,renderCell:this._renderLabel},{id:"value",width:new u.ObservableValue(-60),name:Ve.Value,renderCell:this._renderValue}],this._VariableTableColumns=[{id:"label",width:new u.ObservableValue(-30),name:Ve.ParametersPanelVariablesColumn,renderCell:this._renderLabel},{id:"value",width:new u.ObservableValue(-60),name:Ve.Value,renderCell:this._renderValue}],this.state={selectedTab:a.Parameters,copiedItems:new Set}}_transformParameterData(e){if(!e)return[];const t=[];return Object.entries(e).forEach((([e,s])=>{t.push({label:e,value:s})})),t}_transformRuntimeVariableData(e,t){const s=[];if(e)try{const t=JSON.parse(e);Object.entries(t).forEach((([e,t])=>{s.push({label:e,value:String(t)})}))}catch(e){}return t&&Object.entries(t).forEach((([e,t])=>{t.allowOverride||s.push({label:e,value:t.value})})),s}render(){return s.createElement(m.CustomPanel,{onDismiss:this.props.onDismiss,size:2,className:"pipeline-parameters-panel"},s.createElement(m.PanelHeader,{titleProps:{text:Ve.ParametersPanelTitle,size:1},onDismiss:this.props.onDismiss}),s.createElement(m.PanelContent,{className:"no-padding"},s.createElement(y.TabProvider,{selectedTabId:this.state.selectedTab,providers:new u.ObservableArray([])},s.createElement("div",{className:"flex-column flex-grow"},s.createElement(y.TabBar,{tabSize:"compact",onSelectedTabChanged:this._onTabChanged,className:"padding-horizontal-8"},s.createElement(y.Tab,{name:Ve.ParametersPanelParametersTabTitle,id:a.Parameters,key:a.Parameters}),s.createElement(y.Tab,{name:Ve.Variables,id:a.Variables,key:a.Variables}),s.createElement(y.Tab,{name:Ve.ParametersPanelStagesTabTitle,id:a.Stages,key:a.Stages})),s.createElement(y.TabContent,null,s.createElement("div",{className:"custom-scrollbar flex-column flex-grow h-scroll-hidden"},this._renderTab(this.state.selectedTab)))))))}}t[e].ParametersPanel=i}("ComponentsParametersPanel"),function(e){var a,d;ft=t[e]={},function(e){e.artifactType="artifactType",e.projectId="projectId",e.source="source",e.pipelineId="pipelineId",e.version="version",e.alias="alias",e.tag="tag",e.pipelineTriggerType="pipelineTriggerType",e.scheduleName="scheduleName"}(a=t[e].TriggerInfo||(t[e].TriggerInfo={})),function(e){e.BuildResourceCompletion="BuildResourceCompletion",e.ContainerImage="ContainerImage",e.ContinuousIntegration="ContinuousIntegration",e.PullRequest="PullRequest",e.PipelineCompletion="PipelineCompletion",e.WebhookTriggeredEvent="WebhookTriggeredEvent"}(d=t[e].PipelineTriggerType||(t[e].PipelineTriggerType={}));const m=e=>s.createElement("div",{className:(0,w.css)("flex-grow",e.compact?"flex-row flex-self-start summary-column-compact":"flex-column summary-column")},s.createElement("div",{className:"flex-row"},s.createElement("div",{className:(0,w.css)("secondary-text summary-line-non-link",e.compact&&"summary-line-compact"),id:(0,w.getSafeId)(e.labelId)},e.label),e.count&&e.count>1&&s.createElement(re.Pill,{className:"margin-horizontal-4 margin-top-16",size:0},e.count)),s.createElement("div",{className:(0,w.css)("summary-line flex-column flex-grow")},e.children));class p extends n.VssComponent{constructor(e,t){var a,i;super(e,t),this._showSummary=new u.ObservableValue(!1),this._onObservableChanged=e=>{this.setState({run:e})},this._onObservableArtifactChanged=e=>{this.setState({consumedArtifactsData:e})},this._renderCard=e=>{var t,a;const i=e.some((e=>e.compact)),n=this.state.run,d=this.state.artifacts;let u=[];(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&(u=null!==(a=null===(t=this.state.consumedArtifactsData)||void 0===t?void 0:t.consumedSources.filter((e=>"Pipeline"===e.artifactCategory)))&&void 0!==a?a:[]);const h=n.repositoryResources&&n.repositoryResources.length>1;return s.createElement("div",{role:"region","aria-label":Ve.SummaryTitle},s.createElement(C.Card,{className:"flex-grow summary-card",contentProps:{className:"summary-card-content-container"},titleProps:{size:0}},!!n&&s.createElement("div",{className:(0,w.css)("flex-column summary-card-content flex-grow",i&&"scroll-hidden")},s.createElement("div",{className:"flex-row flex-center summary-header padding-bottom-0"},s.createElement("div",{className:"flex-grow text-ellipsis"},this._getTriggerElement()),s.createElement(U.ScreenSizeConditional,{condition:e=>0===e},s.createElement(l.Button,{iconProps:{iconName:"ChevronUnfold10"},subtle:!0,onClick:this._onShowSummaryClick}))),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&s.createElement("div",{className:"flex-row flex-center padding-bottom-16 padding-vertical-0 padding-left-8"},s.createElement("div",{className:"flex-row flex-center summary-line summary-line-non-link-date-time"},s.createElement(r.Icon,{iconName:"Calendar",className:"icon-margin summary-card-icon"}),s.createElement(Y.Ago,{date:n.queueTime,format:1})),!!n.startTime&&s.createElement("div",{"aria-describedby":"duration-label",className:"flex-row flex-center summary-line summary-line-non-link-date-time"},s.createElement(r.Icon,{iconName:"Clock",className:"icon-margin summary-card-icon"}),s.createElement(I.Duration,{startDate:n.startTime,endDate:n.finishTime}))),s.createElement("div",{className:(0,w.css)("flex-center flex-grow body-m",i?"flex-column summary-view-compact":"flex-row summary-view")},(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&u.length>0&&s.createElement(m,{compact:i,label:"Pipeline Artifacts",labelId:"pipeline-artifacts-label",count:u.length},this._renderPipelineArtifactsColumn(u)),s.createElement(m,{compact:i,label:h?Ve.RepositoriesHeader:Ve.RepositoryVersionHeader,labelId:"repo-label",count:h&&n.repositoryResources.length||void 0},this._renderRepoColumn(n)),s.createElement(U.ScreenSizeObserver,null,(e=>{const t=s.createElement(s.Fragment,null,!(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&s.createElement(m,{compact:i,label:Ve.TimeElapsedHeader,labelId:"duration-label"},s.createElement("div",{className:"flex-row summary-line summary-line-non-link-date-time flex-center"},s.createElement(r.Icon,{iconName:"Calendar",className:"icon-margin summary-card-icon"}),s.createElement(Y.Ago,{date:n.queueTime,format:1})),!!n.startTime&&s.createElement("div",{"aria-describedby":"duration-label",className:"summary-line summary-line-non-link-date-time flex-center flex-row"},s.createElement(r.Icon,{iconName:"Clock",className:"icon-margin summary-card-icon"}),s.createElement(I.Duration,{startDate:n.startTime,endDate:n.finishTime})),!n.startTime&&s.createElement("div",{className:"summary-line summary-line-non-link-date-time flex-row flex-center"},s.createElement("span",{"aria-hidden":!0},"-"))),s.createElement(m,{compact:i,label:Ve.RelatedHeader,labelId:"work-items-label"},this._getWorkItemsLinkComponent(n),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?s.createElement(c.Observer,{artifacts:d},(e=>s.createElement(dt.PublishedArtifactsLink,{runId:this.state.run.id,linkText:(0,o.localeFormat)(Ve.ArtifactsPublishedFormat,e.artifacts.publishedArtifactsCount),linkDescribedBy:"artifacts-label",c_TelemetrySource:"RunSummary"}))):s.createElement(ct.ArtifactsLink,{run:this.state.run,artifactsData:this.state.artifacts,linkDescribedBy:"artifacts-label"})),s.createElement(m,{compact:i,label:Ve.TestsHeader,labelId:"tests-label"},s.createElement(pt.TestResultsLink,{linkDescribedBy:"tests-label",testsTabUrl:this.props.testsTabUrl}),s.createElement(mt.CoverageResultsLink,{linkDescribedBy:"coverage-label",coverageTabUrl:this.props.coverageTabUrl})));return s.createElement(c.Observer,{showSummary:this._showSummary},(s=>s.showSummary||e.screenSize>0?t:null))}))))))},this._onActivateParametersPanel=e=>{const t=this.context.pageContext.getService("IVssLayoutManager"),a=this.context.pageContext.getRestClient("IBuildRestClient"),i=this.context.pageContext.getService("ITfsPageService").getData();i&&i.project&&a.getDefinition(i.project.id,e.pipeline.id).then((a=>{t.renderCallout((t=>{const i={templateParameters:e.templateParameters,stages:e.stages,definitionVariables:a.variables,runtimeVariables:e.parameters,onDismiss:t};return s.createElement(Ct.ParametersPanel,i)}))}),ie.handleError)},this._onShowSummaryClick=()=>{this._showSummary.value=!this._showSummary.value},this._getAvatarUrl=e=>{if(e){if(e.imageUrl)return e.imageUrl;const t=(0,J.getAvatarUrl)(e);if(t)return t;if(e.id)return(0,G.getIdentityImageUrl)(this.context.pageContext,e.id)}return""},this._service=this.context.pageContext.getService("IRunDetailsService"),this._observable=this._service.data,(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&(this._consumedArtifactsService=this.context.pageContext.getService("ConsumedArtifactsService"),this._observableArtifact=this._consumedArtifactsService.data),this.state={run:this._service.data.value,associatedChanges:this._service.associatedChanges,artifacts:this._service.artifacts,traceabilityWorkItemsCount:this._service.traceabilityWorkItemsCount,traceabilityChangesCount:this._service.traceabilityChangesCount,fallbackTraceabilityFlag:this._service.fallbackTraceabilityFlag,consumedArtifactsData:(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?null===(i=null===(a=this._consumedArtifactsService)||void 0===a?void 0:a.data)||void 0===i?void 0:i.value:void 0}}render(){return s.createElement(oe.ResponsiveViewport,{breakPoints:[{className:"summary-view-compact",maxWidth:932,compact:!0}],onRenderContent:this._renderCard})}componentDidMount(){this._observable.subscribe(this._onObservableChanged),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&this._observableArtifact.subscribe(this._onObservableArtifactChanged)}componentWillUnmount(){this._observable.unsubscribe(this._onObservableChanged),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&this._observableArtifact.unsubscribe(this._onObservableArtifactChanged)}_renderPipelineArtifactsColumn(e){const t=e.length-1;return s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row summary-info-link flex-center"},s.createElement(lt.PipelineRunLink,{linkText:e[0].alias+"/"+e[0].versionName,runId:e[0].versionId,projectId:e[0].properties.projectId,c_TelemetrySource:"ResourcesCard"}),t>0&&`, +${t}`),s.createElement("div",{className:"flex-row summary-info flex-center"},s.createElement(h.Link,{className:"resourcecard-link",href:"#ResourceCard"},Ve.ResourceCardLink)))}_renderRepoColumn(e){const t=(0,vt.getRepositoryResourceItems)(e,this.context);if(t.length>1){const a=t.length-1;return s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row summary-info-link flex-center"},s.createElement($.RepoLink,{sourceRepositoryId:e.sourceRepositoryId,sourceRepositoryName:e.sourceRepositoryName,sourceRepositoryType:e.sourceRepositoryType,sourceRepositoryUrl:e.sourceRepositoryUrl}),", +",a),s.createElement("div",{className:"flex-row summary-info flex-center"},(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?s.createElement(h.Link,{className:"resourcecard-link",href:"#ResourceCard"},Ve.ResourceCardLink):s.createElement(h.Link,{className:"sourcecard-link",href:"#SourceCard"},Ve.SourceCardLink)))}return s.createElement(s.Fragment,null,s.createElement("div",{className:"flex-row summary-info-link flex-center"},s.createElement($.RepoLink,{sourceRepositoryId:e.sourceRepositoryId,sourceRepositoryName:e.sourceRepositoryName,sourceRepositoryType:e.sourceRepositoryType,sourceRepositoryUrl:e.sourceRepositoryUrl})),s.createElement("div",{className:"flex-row summary-info-link flex-center"},s.createElement(Z.BranchLink,{excludeTabStop:!1,repositoryType:e.sourceRepositoryType,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryUrl:e.sourceRepositoryUrl,branch:e.sourceBranch,monospace:!1}),s.createElement(ee.CommitLink,{excludeTabStop:!1,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryType:e.sourceRepositoryType,repositoryUrl:e.sourceRepositoryUrl,commitId:e.sourceVersion,monospace:!1})))}_getChangesLinkComponent(e){return s.createElement(c.Observer,{fallbackTraceabilityFlag:this.state.fallbackTraceabilityFlag},(t=>this._isRunSummaryTraceabilityEnabled&&!t.fallbackTraceabilityFlag?s.createElement(Oe.RunSummaryChangesLink,{traceabilityChangesCount:this.state.traceabilityChangesCount,linkDescribedBy:"changes-label",sourceType:e.sourceRepositoryType,currentRunId:e.id}):s.createElement(ht.ChangesLink,{linkDescribedBy:"changes-label",associatedChangesData:this.state.associatedChanges,branch:e.sourceBranch,repositoryName:e.sourceRepositoryName,repositoryId:e.sourceRepositoryId,repositoryUrl:e.sourceRepositoryUrl,sourceType:e.sourceRepositoryType,reason:e.reason})))}_getParametersLinkComponent(e){return(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.RunParametersPanel",!1)?s.createElement("div",{className:"text-ellipsis flex-row flex-baseline margin-horizontal-8 "},s.createElement(l.Button,{text:Ve.Parameters,onClick:()=>this._onActivateParametersPanel(e)})):null}get _isRunSummaryTraceabilityEnabled(){return this._service&&this._service.isRunSummaryTraceabilityEnabled}_getWorkItemsLinkComponent(e){return s.createElement(c.Observer,{fallbackTraceabilityFlag:this.state.fallbackTraceabilityFlag},(t=>this._isRunSummaryTraceabilityEnabled&&!t.fallbackTraceabilityFlag?s.createElement(je.RunSummaryWorkItemsLink,{traceabilityWorkItemsCount:this.state.traceabilityWorkItemsCount,linkDescribedBy:"work-items-label",currentRunId:e.id}):s.createElement(gt.WorkItemsLink,{linkDescribedBy:"work-items-label",associatedChangesData:this.state.associatedChanges,sourceType:this.state.run.sourceRepositoryType})))}_getTriggerElement(){const e=this.state.run;if(e){const c=e.requestedFor&&e.requestedFor.displayName,u=this._getAvatarUrl(e.requestedFor),m=e.triggerInfo[a.scheduleName],p="flex-row flex-center",g=c&&s.createElement("span",{className:p}," ",Ve.By," ",s.createElement(q.BuildPersona,{cssClass:"icon-margin",size:"small",displayName:c,imageUrl:u}),c),v=m&&s.createElement("span",{className:p}," ",Ve.By,"  '",m,"'");let b,C="";switch(this.state.run.reason){case 4:b=s.createElement("span",null,Ve.ReasonBatchedCI),C=Ve.ReasonBatchedCI;break;case 512:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonBuildCompletion),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonBuildCompletion,c):Ve.ReasonBuildCompletion;break;case 128:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonCheckInShelveset),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonCheckInShelveset,c):Ve.ReasonCheckInShelveset;break;case 2:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonCI),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonCIFor,c):Ve.ReasonCI;break;case 1:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonManual),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonManual,c):Ve.ReasonManual;break;case 256:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonPullRequest),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonManual,c):Ve.ReasonManual;break;case 8:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonScheduled),v),C=m?(0,o.format)(Ve.ByFormat,Ve.ReasonScheduled,m):Ve.ReasonScheduled;break;case 64:b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonValidate),g),C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonValidate,c):Ve.ReasonValidate;break;case 1024:switch(e.triggerInfo[a.pipelineTriggerType]){case d.PipelineCompletion:var t=e.triggerInfo[a.alias],n=e.triggerInfo[a.version];const o=this.context.pageContext,c=o.getService("IBuildLinkingService").getBuildUrl(Number(e.triggerInfo[a.pipelineId]),"",e.triggerInfo[a.projectId]);b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Ve.By," ",s.createElement(ne.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:Ve.Pipeline}),s.createElement(h.Link,{className:"bolt-table-link bolt-table-inline-link text-ellipsis",href:c,onClick:e=>{e.preventDefault(),(0,_.onClickFPS)(o,c,!0,e)}},t,"/",n)));break;case d.BuildResourceCompletion:t=e.triggerInfo[a.alias];var r=e.triggerInfo[a.source];n=e.triggerInfo[a.version];b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Ve.By," ",s.createElement(ne.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/jenkins.svg"),alt:Ve.Jenkins}),t,"/",r,"/",n));break;case d.ContainerImage:t=e.triggerInfo[a.alias];var l=e.triggerInfo[a.tag];b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Ve.By," ",s.createElement(ne.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/azure-container-repository.svg"),alt:Ve.AzureContainerRepository}),t,"/",l));break;case d.WebhookTriggeredEvent:t=e.triggerInfo[a.alias];b=s.createElement("span",{className:p},s.createElement("span",null,Ve.ReasonAutomaticTrigger),s.createElement("span",{className:p}," ",Ve.By," ",s.createElement(ne.Image,{className:"icons-margin",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/artifacts-view/icons/pipeline.svg"),alt:Ve.WebHook}),t))}C=c?(0,o.format)(Ve.ByFormat,Ve.ReasonAutomaticTrigger,c):Ve.ReasonAutomaticTrigger}if(b)return s.createElement("div",{"aria-label":C,className:"flex-row"},s.createElement("span",{className:"flex-star flex-grow  body-xl"},b),this._getChangesLinkComponent(e),this._getParametersLinkComponent(e))}return s.createElement("div",null)}}t[e].RunSummary=p}("ComponentsRunSummary"),function(e){St=t[e]={};class a extends n.VssComponent{constructor(e,t){super(e,t),this._renderRepositoryColumn=(e,t,a,i)=>{const n=i.name,o=i.type;return s.createElement(p.TwoLineTableCell,{className:"sources-card-table-cell",key:"col-"+t,columnIndex:t,tableColumn:a,line1:s.createElement("span",{className:"flex-row scroll-hidden sourcecard-repositorylink"},s.createElement(k.Tooltip,{text:n,overflowOnly:!0},s.createElement($.RepoLink,{sourceRepositoryId:i.id,sourceRepositoryName:i.name,sourceRepositoryType:i.type,sourceRepositoryUrl:i.url,includeIcon:!1}))),line2:s.createElement(k.Tooltip,{text:o,overflowOnly:!0},s.createElement("span",{className:"fontSize secondary-text sources-card-repotype flex-row flex-center text-ellipsis"},s.createElement("span",{className:"text-ellipsis",key:"release-type-text"},r(o))))})},this._renderBranchColumn=(e,t,a,i)=>{const n=this._getRepositoryUrl(i,i.connectionId);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"sources-card-table-cell fontSizeM scroll-hidden"},s.createElement(Z.BranchLink,{excludeTabStop:!1,repositoryType:i.type,repositoryName:i.name,repositoryId:i.id,repositoryUrl:n,branch:i.refName,monospace:!1}))},this._renderVersionColumn=(e,t,a,i)=>{const n=this._getRepositoryUrl(i,void 0);return s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"sources-card-table-cell fontSizeM scroll-hidden"},s.createElement(ee.CommitLink,{excludeTabStop:!1,repositoryName:i.name,repositoryId:i.id,repositoryType:i.type,repositoryUrl:n,commitId:i.version,monospace:!1,showIcon:!1}))},this._renderRelatedColumn=(e,t,a,n)=>s.createElement(p.SimpleTableCell,{columnIndex:t,tableColumn:a,key:"col-"+t,contentClassName:"fontSizeM size-m scroll-hidden"},s.createElement(i,{repository:n,associatedChanges:this._runDetailsService.associatedChanges})),this._runDetailsService=t.pageContext.getService("IRunDetailsService"),this._columns=[{className:"pipelines-sourcecard-repositorycolumn",id:"repository",name:Ve.SourceCardRepositoryColumnTitle,renderCell:this._renderRepositoryColumn,width:-30},{className:"pipelines-sourcecard-versioncolumn",id:"Version",name:Ve.SourceCardBranchColumnTitle,renderCell:this._renderBranchColumn,width:-30},{className:"pipelines-sourcecard-changescolumn",id:"Changes",name:Ve.SourceCardVersionColumnTitle,renderCell:this._renderVersionColumn,width:-20},{className:"pipelines-sourcecard-relatedcolumn",id:"Version",name:Ve.SourceCardRelatedColumnTitle,renderCell:this._renderRelatedColumn,width:-20}],this._isPipelinesProximaEnabled=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.GitHubProximaInstallationFlowEnabled",!1)}render(){return s.createElement(c.Observer,{runData:this._runDetailsService.data},(e=>e.runData.repositoryResources&&e.runData.repositoryResources.length>1?s.createElement("div",{id:"SourceCard"},s.createElement(C.Card,{titleProps:{text:Ve.SourceCardTitle},className:"sources-card flex-grow bolt-table-card margin-top-16",contentProps:{contentPadding:!1}},s.createElement(p.Table,{ariaLabel:Ve.SourceCardTitle,itemProvider:new W.ArrayItemProvider(l(e.runData,this.context)),columns:this._columns}))):null))}_getRepositoryUrl(e,t){return this._isPipelinesProximaEnabled&&(0,o.equals)(e.type,Q.RepositoryTypes.GitHub,!0)&&(0,te.isProximaRepository)(this.context.pageContext,{repositoryName:e.name,repositoryUrl:e.url})?e.url:t}}t[e].SourcesCard=a;class i extends s.PureComponent{render(){return"self"===this.props.repository.alias?s.createElement(gt.WorkItemsLink,{associatedChangesData:this.props.associatedChanges,sourceType:this.props.repository.type,showIcon:!1}):null}}function r(e){switch(e.toLowerCase()){case Q.RepositoryTypes.TfsGit:return X.TfsGit;case Q.RepositoryTypes.Bitbucket:return X.Bitbucket;case Q.RepositoryTypes.ExternalGit:return X.ExternalGit;case Q.RepositoryTypes.ExternalUnknown:return X.ExternalUnknown;case Q.RepositoryTypes.GitHub:return X.GitHub;case Q.RepositoryTypes.GitHubEnterprise:return X.GitHubEnterprise;case Q.RepositoryTypes.Svn:return X.Svn;case Q.RepositoryTypes.TfsVersionControl:return X.TfsVersionControl;default:return e}}function l(e,t){const s={};for(const a of e.repositoryResources||[]){const i=`${a.type}##${a.name}##${a.refName}##${a.version}`;if(!s[i]||"self"===a.alias){const n="self"!==a.alias||(0,b.isFeatureFlagEnabled)(t.pageContext,"Build2.SelectTriggeringRepositoriesBasedOnSHA")&&(256!==e.reason||e.triggerInfo["pr.triggerRepository"]!==a.id)?a.refName:e.sourceBranch;s[i]=Object.assign(Object.assign({},a),{refName:n})}}return Object.keys(s).map((e=>s[e]))}t[e].getRepositoryResourceItems=l}("ComponentsSourcesCard"),function(e){yt=t[e]={};t[e].TagsDialog=e=>{const{run:t,showTagsDialog:a,onSaveTags:i,getRemoteTags:n,context:r}=e,o=new u.ObservableArray;o.push(...t.value.tags);let l=!1,d=[];const h=new u.ObservableArray([]),m=new u.ObservableValue(!0),p=new u.ObservableValue(!1),g=(e,t)=>e===t,_=e=>({content:e}),v=e=>{const t=e.toLocaleLowerCase(),s=d.findIndex((e=>e.toLocaleLowerCase()===t));return s>=0?d[s]:e},b=()=>{h.removeAll()},C=()=>{o.value=t.value.tags,h.value=[],a.value=!1},f=async()=>{p.value=!0,await i(o.value),p.value=!1,C()},S=e=>{const t=e.toLocaleLowerCase();h.value=d.filter((e=>e.toLocaleLowerCase().startsWith(t)&&e.toLocaleLowerCase()!==t))},y=()=>{l||(l=!0,n().then((e=>{d=e,m.value=!1})))},k=e=>{o.value.indexOf(e)<0&&o.push(e),d.indexOf(e)<0&&d.push(e)},w=e=>o.splice(o.value.indexOf(e),1),I=e=>s.createElement(s.Fragment,null,e.item);return s.createElement(c.Observer,{showTagsDialog:a,saving:p},(e=>e.showTagsDialog?s.createElement(le.Dialog,{titleProps:{text:Ve.AddTagsDialogTitle},lightDismiss:!0,onDismiss:C,footerButtonProps:[{disabled:e.saving,text:Ve.Cancel,type:"reset",onClick:C},{disabled:e.saving,primary:!0,text:Ve.Save,type:"submit",onClick:f}]},s.createElement("div",{className:"margin-top-4"},s.createElement(ce.TagPicker,{areTagsEqual:g,convertItemToPill:_,createDefaultItem:v,noResultsFoundText:"",onFocus:y,onBlur:b,onEmptyInputFocus:void 0,onSearchChanged:S,onSearchChangedDebounceWait:0,onTagAdded:k,onTagRemoved:w,placeholderText:Ve.TagsDialogPlaceholder,renderSuggestionItem:I,selectedTags:o,shouldBlurClear:()=>!0,suggestions:h,suggestionsLoading:m,suggestionsLoadingText:Ve.Loading}))):null))}}("ComponentsTagsDialog"),function(e){t[e]={};const s=36e5;class a extends T.VssService{_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._buildHub&&this._buildHub.dispose(),this._poolHub&&this._poolHub.dispose(),this._testHub&&this._testHubStarted&&this._testHubStarted.then((()=>{this._testHub.dispose()}))}watch(e){this._buildHub&&this._buildHub.start().then((()=>{this._buildHub.watch(e)}))}watchTestHub(e,t){1!==t.status&&32!==t.status||this._testHub&&this._testHubInitialize.then((()=>{this._testHubStarted=this._testHub.watchBuild(e)}))}endWatchTestHub(e){this._testHub&&this._testHubStarted&&this._testHubStarted.then((()=>{this._testHub.unwatchBuild(e).then((()=>{this._testHub.dispose()}))}))}watchPool(e){this._watchingPoolId!==e&&this._poolHub&&(this._watchingPoolId&&this.endWatchPool(this._watchingPoolId),this._watchingPoolId=e,this._poolHub.start().then((()=>{this._poolHub.watch(e)})))}endWatch(e){this._buildHub&&this._buildHub.start().then((()=>{this._buildHub.endWatch(e)}))}endWatchPool(e){this._poolHub&&this._poolHub.start().then((()=>{delete this._watchingPoolId,this._poolHub.endWatch(e)}))}_initialize(){const e=this.pageContext.getService("IVssPageService").getData(),t=this.pageContext.getService("ITfsPageService").getData(),s=this.pageContext.getService("IVssHistoryService"),a=new r(this.pageContext);if(e&&t&&t.project){const r={hostInformation:{hostId:e.hostId,hostPath:e.hostPath,isHosted:e.isHosted,projectId:t.project.id},pageContext:this.pageContext,historyService:s};this._buildHub=new i(r),this._poolHub=new n(r),this._testHub=this.pageContext.getService("ITestSignalRHub"),this._testHubInitialize=this._testHub.initialize(this.pageContext,t.project.id,a)}}}t[e].SignalRService=a,T.Services.add("ISignalRService",{serviceFactory:a});class i extends he.SingleConnectionSignalRHub{constructor(e){super({name:de.HubNames.buildDetailHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:de.getBuildProxyToRegister,pageContext:e.pageContext}),this._initializeClient=e=>{e.client.buildUpdated2=(e,t)=>{this._getView()===o.Summary&&this._detailsService.refreshData()},e.client.timelineRecordsUpdated=(e,t,s,a)=>{const i=this._getView();i===o.Summary&&this._detailsService.refreshData(),i===o.Logs&&this._logsService.onLiveTimelineUpdate(s,a)},e.client.logConsoleLines=e=>{this._getView()===o.Logs&&this._logsService.onLiveContent({content:e.lines.join("\n"),jobId:e.timelineRecordId,taskId:e.stepRecordId,timelineId:e.timelineId})},e.client.buildArtifactAdded=(e,t)=>{const s=this._getView();s===o.Artifacts&&this._artifactsService.refreshData(),s===o.Summary&&this._detailsService.refreshArtifactsData()}},this._options=e,this.initializeProxyClient(de.HubNames.buildDetailHub,this._initializeClient)}start(){return super.start()}watch(e){const t=this._hub;t&&t.server.watchBuild(this._options.hostInformation.projectId,e)}endWatch(e){const t=this._hub;t&&t.server.stopWatchingBuild(this._options.hostInformation.projectId,e)}dispose(){super.dispose()}get _hub(){return this.getHub(de.HubNames.buildDetailHub)}_getView(){const e=this._options.historyService.getState();switch((e&&e.view||"").toLowerCase()){case"logs":return o.Logs;case"artifacts":return o.Artifacts;default:return o.Summary}}get _logsService(){return this._options.pageContext.getService("IRunLogsService")}get _detailsService(){return this._options.pageContext.getService("IRunDetailsService")}get _artifactsService(){return this._options.pageContext.getService("pipelines-run-published-artifacts-tab-provider-service")}}t[e].BuildHub=i;class n extends he.SingleConnectionSignalRHub{constructor(e){super({name:ue.HubNames.taskAgentPoolHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:ue.getDTProxyToRegister,pageContext:e.pageContext}),this._initializeClient=e=>{e.client.notifyAgentConnected=(e,t)=>{this._logsService.onLiveAgentStatusUpdate(e,t)},e.client.notifyAgentDisconnected=(e,t)=>{this._logsService.onLiveAgentStatusUpdate(e,t)},e.client.notifyAgentRequestAssigned=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)},e.client.notifyAgentRequestQueued=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t,!0)},e.client.notifyAgentRequestStarted=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)},e.client.notifyAgentRequestCompleted=(e,t)=>{this._logsService.onLiveRequestUpdate(e,t)}},this._options=e,this.initializeProxyClient(ue.HubNames.taskAgentPoolHub,this._initializeClient)}start(){return super.start()}watch(e){const t=this._hub;t&&t.server.subscribe(e)}endWatch(e){const t=this._hub;t&&t.server.unsubscribe(e)}dispose(){super.dispose()}get _hub(){return this.getHub(ue.HubNames.taskAgentPoolHub)}get _logsService(){return this._options.pageContext.getService("IRunLogsService")}}t[e].PoolHub=n;class r{constructor(e){this._runDetailsService=e.getService("IRunDetailsService")}testRunStatsChangedForBuild(e){this._runDetailsService.updateTestPassRate(),this._runDetailsService.updateCodeCoverageSummary()}testRunStatsChangedForRelease(e,t){}}var o;!function(e){e[e.Summary=0]="Summary",e[e.Logs=1]="Logs",e[e.Artifacts=2]="Artifacts"}(o||(o={}))}("SignalRService"),function(e){kt=t[e]={};const s="User";class a extends T.VssService{constructor(){super(...arguments),this._refreshData=()=>{if(this._runDetails&&this._runDetails.value){this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.run-details-data-provider",{buildId:this._runDetails.value.id.toString()},!0).then((e=>{if(e){2===e.status&&this._liveCheckTimer&&(this._timerManagement.clearInterval(this._liveCheckTimer),this._liveCheckTimer=void 0);const t=this._runDetails.value;this._runDetails.value=this._standardizeData(e),this._retentionLeases.value=this._runDetails.value.retentionLeases,2===this._runDetails.value.status&&(this.updateTestPassRate(),this.updateCodeCoverageSummary(),this._signalR&&this._signalR.endWatchTestHub(this._runDetails.value.id)),!e.sourceVersion||t&&t.sourceVersion||this._fetchChangeData()}}))}},this._updateData=()=>{this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._tempTraceabilityWorkItemsCount&&(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount),this._tempTraceabilityChangesCount&&(this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount)):this._tempAssociatedChanges&&(this._associatedChanges.value=this._tempAssociatedChanges),this._tempTestResults&&(this._testResults.value=this._tempTestResults),this._tempArtifactsData&&(this._artifacts.value=this._tempArtifactsData),this._codeCoverageResults&&(this._codeCoverageResults.value=this._tempCodeCoverageResults)},this._refreshArtifactsData=()=>{this._getArtifactsData()},this._fetchTraceabilityChangesCount=(e,t,s=0)=>{this._contributionService.getDataAsync("ms.vss-build-web.traceability-run-changes-count-data-provider",e,!0).then((a=>{const i=a&&null!=a.changesCount?a.changesCount:-1;if(i>-1){this._tempTraceabilityChangesCount=i;const e=this._shouldUpdateData();e?(this._traceabilityChangesCount.value=i,1===e&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}if(-1===i)s<2?setTimeout((()=>this._fetchTraceabilityChangesCount(e,t,s+1)),2e3):(this._fallbackTraceabilityFlag.value=!0,this._getChangeData());else{const a=(0,F.duration)(t,new Date);this._publishTraceabilityProviderTelemetry(e.currentRunId,this._runDetails.value.sourceRepositoryType,a,s,i)}}))},this._fetchTraceabilityWorkItemsCount=(e,t,s=0)=>{this._contributionService.getDataAsync("ms.vss-build-web.traceability-run-workitems-count-data-provider",e,!0).then((a=>{const i=a&&null!=a.workItemsCount?a.workItemsCount:-1;if(i>-1){this._tempTraceabilityWorkItemsCount=i;const e=this._shouldUpdateData();e?(this._traceabilityWorkItemsCount.value=i,1===e&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}if(-1===i)s<2?setTimeout((()=>this._fetchTraceabilityWorkItemsCount(e,t,s+1)),2e3):(this._fallbackTraceabilityFlag.value=!0,this._getChangeData());else{const a=(0,F.duration)(t,new Date);this._publishTraceabilityProviderTelemetry(e.currentRunId,this._runDetails.value.sourceRepositoryType,a,s,void 0,i)}}))}}get data(){return this._runDetails}get internalData(){const e=(0,Qe.getInternalRunDetailsData)(this._runDetails.value);return new u.ObservableValue(e)}get associatedChanges(){return this._associatedChanges}get fallbackTraceabilityFlag(){return this._fallbackTraceabilityFlag}get traceabilityChangesCount(){return this._traceabilityChangesCount}get traceabilityWorkItemsCount(){return this._traceabilityWorkItemsCount}get artifacts(){return this._artifacts}get isDeleted(){return this._isDeleted}get testRunResults(){return this._testResults}get codeCoverageResults(){return this._codeCoverageResults}get retentionLeases(){return this._retentionLeases}refreshData(e=!1){this._liveCheckTimer&&(this._timerManagement.clearInterval(this._liveCheckTimer),this._liveCheckTimer=this._timerManagement.setInterval(this._refreshData,9e4)),e?this._refreshData():this._refreshDataDebounced()}refreshArtifactsData(){this._refreshArtifactsDataDebounced()}getPermissions(){const e=this._runDetails.value;let t=!1,s=!1,a=!1,i=!1,n=!1,r=!1,o=!1,l=!1;return this._runDetails&&(t=this._security.canQueueBuildById(e.pipeline.id.toString(),e.pipeline.path),s=this._security.canRetainBuildByDefinitionId(e.pipeline.id.toString(),e.pipeline.path),a=this._security.canCancelBuildByUserId(this._userId,e.pipeline.id.toString(),e.pipeline.path,e.requestedForId,e.requestedById),i=this._security.canDeleteBuildByDefinitionId(e.pipeline.id.toString(),e.pipeline.path),n=this._security.canEditDefinition({id:e.pipeline.id,path:e.pipeline.path}),r=this._security.canEditTagsByUserId(this._userId,e.pipeline.id.toString(),e.pipeline.path,e.requestedForId,e.requestedById),o=this._security.canManageStageRunOrder({id:e.pipeline.id,path:e.pipeline.path}),l=this._isRequestor(this._userId,e.requestedById,e.requestedForId)||this._security.canQueueBuildById(e.pipeline.id.toString(),e.pipeline.path)),{canRunBuild:t,canRetainBuild:s,canCancelBuild:a,canDeleteBuild:i,canEditPipeline:n,canEditTags:r,canManageStageRunOrder:o,canQueueManualStage:l}}getTags(){return this._client.getTags(this._projectId)}cancelRun(){const e=this._runDetails.value;this._client.updateBuild({status:4},this._projectId,e.id).then((e=>{this.refreshData()})).catch(ie.handleError)}deleteRun(){const e=this._runDetails.value;this._client.deleteBuild(this._projectId,e.id).then((()=>{this._isDeleted.value=!0,this.refreshData()})).catch(ie.handleError)}cancelStage(e){this._client.updateStage({state:0},this._runDetails.value.id,e,this._projectId).then((()=>{this.refreshData()})).catch(ie.handleError)}retryStage(e,t=!1,s=!0){const a={state:1,forceRetryAllJobs:t,retryDependencies:s};this._client.updateStage(a,this._runDetails.value.id,e,this._projectId).then((()=>{this.refreshData()})).catch(ie.handleError)}runStage(e){this._client.updateStage({state:2,forceRetryAllJobs:!0,retryDependencies:!0},this._runDetails.value.id,e,this._projectId).then((()=>{this.refreshData(!0)})).catch(ie.handleError)}retryPipeline(){this._client.updateBuild({},this._projectId,this._runDetails.value.id,!0).then((()=>{this.refreshData()})).catch(ie.handleError)}retainBuild(){if(this._userId){const e=this._runDetails.value,t=this._retentionLeases.value.filter((e=>this._matchUserLease(e)));if(!t||0===t.length){const t={daysValid:365e3,definitionId:e.pipeline.id,ownerId:`${s}:${this._userId}`,protectPipeline:!1,runId:e.id};this._client.addRetentionLeases([t],this._projectId).then((e=>{this._refreshData()}),ie.handleError)}}}stopRetainingBuild(){if(this._userId){const e=this._retentionLeases.value.filter((e=>this._matchUserLease(e)));if(e&&e.length>0){const t=e.map((e=>e.id));this.deleteRetentionLeases(t)}}}updateApprovals(e){return(0,me.getApprovalClient)(this.pageContext).updateApprovals(e,this._projectId)}updateCheckSuite(e,t){return(0,ge.getPipelinesChecksClient)(this.pageContext).updateCheckSuite(t,this._projectId,e)}updatePermissions(e,t,s){return(0,pe.getPipelinePermissionsClient)(this.pageContext).updatePipelinePermisionsForResource(e,this._projectId,t,s).catch(ie.handleError)}async updateTags(e){const t=this._runDetails.value,s=t.tags,a=e.filter((e=>s.indexOf(e)<0)),i=s.filter((t=>e.indexOf(t)<0));try{const e={tagsToAdd:a,tagsToRemove:i};t.tags=await this._client.updateBuildTags(e,this._projectId,t.id)}catch(e){(0,ie.handleError)(e)}this._runDetails.value=t}startListening(){this._runDetails&&this._runDetails.value&&(this._signalR=this.pageContext.getService("ISignalRService"),this._signalR.watch(this._runDetails.value.id),this._signalR.watchTestHub(this._runDetails.value.id,this._runDetails.value))}stopListening(){this._signalR&&(this._signalR.endWatch(this._runDetails.value.id),this._signalR=void 0)}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._timerManagement.clearAllTimers()}async updateTestPassRate(){if(this._runDetails){const e=await this._externalService.getTestResultsForRun(this._runDetails.value.id,this._runDetails.value.status);if(e){this._tempTestResults=e;const t=this._shouldUpdateData();t?(this._testResults.value=e,1===t&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}}}async updateCodeCoverageSummary(){if(this._runDetails){const e=await this._externalService.getCodeCoverageSummary(this._runDetails.value.id,this._runDetails.value.status);if(e){this._tempCodeCoverageResults=e;const t=this._shouldUpdateData();t?(this._codeCoverageResults.value=e,1===t&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._artifacts.value=this._tempArtifactsData,this._testResults.value=this._tempTestResults)):this._updateData()}}}get isRunSummaryTraceabilityEnabled(){return this._isRunViewTraceabilityFeatureFlagEnabled&&this._runDetails&&this._runDetails.value&&256!=this._runDetails.value.reason&&(o.equals(this._runDetails.value.sourceRepositoryType,Q.RepositoryTypes.TfsGit,!0)||o.equals(this._runDetails.value.sourceRepositoryType,Q.RepositoryTypes.GitHub,!0))}deleteRetentionLeases(e){this._client.deleteRetentionLeasesById(this._projectId,e).then((()=>{this.refreshData()})).catch(ie.handleError)}_isRequestor(e,t,s){const a=(t||"").toLowerCase(),i=(s||"").toLowerCase();return(e=e||e.toLowerCase())===a||e===i}_shouldUpdateData(){if(this._tempArtifactsData&&this._tempTestResults&&-1!=this._tempTestResults.testsCount)if(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value){if(this._tempTraceabilityWorkItemsCount&&this._tempTraceabilityChangesCount)return 1}else if(this._tempAssociatedChanges)return 1;return!this._runDetails||1!==this._runDetails.value.status&&32!==this._runDetails.value.status&&8!==this._runDetails.value.status?0:2}_publishTraceabilityProviderTelemetry(e,t,s,a,i,n){const r={};r.currentRunId=e,r.sourceType=t,r.timeTaken=s,r.retryCount=a;let o="RunViewChangesCount";null!=i?r.commitsCount=i:(r.workItemsCount=n,o="RunViewWorkItemsCount"),this._telemetryService.publishEvent("Traceability",o,r)}_publishGetChangesTelemetry(e,t,s){const a={};a.sourceType=e,a.commitsCount=t,a.timeTaken=s,this._telemetryService.publishEvent("Pipelines","GetChanges",a)}_initialize(){const e=this.pageContext.getService("ITfsPageService").getData();e&&e.project&&(this._projectId=e.project.id);const t=this.pageContext.getService("IVssPageService").getData();t&&t.user&&(this._userId=t.user.id),this._isRunViewTraceabilityFeatureFlagEnabled=(0,b.isFeatureFlagEnabled)(this.pageContext,"Pipelines.Traceability.EnableTraceabilityForRunView",!1),this._externalService=this.pageContext.getService("IRunExternalService"),this._contributionService=this.pageContext.getService("IVssContributionService");const s=this._contributionService.getData("ms.vss-build-web.run-details-data-provider");this._testResults=new u.ObservableValue({testsPassRate:-1,testsCount:-1}),this._codeCoverageResults=new u.ObservableValue({coverage:"",coverageDetailedSummaryStatus:""}),this._traceabilityChangesCount=new u.ObservableValue(0),this._traceabilityWorkItemsCount=new u.ObservableValue(0),this._fallbackTraceabilityFlag=new u.ObservableValue(!1),this._associatedChanges=new u.ObservableValue({changes:[],workItems:[],previousSourceVersion:""}),this._artifacts=new u.ObservableValue({publishedArtifactsCount:0,sources:[],consumedArtifactsCount:0}),this._isDeleted=new u.ObservableValue(!1),s&&(this._runDetails=new u.ObservableValue(this._standardizeData(s)),this._retentionLeases=new u.ObservableArray(s.retentionLeases),this._permissionsStore=new ve.PermissionsStore({pageContext:this.pageContext}),this._security=new _e.Security({projectId:this._projectId,store:this._permissionsStore}),this._fetchChangeData(),this._getArtifactsData(),this.updateTestPassRate(),this.updateCodeCoverageSummary()),this._client=this.pageContext.getRestClient("IBuildRestClient"),this._timerManagement=new be.TimerManagement,this._refreshDataDebounced=this._timerManagement.debounce(this._refreshData,3e3),this._refreshArtifactsDataDebounced=this._timerManagement.debounce(this._refreshArtifactsData,3e3),this._updateData=this._timerManagement.debounce(this._updateData,700),this._telemetryService=this.pageContext.getService("IVssTelemetryService"),this._runDetails&&this._runDetails.value&&2!==this._runDetails.value.status&&(this._liveCheckTimer=this._timerManagement.setInterval(this._refreshData,9e4))}_fetchChangeData(){this._runDetails&&this._runDetails.value&&(this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?this._getRunViewTraceabilityData():this._getChangeData())}_getRunViewTraceabilityData(){var e={currentRunId:this._runDetails.value.id.toString()};const t=new Date;this._fetchTraceabilityChangesCount(e,t);const s=new Date;this._fetchTraceabilityWorkItemsCount(e,s)}_getChangeData(){const e=new Date,t={repositoryId:this._runDetails.value.sourceRepositoryId,repositoryType:this._runDetails.value.sourceRepositoryType,buildId:this._runDetails.value.id.toString(),serviceEndpointId:this._runDetails.value.sourceEndpointId,includeSourceChanges:!1};this._contributionService.getDataAsync("ms.vss-build-web.run-details-changes-data-provider",t,!0).then((t=>{if(t){this._tempAssociatedChanges=t;const s=this._shouldUpdateData();s?(this._associatedChanges.value=t,1===s&&(this._testResults.value=this._tempTestResults,this._artifacts.value=this._tempArtifactsData,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData();const a=t&&t.changes?t.changes.length:0,i=(0,F.duration)(e,new Date);this._publishGetChangesTelemetry(this._runDetails.value.sourceRepositoryType,a,i)}}))}_getArtifactsData(){if(this._runDetails&&this._runDetails.value){const e={buildId:this._runDetails.value.id.toString()};this._contributionService.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",e,!0).then((e=>{if(e){this._tempArtifactsData=e;const t=this._shouldUpdateData();t?(this._artifacts.value=e,1===t&&(this._testResults.value=this._tempTestResults,this.isRunSummaryTraceabilityEnabled&&!this.fallbackTraceabilityFlag.value?(this._traceabilityWorkItemsCount.value=this._tempTraceabilityWorkItemsCount,this._traceabilityChangesCount.value=this._tempTraceabilityChangesCount):this._associatedChanges.value=this._tempAssociatedChanges,this._codeCoverageResults.value=this._tempCodeCoverageResults)):this._updateData()}}))}}_standardizeData(e){return e.jobs||(e.jobs=[]),e.stages||(e.stages=[]),e.tags||(e.tags=[]),e.issues||(e.issues=[]),e}_matchUserLease(e){return e&&e.leaseType===s&&e.leaseOwnerIdentityRef&&e.leaseOwnerIdentityRef.id===this._userId}}t[e].RunDetailsService=a,t[e].getRunDetailsService=function(e){return e.getService("IRunDetailsService")},T.Services.add("IRunDetailsService",{serviceFactory:a})}("RunDetailsService"),function(e){t[e]={};class s extends T.VssService{constructor(){super(...arguments),this.items=new u.ObservableArray}getBreadcrumbItems(e){return this.items}setBreadcrumbs(e,t,s,a){this.items.removeAll(),this.items.push({key:"pipeline-breadcrumb",text:e,href:t,onClick:e=>{(0,_.onClickFPS)(this.pageContext,t,!0,e,{telemetrySource:"pipeline-breadcrumb"})}}),this.items.push({key:"run-breadcrumb",text:s,href:a,onClick:e=>{(0,_.onClickFPS)(this.pageContext,a,!0,e,{telemetrySource:"run-breadcrumb"})}})}clearBreadcrumbs(){this.items.removeAll()}}t[e].RunHeaderBreadcrumbService=s,T.Services.add("run-header-breadcrumb-service",{serviceFactory:s})}("RunHeaderBreadcrumbService"),function(e){wt=t[e]={};const a="ms.vss-test-web.unified-test-results-tab";var i,r;!function(e){e.Results="results"}(i||(i={})),function(e){e.Container="Container".toLowerCase(),e.FilePath="FilePath".toLowerCase()}(r||(r={}));t[e].legacyNoop=e=>{console.error("Not supported")};class l extends n.VssComponent{constructor(e,t){super(e,t),this._tabProviders=new u.ObservableCollection,this._projectId="",this._headerActions=new u.ObservableArray,this._staticActions=new u.ObservableArray,this._contributedActions=new u.ObservableCollection,this._extCallbacks=[],this._showChecksPanel=new u.ObservableValue(!1),this._checkListItemType=new u.ObservableValue(3),this._stagesToReview=new u.ObservableArray,this._reviewMode=new u.ObservableValue(0),this._reviewingPendingStages=!1,this._atpAnnouncementId="ATPAnnouncementDialog",this._onBypassCheck=(e,t)=>{const s={action:1,checkId:e};return this._service.updateCheckSuite(t,s).then((e=>{if(e)return this._service.refreshData(!0),this._showChecksPanel.value=!1,Promise.resolve()}),(e=>Promise.reject(e)))},this._getRetentionMessage=(e,t,s)=>{let a=e.retainedFor;const i=this._getMaxLease(t,e.retainedFor);if(i&&(a=this._getDaysUntilExpiration(i)),a>=36500)switch(i.leaseType){case Ue.LeaseType.Pipeline:return(0,o.format)(Ve.RetainedByPipelineRecentRuns,s);case Ue.LeaseType.Branch:return(0,o.format)(Ve.RetainedByProtectBranchRecentRuns,s,i.ownerDisplayName);case Ue.LeaseType.User:case Ue.LeaseType.ReleaseManagment:default:return(0,o.format)(Ve.RetainedByLeaseForever,i.ownerDisplayName,i.leaseType)}const n=a>=365?Math.floor(a/365):0;a-=365*n;const r=Math.floor(a/30);a-=365*r,a<0&&(a=0);let l=function(e){switch(e){case 0:return"";case 1:return Ve.RetainedByLeaseForOneYear;default:return(0,o.format)(Ve.RetainedByLeaseForYears,e)}}(n);if(n<2){const e=function(e){switch(e){case 0:return"";case 1:return Ve.RetainedByLeaseForOneMonth;default:return(0,o.format)(Ve.RetainedByLeaseForMonths,e)}}(r);if(1===n&&r>0&&(l+=", "),r>0&&(l+=e),0===n&&r<6){const e=function(e){switch(e){case 0:return"";case 1:return Ve.RetainedByLeaseForOneDay;default:return(0,o.format)(Ve.RetainedByLeaseForDays,e)}}(a);r>0&&a>0&&(l+=", "),a>0&&(l+=e)}}return i?function(e,t){return e>0||t>=6?Ve.RetainedByLeaseBegin_MoreThan:Ve.RetainedByLeaseBegin_Exact}(n,r)+l+(0,o.format)(Ve.RetainedByLeaseEnd,i.ownerDisplayName,i.leaseType):e.retainedFor>1?(0,o.format)(Ve.RetainedByNobody,l):Ve.RetainedByNobodyNextRun},this._getMaxLease=(e,t)=>{if(e.length>0){let s=e[0],a=this._getDaysUntilExpiration(s);for(let t=1;t!==e.length;++t){const i=this._getDaysUntilExpiration(e[t]);i>a&&(s=e[t],a=i)}if(a>=t)return s}},this._getDaysUntilExpiration=e=>Math.floor((e.validUntil.getTime()-Date.now())/864e5),this._getMaxDaysUntilExpiration=(e,t)=>{if(t.length>0){const e=t.reduce(((e,t)=>Math.max(t.validUntil.getTime(),e)),0);return Math.floor((e-Date.now())/864e5)}return e.retainedFor},this._updateTab=e=>{if(e.id===a)e.url=this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,Ue.NavTestTabId),e.id=Ue.NavTestTabId;else{const t=this.context.pageContext.getService("IVssHistoryService");e.url=t.generateUrl({view:e.id})}},this._getHeaderIconProps=e=>{const t=(0,v.getBuildStatusIndicatorData)(e.status,e.result);return{render:()=>s.createElement(k.Tooltip,{text:t.label},s.createElement("span",null,s.createElement(f.Status,Object.assign({ariaLabel:t.label,size:"24"},t.statusProps))))}},this._onActionsUpdate=()=>{const e=this._contributedActions?this._contributedActions.value:[];e.length>0&&e.unshift({id:"contributed-divider",important:!1,itemType:1}),e.forEach((e=>e.important=!1)),this._headerActions.value=this._staticActions.value.concat(e)},this._confirmAction=(e,t,a)=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const n={title:e,message:t,onClose:i,onConfirm:a};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},n),null)}))},this._getTags=()=>this._service.getTags(),this._onClickHeaderBack=()=>{const e=this.context.pageContext.getService("IBuildLinkingService").getPipelinesUrl(this._run.value.pipeline.id);(0,_.onClickFPS)(this.context.pageContext,e,!0)},this._onTabChanged=e=>{this._pivot.value=e,e===Ue.NavTestTabId?(this._isAzureTestPlanTaskAnnouncementEnabled&&this._showAtpAnnouncementIfNeeded(),this._performanceService.startScenario(a,!1,void 0,{isTabChangeScenario:!0})):e===Ue.CodeCoverageCiTabId&&this._performanceService.startScenario("Pipelines.CodeCoverage",!1,void 0,{isTabChangeScenario:!0})},this._onViewStateChanged=e=>{this.setState({selectedTab:e})},this._onRunDeleted=e=>{if(e){const e=this._navigationService.getLinkingService().getDefinitionUrl(this._run.value.pipeline.id);(0,_.onClickFPS)(this.context.pageContext,e,!0)}},this._onSubmitBulkApproval=e=>{this._service.updateApprovals(e).then((e=>{e&&(this._service.refreshData(!0),this._showChecksPanel.value=!1)})).catch(ie.handleError)},this._onReassignApprovals=e=>this._service.updateApprovals(e).then((e=>{if(e)return this._service.refreshData(!0),this._showChecksPanel.value=!1,this._globalMessageService.addToast({message:Ve.ApprovalReassigned,duration:5e3,forceOverrideExisting:!0}),Promise.resolve()}),(e=>Promise.reject(e))),this._onPermitResource=(e,t,s)=>{this._service.updatePermissions(e,t,s).then((e=>{e&&(this._globalMessageService.addToast({message:Ve.PermissionGranted,duration:5e3,forceOverrideExisting:!0}),this._service.refreshData(!0))}))},this._onRerunCheck=(e,t)=>{const s={action:0,checkId:e};return this._service.updateCheckSuite(t,s).then((e=>{if(e)return this._service.refreshData(!0),this._showChecksPanel.value=!1,Promise.resolve()}),(e=>Promise.reject(e)))},this._shouldHideChecksPanel=e=>{if(1===this._reviewMode.value&&this._stagesToReview.value&&1===this._stagesToReview.value.length){const t=e.find((e=>e.id===this._stagesToReview.value[0].id));t&&t.checks&&t.checks.some((e=>2===e.status))||(this._showChecksPanel.value=!1)}else e.some((e=>e.checks&&e.checks.some((e=>2===e.status))))||(this._showChecksPanel.value=!1)},this._onActivateRetentionPanel=e=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const a=this._service.retentionLeases,i={canDeleteLeases:e,onDelete:e=>{this._service.deleteRetentionLeases(e),e.forEach((e=>{const t=a.value.findIndex((t=>t.id===e));a.splice(t,1)}))},onDismiss:t,retentionLeases:a};return s.createElement(Ce.RetentionPanel,i)}))},this._onReviewStageClicked=e=>{this._stagesToReview.value=[e],this._reviewMode.value=1,this._reviewingPendingStages=!1,this._showChecksPanel.value=!0,this._checkListItemType.value=1,this._activeElement=document.activeElement},this._onReviewManualValidationClicked=e=>{this._stagesToReview.value=[e],this._reviewMode.value=1,this._showChecksPanel.value=!0,this._checkListItemType.value=2,this._activeElement=document.activeElement},this._onReviewClicked=e=>{this._stagesToReview.value=e,this._pendingStages=e,this._reviewMode.value=0,this._reviewingPendingStages=!0,this._showChecksPanel.value=!0,this._checkListItemType.value=3,this._activeElement=document.activeElement},this._onViewStageChecksClicked=e=>{this._stagesToReview.value=[e],this._reviewMode.value=1,this._showChecksPanel.value=!0,this._checkListItemType.value=1,this._activeElement=document.activeElement},this._onStageChecksBackClicked=()=>{this._stagesToReview.value=this._pendingStages,this._reviewMode.value=0,this._showChecksPanel.value=!0,this._checkListItemType.value=3,this._activeElement=document.activeElement},this._onPanelDismiss=()=>{this._showChecksPanel.value=!1,this._activeElement&&(this._activeElement.focus(),this._activeElement=void 0)},this._onRunUpdated=()=>{let e=!1;const t=this._run.value;let s=!1;if(this._initializeActions(),t.id!=this._contributedTabProps.runId.value&&(this._contributedTabProps.runId.value=t.id,e=!0,s=!0),t.number!=this._contributedTabProps.runNumber.value&&(this._contributedTabProps.runNumber.value=t.number,e=!0),t.status!=this._contributedTabProps.status.value&&(this._contributedTabProps.status.value=t.status,s=!0),t.sourceBranch!=this._contributedTabProps.sourceBranch.value&&(this._contributedTabProps.sourceBranch.value=t.sourceBranch),t.sourceRepositoryId!=this._contributedTabProps.sourceRepositoryId.value&&(this._contributedTabProps.sourceRepositoryId.value=t.sourceRepositoryId),t.sourceRepositoryType!=this._contributedTabProps.sourceRepositoryType.value&&(this._contributedTabProps.sourceRepositoryType.value=t.sourceRepositoryType),t.pipeline.id!=this._contributedTabProps.pipelineId.value&&(this._contributedTabProps.pipelineId.value=t.pipeline.id),t.sourceVersion!=this._contributedTabProps.sourceVersion.value&&(this._contributedTabProps.sourceVersion.value=t.sourceVersion),t.finishTime!=this._contributedTabProps.finishTime.value&&(this._contributedTabProps.finishTime.value=t.finishTime),t.templateParameters!=this._contributedTabProps.templateParameters.value&&(this._contributedTabProps.templateParameters.value=t.templateParameters),this._contributedTabProps.notifyUpdated.value++,e&&this._updateHeaderBreadcrumb(),s){const e=this._getBuild();e&&e.then((e=>{this._extCallbacks.forEach((t=>{t(e)}))}))}this._isProductionReadinessCheckEnabled||this._shouldHideChecksPanel(this._run.value.stages)},this._onSaveTags=async e=>{await this._service.updateTags(e)},this._service=(0,kt.getRunDetailsService)(this.context.pageContext),this._navigationService=this.context.pageContext.getService("IBuildNavigationService"),this._globalMessageService=this.context.pageContext.getService("IGlobalMessagesService"),this._settingsClient=this.context.pageContext.getRestClient("ISettingsRestClient"),this._pageHistoryService=this.context.pageContext.getService("IPageStateHistoryService");const n=this.context.pageContext.getService("IVssHistoryService");this._resultsUrl=n.generateUrl({view:i.Results});const r=n.getState();this._pivot=new u.ObservableValue(r&&r.view||i.Results),this._run=this._service.data;const l=t.pageContext.getService("ITfsPageService").getData();l&&l.project&&(this._projectId=l.project.id),this._run&&(this._contributedTabProps={runId:new u.ObservableValue(this._run.value.id),runNumber:new u.ObservableValue(this._run.value.number),pipelineId:new u.ObservableValue(this._run.value.pipeline.id),projectId:new u.ObservableValue(this._projectId),sourceBranch:new u.ObservableValue(this._run.value.sourceBranch),sourceRepositoryId:new u.ObservableValue(this._run.value.sourceRepositoryId),sourceRepositoryType:new u.ObservableValue(this._run.value.sourceRepositoryType),status:new u.ObservableValue(this._run.value.status),stages:new u.ObservableArray,notifyUpdated:new u.ObservableValue(1),sourceVersion:new u.ObservableValue(this._run.value.sourceVersion),finishTime:new u.ObservableValue(this._run.value.finishTime),templateParameters:new u.ObservableValue(this._run.value.templateParameters)},this._run.value.stages.forEach((e=>{this._contributedTabProps.stages.push({name:e.name,refName:e.refName})}))),this._tabProviders.push((0,Re.getTabs)(t.pageContext,"ms.vss-build-web.run-details-view-tabs",{contextualData:this._contributedTabProps,props:this._contributedTabProps,preProcessTabContribution:this._updateTab})),this.state={selectedTab:this._pivot.value,cancelClicked:!1,showTagsDialog:new u.ObservableValue(!1),runsToRetainPerProtectedBranch:"",checkResults:{}},this._performanceService=this.context.pageContext.getService("IVssPerformanceService"),this._initializeActions(),this._isAzureTestPlanTaskAnnouncementEnabled=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"TestManagement.Server.EnableATPAnnoucment",!1),this._isProductionReadinessCheckEnabled=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"ProductionReadiness.EnableProductionReadinessCheck",!1),this._telemetryService=this.context.pageContext.getService("IVssTelemetryService")}render(){if(!this._run)return s.createElement(ot.NoData,null);const e=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1Flow",!1),t=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.DisableUpdatedChecksLogs",!1),a=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.EnableUpdatedChecksLogsAsync",!1),r=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ImproveInformationalRunFeedback",!1),o=(e,t)=>{this.setState((s=>({checkResults:Object.assign(Object.assign({},s.checkResults),{[e]:t})}))),t.success&&(this._service.refreshData(!0),this._showChecksPanel.value=!1)};return s.createElement(S.Surface,{background:1},s.createElement(H.Page,{className:"run-details-page",selectedTabId:this._pivot.value,tabProviders:this._tabProviders},s.createElement(c.Observer,{run:this._run,leases:this._service.retentionLeases},(e=>{const t=(0,Se.formatPipelineRunName)(e.run.number,e.run.sourceVersionMessage,e.run.appendCommitMessageToRunName),a=e.run.pipeline.name;return s.createElement(s.Fragment,null,s.createElement(ae.CustomHeader,{className:"run-view-header"},s.createElement(U.ScreenSizeConditional,{condition:e=>0===e},s.createElement(ae.HeaderBackButton,{buttonProps:{onClick:this._onClickHeaderBack,text:e.run.pipeline.name}})),s.createElement("div",{className:"flex-row flex-self-stretch"},s.createElement(ae.HeaderIcon,{iconProps:this._getHeaderIconProps(e.run),titleSize:2}),s.createElement(ae.HeaderTitleArea,{className:"padding-bottom-4"},s.createElement(ae.HeaderTitleRow,null,s.createElement("div",{className:"flex-row flex-baseline scroll-hidden"},s.createElement(ae.HeaderTitle,{titleSize:1,className:"text-ellipsis"},t))),s.createElement(U.ScreenSizeConditional,{condition:e=>e>0},s.createElement("div",{className:"flex-row summary-line summary-line-non-link flex-center"},s.createElement(we.ContributedIcon,{alt:"",contributionId:"ms.vss-build-web.pipelines-hub",iconName:"Build",iconSize:"small",pageContext:this.context.pageContext,className:"pipelines-icon-right-margin"}),s.createElement(ae.HeaderDescription,null,a)))),s.createElement(c.UncheckedObserver,{items:this._headerActions},s.createElement(xe.HeaderCommandBar,{className:"flex-self-start",items:[]}))),s.createElement(U.ScreenSizeConditional,{condition:e=>e>0},e.run.tags.length>0&&s.createElement(Te.PillGroup,{overflow:1,className:"margin-top-4 flex-self-stretch margin-left-32"},e.run.tags.map((e=>s.createElement(re.Pill,{className:"margin-right-4",key:e,size:0,excludeTabStop:!0,excludeFocusZone:!0},e)))))),r&&e.run.triggerInfo&&"True"===e.run.triggerInfo["ci.isInformationalRun"]&&s.createElement("div",{className:"page-content page-content-top"},s.createElement(d.MessageCard,{buttonProps:[{href:Ve.InformationalRunHref,text:Ve.LearnMoreButton,target:"_blank",rel:"noopener noreferrer"}]},Ve.InformationalRunCIMessage)),(e.run.finishTime||e.leases.length>0)&&s.createElement("div",{className:"page-content page-content-top"},s.createElement(d.MessageCard,{severity:this._getMaxDaysUntilExpiration(e.run,e.leases)>7?"Info":"Warning",buttonProps:e.leases.length?[{onClick:()=>{this._onActivateRetentionPanel(!0)},text:Ve.ViewRetentionLeasesMenuItem}]:[]},this._getRetentionMessage(e.run,e.leases,this.state.runsToRetainPerProtectedBranch))))})),s.createElement(y.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged},s.createElement(y.Tab,{name:Ve.PipelineTabName,id:i.Results,key:i.Results,url:this._resultsUrl})),s.createElement("div",{className:(0,w.css)("run-details-tab-content page-content page-content-top",this.state.selectedTab===Ue.NavTestTabId&&"unified-testtab-extension-tab-content",this.state.selectedTab!==i.Results&&"run-details-extension-tab-content")},s.createElement(y.TabContent,null,this.state.selectedTab===i.Results&&s.createElement(c.Observer,{providers:this._tabProviders,run:this._run},(i=>s.createElement("div",{className:"flex-column"},s.createElement(c.Observer,{stages:this._stagesToReview,shouldShowChecksPanel:this._showChecksPanel,reviewMode:this._reviewMode},(t=>{const a={stages:t.stages,runId:i.run.id,pipelineId:i.run.pipeline.id,checkListItemType:this._checkListItemType.value,reviewMode:t.reviewMode,onSubmitBulkApproval:this._onSubmitBulkApproval,onReassignApprovals:this._onReassignApprovals,onPermitResource:this._onPermitResource,onGrantResource:Qe.grantResourceHandler(this.context,o),onGrantProductionReadinessResource:Qe.grantResourceHandlerForProductionReadinessCheck(this.context,o),onDismiss:this._onPanelDismiss,onViewStageClick:e?this._onViewStageChecksClicked:void 0,onStageBackClick:e&&this._reviewingPendingStages?this._onStageChecksBackClicked:void 0,onRerunCheck:this._onRerunCheck,onBypassCheck:this._onBypassCheck,checkResults:this.state.checkResults};return s.createElement("div",null,!!t.stages&&t.shouldShowChecksPanel&&s.createElement(n.WrappedComponent,Object.assign({dependencies:["ms.vss-build-web.approvals-panel"],wrappedType:e?"ms.tfs-build.stage-checks-panel":"ms.tfs-build.approvals-list-panel"},a)))})),s.createElement(ft.RunSummary,{testsTabUrl:this._getTestsTabUrl(i.providers),coverageTabUrl:this._getCoverageTabUrl(i.providers)}),s.createElement(Ge.IssuesCard,null),s.createElement(He.ChecksCard,{stages:i.run.stages,pageContext:this.context.pageContext,projectId:this._projectId,onReviewClicked:this._onReviewClicked,useUpdatedChecksFormat:e,isChecksLogsDisabled:t,isAsyncCheckLogsFlowEnabled:a}),s.createElement(rt.JobsCard,{onReviewStageClicked:this._onReviewStageClicked,onReviewManualValidationClicked:this._onReviewManualValidationClicked}),(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)?s.createElement(vt.ResourcesCard,null):s.createElement(St.SourcesCard,null))))))),s.createElement(yt.TagsDialog,{getRemoteTags:this._getTags,onSaveTags:this._onSaveTags,run:this._run,showTagsDialog:this.state.showTagsDialog,context:this.context}))}async componentWillMount(){const e=new ke.ContributionSource({pageContext:this.context.pageContext}),t=await e.getDataAsync(Ue.RetentionSettingDataContributionId,void 0,!0);t&&t.runsToRetainPerProtectedBranch&&this.setState({runsToRetainPerProtectedBranch:t.runsToRetainPerProtectedBranch.value.toString()})}componentDidMount(){(0,M.prefetch)(this.context.pageContext),this._run&&(this._pivot.subscribe(this._onViewStateChanged),this._service.isDeleted.subscribe(this._onRunDeleted),this._run.subscribe(this._onRunUpdated),(0,ie.registerErrorHandler)((e=>{e&&this._globalMessageService.addBanner({message:e.message,level:2})})),this._service.startListening(),this._updateHeaderBreadcrumb(),this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(Ue.Telemetry.Area,Ue.Telemetry.RunDetails),document.title=(0,o.format)(Ve.TitleSummary,this._run.value.number),this._pageHistoryService.registerObservable(this._pivot,"view",1),this._staticActions.subscribe(this._onActionsUpdate))}componentWillUnmount(){this._pivot.unsubscribe(this._onViewStateChanged),this._service.isDeleted.unsubscribe(this._onRunDeleted),this._run.unsubscribe(this._onRunUpdated),(0,ie.registerErrorHandler)((e=>{})),this._service.stopListening();this.context.pageContext.getService("run-header-breadcrumb-service").clearBreadcrumbs(),this._staticActions.unsubscribe(this._onActionsUpdate),this._contributedActions&&this._contributedActions.unsubscribe(this._onActionsUpdate),(0,ye.clearTreeStateOnUnmount)(this.context.pageContext),this._pageHistoryService.unregisterObservable("view")}_getLegacyConfig(){return{onBuildChanged:e=>{this._extCallbacks.push(e);const t=this._getBuild();t&&t.then((t=>e(t)))},onViewDisplayed:t[e].legacyNoop,selectTab:t[e].legacyNoop,setSectionVisibility:t[e].legacyNoop}}_getCoverageTabUrl(e){if(e&&e.length>0){const t=e.filter((e=>e.id===Ue.CodeCoverageCiTabId));if(t&&t.length>0&&t[0].id)return this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,t[0].id)}return""}_getTestsTabUrl(e){if(e&&e.length>0){const t=e.filter((e=>e.id===Ue.NavTestTabId));if(t&&t.length>0&&t[0].id)return this._navigationService.getLinkingService().getBuildUrl(this._run.value.id,t[0].id)}return""}_getBuild(){if(this._run){return this.context.pageContext.getRestClient("IBuildRestClient").getBuild(this._projectId,this._run.value.id)}}async _initializeActions(){const e=[],t=this._run&&this._run.value,s=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Build2.AddLinkToFullYAML",!1);if(t){const a=this._service.getPermissions();this._addRetryActionItems(e,t,a),this._addRunActionItems(e,t,a),this._addCancelActionItems(e,t,a),this._addLogsActionItems(e,t),this._addTagsActionItems(e,t,a),this._addEditActionItems(e,t,a),s&&t.processType===g.ProcessType.Yaml&&this._addFullYAMLActionItems(e,t),this._addRetainActionItems(e,t,a),this._addDeleteActionItems(e,t,a)}if(this._staticActions.value=e,t){if(this._contributedActions&&(this._contributedActions.unsubscribe(this._onActionsUpdate),this._contributedActions=new u.ObservableCollection),this._contributedActions.push((0,Ie.getMenuItems)(this.context.pageContext,"ms.vss-build-web.run-actions",{runId:t.id,result:t.result,pipelineId:t.pipeline.id,status:t.status,projectId:this._projectId})),2==t.status){const e=await this._getBuild();this._contributedActions.push((0,Ie.getMenuItems)(this.context.pageContext,"ms.vss-build-web.build-result-completed-actions-menu",e))}this._contributedActions.push((0,Ie.getMenuItems)(this.context.pageContext,"ms.vss-build-web.build-result-actions-menu",this._getLegacyConfig())),this._contributedActions.subscribe(this._onActionsUpdate)}this._onActionsUpdate()}_addRunActionItems(e,t,a){const i=2===t.pipeline.queueStatus,n=this.context.pageContext.getRestClient("IBuildRestClient");t&&a.canRunBuild&&!i&&1!==t.status&&32!==t.status&&e.push({id:"run-pipeline-command",text:Ve.RunPipeline,important:!0,isPrimary:!0,onActivate:(e,a)=>{n.getDefinition(this._projectId,t.pipeline.id).then((e=>{const a=this.context.pageContext.getService("IVssLayoutManager");let i=!(e.repository&&e.repository.type&&e.repository.type.toLowerCase()===Q.RepositoryTypes.TfsVersionControl.toLowerCase())&&this._run&&this._run.value&&this._run.value.sourceBranch?this._run.value.sourceBranch:void 0;void 0===i&&(i=e.repository?e.repository.defaultBranch:void 0),a.renderCallout((a=>{const n={definition:e,repository:e.repository,processType:e.process.type,pageContext:this.context.pageContext,project:e.project.id,source:"runs",onSuccess:e=>{this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:(0,o.format)(Ve.RunQueued,e.buildNumber),level:3})},definitionVariables:e.variables,previousRunVariables:this._deserializeVariableData(t.parameters),previousTemplateParameters:t.templateParameters,queue:e.queue,defaultSourceBranch:i,onDismiss:a};return s.createElement(M.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent"},n),null)}))}),ie.handleError)}})}_addRetryActionItems(e,t,s){const a=!t.pipeline||2===t.pipeline.queueStatus;t&&s.canRunBuild&&!a&&1!==t.status&&32!==t.status&&2!=t.result&&4!=t.result&&e.push({id:"retry-pipeline-command",text:Ve.RetryFromFailed,important:!0,isPrimary:!1,onActivate:(e,t)=>{this._confirmAction(Ve.RerunFromFailed,Ve.ConfirmRerunPipeline,(()=>{this._service.retryPipeline()}))}})}_addCancelActionItems(e,t,s){if(s.canCancelBuild&&(1===t.status||32===t.status)){let s="";s=this.state.cancelClicked?Ve.CancelingBuild:Ve.CancelBuild,e.push({id:"nbr-cancel",text:s,disabled:this.state.cancelClicked,important:!0,onActivate:()=>{const e=(0,o.format)(Ve.ConfirmCancelBuild,t.number);this._confirmAction(Ve.CancelBuild,e,(()=>{this.setState({cancelClicked:!0}),this._service.cancelRun()}))}})}}_addLogsActionItems(e,t){if(2===t.status){const s=t.logs&&t.logs.type.toLowerCase()===r.Container;e.push({id:"download-logs-command",text:s||!t.logs?Ve.DownloadAllLogs:Ve.CopyLogsLocation,important:!1,onActivate:()=>{if(t.logs)if(s)(0,fe.openLinkSecurely)(t.logs.url+"?$format=zip");else if(document.queryCommandSupported("copy")){const e=document.createElement("textarea");e.value=t.logs.url,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}else console.error("Browser doesn't allow to copy URL "+t.logs.url);else{this.context.pageContext.getService("IGlobalMessagesService").addToast({duration:2e3,message:Ve.NoLogsToastMessage})}}}),e.push({id:"download-command-divider",important:!1,itemType:1})}}_addTagsActionItems(e,t,s){s.canEditTags&&e.push({id:"nbr-tag",text:0===t.tags.length?Ve.AddTags:Ve.EditTags,important:!1,onActivate:()=>{this.state.showTagsDialog.value=!0}})}_addEditActionItems(e,t,s){const a=this._navigationService.getLinkingService();if(a&&t.pipeline){const i=t.processType===g.ProcessType.Yaml;let n="";if(!(256===t.reason)&&i){const e=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(t.sourceRepositoryType);n=e?e.getBranchText(t.sourceBranch):""}const r=i?a.getYamlPipelineEditUrl(t.pipeline.id,n):a.getDefinitionEditUrl(t.pipeline.id);e.push({id:"edit-pipeline-command",text:s.canEditPipeline?Ve.EditPipeline:Ve.ViewPipeline,important:!1,href:r,onActivate:(e,t)=>{(0,_.onClickFPS)(this.context.pageContext,r,!0,t)}})}}_addFullYAMLActionItems(e,t){const s=this._navigationService.getLinkingService().getFullYAMLUrl(t.id,this._projectId);e.push({id:"see-full-YAML",text:Ve.SeeFullYAML,important:!1,href:s,onActivate:(e,t)=>{t&&t.preventDefault();const a=window.open(s,"_blank");this.publishTelemetry(Ue.Telemetry.Area,g.TelemetryConstants.SeeFullYAML),a&&(a.opener=null)}})}publishTelemetry(e,t){const s=this._run&&this._run.value;s&&this._telemetryService.publishEvent(e,t,{ProjectId:this._projectId,BuildId:s.id})}_addRetainActionItems(e,t,s){if(!t.deleted&&(e.push({id:"retain-command-divider",important:!1,itemType:1}),e.push({id:"open-retention-panel-command",important:!1,onActivate:()=>this._onActivateRetentionPanel(s.canRetainBuild),text:Ve.ViewRetentionLeasesMenuItem}),s.canRetainBuild)){const s=this.context.pageContext.getService("IVssPageService").getData();if(s){t.retentionLeases.some((e=>e.leaseOwnerIdentityRef&&e.leaseOwnerIdentityRef.id===s.user.id))?e.push({text:Ve.StopRetainingBuild,id:"run-action-retain",important:!1,onActivate:()=>{this._service.stopRetainingBuild()}}):e.push({text:Ve.RetainBuild,id:"run-action-retain",important:!1,onActivate:()=>{this._service.retainBuild()}})}}}_addDeleteActionItems(e,t,s){0===t.retentionLeases.length&&t.pipeline&&!t.deleted&&s.canDeleteBuild&&e.push({id:"nbr-delete",text:Ve.DeleteRunActionName,important:!1,onActivate:()=>{const e=(0,o.format)(Ve.ConfirmDeleteRun,t.number);this._confirmAction(Ve.DeleteRun,e,(()=>{this._service.deleteRun()}))}})}async _showAtpAnnouncementIfNeeded(){const e=await this._settingsClient.getEntries("me","GlobalDialog/Dismissed"),t=this._globalMessageService.getDialog();t&&t.settingId===this._atpAnnouncementId||e&&e[this._atpAnnouncementId]||this._globalMessageService.addDialog({settingId:this._atpAnnouncementId,message:Ve.ATPAnnoucementMessage,title:Ve.ATPAnnoucementFullTitle,buttonProps:[{primary:!0,text:Ve.LearnMoreButton,href:Ue.ATPAnnoucementLearnMoreLink},{text:Ve.Cancel,onClick:()=>this._globalMessageService.closeDialog()}]})}_updateHeaderBreadcrumb(){const e=this.context.pageContext.getService("IBuildLinkingService"),t=this._run.value.pipeline.name,s=e.getDefinitionUrl(this._run.value.pipeline.id),a=this._run.value.number,i=e.getBuildUrl(this._run.value.id);this.context.pageContext.getService("run-header-breadcrumb-service").setBreadcrumbs(t,s,a,i)}_deserializeVariableData(e){let t;try{t=JSON.parse(e)}catch(e){t={}}return t}}t[e].RunViewContent=l,n.Components.add("run-view-content",l)}("RunView"),function(e){t[e]={};class s extends T.VssService{constructor(){super(...arguments),this._tabs=new u.ObservableArray,this._tabMap={},this._tabSupportsTasks={},this._extCallbacks=[],this._initialize=async()=>{if(this._data){const e=(0,Ne.getContributedItems)(this.pageContext,"ms.vss-build-web.build-results-view",void 0,"ms.vss-build-web.build-results-tab"),t=[];e.forEach((e=>{const s=e.contribution;s.supportsTasks&&s.supportsTasks.length>0&&(this._tabSupportsTasks[e.id]=s.supportsTasks.map((e=>e.toLowerCase()))),t.push((0,Re.processTabContribution)(this.pageContext,{contextualData:this._getLegacyConfig(),props:this._getLegacyConfig(),preProcessTabContribution:this._updateLegacyTab},Object.assign({id:e.id},e.contribution),e.id))}));const s=[];if(Object.keys(this._tabSupportsTasks).length>0){const e=await this._client.getBuildTimeline(this._data.projectId.value,this._data.runId.value);(e&&e.records||[]).filter((e=>"Task"===e.type)).forEach((e=>{let t=e.task&&e.task.id;t||(t=e.id),s.push(t.toLowerCase())}))}const a=[],i=[];t.forEach((e=>{const t=this._tabSupportsTasks[e.id];let n=!0;if(t){n=!1;for(let e=0;e<t.length;e++){const a=t[e];if(s.indexOf(a)>-1){n=!0;break}}}n&&!this._tabMap[e.id]&&(this._tabMap[e.id]=!0,a.push(e)),!n&&this._tabMap[e.id]&&(delete this._tabMap[e.id],i.push(e.id))})),a.length>0&&this._tabs.push(...a),i.length>0&&this._tabs.removeAll((e=>i.indexOf(e.id)>-1))}},this._updateLegacyTab=e=>{const t=this.pageContext.getService("IVssHistoryService");e.url=t.generateUrl({view:e.id}),void 0!==e.order&&(e.order=100+e.order)}}getTabs(e,t){return this._data=t,this._data&&(this._initialize(),this._data.status.subscribe(this._initialize)),this._tabs}_serviceStart(e){super._serviceStart(e),this._client=e.getRestClient("IBuildRestClient")}_serviceEnd(e){super._serviceEnd(e),this._data&&this._data.status.unsubscribe(this._initialize)}_getLegacyConfig(){const e={onBuildChanged:e=>{this._extCallbacks.push(e);const t=this._getBuild();t&&t.then((t=>e(t)))},onViewDisplayed:wt.legacyNoop,selectTab:wt.legacyNoop,setSectionVisibility:wt.legacyNoop};return(0,T.setRemoteSerializationSettings)(e,{proxyFunctions:!0}),e}_getBuild(){return this._client.getBuild(this._data.projectId.value,this._data.runId.value)}}t[e].LegacyRunTabProviderService=s,T.Services.add("legacy-run-tab-provider-service",{serviceFactory:s})}("LegacyRunTabProviderService"),function(e){t[e]={};const s=e=>`##[${e}]`,a=(e,t)=>"<a class='is-link' href='"+e+"'>"+t+"</a>",n=e=>`##[icon]${e} `,r=s("error"),l=s("warning"),c=s("group"),d=s("endgroup"),h="\n",m=1e4,p="00000000-0000-0000-0000-000000000000";class _ extends T.VssService{constructor(){super(...arguments),this._content={},this._liveContent={},this._jobStatus={},this._phaseLog={},this._jobTestData={},this._jobArtifactData={},this._skipTestCall={},this._skipArtifactsCall={},this._jobCompletedCalls={},this._url={},this._followTail=!0,this._onFocus=!0,this._expandedStages={},this._resiliency={},this._lastUpdate=new Date,this._refreshWhenCompleted={},this._expanded={},this._linesFetching={},this._previousTimelines=[],this._previousTimelinesMap={},this.updatedSelection=!1,this._provider="ms.vss-build-web.run-logs-data-provider",this._poolPermissionProvider="ms.vss-build-web.task-agent-pool-security-data-provider",this._parallelismTagKey="ParallelismTag",this._queuePositionKey="QueuePosition",this._private="Private",this._updateNavigation=()=>{this._updateSelection()},this._noLiveCheck=()=>{if(this._isDone())return void this._timer.clearInterval(this._liveCheckTimer);if(this._isCurrentTaskDone()||this._isCurrentStageDone())return;if(!this._onFocus)return;const e=new Date;new Date(e.getTime()-this._lastUpdate.getTime()).getMinutes()>=1&&(console.info("#resiliency3"),this._initialize(!0))},this._liveLogCheck=e=>{const t=this._getCurrentJob();if(!t||t.id!==e.jobId)return;const s=this._rawData.jobs[this._rawData.jobMap[e.jobId]];let a="";if(s&&s.startTime||(a="1"),e.taskId!==e.jobId){const t=this._rawData.tasks[this._rawData.taskMap[e.taskId]];t&&t.startTime||(a="2")}a&&(this._resiliency[a]||(console.info(`#resiliency${a}`,e,this._rawData.jobs,this._rawData.tasks),this._resiliency[a]=!0,this.onLiveTimelineUpdate(this._rawData.timelineId,0,(()=>{delete this._resiliency[a]}))))},this._onSelectionChange=e=>{const t=this._getCurrentJob(e.jobId);if(t){this._updateLogsData(this._rawData.buildId,e.jobId,e.taskId,this._getTasks(t),e.stageId);const s=this._rawData.jobQueueData[t.id];s&&this._signalR.watchPool(s.poolId);const a=this._getRunningSteps(t);this._followTail&&a.length>0&&a.forEach((e=>{this._fetchLinesForStep(t,e)}))}},this._sortRecords=(e,t)=>e.order>t.order?1:e.order<t.order?-1:0,this._getData=e=>(!this._content[e]&&this._url[e]&&(this._content[e]=(0,Pe.issueRequest)(this._url[e]).then((e=>e.text()))),this._content[e]),this._getLiveData=e=>{var t;return null===(t=this._liveContent[e])||void 0===t?void 0:t.content},this._updateSelection=e=>{const t=null!=e?e:this._historyService.getState();let s=t[g.NavConstants.job]||t.jobId;const a=t[g.NavConstants.stage];if(!s){const e=t[g.NavConstants.stage]||"";if(e){const t=this._rawData.phases.find((t=>t.parentId===e));if(t){const e=this._rawData.jobs.find((e=>e.parentId===t.id));s=e&&e.id}}}let i;if(s){const e=this._getJobById(s);if(e){const t=this._getRunningSteps(e);this._followTail&&t&&t.length>0&&t.forEach((e=>{i=e.id}))}}const n=t[g.NavConstants.task]||t.taskId||i;let r=parseInt(t[g.NavConstants.line]||t.line);const o=(t=!1)=>{let a,i,o="";if(this._storeStageIds){o=(null!=e?e:this._historyService.getState())[g.NavConstants.stage]||""}if(n&&(i=this._getTaskById(n)),s&&(a=this._getJobById(s)),!a)return a=this._rawData.jobs[0],void(a&&this.selectJob(a.id,o));t&&(i?this.selectTask(i.id,o):this.selectJob(a.id,o));const l={jobId:a.id,taskId:i?i.id:"",stageId:o};i&&2===i.state&&!r&&i.issues&&i.issues.length&&(r=parseInt(i.issues[0].data&&i.issues[0].data.logFileLineNumber)),n&&(l.taskSelection={key:n,lineToScroll:isNaN(r)?void 0:r}),this._selection=this._notifyData(this._selection,l)},l=s&&this._getJobById(s);if(l||!a)l&&l.stageId&&!this.updatedSelection?(this.updatedSelection=!0,o(!0),this._updateTreeData()):o();else{const e=this._rawData.jobs[0];e&&this.selectJob(e.id);const t=this._rawData.stages[this._rawData.stageMap[a]];t&&Promise.resolve(this._loadAndUpdateAttempts(t)).then((()=>{this.updatedSelection=!0,o(!0),this._updateTreeData()}))}}}get liveContent(){return this._liveContentData}get logsData(){return this._logsData}get treeData(){return this._treeData}get partialData(){return this._partialData}get selection(){return this._selection}get rawData(){return this._rawData}get followTail(){return this._followTail}setFocused(e){this._onFocus=e}getLogUrl(e){return this._url[e]}bypassCheck(e,t){const s={action:1,checkId:e};return(0,ge.getPipelinesChecksClient)(this.pageContext).updateCheckSuite(s,this._rawData.projectId,t)}updateApprovals(e){return(0,me.getApprovalClient)(this.pageContext).updateApprovals(e,this._rawData.projectId)}rerunCheck(e,t){const s={action:0,checkId:e};return(0,ge.getPipelinesChecksClient)(this.pageContext).updateCheckSuite(s,this._rawData.projectId,t)}updatePermissions(e,t,s){return(0,pe.getPipelinePermissionsClient)(this.pageContext).updatePipelinePermisionsForResource(e,this._rawData.projectId,t,s).catch(ie.handleError)}refresh(){this._initialize(!0)}createRecord(e,t,s){const a=(0,v.getTimelineStatusIndicatorData)(e.state,e.result,e.stateData&&e.stateData.pendingChecks,e.stateData&&!e.stateData.pendingDependencies),i=a.statusProps;let n;return i.ariaLabel=a.label,(!e.refName||e.refName&&e.refName.indexOf("JobExtension")>-1&&"success"===i.color)&&(n=Object.assign(Object.assign({},i),{color:"system-task"})),{name:e.name,refName:e.refName,id:e.id,statusProps:n||i,start:e.startTime,end:e.finishTime,isJob:t,isTask:s,issues:e.issues,workerName:e.workerName,state:e.state,result:e.result,percentComplete:e.percentComplete,stageId:e.stageId}}createAttemptRecord(e,t,s,a,i){return{name:t,refName:e,id:e+t,statusProps:void 0,isJob:s,isTask:a,stageId:i}}createActionRecord(e,t,s,a){return{name:e,id:(0,o.newGuid)(),statusProps:void 0,isJob:t,isTask:s,stageId:void 0,onClick:a}}createTask(e,t){const s=t.id;this._updateUrl(e,s,t.logId);const a=this.createRecord(t,!1,!0),i=!!this.getLogUrl(s)||!!this._liveContent[s]||4===t.result&&!!t.message,n=!i&&2==t.state;return null!=this._expanded[s]&&this._expanded[s]||(this._expanded[s]=1===t.state),{key:s,title:t.name,isExpanded:this._expanded[s],getData:()=>{if(2!==t.state){const e=this._getData(s);return e?(this._refreshWhenCompleted[s]=!0,new Promise((async(t,a)=>{t(await e+this._getLiveData(s))}))):this._getLiveData(s)}return 4===t.result?t.message:(delete this._liveContent[s],this._refreshWhenCompleted[s]&&(delete this._refreshWhenCompleted[s],delete this._content[s]),n?Promise.resolve(Ve.NoLogsToShow):this._getData(s))},statusProps:(0,v.getTimelineStatusIndicatorData)(t.state,t.result).statusProps,hasData:i||n,payload:Object.assign({jobId:t.parentId},a),hidden:!0}}selectJob(e,t=""){const s=this._historyService.getState();if(delete s[g.NavConstants.line],delete s[g.NavConstants.task],delete s[g.NavConstants.stage],s[g.NavConstants.job]=e,this._storeStageIds&&t)s[g.NavConstants.stage]=t;else{const t=this._getJobById(e);t&&t.stageId&&(s[g.NavConstants.stage]=t.stageId+"")}this._historyService.replaceState(s),this._updateSelection()}selectTask(e,t=""){const s=this._historyService.getState();delete s[g.NavConstants.line],delete s[g.NavConstants.task],delete s[g.NavConstants.stage];const a=this._getTaskById(e);if(a){if(this._getJobById(a.parentId))s[g.NavConstants.job]=a.parentId;else{const e=this._getTaskById(a.parentId);e&&(s[g.NavConstants.job]=e.parentId)}}s[g.NavConstants.task]=e,this._storeStageIds&&t?s[g.NavConstants.stage]=t:a&&a.stageId&&(s[g.NavConstants.stage]=a.stageId+""),this._historyService.replaceState(s),this._updateSelection()}setFollowTail(e){this._followTail=e}expandStage(e){this._expandedStages[e.data.id]=!!e.expanded}onLiveContent(e){var t,s,a,i;if(e.timelineId!==this._rawData.timelineId)return;const n=this._selection.value&&this._selection.value.jobId,r=this._selection.value&&this._selection.value.taskId;if(this._lastUpdate=new Date,e.taskId===p&&n)for(let t=0;t<this._rawData.tasks.length;t++){const s=this._rawData.tasks[t];if(s.parentId===n&&1===s.state){e.taskId=s.id;break}}if(e.taskId!==p){n===e.jobId&&this._initJobPendingReason(this._getCurrentJob()),this._liveLogCheck(e);let o=null!==(s=null===(t=this._liveContent[e.taskId])||void 0===t?void 0:t.content)&&void 0!==s?s:"";o=o.length>0?o+"\n":"",this._liveContent[e.taskId]={content:o+e.content,startLine:null!==(i=null===(a=this._liveContent[e.taskId])||void 0===a?void 0:a.startLine)&&void 0!==i?i:1},this._followTail&&n===e.jobId&&r!=e.taskId&&this.selectTask(e.taskId,void 0),n===e.jobId&&(this._liveContentData.value=e)}}onLiveTimelineUpdate(e,t,s){e===this._rawData.timelineId&&(this._marker||(this._marker=t),this._marker<t&&(this._marker=t),this._lastUpdate=new Date,this._initNoLiveCheck(),this._fetchTimeline(this._marker).then((e=>{if(e){this._marker<e.changeId&&(this._marker=e.changeId);const t=[],a=[],i=[],n=[],r=[],o=[],l=[],c=[];this._merge(e.stages,this._rawData.stages,this._rawData.stageMap,t,r),this._merge(e.phases,this._rawData.phases,this._rawData.phaseMap,a,o,(e=>{this._updateOrder(e,m,this._rawData.stageMap,this._rawData.stages)})),this._merge(e.jobs,this._rawData.jobs,this._rawData.jobMap,i,l,(e=>{if(this._updateOrder(e,1e5,this._rawData.phaseMap,this._rawData.phases),"Job"===e.name){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]];t&&t.name&&t.name!==e.name&&t.name.length>0&&(e.name=t.name)}})),this._merge(e.tasks,this._rawData.tasks,this._rawData.taskMap,n,c,(e=>{this._updateOrder(e,1e6,this._rawData.jobMap,this._rawData.jobs)})),this._normalizeRawData(),this._updateTreeData(),this._ensureSelection();const d=this._getCurrentJob(),u=this._getCurrentTask();let h,p;u&&(h=u&&(n.indexOf(u.id)>-1||c.indexOf(u.id)>-1)),d&&(p=i.indexOf(d.id)>-1||l.indexOf(d.id)>-1),d&&(p&&this._followTail||h)&&(this._updateLogsData(this._rawData.buildId,d.id,u?u.id:"",this._getTasks()),2!==d.state||this._jobCompletedCalls[d.id]||(this._jobCompletedCalls[d.id]=!0,this._updateArtifacts(d,!0),this._updateTestData(d,this._rawData.phases[this._rawData.phaseMap[d.parentId]],!0))),s&&s()}})))}onLiveRequestUpdate(e,t,s){const a=this._getCurrentJob(t.jobId);if(a){const e=this._jobStatus[a.id];let i=!1;if(e)e.poolId===t.poolId&&e.requestId===t.requestId&&(i=!0);else if(s){const e=this._rawData.jobQueueData[a.id];if(e)t.poolId===e.poolId&&(i=!0);else{const e={};e[g.NavConstants.buildId]=this._rawData.buildId+"",e[g.NavConstants.update]=g.NavConstants.jobQueueData,this._contributionService.getDataAsync(this._provider,e,!0).then((e=>{if(e){const s=e;this._rawData.jobQueueData=s.jobQueueData||this._rawData.jobQueueData||{};const i=this._rawData.jobQueueData[a.id];i&&t.poolId===i.poolId&&this._initJobPendingReason(a)}}))}}i&&this._initJobPendingReason()}}onLiveAgentStatusUpdate(e,t){const s=this._getCurrentJob();if(s){const e=this._jobStatus[s.id];e&&e.matchedAgents.indexOf(t)>-1&&this._initJobPendingReason()}}_serviceStart(e){super._serviceStart(e),this._timer=new be.TimerManagement,this._liveLogCheck=this._timer.throttle(this._liveLogCheck,600),this._partialData=new u.ObservableValue(void 0),this._selection=new u.ObservableValue(void 0),this._liveContentData=new u.ObservableValue(void 0),this._selection.subscribe(this._onSelectionChange),this._contributionService=this.pageContext.getService("IVssContributionService"),this._historyService=this.pageContext.getService("IVssHistoryService"),this._signalR=this.pageContext.getService("ISignalRService"),this._extService=this.pageContext.getService("IRunExternalService"),this._linking=this.pageContext.getService("IBuildLinkingService"),this._historyService.subscribe(this._updateNavigation),this._dtClient=(0,Ee.getTaskAgentClient)(this.pageContext),this._storeStageIds=(0,b.isFeatureFlagEnabled)(this.pageContext,"Pipelines.StoreStageIds",!1),this._initialize()}_serviceEnd(e){super._serviceEnd(e),this._selection.unsubscribe(this._onSelectionChange),this._historyService.unsubscribe(this._updateNavigation),this._timer.dispose()}getCurrentJobId(){const e=this._getCurrentJob();if(e)return e.refName}getCurrentPhaseId(){const e=this._getCurrentJob(),t=e&&this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(t)return t.refName}_getCurrentStage(){const e=this._getCurrentJob();if(e)return this._getStageRecord(e)}getCurrentStageId(){const e=this._getCurrentStage();if(e)return e.refName}getCurrentStageName(){const e=this._getCurrentStage();if(e)return e.originalName}bumpJobPriority(e){const t=this._jobStatus[e].poolId,s=this._jobStatus[e].requestId;this._dtClient.updateAgentRequest({requestId:s},t,s,p,1).then((e=>{this._initJobPendingReason()}))}canPriorityBeBumped(e){const t=this._jobStatus[e];return(0,b.isFeatureFlagEnabled)(this.pageContext,"DistributedTask.BumpAgentRequestPriority",!1)&&t&&this._security.hasManageAgentPoolPermission(t.poolId)&&void 0!==t.data[this._queuePositionKey]&&parseInt(t.data[this._queuePositionKey])>1}_ensureSelection(){if(this._resetPhaseSelection){const e=(this._rawData.jobs||[]).find((e=>e.parentId===this._resetPhaseSelection));e&&(this.selectJob(e.id),this._resetPhaseSelection=void 0)}}_initialize(e=!1){const t=e?void 0:this._contributionService.getData(this._provider);if(t)this._permissionsStore=new ve.PermissionsStore({pageContext:this.pageContext}),this._security=new _e.Security({projectId:t.projectId,store:this._permissionsStore}),this._initializeData(t);else if(this._rawData){const e={};e[g.NavConstants.buildId]=this._rawData.buildId+"",this._contributionService.getDataAsync(this._provider,e,!0).then((e=>{e&&this._initializeData(e)}))}}_initializeData(e){this._rawData=e;const t=this._historyService.getState();this._rawData.jobs.map((async e=>{var s;await(null===(s=e.previousAttempts)||void 0===s?void 0:s.forEach((async e=>{await this._loadAndUpdateAttempts({},null==e?void 0:e.timelineId),t[g.NavConstants.job]===e.recordId&&this._previousTimelines&&this._updateSelection(t)})))})),this._normalizeRawData(),console.log(this._rawData),this._initNoLiveCheck(),this._updateSelection(t),this._updateSelection(),this._updateTreeData()}_fetchTimeline(e,t,s){const a={};return a[g.NavConstants.buildId]=this._rawData.buildId+"",a[g.NavConstants.timelineId]=t||this._rawData.timelineId,a[g.NavConstants.changeId]=e+"",a[g.NavConstants.fullTimeline]=!!s+"",this._contributionService.getDataAsync("ms.vss-build-web.run-timeline-data-provider",a)}async _loadAndUpdateAttempts(e,t){const s={};s[g.NavConstants.buildId]=this._rawData.buildId.toString(),e.refName&&(s[g.NavConstants.stageName]=e.refName),t&&(s.timelineId=t);const a=await this._contributionService.getDataAsync("ms.vss-build-web.run-attempts-data-provider",s);a&&(e.id?a.forEach((t=>{t&&this._addPreviousTimeline(t,e)})):a&&a.forEach((e=>{e.stages.forEach((t=>this._addPreviousTimeline(e,t)))})))}_fetchLines(e,t,s){const a={};return a[g.NavConstants.planId]=this._rawData.planId,a[g.NavConstants.timelineId]=this._rawData.timelineId,a[g.NavConstants.jobId]=e,a[g.NavConstants.stepId]=t,s&&(a[g.NavConstants.continuationToken]=s),this._contributionService.getDataAsync("ms.vss-build-web.run-lines-data-provider",a)}_normalizeRawData(){let e=!1;this._rawData.stages=(this._rawData.stages||[]).sort(this._sortRecords),this._rawData.phases=(this._rawData.phases||[]).sort(this._sortRecords),this._rawData.jobs=(this._rawData.jobs||[]).sort(this._sortRecords),this._rawData.tasks=(this._rawData.tasks||[]).sort(this._sortRecords),this._rawData.stageMap=this._rawData.stageMap||{},this._rawData.phaseMap=this._rawData.phaseMap||{},this._rawData.jobMap=this._rawData.jobMap||{},this._rawData.taskMap=this._rawData.taskMap||{},this._rawData.jobQueueData=this._rawData.jobQueueData||{},this._updateMaps(),this._rawData.stages.forEach((e=>{e.previousAttempts=e.previousAttempts.sort(((e,t)=>t.attempt-e.attempt))}));const t=new Set;this._rawData.jobs.forEach((e=>{e.id!==e.parentId&&t.add(e.parentId)}));const s=this._rawData.jobs.slice();t.forEach((t=>{const a=this._rawData.jobMap[t],i=s[a];i&&i.id===i.parentId&&(this._selection.value&&this._selection.value.jobId===i.id&&(this._resetPhaseSelection=i.id),delete this._rawData.jobMap[t],s.splice(a,1),e=!0,s.forEach(((e,t)=>{this._rawData.jobMap[e.id]=t})))})),e&&(this._rawData.jobs=s.sort(this._sortRecords),this._updateMaps())}_updateMaps(){this._rawData.stages.forEach(((e,t)=>{this._rawData.stageMap[e.id]=t})),this._rawData.phases.forEach(((e,t)=>{this._rawData.phaseMap[e.id]=t})),this._rawData.jobs.forEach(((e,t)=>{this._rawData.jobMap[e.id]=t})),this._rawData.tasks.forEach(((e,t)=>{this._rawData.taskMap[e.id]=t}))}_merge(e,t,s,a,i,n){(e||[]).forEach((e=>{n&&n(e);const r=s[e.id];void 0!==r?(t[r]=e,a.push(e.id),s[e.id]=r):(t.push(e),i.push(e.id))}))}_initNoLiveCheck(){this._isDone()?this._liveCheckTimer&&this._timer.clearInterval(this._liveCheckTimer):this._liveCheckTimer||(this._liveCheckTimer=this._timer.setInterval(this._noLiveCheck,6e4))}_isDone(){let e=!0;for(let t=0;t<this._rawData.stages.length;t++){if(2!==this._rawData.stages[t].state){e=!1;break}}return e}_isCurrentTaskDone(){const e=this._getCurrentTask();return 2===(null==e?void 0:e.state)}_isCurrentStageDone(){const e=this._getCurrentStage();return 2===(null==e?void 0:e.state)}_updateOrder(e,t,s,a){const i=s&&s[e.parentId];return void 0!==i&&(e.order=e.originalOrder+t*a[i].originalOrder),e}_getCurrentJob(e){const t=e||this._selection.value&&this._selection.value.jobId;if(t)return this._getJobById(t)}_getCurrentTask(e){const t=e||this._selection.value&&this._selection.value.taskId;if(t)return this._getTaskById(t)}_getJobSection(e){const t=this.createRecord(e,!0,!1);let s="";s+=(t.issues||[]).map((e=>{const t=(0,De.escape)(e.message);let s="";return 1===e.type&&(s+=r+t),2===e.type&&(s+=l+t),s+h}));let i=t.start;if(!i&&0!==e.state){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(t&&(i=t.startTime,!i)){const e=this._rawData.stages[this._rawData.stageMap[t.parentId]];e&&(i=e.startTime)}}const u=this._rawData.jobQueueData[e.id];if(u){const e=this._getPoolUrl(u.id),t=u.poolName||u.name||u.poolId+"";s+=(0,o.format)(Ve.JobInfoPool,a(e,(0,De.escape)(t))),s+=h,u.imageName&&(s+=(0,o.format)(Ve.JobInfoImage,(0,De.escape)(u.imageName)),s+=h)}const m=this._jobStatus[e.id];if(u&&m){const e=this.pageContext.getService("IVssPageService").getData();if(void 0===e||e.isHosted){const e=m.data[this._parallelismTagKey]||this._private,t=this._getParallelJobsUrl(u.isHosted,e);s+=(0,o.format)(Ve.JobInfoQueued,(0,F.ago)(m.queueTime,1),a(t,Ve.ParallelJobsLinkText)),s+=h}else s+=(0,o.format)(Ve.JobInfoQueuedOnPrem,(0,F.ago)(m.queueTime,1)),s+=h}t.workerName&&(s+=(0,o.format)(Ve.JobInfoAgent,(0,De.escape)(t.workerName)),s+=h),i&&(s+=(0,o.format)(Ve.JobInfoStart,(0,F.ago)(i,1)),s+=h,2===t.state&&(s+=(0,o.format)(Ve.JobInfoDuration,(0,F.duration)(i,t.end)),s+=h)),m&&(s+=h+m.statusMessage);const p=this._rawData.phases[this._rawData.phaseMap[e.parentId]];if(p&&p.logId&&(this._phaseLog[p.id]?s+=h+c+Ve.PrepareJob+h+this._phaseLog[p.id]+h+d:s+=h,p.logId&&this._updatePhaseLog(e,p)),this._rawData.parameters)try{const e=/\,(?!\s*?[\{\[\"\'\w])/g,t=JSON.parse((this._rawData.parameters||"").replace(e,"")),a=Object.keys(t).length;if(this._rawData.queueStatus>0)s+=Ve.PipelinePaused;else if(a>0){const e=a>1?Ve.QueueTimeVariablesGroup:Ve.QueueTimeVariableGroup,i=(0,o.format)(e,a)+h,r=Object.keys(t).reduce(((e,s)=>e+s+" : "+(t[s]||"undefined")+h),"");s+=h+c+n("Variable")+i+r+h+d}}catch(e){}if(this._rawData.templateParameters)try{const e=this._rawData.templateParameters,t=Object.keys(e).length;if(t>0){const a=(0,o.format)(Ve.RuntimeParameterGroup,t)+h,i=Object.keys(e).reduce(((t,s)=>t+s+" : "+(JSON.stringify(e[s])||"undefined")+h),"");s+=h+c+n("Variable")+a+i+h+d}}catch(e){}this._updateArtifacts(e);const _=this._jobArtifactData[e.id];if(_&&_.publishedArtifactsCount>0){const t=this._jobArtifactData[e.id].publishedArtifactsCount,i=t>1?Ve.ArtifactsCount:Ve.ArtifactCount,r=this._linking.getBuildUrl(this._rawData.buildId,g.NavConstants.artifacts,void 0,void 0,{pathAsName:"false"}),l=a(r,(0,o.format)(i,t)),c=(0,o.format)(Ve.ArtifactsCountFormat,l);s+=h+n("Package")+c}this._updateTestData(e,p);const v=this._jobTestData[e.id];if(v&&v.testsCount>0){const t=a(this._extService.getTestTabLink(this._rawData.buildId),(0,o.format)(Ve.TestResultTestsFormat,P.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(this._jobTestData[e.id].testsPassRate,1))),i=(0,o.format)(Ve.TestResultPassedFormat,t);s+=h+n("TestBeaker")+i}return e.message&&(s+=e.message),this._liveContent[e.id]&&(s+=h+Ve.JobLiveData+h+this._liveContent[e.id].content+h),s?{key:e.id,title:Ve.JobInformation,iconProps:{iconName:"Processing"},hasData:!0,isExpanded:!0,getData:()=>s,showHtml:!0,noAutoScroll:!0,hidden:!0}:null}_getPoolUrl(e){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.run-pools-route",{project:this._rawData.projectId,queueId:e+""})}_getParallelJobsUrl(e,t){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.build-queue-route",{project:this._rawData.projectId,isHosted:e+"",parallelismTag:t})}_fetchLinesForStep(e,t,s){this._fetchLines(e.id,t.id,s).then((s=>{var a,i,n;if(s){const r=this._getRunningSteps(e).find((e=>e.id===s.stepId));let o=s.content||"",l=null!==(i=null===(a=this._liveContent[s.stepId])||void 0===a?void 0:a.startLine)&&void 0!==i?i:Number.MAX_SAFE_INTEGER;if(r&&s.timelineId===this._rawData.timelineId&&s.stepId===r.id){if(s.startLine>=l)return;let a;if(this._liveContent[s.stepId]={content:o+((null===(n=this._liveContent[s.stepId])||void 0===n?void 0:n.content)||""),startLine:s.startLine},this._liveContentData.value={content:o,jobId:e.id,taskId:s.stepId,timelineId:s.timelineId},s.continuationToken?(a=this.createTask(this._rawData.buildId,r),a.asyncInfo={getMore:s=>{this._linesFetching[s]||(this._linesFetching[s]=!0,this._fetchLinesForStep(e,t,s))},hasMore:!0,payload:s.continuationToken}):(a=this.createTask(this._rawData.buildId,r),a.asyncInfo=void 0),this._selection.value&&(this._selection.value.taskId===s.stepId||this._selection.value.jobId===e.id&&""===this._selection.value.taskId)){const e={updatedSections:[a]};this._partialData=this._notifyData(this._partialData,e)}}}}))}_getRunningSteps(e){return this._getTasks(e,(e=>1===e.state))}_updateUrl(e,t,s){s&&(this._url[t]=this._getUrl(e,t,s))}_getUrl(e,t,s){return(0,i.routeUrl)(this.pageContext,"ms.vss-build-web.run-build-logsapi-route",{project:this._rawData.projectId,buildId:e+"",logId:s+""})}async _updateTestData(e,t,s){if(t&&(s||!this._jobTestData[e.id]&&!this._skipTestCall[e.id])){const s=this._rawData.stages[this._rawData.stageMap[t.parentId]];try{const a=await this._extService.getTestsResultsForJob(this._rawData.buildId,{jobName:e.refName,phaseName:t.refName,stageName:s.refName});a&&this._selection.value&&(this._jobTestData[e.id]=a,this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e)),2===e.state&&(this._skipTestCall[e.id]=!0)}catch(t){this._skipTestCall[e.id]=!0}}}async _updatePhaseLog(e,t){if(!this._phaseLog[t.id]&&t&&t.logId){const s=await(0,Pe.issueRequest)(this._getUrl(this._rawData.buildId,t.id,t.logId));let a=(0,De.escape)(await s.text()).split("\n");a=a.splice(1,a.length),a=a.splice(0,a.length-2),this._phaseLog[t.id]=a.join("\n"),this._selection.value&&this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e)}}async _updateArtifacts(e,t){if(t||!this._jobArtifactData[e.id]&&!this._skipArtifactsCall[e.id]){const t={};t[g.NavConstants.buildId]=this._rawData.buildId+"",t.source=e.id,2===e.state&&(this._skipArtifactsCall[e.id]=!0);const s=await this._contributionService.getDataAsync("ms.vss-build-web.run-details-artifacts-data-provider",t,!0);s&&this._selection.value&&(this._jobArtifactData[e.id]=s,this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e))}}_updateJobSection(e){const t=this._getJobSection(e);if(t){const e={buildId:this._logsData.value.buildId,job:this._logsData.value.job,stage:this._logsData.value.stage,message:this._logsData.value.message,sections:[t]};this._logsData=this._notifyData(this._logsData,e)}}_getStageRecord(e){const t=this._rawData.phases[this._rawData.phaseMap[e.parentId]],s=e.stageRef,a=e.timelineId;if(t)return this._rawData.stages[this._rawData.stageMap[t.parentId]];if(s&&a){return this._previousTimelines[this._previousTimelinesMap[s][a]].stages.find((e=>e.refName=s))}}_updateLogsData(e,t,s,a,i=""){const n=this._getCurrentJob(t);if(!n)return;this._rawData.phases[this._rawData.phaseMap[n.parentId]];let r=[];const o=this._getTaskById(s);if(o)r.push(this.createTask(e,o));else{const e=this._getJobSection(n);e&&r.unshift(e)}const l=this._rawData.throttleMessage;0==r.length&&(r=[{key:"",title:"",hasData:!0,isExpanded:!0,hidden:!0,className:"empty-sec",noAutoScroll:!0,getData:()=>l||(4==n.result?Ve.SkippedJobLogs:this._rawData.queueStatus?Ve.PipelinePaused:Ve.NoLogs)}]);const c=this._getStageRecord(n);let d;c&&(d=Object.assign(Object.assign({},this.createRecord(c,!1,!1)),{checks:c.checks||[]}));let u=null==d?void 0:d.start,h=null==c?void 0:c.attempt;if(this._storeStageIds&&i&&d&&d.id!=i){let e=d.refName||"";if(this._previousTimelinesMap[e]&&void 0!==this._previousTimelinesMap[e][i]){let t=this._previousTimelinesMap[e][i],s=this._previousTimelines[t].stages.find((t=>t.refName==e));c&&s&&(u=null==s?void 0:s.startTime,h=null==s?void 0:s.attempt)}}const m=o?{buildId:e,job:this.createRecord(o,!1,!0),stage:d,sections:r}:{buildId:e,job:this.createRecord(n,!0,!1),stage:d,sections:r},p=this._getPhaseById(n.parentId);c&&p&&h&&(h>p.attempt||h>n.attempt)&&u&&n.startTime&&u>n.startTime&&(m.message=Ve.OldJobAttempt),this._logsData=this._notifyData(this._logsData,m),this._initJobPendingReason(n)}_updateTreeData(){const e=this._rawData.jobs,t=this._rawData.phases,s=this._rawData.stages,a=this._rawData.tasks,i={items:[]},n={},r={};1==s.length&&"__default"===s[0].refName&&(s[0].name=Ve.JobsTitle),s.forEach(((e,t)=>{const s={data:this.createRecord(e,!1,!1)};e.previousAttempts.length>0&&(r[e.id]=r[e.id]||{},s.childItems=[],s.childItems.push({data:this.createAttemptRecord(e.refName,(0,o.format)(Ve.AttemptNumber,e.attempt),!1,!1,e.id)}),r[e.id][e.attempt]=0,this._previousTimelinesMap[e.refName]?e.previousAttempts.forEach(((t,a)=>{s.childItems=s.childItems||[],s.childItems.push({data:this.createAttemptRecord(e.refName,(0,o.format)(Ve.AttemptNumber,t.attempt),!1,!1,t.timelineId)}),r[e.id][t.attempt]=a+1})):s.childItems.push({data:this.createActionRecord(Ve.ShowPreviousAttempts,!1,!1,(()=>{Promise.resolve(this._loadAndUpdateAttempts(e)).then((()=>{this._updateTreeData()}))}))})),i.items.push(s),n[e.id]=t}));const l={};t.forEach((e=>{l[e.id]=e.parentId}));const c=this._selection&&this._selection.value&&this._selection.value.jobId;e.forEach((e=>{this._updateUrl(this._rawData.buildId,e.id,e.logId);const t=c===e.id,s=l[e.parentId],o=n[s],d={data:this.createRecord(e,!0,!1),expanded:t};if(a.filter((e=>e.parentId===d.data.id)).forEach((e=>{void 0===d.childItems&&(d.childItems=[]);const t={data:this.createRecord(e,!1,!0),expanded:!1};d.childItems.push(t),a.forEach((e=>{e.parentId===t.data.id&&(void 0===t.childItems&&(t.childItems=[]),t.childItems.push({data:this.createRecord(e,!1,!0),expanded:!1}))}))})),void 0!==o){let e=i.items[o];(t||this._expandedStages[s])&&(e.expanded=!0,this._expandedStages[e.data.id]=!0),s in r&&(e.childItems=e.childItems||[],e=e.childItems[0],(t||this._expandedStages[e.data.id])&&(e.expanded=!0,this._expandedStages[e.data.id]=!0)),e.childItems=e.childItems||[],e.childItems.push(d)}else i.items.push(d)})),s.forEach((e=>{if(e.refName in this._previousTimelinesMap)for(const t of e.previousAttempts){const s=this._previousTimelinesMap[e.refName][t.timelineId],o=this._previousTimelines[s];void 0!==o&&o.jobs.forEach((s=>{const l=c===s.id,d=n[e.id],u=i.items[d],h=r[e.id][t.attempt];u.childItems=u.childItems||[];const m=u.childItems[h],p={data:this.createRecord(s,!0,!1),expanded:l};(l||this._expandedStages[m.data.id])&&(m.expanded=!0,this._expandedStages[m.data.id]=!0);o.tasks.filter((e=>e.parentId===p.data.id)).forEach((e=>{void 0===p.childItems&&(p.childItems=[]);const t={data:this.createRecord(e,!1,!0),expanded:!1};p.childItems.push(t),a.forEach((e=>{e.parentId===t.data.id&&(void 0===t.childItems&&(t.childItems=[]),t.childItems.push({data:this.createRecord(e,!1,!0),expanded:!1}))}))})),m.childItems=m.childItems||[],m.childItems.push(p)}))}})),this._treeData=this._notifyData(this._treeData,i)}_initJobPendingReason(e){if(!(e=e||this._getCurrentJob()))return;const t=this._rawData.jobQueueData[e.id];if(t&&2!==e.state&&1!==e.state){const s=this._jobStatus[e.id];s?this._dtClient.getAgentRequest(t.poolId,s.requestId,!0).then((t=>{e&&this._updateJobPendingReason(e,t)})):this._dtClient.getAgentRequestsForPlan(t.poolId,this._rawData.planId).then((s=>{const a=s.find((t=>t.jobId===e.id));a&&this._dtClient.getAgentRequest(t.poolId,a.requestId,!0).then((s=>{const a={};a[g.NavConstants.poolId]=t.poolId+"",this._contributionService.getDataAsync(this._poolPermissionProvider,a).then((()=>{e&&this._updateJobPendingReason(e,s)}))}))}))}}_updateJobPendingReason(e,t){const s=this._selection.value&&this._selection.value.jobId;e.id===s&&(this._jobStatus[e.id]={poolId:t.poolId,requestId:t.requestId,matchedAgents:(t.matchedAgents||[]).map((e=>e.id)),statusMessage:t.statusMessage,data:t.data,queueTime:t.queueTime,priority:t.priority},this._selection.value&&this._selection.value.jobId===e.id&&""===this._selection.value.taskId&&this._updateJobSection(e))}_getTasks(e,t){const s=[];e&&!(e.id in this._rawData.jobMap)||s.push(...this._rawData.tasks),e&&e.id in this._rawData.jobMap||this._previousTimelines.forEach((e=>{s.push(...e.tasks)}));const a=[],i=[];return s.forEach((s=>{t&&!t(s)||e&&s.parentId!==e.id?i.push(s):a.push(s)})),a.forEach((e=>{const t=i.find((t=>e.id===t.parentId));t&&a.push(t)})),a}_getPhaseById(e,t=!0){return e in this._rawData.phaseMap?this._rawData.phases[this._rawData.phaseMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.phases)):void 0}_getJobById(e,t=!0){return e in this._rawData.jobMap?this._rawData.jobs[this._rawData.jobMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.jobs)):void 0}_getTaskById(e,t=!0){return e in this._rawData.taskMap?this._rawData.tasks[this._rawData.taskMap[e]]:t?this._getRecordFromPreviousTimeline(e,(e=>e.tasks)):void 0}_getRecordFromPreviousTimeline(e,t){for(const s of this._previousTimelines){const a=t(s).find((t=>t.id===e));if(a)return a}}_addPreviousTimeline(e,t){e.timelineId!=this._rawData.timelineId&&(t=t||e.stages[0],e.jobs.forEach((s=>{const a=s;a.timelineId=e.timelineId,a.stageId=t?t.id:void 0,a.stageRef=t?t.refName:void 0})),e.tasks.forEach((s=>{const a=s;a.timelineId=e.timelineId,a.stageId=t?t.id:void 0,a.stageRef=t?t.refName:void 0})),e.jobs=e.jobs.sort(this._sortRecords),e.tasks=e.tasks.sort(this._sortRecords),this._previousTimelinesMap[t.refName]=this._previousTimelinesMap[t.refName]||{},this._previousTimelinesMap[t.refName][e.timelineId]=this._previousTimelines.push(e)-1)}_notifyData(e,t){return e&&(e.value=t),e||new u.ObservableValue(t)}}t[e].RunLogsService=_,T.Services.add("IRunLogsService",{serviceFactory:_})}("RunLogsService"),function(e){t[e]={};const a=(e,t,a,i)=>{const n=i.underlyingItem.data,r=n,l=n,c=r.percentComplete&&!r.end?s.createElement("span",null,(0,o.format)(Ve.PercentComplete,r.percentComplete)):void 0,d=r.start?s.createElement(I.Duration,{startDate:r.start,endDate:r.end}):void 0,u=s.createElement("div",{className:"job-detail text-ellipsis flex body-m flex-row flex-grow "+(n.isJob||n.isTask?"is-job":"")},s.createElement(k.Tooltip,{text:n.name},s.createElement("div",{className:"flex flex-center flex-grow text-ellipsis job-name-area"},(n.isJob||n.isTask)&&s.createElement(f.Status,Object.assign({},n.statusProps,{className:"icon-large-margin",size:"16"})),s.createElement(h.Link,{className:"text-ellipsis",subtle:!l.onClick,onClick:l.onClick,removeUnderline:!0},s.createElement("span",null,n.name)))),s.createElement("div",{className:"job-duration flex flex-self-end"},c||d));return(0,A.ExpandableTreeCell)({children:u,columnIndex:t,treeColumn:a,treeItem:i,className:"run-tree-cell "+(n.isJob?"run-job-cell":"")})},i=(e,t)=>s.createElement("th",{"aria-colindex":e+1,"aria-readonly":"true",className:"body-m bolt-table-header-cell col-header-0","data-column-index":"0","data-focuszone":"false",tabIndex:-1,key:t.id},s.createElement("div",{className:"bolt-table-header-cell-content flex-row"},s.createElement("div",{className:"bolt-table-header-cell-text text-ellipsis body-m"},t.name))),r="logs-view",l="dark-run-logs";class m extends n.VssComponent{constructor(e,t){super(e,t),this._reader=s.createRef(),this._commandsUpdate=new u.ObservableValue(!1),this._searchActive=!1,this._searchText=new u.ObservableValue(""),this._search=s.createRef(),this._showTimestamps=new u.ObservableValue(!1),this._projectId="",this._showChecksPanel=new u.ObservableValue(!1),this._checkListItemType=new u.ObservableValue(3),this._showMasterPanelXSmallScreen=new u.ObservableValue(!0),this._enableStagesSorting=!1,this._enableSingleRowSelection=!1,this._storeStageIds=!1,this._onReviewClick=e=>{this._showChecksPanel.value=!0,this._checkListItemType.value=3,this._activeElement=document.activeElement},this._onChecksPanelDismiss=()=>{this._showChecksPanel.value=!1,this._activeElement&&(this._activeElement.focus(),this._activeElement=void 0)},this._onSubmitBulkApproval=e=>{this._service.updateApprovals(e).then((e=>{e&&(this._service.refresh(),this._onChecksPanelDismiss())})).catch(ie.handleError)},this._onReassignApprovals=e=>this._service.updateApprovals(e).then((e=>{if(e)return this._service.refresh(),this._onChecksPanelDismiss(),this._globalMessageService.addToast({message:Ve.ApprovalReassigned,duration:5e3,forceOverrideExisting:!0}),Promise.resolve()}),(e=>Promise.reject(e))),this._onRerunCheck=(e,t)=>this._service.rerunCheck(e,t).then((e=>{if(e)return this._service.refresh(),this._onChecksPanelDismiss(),Promise.resolve()}),(e=>Promise.reject(e))),this._onBypassCheck=(e,t)=>this._service.bypassCheck(e,t).then((e=>{if(e)return this._service.refresh(),this._onChecksPanelDismiss(),Promise.resolve()}),(e=>Promise.reject(e))),this._onPermitResource=(e,t,s)=>{this._service.updatePermissions(e,t,s).then((e=>{e&&(this._globalMessageService.addToast({message:Ve.PermissionGranted,duration:5e3,forceOverrideExisting:!0}),this._service.refresh())}))},this._onDown=()=>{this._reader.current&&this._reader.current.toEnd()},this._onUp=()=>{this._reader.current&&this._reader.current.toHome()},this._onSearch=(e,t)=>{this._reader.current&&(this._searchText.value=t,this._reader.current.find(t))},this._onKeyDown=e=>{const t=e.key.toLowerCase();(e.metaKey||e.ctrlKey)&&"f"===t&&(this._showFind(),e.preventDefault())},this._onSearchKeyDown=e=>{const t=e.key.toLowerCase(),s=this._reader.current;"escape"===t?this._hideFind():e.shiftKey&&"enter"===t?s&&s.findPrev():"enter"===t?s&&s.findNext():"tab"==t&&requestAnimationFrame((()=>{const e=document.getElementById("__bolt-log-up");e&&e.focus()}))},this._getFarRight=e=>{const t=e.payload;return t&&t.start?s.createElement(I.Duration,{startDate:t.start,endDate:t.end}):null},this._getLeftHeader=()=>{const e=this._service.rawData;return s.createElement(Me.SingleLayerMasterPanelHeader,{title:(0,o.format)(Ve.JobsInRun,e.buildNumber),subTitle:e.definitionName,onBackButtonClick:this._onBackClick})},this._getLeftContent=()=>{let e=[];if(this._enableStagesSorting){let t=this._sortStageList(this._service.treeData.value.items,this._service.rawData.stageDependencies);for(let s=0;s<t.sorted.length;s++){this._selection.push(new z.ListSelection(!1));const a=t.sorted[s],i=t.indexes[s];e=this._pushStageToList(e,a,i)}}else this._service.treeData.value.items.forEach(((t,s)=>{this._selection.push(new z.ListSelection(!1)),e=this._pushStageToList(e,t,s)}));return s.createElement("div",{className:"run-logs-tree flex-grow flex-"},e)},this._clearOtherSelections=e=>{if(this._selection)for(let t=0;t<this._selection.length;t++){if(t===e)continue;const s=this._selection[t];(null==s?void 0:s.clear)&&s.clear()}},this._pushStageToList=(e,t,n)=>(e.push(s.createElement(c.Observer,{data:this._service.treeData,key:t.data.id},(e=>{const r=new L.TreeItemProvider(e.data.items[n].childItems||[]),o=[{hierarchical:!0,id:t.data.id,renderCell:a,name:t.data.name,renderHeaderCell:i,headerClassName:"body-m",width:-100}];return s.createElement(A.Tree,{key:t.data.id,showHeader:!0,role:"treegrid",renderRow:(e,t,s)=>{var a,i,r,l,c,d,u;s.role="row";const h=null===(i=null===(a=this._service)||void 0===a?void 0:a.selection)||void 0===i?void 0:i.value,m=null===(r=null==t?void 0:t.underlyingItem)||void 0===r?void 0:r.data,p=(null==h?void 0:h.taskId)?null==h?void 0:h.taskId:null==h?void 0:h.jobId;if(this._enableSingleRowSelection){if(!this._initialSelectionDone&&p===(null==m?void 0:m.id)){const t=n;this._clearOtherSelections(t),(null===(l=s.selection)||void 0===l?void 0:l.clear)&&s.selection.clear(),null===(c=s.selection)||void 0===c||c.select(e),this._initialSelectionDone=!0}}else this._initialSelectionDone||p!==(null==m?void 0:m.id)||(null===(d=s.selection)||void 0===d?void 0:d.selected(e))||null===(u=s.selection)||void 0===u||u.select(e);return(0,A.renderTreeRow)(e,t,s,o,m)},columns:o,itemProvider:r,selection:this._selection[n],onToggle:(e,t)=>{var s,a,i,o,l,c,d;const u=t.underlyingItem;if(!e.currentTarget.className.includes("expand-button")&&u.expanded||r.toggle(u),u.data.isJob)if(this._storeStageIds){let e=null===(i=null===(a=null===(s=null==t?void 0:t.parentItem)||void 0===s?void 0:s.underlyingItem)||void 0===a?void 0:a.data)||void 0===i?void 0:i.stageId;this._service.selectJob(u.data.id,e)}else this._service.selectJob(u.data.id);else if(u.data.isTask)if(this._storeStageIds){let e=null===(d=null===(c=null===(l=null===(o=null==t?void 0:t.parentItem)||void 0===o?void 0:o.parentItem)||void 0===l?void 0:l.underlyingItem)||void 0===c?void 0:c.data)||void 0===d?void 0:d.stageId;this._service.selectTask(u.data.id,e)}else this._service.selectTask(u.data.id);if(this._enableSingleRowSelection){this._clearOtherSelections(n);const e=this._selection[n];if(e){const s=r.value.indexOf(t);s>=0&&(e.clear(),e.select(s))}}},onSelect:(e,t)=>{var s,a,i,r,o;const l=t.data.underlyingItem.data,c=this._service.selection.value&&this._service.selection.value.jobId;if(1===l.state&&c!==l.id||0===l.state?this._service.setFollowTail(!0):this._service.setFollowTail(!1),this._enableSingleRowSelection){this._clearOtherSelections(n);const e=this._selection[n];if(e){const s=t.index;e.clear(),e.select(s)}}if(l.isJob)if(this._storeStageIds){let e=null===(a=null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.parentItem)||void 0===a?void 0:a.underlyingItem.data.stageId;this._service.selectJob(l.id,e)}else this._service.selectJob(l.id);else if(l.isTask)if(this._storeStageIds){let e=null===(o=null===(r=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.parentItem)||void 0===r?void 0:r.parentItem)||void 0===o?void 0:o.underlyingItem.data.stageId;this._service.selectTask(l.id,e)}else this._service.selectTask(l.id);this._showMasterPanelXSmallScreen.value=!1},scrollable:!0})}))),e),this._sortStageList=(e,t)=>{const s=new Map,a=new Map,i=new Map;for(const t of e)s.set(t.data.id,t),void 0!==t.data.refName&&a.set(t.data.refName,t.data.id),i.set(t.data.id,[]);for(const[e,s]of Object.entries(t)){const t=s.map((e=>a.get(e))).filter((e=>!!e));i.set(e,t)}const n=[],r=[],o=new Set,l=new Set,c=t=>{if(o.has(t))return;if(l.has(t))throw new Error(`Circular dependency detected at stage: ${t}`);l.add(t);const a=i.get(t)||[];for(const e of a)c(e);l.delete(t),o.add(t);const d=s.get(t);d&&(n.push(d),r.push(e.indexOf(d)))};for(const t of e)o.has(t.data.id)||c(t.data.id);return{sorted:n,indexes:r}},this._onLogsDataChange=e=>(this._normalize(e.sections),this._sections?this._sections.value=e.sections:this._sections=new u.ObservableArray(e.sections),this._currentSelection?this._currentSelection.value=e.job:this._currentSelection=new u.ObservableValue(e.job),!0),this._onPartialData=()=>{const e=this._service.partialData.value;if(e){if(e.updatedSections){this._normalize(e.updatedSections);const t=e.updatedSections[0],s=this._sections.value.findIndex((e=>e.key===t.key));s>-1?(this._sections.change(s,t),this._sections.value.splice(s+1,this._sections.value.length-s),this._sections.value.splice(0,s)):this._sections.value.splice(0,this._sections.length,...e.updatedSections)}e.currentJob&&(this._currentSelection.value=e.currentJob)}},this._onBackClick=()=>{const e=this.context.pageContext,t=e.getService("IBuildLinkingService").getBuildUrl(this._service.rawData.buildId);(0,_.onClickFPS)(e,t,!0)},this._onLogsBackClick=()=>{this._showMasterPanelXSmallScreen.value=!0},this._getLineLink=(e,t)=>{const s=this.context.pageContext.getService("IBuildLinkingService"),a={};e.payload&&(a[g.NavConstants.job]=e.payload.jobId+"",e.payload.stageId&&(a[g.NavConstants.stage]=e.payload.stageId+"")),a[g.NavConstants.task]=e.key+"",a[g.NavConstants.line]=t+"";const i=s.getBuildUrl(this._service.logsData.value.buildId,g.NavConstants.logs,void 0,void 0,a);return s.getAbsoluteUrl(i)},this._onLiveData=()=>{const e=this._service.liveContent.value;e&&this._reader.current&&this._reader.current.updateContent(e.taskId)},this._onSelectionChanged=()=>{const e=this._service.selection.value;e&&e.taskSelection&&this._reader.current&&this._reader.current.select(e.taskSelection.key,e.taskSelection.lineToScroll)},this._onFocus=e=>{this._service.setFocused(!0)},this._onBlur=e=>{this._service.setFocused(!1)},this._enableStagesSorting=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.SortJobsListAndLogsView",!1),this._enableSingleRowSelection=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.EnableSingleRowSelection",!1),this._storeStageIds=(0,b.isFeatureFlagEnabled)(t.pageContext,"Pipelines.StoreStageIds",!1),this._service=this.context.pageContext.getService("IRunLogsService");const n=this.context.pageContext.getService("IVssThemeService");n.createThemedSelector("."+l,(e=>e.isDark?e:n.getTheme("ms.vss-web.vsts-theme-dark"))),this._selection=[],this._signalR=this.context.pageContext.getService("ISignalRService"),this._service.logsData&&this._onLogsDataChange(this._service.logsData.value),this._globalMessageService=this.context.pageContext.getService("IGlobalMessagesService");const r=t.pageContext.getService("ITfsPageService").getData();r&&r.project&&(this._projectId=r.project.id),this.state={checkResults:{}}}render(){if(!this._service.logsData||!this._service.rawData)return s.createElement(ot.NoData,null);const e=(e,t)=>{this.setState((s=>({checkResults:Object.assign(Object.assign({},s.checkResults),{[e]:t})}))),t.success&&(this._service.refresh(),this._showChecksPanel.value=!1)},t=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.EnableChecksScalabilityPhase1Flow",!1),a=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.DisableUpdatedChecksLogs",!1),i=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Checks.EnableUpdatedChecksLogsAsync",!1),u=(0,b.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.ScrollToLogLineWhenGroupLogsArePresent",!1);return s.createElement(S.Surface,{background:1},s.createElement("div",{className:"flex flex-row run-logs-view",ref:e=>this._view=e},s.createElement(U.ScreenSizeConditional,{condition:e=>0===e},s.createElement(c.UncheckedObserver,{showOnSmallScreens:this._showMasterPanelXSmallScreen},s.createElement(Me.SingleLayerMasterPanel,{renderContent:this._getLeftContent,renderHeader:this._getLeftHeader,className:this._showMasterPanelXSmallScreen?"xs-master-panel-full":""}))),s.createElement(U.ScreenSizeConditional,{condition:e=>e>0},s.createElement(Me.SingleLayerMasterPanel,{renderContent:this._getLeftContent,renderHeader:this._getLeftHeader,showOnSmallScreens:!0})),s.createElement(H.Page,{className:`${r} right themed ${l}`},s.createElement(c.Observer,{data:{observableValue:this._service.logsData,filter:this._onLogsDataChange}},(r=>{const h=r.data;if(h){const r=this._service.getCurrentStageName();return s.createElement("div",{className:"flex flex-grow flex-column v-scroll-hidden",onKeyDown:this._onKeyDown},s.createElement(c.Observer,{element:this._currentSelection,y:this._commandsUpdate},(e=>s.createElement(ae.CustomHeader,{className:"log-header"},s.createElement(U.ScreenSizeConditional,{condition:e=>0===e},s.createElement(ae.HeaderBackButton,{buttonProps:{onClick:this._onLogsBackClick,text:(0,o.format)(Ve.JobsInRun,this._service.rawData.buildNumber)}})),s.createElement("div",{className:"flex-row flex-grow flex-self-stretch"},s.createElement(U.ScreenSizeConditional,{condition:e=>e>0||!this._searchActive},s.createElement(ae.HeaderTitleArea,null,s.createElement(ae.HeaderTitle,{className:"text-ellipsis"},s.createElement("div",{className:"flex flex-row flex-center job-header"},s.createElement("div",{className:"flex status"},s.createElement(f.Status,Object.assign({},e.element.statusProps,{size:"24"}))),s.createElement("div",{className:"text-ellipsis title-m"},e.element.name))))),this._reader.current&&s.createElement(c.Observer,{result:this._reader.current.getFindResult()},(e=>{const t=e.result,a=!(!this._searchText.value||t&&0!=t.lines.length);return s.createElement(U.ScreenSizeObserver,null,(e=>{const i=e.screenSize>0;return this._searchText.value&&(0,Le.announce)(this._getFindResultText(t)),s.createElement("div",{className:(0,n.css)("find-area",i?"flex-row":"flex-column flex-grow",this._searchActive&&"active",a&&"error")},s.createElement(Be.TextField,{ref:this._search,className:"find-box",prefixIconProps:{iconName:"Search"},style:1,width:i?"bolt-textfield-default-width":"auto",placeholder:Ve.SearchLabel,onChange:this._onSearch,value:this._searchText,onKeyDown:this._onSearchKeyDown}),this._searchActive&&s.createElement("span",{className:"find-result body-s"},this._getFindResultText(t)))}))})),s.createElement(U.ScreenSizeObserver,null,(t=>{const a=t.screenSize<=0;return s.createElement(xe.HeaderCommandBar,{className:"reader-actions flex-start",overflowClassName:`themed ${l}`,items:this._getJobCommands(e.element,a&&this._searchActive)})})))))),s.createElement(c.Observer,{showChecksPanel:this._showChecksPanel},(a=>{const i=h.stage;if(i&&i.checks&&i.checks.some((e=>2===e.status))){const r={stages:[{id:i.id,name:i.name,checks:i.checks}],runId:this._service.rawData.buildId,pipelineId:this._service.rawData.definitionId,checkListItemType:this._checkListItemType.value,reviewMode:1,onSubmitBulkApproval:this._onSubmitBulkApproval,onReassignApprovals:this._onReassignApprovals,onPermitResource:this._onPermitResource,onGrantResource:Qe.grantResourceHandler(this.context,e),onGrantProductionReadinessResource:Qe.grantResourceHandlerForProductionReadinessCheck(this.context,e),onDismiss:this._onChecksPanelDismiss,onRerunCheck:this._onRerunCheck,onBypassCheck:this._onBypassCheck,checkResults:this.state.checkResults};return a.showChecksPanel&&s.createElement("div",null,s.createElement(n.WrappedComponent,Object.assign({dependencies:["ms.vss-build-web.approvals-panel"],wrappedType:t?"ms.tfs-build.stage-checks-panel":"ms.tfs-build.approvals-list-panel"},r)))}return s.createElement("div",null)})),h.stage&&s.createElement(He.ChecksCard,{className:"logs-checks-card body-m",pageContext:this.context.pageContext,projectId:this._projectId,isChecksLogsDisabled:a,isAsyncCheckLogsFlowEnabled:i,stages:[{id:h.stage.id,name:r||h.stage.name,checks:h.stage.checks}],onReviewClicked:this._onReviewClick}),h.message&&s.createElement(d.MessageCard,{className:"pipelines-run-checks-message attempt-message",severity:"Info"},h.message),s.createElement(c.UncheckedObserver,{showTimestamps:this._showTimestamps},s.createElement(Ae.LogViewer,{ref:this._reader,className:"log-reader custom-scrollbar v-scroll-auto h-scroll-auto flex-grow",sections:this._sections,scrollToLogLineWhenGroupLogsArePresent:u})),null!=this._sections&&null!=this._sections.value&&null!=this._sections.value[0]&&s.createElement(n.RegionComponent,{componentRegion:"logs-view-insights",childComponentProperties:{pipelineId:this._service.rawData.definitionId,pipelineRunId:this._service.rawData.buildId,taskStatus:this._sections.value[0].statusProps,taskName:this._sections.value[0].title,jobId:this._service.getCurrentJobId(),phaseId:this._service.getCurrentPhaseId(),stageId:this._service.getCurrentStageId()}}))}return s.createElement("div",null,"...")})))))}componentDidMount(){const e=this._service.rawData;if(!e)return;this._service.selection.subscribe(this._onSelectionChanged),this._service.liveContent.subscribe(this._onLiveData),this._service.partialData.subscribe(this._onPartialData),this._onSelectionChanged(),this._onLiveData(),window.addEventListener("focus",this._onFocus),window.addEventListener("blur",this._onBlur);const t=this.context.pageContext.getService("IBuildLinkingService"),s=e.definitionName,a=t.getDefinitionUrl(e.definitionId),i=e.buildNumber,n=t.getBuildUrl(e.buildId);this.context.pageContext.getService("run-header-breadcrumb-service").setBreadcrumbs(s,a,i,n),this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(Ue.Telemetry.Area,Ue.Telemetry.RunLogs),this._signalR.watch(this._service.rawData.buildId);const l=document.querySelector("."+r);l&&this._reader.current&&this._reader.current.initializeScrollable(l),document.title=(0,o.format)(Ve.TitleLogs,e.buildNumber),this._enableStagesSorting||(this._initialSelectionDone=!0),setTimeout((()=>{const e=document.querySelector(".run-logs-tree .bolt-tree-row.selected");null==e||e.scrollIntoView({behavior:"smooth",block:"center"})}),500)}componentWillUnmount(){this._service.selection.unsubscribe(this._onSelectionChanged),this._service.liveContent.unsubscribe(this._onLiveData),this._service.partialData.unsubscribe(this._onPartialData),window.removeEventListener("focus",this._onFocus),window.removeEventListener("blur",this._onBlur);this.context.pageContext.getService("run-header-breadcrumb-service").clearBreadcrumbs(),this._signalR.endWatch(this._service.rawData.buildId)}_getFindResultText(e){return e?(0,o.format)(Ve.SearchMatch,e.toScrollIndex+1,e.scrollCount):Ve.SearchNone}_normalize(e){e.forEach((e=>{e.getFarRight=this._getFarRight,e.payload&&2===e.payload.state&&(e.getLineLink=this._getLineLink)}))}_getJobCommands(e,t){const s=[];t||this._service.liveContent.value||s.push({id:"timestamp",ariaLabel:Ve.ToggleTimestamps,text:Ve.ToggleTimestamps,important:!1,className:"subtle",onActivate:(e,t)=>{this._toggleTimestamp()}}),this._searchActive?(s.push({ariaLabel:Ve.SearchPrev,className:"subtle",id:"log-up",important:!0,iconProps:{iconName:"ChevronUp"},onActivate:(e,t)=>{this._reader.current&&this._reader.current.findPrev()},tooltipProps:{text:Ve.SearchPrev}}),s.push({ariaLabel:Ve.SearchNext,className:"subtle",id:"down",important:!0,iconProps:{iconName:"ChevronDown"},onActivate:(e,t)=>{this._reader.current&&this._reader.current.findNext()},tooltipProps:{text:Ve.SearchNext}}),s.push({ariaLabel:Ve.SearchClose,className:"subtle",id:"close",important:!0,iconProps:{iconName:"ChromeClose"},onActivate:(e,t)=>{this._hideFind()},tooltipProps:{text:Ve.SearchClose}})):s.push({ariaLabel:Ve.SearchLabel,className:"subtle",id:"log-search",important:!0,iconProps:{iconName:"Search"},onActivate:(e,t)=>{this._showFind()},tooltipProps:{text:Ve.SearchLabel}});0===e.state&&this._service.canPriorityBeBumped(e.id)&&s.push({id:"priority",ariaLabel:Ve.RunNext,text:Ve.RunNext,important:!0,className:"log-header-button",onActivate:(t,s)=>{this._service.bumpJobPriority(e.id),this._commandsUpdate.value=!this._commandsUpdate.value},tooltipProps:{text:Ve.RunNextTooltip}});const a=this._service.getLogUrl(e.id);return a&&s.push({id:"download",ariaLabel:Ve.AriaDownloadLog,text:Ve.AriaDownloadLog,important:!0,className:"log-header-button",onActivate:(e,t)=>{t&&t.preventDefault();const s=window.open(a,"_blank");s&&(s.opener=null)},href:a}),s}_showFind(){this._searchActive=!0,this._commandsUpdate.value=!this._commandsUpdate.value,requestAnimationFrame((()=>{this._search.current&&this._search.current.focus()}))}_toggleTimestamp(){this._showTimestamps.value=!this._showTimestamps.value;const e={},t=this._sections.value.slice();t.forEach(((t,s)=>{e[t.key]=s})),t.forEach((t=>{const s=e[t.key];this._sections.change(s,t)}))}_hideFind(){this._reader.current&&this._reader.current.clearFind(),this._searchActive=!1,this._searchText.value="",this._commandsUpdate.value=!this._commandsUpdate.value,requestAnimationFrame((()=>{const e=document.getElementById("__bolt-log-search");e&&e.focus()}))}}t[e].LogsView=m,n.Components.add("run-logs-content",m)}("ComponentsLogsView")}),["Resources","Components/RunSummaryBaseLinkComponent","Components/RunSummaryChangesLinkComponent","Components/RunSummaryWorkItemsLinkComponent","Constants","Components/ChecksCard","Components/TaskControllerView","Components/IssueAnalysisPanel","Components/PipelinePermissionsErrorCard","Components/IssuesCard","Components/BaseStatus","Components/CheckStatus","Utilities","Components/JobsTable","Components/ArtifactStatus","Components/Canvas/Types","Components/Canvas/PathHelpers","Components/Canvas/Edge","Components/Canvas/GraphLayoutHelper","Components/Canvas/Graph","RunExternalService","Components/TestStatus","StagesRunSummary","Components/StageGraph","Components/JobsCard","Components/NoData","ConsumedArtifactsService","Components/PipelineRunLink","Components/ArtifactsLink","Components/PublishedArtifactsLink","Components/ChangesPanel","Components/ChangesLink","Components/CoverageResultsLink","Components/TestResultsLink","Components/WorkItemsLink","Components/PipelineDefinitionLink","Components/ResourcesCard","Components/StageViewer","Components/ParametersPanel","Components/RunSummary","Components/SourcesCard","Components/TagsDialog","SignalRService","RunDetailsService","RunHeaderBreadcrumbService","RunView","LegacyRunTabProviderService","RunLogsService","Components/LogsView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.run"}}));