"use strict";define("Test/TestSummary",["require","exports","react","VSSUI/Util","VSS/Platform/Layout","VSSUI/Icon","VSS/Core/Util/String","VSSUI/TooltipEx","Test/common-util/Common","VSS/Reflux/Action","Test/common-util/Common.Utils","Test/common-util/Telemetry","Test/common-util/TelemetryConstants","VSS/Reflux/Store","VSS/Core/Observable","VSS/Platform/Components/FPSLink","VSS/Platform/Feature","VSSUI/Card","VSSUI/Observer","Test/common-util/TCMPerfScenarios","VSSUI/Accordion"],(function(e,t,s,a,r,n,o,i,u,l,c,d,m,h,p,g,T,S,C,y,_){var f,P,R,b,v,D,N,x,w,F,I;f=t[I="Resources"]={},t[I].RunDurationHeading="Run duration",t[I].TestsNotReportedHeading="Tests not reported",t[I].TotalTestsText="Total tests",t[I].TotalAbortedRunText="Total Aborted Tests",t[I].PassPercentHeading="Pass percentage",t[I].ErrorFetchingResults="Error occurred while trying to fetch test results data.",t[I].TestSummaryTitle="Summary",t[I].ResultStateInProgress="InProgress",t[I].CommaSeparator=",",t[I].TestRunStateCompleted="Test Run Completed",t[I].TestRunStateAborted="Test Run Aborted",t[I].TestOutcome_NotExecuted="Not executed",t[I].ResultStateNotImpacted="Not Impacted",t[I].OthersText="Others",t[I].TestOutcome_Passed="Passed",t[I].TestOutcome_Failed="Failed",t[I].TestOutcome_Aborted="Aborted",t[I].TestOutcome_Inconclusive="Inconclusive",t[I].TestOutcome_None="None",t[I].RunsAborted="Run(s) Aborted",t[I].TotalTestsHeading="Total tests",t[I].FailedTestsHeading="Failed tests",t[I].ExistingFailuresLegendText="Existing",t[I].PassedText="Passed",t[I].FailedText="Failed",t[I].PartiallySucceededText="Partially succeeded",t[I].PassedOnRerunLegendText="Passed on rerun ({0})",t[I].NewFailuresLegendText="New",t[I].NotImpactedLegendText="Not Impacted",t[I].RunsSummaryStatus="{0} Run(s) Completed ( {1} Passed, {2} Failed )",t[I].RunsSummaryStatusWithImpactedAndOtherRuns="{0} Run(s) Completed ( {1} Passed, {2} Failed, {3} Not impacted, {4} Others )",t[I].RunsSummaryStatusWithImpactedRunsOnly="{0} Run(s) Completed ( {1} Passed, {2} Failed, {3} Not impacted )",t[I].RunsSummaryStatusWithOtherRunsOnly="{0} Run(s) Completed ( {1} Passed, {2} Failed, {3} Others )",t[I].TestsTabInBuild="Tests",t[I].BuildDoesNotHaveTestReports="No test runs are available for this build. Run tests and get rich reports by using an appropriate built-in task such as the <a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=835764' rel='nofollow noopener noreferrer' target='_blank'>Visual Studio Test task</a>. Alternately, run tests using a runner of your choice such as <a class='bolt-link' href='https://junit.org' rel='nofollow noopener noreferrer' target='_blank'>JUnit</a>, <a class='bolt-link' href='https://xunit.github.io/' rel='nofollow noopener noreferrer' target='_blank'>xUnit</a>, <a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=2081227' rel='nofollow noopener noreferrer' target='_blank'>mocha, jest, </a><a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=2081228' rel='nofollow noopener noreferrer' target='_blank'>pytest, </a><a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=2080895' rel='nofollow noopener noreferrer' target='_blank'>rspec, </a>etc. and use the <a class='bolt-link' href='https://go.microsoft.com/fwlink/?LinkId=857107' rel='nofollow noopener noreferrer' target='_blank'>Publish Test Results</a> task to get rich reports.",t[I].BuildDetailsSummaryNoTestRuns="No test runs are available for this build. <br>",t[I].NoTestsMessageWhileBuildInProgress="Build is in progress. No tests results available at this stage!",t[I].BuildHasNotCompletedText="The build is in progress. Test results will appear here when the build completes.",t[I].BuildDeletedNoTestResults="No test runs are available for this build as this build has been deleted.",t[I].Runs="Runs",t[I].NoTestResultsMessage="Test results are not yet available.",t[I].RunDurationInfoMessage="Effective run duration for all tests",t[I].TestAnalyticsLinkMessage="{0} unique failing {1} in the last 14 days",t[I].TestPluralText="tests",t[I].TestSingularText="test",t[I].ResultsSmallViewStatus="({0} Passed, {1} Failed, {2} Others)",t[I].AbortedResultsSmallView="({0} Passed, {1} Failed, {2} Others, {3} Aborted, {4} Not impacted)",t[I].FailedResultsSmallView="({0} New, {1} Existing)",t[I].ValueDifferenceIcon="Value {0} icon",function(e){P=t[e]={};class n extends r.VssComponent{render(){let e=[],t=[],r=[];return this.props.legend.forEach((a=>{const n=a.count.toString()+" "+a.label;if(e.push(s.createElement("div",{key:a.label,role:"img","aria-label":n,className:"legend-cell data-count"},a.count)),t.push(s.createElement("div",{key:a.label,"aria-hidden":"true",className:"legend-cell data-color"},this._getLegendCircleElement(a.color))),r.push(s.createElement("div",{key:a.label,"aria-hidden":"true",className:"legend-cell data-value"},a.label)),a.sublabel){const n=a.sublabel;e.push(s.createElement("div",{key:a.sublabel,role:"img","aria-label":n,className:"legend-sub-cell data-count"})),t.push(s.createElement("div",{key:a.sublabel,"aria-hidden":"true",className:"legend-sub-cell data-color"})),r.push(s.createElement("div",{key:a.sublabel,"aria-hidden":"true",className:"legend-sub-cell data-value"},a.sublabel))}})),s.createElement("div",{className:(0,a.css)("donut-legend-container",this.props.cssClass||"")},s.createElement("div",null,e),s.createElement("div",null,t),s.createElement("div",null,r))}_getLegendCircleElement(e){return s.createElement("span",{className:"legend-circle"},s.createElement("svg",{width:"14px",height:"14px"},s.createElement("circle",{className:"color-circle",cx:"7",cy:"7",r:"7",fill:e})))}}t[e].DonutChartLegendComponent=n}("ComponentsDonutChartLegend"),function(e){var u,l,c;R=t[e]={},function(e){e[e.Improved=0]="Improved",e[e.Worsened=1]="Worsened",e[e.Unchanged=2]="Unchanged"}(u=t[e].DifferenceType||(t[e].DifferenceType={})),function(e){e[e.Increased=0]="Increased",e[e.Unchanged=1]="Unchanged",e[e.Decreased=2]="Decreased"}(l=t[e].ValueType||(t[e].ValueType={})),function(e){e[e.String=0]="String",e[e.Percentage=1]="Percentage",e[e.DateTime=2]="DateTime"}(c=t[e].DataType||(t[e].DataType={}));class d extends r.VssComponent{render(){return this.props.isScreenSizeSmall?s.createElement("div",{className:(0,a.css)("flex-grow","flex-row flex-self-start","formatted-summary-string")},s.createElement("div",{className:(0,a.css)("secondary-text summary-line-compact"),id:(0,a.getSafeId)(this.props.title)},this.props.title,":"),s.createElement("div",{className:(0,a.css)("summary-line-smallWindow flex-center flex-column")},this._getChartValueDiv())):s.createElement("div",{className:"testresults-number-chart"},s.createElement("div",{className:"chart-value"},this._getChartValueDiv()),s.createElement("div",{className:"chart-title"},s.createElement("span",null,this.props.title),this.props.infoMessage&&this._getInfoMessageButton()),s.createElement("div",{className:"chart-difference "+(this.props.isVerticalAlignWithDifferencePresent?"chart-difference-show-height":"chart-difference-no-height")},this.props.difference&&this._getDifferenceDiv()))}_getChartValueDiv(){if(null===this.props.dataType)return this.props.value;switch(this.props.dataType){case c.String:return this.props.value;case c.Percentage:return this._getPercentageValueDiv();case c.DateTime:default:return this.props.value}}_getPercentageValueDiv(){return s.createElement("div",null,s.createElement("span",{className:"number-chart-large-font"},o.localeFormat("{0}{1}",this.props.value,"%")))}_getInfoMessageButton(){return s.createElement(i.Tooltip,{text:this.props.infoMessage},(0,n.Icon)({className:"number-chart-info-message-button cursor-pointer",ariaLabel:this.props.infoMessage,iconName:"Info"}))}_getDifferenceDiv(){if(null===this.props.difference)return s.createElement("div",null);let e;switch(this.props.difference.diffType){case u.Improved:e="difference-improved";break;case u.Unchanged:e="difference-unchanged";break;case u.Worsened:e="difference-worsened";break;default:e=""}return s.createElement("div",{className:`${e} chart-difference`},this.props.difference.shouldShowIcon&&this._getIconDiv(),this.props.difference.valueType!==l.Unchanged&&s.createElement("div",{className:"difference-value"},this.props.difference.value))}_getIconDiv(){let e;if(!this.props.difference)return null;switch(this.props.difference.valueType){case l.Unchanged:return null;case l.Increased:e="Up";break;case l.Decreased:e="Down";break;default:return null}return s.createElement("div",{className:"difference-icon-div"},s.createElement(n.Icon,{ariaLabel:o.format(f.ValueDifferenceIcon,e),iconName:e}))}}t[e].ResultSummaryNumberChartComponent=d}("ComponentsResultSummaryDetailsChart"),function(e){b=t[e]={},t[e].getTestAnalyticsLinkData=async function(e,t,s){let a=e.pageContext.getService("IVssContributionService");await a.getContributionAsync("ms.vss-test-analytics-web.failed-tests-metric-view");let r,n=e.pageContext.getService("FailedTestsSourceService");return n&&n.initialize("FailedTestsSourceService",e.pageContext),r=t===u.ViewContext.Build?{contextType:1,definitionId:s}:{contextType:2,definitionId:s},n.getTestAnalyticsLinkData(r)}}("ComponentsTestAnalyticsLink"),function(e){t[e]={};t[e].TestResultsReportActionsHub=class{constructor(){this.initializeTestResultSummary=new l.Action,this.initializeTestResultSummaryForUnifiedPipeline=new l.Action,this.refreshTestResultSummary=new l.Action,this.onSummaryLoaded=new l.Action}}}("ActionsTestResultsReportActionsHub"),function(e){v=t[e]={};class s extends h.Store{constructor(e,t,s,a){super(e),this.pageContext=t,this._actionsHub=s,this._viewContextData=a,this._actionsHub.initializeTestResultSummary.addListener(this._initializeTestResultSummaryHandler.bind(this)),this._actionsHub.initializeTestResultSummaryForUnifiedPipeline.addListener(this._initializeTestResultSummaryForUnifiedPipelineHandler.bind(this)),this._actionsHub.refreshTestResultSummary.addListener(this._refreshSummary.bind(this)),this._initialize()}_initialize(){this._setDefaultState()}getState(){return this._state}dispose(){this._actionsHub.initializeTestResultSummary.removeListener(this._initializeTestResultSummaryHandler),this._actionsHub.initializeTestResultSummaryForUnifiedPipeline.removeListener(this._initializeTestResultSummaryForUnifiedPipelineHandler),this._actionsHub.refreshTestResultSummary.removeListener(this._refreshSummary)}getDefinitionId(){if(this._viewContextData.viewContext==u.ViewContext.Build)return this._viewContextData.data.mainData.definition.id;{let e=0;return this._viewContextData&&this._viewContextData.data&&this._viewContextData.data.subData&&this._viewContextData.data.subData.environment&&this._viewContextData.data.subData.environment.releaseDefinition&&(e=this._viewContextData.data.subData.environment.releaseDefinition.id),e}}_setDefaultState(){this._state={shouldShowSummary:!1,totalTestsNumberChartProps:null,totalAbortedTestsNumberChartProps:null,totalTestsChartProps:null,testFailuresChartProps:null,abortedTestsChartProps:null,passPercentageNumberChartProps:null,runDurationNumberChartProps:null,notReportedNumberChartProps:null,errorMessage:null,isInProgressView:null,aggregatedTestsCount:null,aggregatedRunsCount:null,aggregatedRunsOutcomeCount:null,refreshSummary:!1,testAnalyticsLinkData:{},onlyNotReportedTests:!1,summaryAccordianState:!1}}_refreshSummary(){this._state.refreshSummary=!0,this.emitChanged()}_initializeTestResultSummary(e){this._state.isInProgressView=e.viewContextStatus===u.ViewContextStatus.InProgress,this._state.isInProgressView?this._initializeTestResultSummaryForInProgressView(e.summaryData):this._initializeTestResultSummaryForCompletedView(e.summaryData)}_initializeTestResultSummaryForUnifiedPipeline(e){this._state.isInProgressView=e.viewContextStatus===u.ViewContextStatus.InProgress,this._state.isInProgressView?this._initializeTestResultSummaryForInProgressViewInUnifiedPipeline(e.summaryData):this._initializeTestResultSummaryForCompletedViewInUnifiedPipeline(e.summaryData)}_initializeTestResultSummaryHandler(e){this._initializeTestResultSummary(e),this._state.refreshSummary=!1,this.emitChanged()}_initializeTestResultSummaryForUnifiedPipelineHandler(e){this._initializeTestResultSummaryForUnifiedPipeline(e),this._state.refreshSummary=!1,this.emitChanged()}_initializeTestResultSummaryForInProgressViewInUnifiedPipeline(e){let t={totalTests:0,passedTests:0,failedTests:0,notImpactedTests:0,notExecutedTests:0,abortedTests:0,otherTests:0},s={totalRuns:0,inProgressRuns:0,completedRuns:0,abortedRuns:0};if(e&&e.runSummary&&e.runSummary.runSummaryByState){const t=e.runSummary.runSummaryByState;s.inProgressRuns=t[2]?t[2]:0,s.completedRuns=t[3]?t[3]:0,s.completedRuns+=t[6]?t[6]:0,s.abortedRuns=t[4]?t[4]:0,s.totalRuns=e.runSummary.totalRunsCount}if(e&&e.resultSummary&&e.resultSummary.resultSummaryByRunState){const s=e.resultSummary.resultSummaryByRunState;for(let e of Object.keys(s)){const a=s[parseInt(e)];if(a){t.totalTests+=a.totalTestCount;const e=a.aggregatedResultDetailsByOutcome;if(e)for(let s of Object.keys(e)){const a=e[parseInt(s)];switch(a.outcome){case 2:t.passedTests+=a.count;break;case 3:t.failedTests+=a.count;break;case 14:t.notImpactedTests+=a.count;break;case 8:t.notExecutedTests+=a.count;break;case 6:t.abortedTests+=a.count}}}}t.otherTests=t.totalTests-t.passedTests-t.failedTests-t.notImpactedTests-t.notExecutedTests-t.abortedTests}this._updateStateForTestResultSummaryForInProgressView(t,s)}_initializeTestResultSummaryForInProgressView(e){let t={totalTests:0,passedTests:0,failedTests:0,notImpactedTests:0,notExecutedTests:0,abortedTests:0,otherTests:0},s={totalRuns:0,inProgressRuns:0,completedRuns:0,abortedRuns:0};if(e&&e.aggregatedResultsAnalysis&&e.aggregatedResultsAnalysis.runSummaryByState){const a=e.aggregatedResultsAnalysis.runSummaryByState;s.inProgressRuns=a[2]?a[2].runsCount:0,s.completedRuns=a[3]?a[3].runsCount:0,s.completedRuns+=a[6]?a[6].runsCount:0,s.abortedRuns=a[4]?a[4].runsCount:0;for(let e of Object.keys(a)){s.totalRuns+=a[parseInt(e)].runsCount;const r=a[parseInt(e)].resultsByOutcome;r&&(t.totalTests+=this._getAggregatedCount(r),t.passedTests+=r[2]?r[2].count:0,t.failedTests+=r[3]?r[3].count:0,t.notImpactedTests+=r[14]?r[14].count:0,t.notExecutedTests+=r[8]?r[8].count:0,t.abortedTests+=r[6]?r[6].count:0)}t.otherTests=t.totalTests-t.passedTests-t.failedTests-t.notImpactedTests-t.notExecutedTests-t.abortedTests}this._updateStateForTestResultSummaryForInProgressView(t,s)}_updateStateForTestResultSummaryForInProgressView(e,t){t.totalRuns>0&&(this._state.shouldShowSummary=!0),this._state.aggregatedRunsCount={totalRuns:t.totalRuns,inProgressRuns:t.inProgressRuns,completedRuns:t.completedRuns,abortedRuns:t.abortedRuns},this._state.aggregatedTestsCount={totalTests:e.totalTests,passedTests:e.passedTests,failedTests:e.failedTests,notImpactedTests:e.notImpactedTests,notExecutedTests:e.notExecutedTests,abortedTests:e.abortedTests,otherTests:e.otherTests}}_initializeTestResultSummaryForCompletedViewInUnifiedPipeline(e){let t=0,s=0,a="",r=0,n=0,o=0,i=0,u=0,l=0,h=0,p="",g=0,T=0,S=0,C=0,y=0,_=0,P=0,R=0,b=0,v=!1,D=!1,N={totalTests:0,passedTests:0,failedTests:0,notImpactedTests:0,notExecutedTests:0,abortedTests:0,otherTests:0},x={totalRuns:0,inProgressRuns:0,completedRuns:0,abortedRuns:0};if(e&&e.resultSummary&&e.resultSummary.resultSummaryByRunState){for(let t of Object.keys(e.resultSummary.resultSummaryByRunState)){const s=e.resultSummary.resultSummaryByRunState[parseInt(t)];if(s&&(3===parseInt(t)||6===parseInt(t))){y+=s.totalTestCount,i+=s.notReportedTestCount;const e=s.aggregatedResultDetailsByOutcome;if(e)for(let t of Object.keys(e)){const s=e[parseInt(t)];switch(s.outcome){case 2:C+=s.count,l+=s.rerunResultCount;break;case 3:T+=s.count;break;case 14:S+=s.count;break;default:u+=s.count}}}}y>0?this._state.shouldShowSummary=!0:i>0&&(this._state.shouldShowSummary=!0,this._state.onlyNotReportedTests=!0,d.publishEvent(this.pageContext.pageContext,this.pageContext,m.featureTestTab_TestTabWithOnlyNotReportedTests,{NotOnlyReportedTestsCounts:i})),g=y-S,g>0&&(h=C/g*100)}if(e&&e.runSummary&&e.runSummary.runSummaryByState){if(x.abortedRuns=e.runSummary.runSummaryByState[4],x.abortedRuns>0&&e.resultSummary&&e.resultSummary.resultSummaryByRunState){this._state.shouldShowSummary=!0;const t=e.resultSummary.resultSummaryByRunState[4];if(t&&t.aggregatedResultDetailsByOutcome){N.totalTests=t.totalTestCount;const e=t.aggregatedResultDetailsByOutcome;for(let t of Object.keys(e)){const s=e[parseInt(t)];switch(s.outcome){case 2:N.passedTests=s.count;break;case 3:N.failedTests=s.count;break;case 14:N.notImpactedTests=s.count;break;case 6:N.abortedTests=s.count;break;default:N.otherTests+=s.count}}}this._populateStateOfAbortedRuns(N)}if(x.completedRuns+=e.runSummary.runSummaryByState[3]?e.runSummary.runSummaryByState[3]:0,x.completedRuns+=e.runSummary.runSummaryByState[6]?e.runSummary.runSummaryByState[6]:0,x.completedRuns>0&&(this._state.shouldShowSummary=!0),e.runSummary.runSummaryByOutcome){const t=e.runSummary.runSummaryByOutcome;_=t[0]?t[0]:0,P=t[1]?t[1]:0,R=t[2]?t[2]:0,b=t[3]?t[3]:0}e.runSummary.duration&&(p=e.runSummary.duration)}if(e&&e.resultsAnalysis){const i=e.resultsAnalysis.testFailuresAnalysis;i?(D=!0,o=i.newFailures?i.newFailures.count:0,t=i.existingFailures?i.existingFailures.count:0):t=T;const u=e.resultsAnalysis.resultsDifference;u&&(v=!0,a=u.increaseInDuration,n=u.increaseInTotalTests,r=u.increaseInFailures,s=this._getIncreaseInPassPercentageDifference(g,u.increaseInTotalTests-u.increaseInNonImpactedTests,C,u.increaseInPassedTests,h))}this._state.totalTestsNumberChartProps=this._getTotalTestsNumberChartProps(y,n,v),this._state.passPercentageNumberChartProps=this._getPassPercentageNumberChartProps(h,s,v);const w=c.TestReportDataParser.parseDuration(p);this._state.runDurationNumberChartProps={title:f.RunDurationHeading,value:w,difference:v?this._getDurationDifference(a):null,infoMessage:f.RunDurationInfoMessage},this._state.notReportedNumberChartProps={title:f.TestsNotReportedHeading,value:i.toLocaleString(),difference:this._getNullDifference()},this._state.aggregatedRunsOutcomeCount={passed:_,failed:P,notImpacted:R,others:b},this._state.totalTestsChartProps={aggregatedtotalTests:y,totalPassed:C,totalPassedOnRerun:l,totalFailures:T,totalNotImpactedTests:S,otherTests:u},this._state.testFailuresChartProps=D?{totalFailures:T,newFailures:o,existingFailures:t,increaseInFailures:r}:null,this._state.aggregatedRunsCount=x}_initializeTestResultSummaryForCompletedView(e){let t=0,s=0,a=0,r="",n=0,o=0,i=0,u=0,l=0,h=0,p=0,g="",T=0,S=0,C=0,y=0,_=0,P=0,R=0,b=0,v={totalTests:0,passedTests:0,failedTests:0,notImpactedTests:0,notExecutedTests:0,abortedTests:0,otherTests:0},D={totalRuns:0,inProgressRuns:0,completedRuns:0,abortedRuns:0};if(e&&e.aggregatedResultsAnalysis){const f=e.aggregatedResultsAnalysis.resultsByOutcome,v=e.aggregatedResultsAnalysis.notReportedResultsByOutcome;if(Object.keys(f).length>0?this._state.shouldShowSummary=!0:Object.keys(v).length>0&&(this._state.shouldShowSummary=!0,this._state.onlyNotReportedTests=!0,d.publishEvent(this.pageContext.pageContext,this.pageContext,m.featureTestTab_TestTabWithOnlyNotReportedTests,{NotOnlyReportedTestsCounts:Object.keys(v).length})),t=this._getAggregatedCount(f),y=e.aggregatedResultsAnalysis.totalTests,u=this._getAggregatedCount(e.aggregatedResultsAnalysis.notReportedResultsByOutcome),e.aggregatedResultsAnalysis.runSummaryByState&&e.aggregatedResultsAnalysis.runSummaryByState[4]&&(this._state.shouldShowSummary=!0,D.abortedRuns=e.aggregatedResultsAnalysis.runSummaryByState[4].runsCount),f&&f[3]&&(T=f[3].count),e.testFailures){const t=c.TestReportDataParser.parseFailureData(e.testFailures);i=t.newFailures,s=t.existingFailures}else s=T;if(f&&f[2]&&(C=f[2].count,f[2].rerunResultCount&&(h=f[2].rerunResultCount)),y&&(p=C/y*100),e.aggregatedResultsAnalysis.resultsByOutcome[14]&&(S=e.aggregatedResultsAnalysis.resultsByOutcome[14].count),l=t-(C+T+S),g=e.aggregatedResultsAnalysis.duration,e.aggregatedResultsAnalysis.resultsDifference){const t=e.aggregatedResultsAnalysis.resultsDifference;o=t.increaseInOtherTests+t.increaseInFailures+t.increaseInPassedTests,r=t.increaseInDuration,n=t.increaseInFailures,e.testFailures&&(a=this._getIncreaseInPassPercentageDifference(y,t.increaseInTotalTests,C,t.increaseInPassedTests,p))}if(e.aggregatedResultsAnalysis.runSummaryByState){const t=e.aggregatedResultsAnalysis.runSummaryByState;D.completedRuns=t[3]?t[3].runsCount:0}if(e.aggregatedResultsAnalysis.runSummaryByOutcome){const t=e.aggregatedResultsAnalysis.runSummaryByOutcome;_=t[0]?t[0].runsCount:0,P=t[1]?t[1].runsCount:0,R=t[2]?t[2].runsCount:0,b=t[3]?t[3].runsCount:0}}const N=!!e.aggregatedResultsAnalysis.resultsDifference;this._state.totalTestsNumberChartProps=this._getTotalTestsNumberChartProps(t,o,N),this._state.passPercentageNumberChartProps=this._getPassPercentageNumberChartProps(p,a,N);const x=c.TestReportDataParser.parseDuration(g);this._state.runDurationNumberChartProps={title:f.RunDurationHeading,value:x,difference:N?this._getDurationDifference(r):null,infoMessage:f.RunDurationInfoMessage},this._state.notReportedNumberChartProps={title:f.TestsNotReportedHeading,value:u.toLocaleString(),difference:this._getNullDifference()},this._state.aggregatedRunsOutcomeCount={passed:_,failed:P,notImpacted:R,others:b},this._state.totalTestsChartProps={aggregatedtotalTests:t,totalPassed:C,totalPassedOnRerun:h,totalFailures:T,totalNotImpactedTests:S,otherTests:l};const w=!!e.testFailures;if(this._state.testFailuresChartProps=w?{totalFailures:T,newFailures:i,existingFailures:s,increaseInFailures:n}:null,this._state.aggregatedRunsCount=D,D.abortedRuns>0){const t=e.aggregatedResultsAnalysis.runSummaryByState[4].resultsByOutcome;t&&(v.totalTests=this._getAggregatedCount(t),v.passedTests=t[2]?t[2].count:0,v.failedTests=t[3]?t[3].count:0,v.abortedTests=t[6]?t[6].count:0,v.notImpactedTests=t[14]?t[14].count:0,l=v.totalTests-v.passedTests-v.failedTests-v.notImpactedTests-v.abortedTests),this._populateStateOfAbortedRuns(v)}}_populateStateOfAbortedRuns(e){this._state.totalAbortedTestsNumberChartProps=this._getTotalAbortedTestsNumberChartProps(e.totalTests),this._state.abortedTestsChartProps={totalTests:e.totalTests,totalPassed:e.passedTests,totalFailures:e.failedTests,totalAborted:e.abortedTests,totalNotImpactedTests:e.notImpactedTests,otherTests:e.otherTests}}_getTotalTestsNumberChartProps(e,t,s){return{title:f.TotalTestsText,value:e.toLocaleString(),difference:s?this._getTotalTestsDifference(t):null,dataType:R.DataType.String}}_getTotalAbortedTestsNumberChartProps(e){return{title:f.TotalAbortedRunText,value:e.toLocaleString(),difference:null,dataType:R.DataType.String}}_getTotalTestsDifference(e){let t,s;e<0?(t=o.localeFormat("{0}",e.toLocaleString()),s=R.ValueType.Decreased):e>0?(t=o.localeFormat("+{0}",e.toLocaleString()),s=R.ValueType.Increased):(t=o.localeFormat("+{0}",e.toLocaleString()),s=R.ValueType.Unchanged);return{diffType:R.DifferenceType.Unchanged,shouldShowIcon:!1,value:t,valueType:s}}_getPassPercentageNumberChartProps(e,t,s){const a=e===Math.round(e)?e.toString():c.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(e,2);this._getPassPercentageDifference(t);return{title:f.PassPercentHeading,value:a,difference:s?this._getPassPercentageDifference(t):null,dataType:R.DataType.Percentage}}_getPassPercentageDifference(e){let t,s;const a=Math.abs(e),r=a===Math.round(a)?a.toString():c.TestReportDataParser.getCustomizedDecimalValueInCurrentLocale(a,1),n=o.localeFormat("{0}{1}",r,"%");e<0?(t=R.ValueType.Decreased,s=R.DifferenceType.Worsened):e>0?(t=R.ValueType.Increased,s=R.DifferenceType.Improved):(t=R.ValueType.Unchanged,s=R.DifferenceType.Unchanged);return{diffType:s,shouldShowIcon:!0,value:n,valueType:t}}_getDurationDifference(e){let t;return t=c.TestReportDataParser.isZeroDuration(e)?{value:o.localeFormat("{0}",0),diffType:R.DifferenceType.Unchanged,valueType:R.ValueType.Unchanged,shouldShowIcon:!0}:o.startsWith(e,"-")?{value:o.localeFormat("{0}",c.TestReportDataParser.parseDuration(e)),diffType:R.DifferenceType.Improved,valueType:R.ValueType.Decreased,shouldShowIcon:!0}:{value:o.localeFormat("+{0}",c.TestReportDataParser.parseDuration(e)),diffType:R.DifferenceType.Worsened,valueType:R.ValueType.Increased,shouldShowIcon:!0},t}_getIncreaseInPassPercentageDifference(e,t,s,a,r){const n=e-t;let o=0;return 0!==n&&(o=(s-a)/n*100),r-o}_getNullDifference(){return{value:"",diffType:R.DifferenceType.Unchanged,valueType:R.ValueType.Unchanged,shouldShowIcon:!1}}_getAggregatedCount(e){let t=0;if(e)for(const s of Object.keys(e))t+=e[parseInt(s)].count;return t}}t[e].SummaryViewStore=s}("StoreSummaryViewStore"),function(e){D=t[e]={};class n extends r.VssComponent{constructor(e){super(e),this._paneSize=new p.ObservableValue(void 0),this.state={},this._chartDiameter=100}componentDidMount(){(0,b.getTestAnalyticsLinkData)(this.context,this.props.artifactData.viewContext,this.props.store.getDefinitionId()).then((e=>{this._currentState.testAnalyticsLinkData=e,this.setState(this._currentState)})),this._logTelemetryForClick(),this._getCurrentWidthOfSummary()}componentDidUpdate(){this._getCurrentWidthOfSummary()}render(){return this.props.store&&(this._currentState=this.props.store.getState()),this._getCompletedSummaryViewBody()}_logTelemetryForClick(){let e=this.props.isBuildTimeline?m.featureTestTab_summaryInBuildTimelineRendered:m.featureTestTab_TestTabClicked;this._currentState.totalTestsChartProps&&d.publishEvent(this.context.pageContext,this.props.artifactData,e,{[m.inProgress]:!1,[m.totalTestsExists]:this._currentState.totalTestsChartProps.aggregatedtotalTests>0?"Yes":"No",[m.failedTestsExists]:this._currentState.totalTestsChartProps.totalFailures>0?"Yes":"No",[m.totalTests]:this._currentState.totalTestsChartProps.aggregatedtotalTests,[m.failedTests]:this._currentState.totalTestsChartProps.totalFailures,[m.passedTests]:this._currentState.totalTestsChartProps.totalPassed})}_getSummaryText(){return null!==this._currentState.aggregatedRunsOutcomeCount&&null!==this._currentState.aggregatedRunsCount?0!==this._currentState.aggregatedRunsOutcomeCount.notImpacted&&0!==this._currentState.aggregatedRunsOutcomeCount.others?(0,o.localeFormat)(f.RunsSummaryStatusWithImpactedAndOtherRuns,this._currentState.aggregatedRunsCount.completedRuns,this._currentState.aggregatedRunsOutcomeCount.passed,this._currentState.aggregatedRunsOutcomeCount.failed,this._currentState.aggregatedRunsOutcomeCount.notImpacted,this._currentState.aggregatedRunsOutcomeCount.others):0!==this._currentState.aggregatedRunsOutcomeCount.notImpacted&&0===this._currentState.aggregatedRunsOutcomeCount.others?(0,o.localeFormat)(f.RunsSummaryStatusWithImpactedRunsOnly,this._currentState.aggregatedRunsCount.completedRuns,this._currentState.aggregatedRunsOutcomeCount.passed,this._currentState.aggregatedRunsOutcomeCount.failed,this._currentState.aggregatedRunsOutcomeCount.notImpacted):0===this._currentState.aggregatedRunsOutcomeCount.notImpacted&&0!==this._currentState.aggregatedRunsOutcomeCount.others?(0,o.localeFormat)(f.RunsSummaryStatusWithImpactedAndOtherRuns,this._currentState.aggregatedRunsCount.completedRuns,this._currentState.aggregatedRunsOutcomeCount.passed,this._currentState.aggregatedRunsOutcomeCount.failed,this._currentState.aggregatedRunsOutcomeCount.others):(0,o.localeFormat)(f.RunsSummaryStatus,this._currentState.aggregatedRunsCount.completedRuns,this._currentState.aggregatedRunsOutcomeCount.passed,this._currentState.aggregatedRunsOutcomeCount.failed):""}_getCompletedSummaryViewBody(){(0,T.isFeatureFlagEnabled)(this.context.pageContext,u.FeatureFlagConstants.TriReportCustomization,!1),this._isAnyDifferenceValuePresentInNumberCharts();const e=this._getRequiredDisplaySize();return s.createElement("div",{ref:e=>this._refSummary=e},s.createElement(C.UncheckedObserver,{paneSize:this._paneSize},(t=>{if(void 0===t)return null;{const t=this._paneSize.value,a=this._getCompletedSummaryViewItems(t,e);return s.createElement("div",{className:"summary-view-parent"},this._currentState&&this._currentState.aggregatedRunsCount&&(this._currentState.aggregatedRunsCount.completedRuns>0||this._currentState.aggregatedRunsCount.abortedRuns>0)&&s.createElement("div",{className:"summary-view-container"},s.createElement("div",{className:"summary-view-runs-info-bar"},this._currentState.aggregatedRunsCount&&this._currentState.aggregatedRunsCount.completedRuns>0&&this._currentState.aggregatedRunsOutcomeCount&&s.createElement("div",{className:"summary-view-completed-runs"},this._getSummaryText(),this.state.testAnalyticsLinkData&&this.state.testAnalyticsLinkData.testAnalyticsLinkMessage&&!this.props.isBuildTimeline&&s.createElement(g.FPSLinkComponent,{className:"failing-test-analytics-link",href:this.state.testAnalyticsLinkData.testAnalyticsLink,telemetrySource:m.featureAnalyticsInProductLink_UniqueFailingTests_TestTab,telemetryProperties:this.props.telemetryPropertiesForInProductLink},this.state.testAnalyticsLinkData.testAnalyticsLinkMessage),(0,T.isFeatureFlagEnabled)(this.context.pageContext,u.FeatureFlagConstants.ShowCloudTestLink)&&s.createElement(r.WrappedComponent,{dependencies:["ms.vss-test-web.test-cloud-test-link"],wrappedType:"cloud-test-link",wrappedProps:{artifactData:this.props.artifactData}})),this._currentState.aggregatedRunsCount.abortedRuns>0&&!this._currentState.onlyNotReportedTests&&s.createElement("div",{className:"aborted-view-bar"},this._currentState&&this._currentState.aggregatedRunsCount&&this._currentState.aggregatedRunsCount.completedRuns>0&&s.createElement("div",{className:"aborted-runs-separator-in-bar"}),s.createElement("div",{className:"aborted-runs"},s.createElement("span",{className:"aborted-runs-value"}," ",this._currentState.aggregatedRunsCount.abortedRuns.toLocaleString()," "),f.RunsAborted))),s.createElement(S.Card,{className:"test-summary-card"},s.createElement("div",{className:t>=e?"test-summary-card-row-big":"test-summary-card-row-small"},a.map(((e,t)=>s.createElement("div",{className:"flex-column",style:{minWidth:"50px"},key:t},e)))))))}})))}_getCompletedSummaryViewItems(e,t){const a=this._isAnyDifferenceValuePresentInNumberCharts(),r=(0,T.isFeatureFlagEnabled)(this.context.pageContext,u.FeatureFlagConstants.TriReportCustomization,!1),n=e<t;let o=[];return this._currentState.aggregatedRunsCount&&this._currentState.aggregatedRunsCount.completedRuns>0&&(this._currentState&&this._currentState.totalTestsNumberChartProps&&!this._currentState.onlyNotReportedTests&&(n?this._currentState.totalTestsChartProps&&o.push(this._smallFailedAndPassedData(this._currentState.totalTestsChartProps.aggregatedtotalTests,f.TotalTestsText,[this._currentState.totalTestsChartProps.totalPassed,this._currentState.totalTestsChartProps.totalFailures,this._currentState.totalTestsChartProps.otherTests])):o.push(s.createElement(R.ResultSummaryNumberChartComponent,Object.assign({},this._currentState.totalTestsNumberChartProps,{isVerticalAlignWithDifferencePresent:a})))),!this._currentState||this._currentState.onlyNotReportedTests||n||o.push(s.createElement("div",{className:"separator"})),this._currentState&&this._currentState.totalTestsChartProps&&!this._currentState.onlyNotReportedTests&&!n&&o.push(this._getTotalTestsChart()),this._currentState&&this._currentState.totalTestsChartProps&&this._currentState.testFailuresChartProps&&this._currentState.testFailuresChartProps.totalFailures>0&&!this._currentState.onlyNotReportedTests&&(n?o.push(this._smallFailedAndPassedData(this._currentState.testFailuresChartProps.totalFailures,f.FailedTestsHeading,[this._currentState.testFailuresChartProps.newFailures,this._currentState.testFailuresChartProps.existingFailures])):o.push(this._getFailedTestsChart())),this._currentState&&this._currentState.passPercentageNumberChartProps&&!this._currentState.onlyNotReportedTests&&o.push(s.createElement(R.ResultSummaryNumberChartComponent,Object.assign({},this._currentState.passPercentageNumberChartProps,{isVerticalAlignWithDifferencePresent:a,isScreenSizeSmall:n}))),this._currentState&&this._currentState.runDurationNumberChartProps&&!this._currentState.onlyNotReportedTests&&o.push(s.createElement(R.ResultSummaryNumberChartComponent,Object.assign({},this._currentState.runDurationNumberChartProps,{isVerticalAlignWithDifferencePresent:a,isScreenSizeSmall:n}))),r&&this._currentState&&this._currentState.notReportedNumberChartProps&&o.push(s.createElement(R.ResultSummaryNumberChartComponent,Object.assign({},this._currentState.notReportedNumberChartProps,{isVerticalAlignWithDifferencePresent:a,isScreenSizeSmall:n})))),this._currentState&&this._currentState.aggregatedRunsCount&&this._currentState.aggregatedRunsCount.abortedRuns>0&&!this._currentState.onlyNotReportedTests&&(this._currentState&&this._currentState.aggregatedRunsCount&&this._currentState.aggregatedRunsCount.completedRuns>0&&!n&&o.push(s.createElement("div",{className:"aborted-runs-separator"})),this._currentState&&this._currentState.totalAbortedTestsNumberChartProps&&!n&&o.push(s.createElement(R.ResultSummaryNumberChartComponent,Object.assign({},this._currentState.totalAbortedTestsNumberChartProps,{isVerticalAlignWithDifferencePresent:a}))),this._currentState&&this._currentState.abortedTestsChartProps&&this._currentState.abortedTestsChartProps.totalTests>0&&(!n||this._currentState.totalTestsChartProps&&0==this._currentState.totalTestsChartProps.aggregatedtotalTests&&e>650?o.push(this._getAbortedTestsChart()):o.push(this._smallFailedAndPassedData(this._currentState.abortedTestsChartProps.totalTests,f.TotalAbortedRunText,[this._currentState.abortedTestsChartProps.totalPassed,this._currentState.abortedTestsChartProps.totalFailures,this._currentState.abortedTestsChartProps.otherTests,this._currentState.abortedTestsChartProps.totalAborted,this._currentState.abortedTestsChartProps.totalNotImpactedTests])))),o}_getRequiredDisplaySize(){let e=0;return this._currentState.onlyNotReportedTests||e++,this._currentState.abortedTestsChartProps&&this._currentState.abortedTestsChartProps.totalTests>0&&e++,this._currentState.notReportedNumberChartProps&&this._currentState.notReportedNumberChartProps.value>0&&e++,3==e?1500:2==e?1350:1024}_smallFailedAndPassedData(e,t,r){let n="";return t===f.TotalTestsText&&(n=(0,o.localeFormat)(f.ResultsSmallViewStatus,r[0],r[1],r[2])),t===f.TotalAbortedRunText&&(n=(0,o.localeFormat)(f.AbortedResultsSmallView,r[0],r[1],r[2],r[3],r[4])),t===f.FailedTestsHeading&&(n=(0,o.localeFormat)(f.FailedResultsSmallView,r[0],r[1])),s.createElement("div",{className:(0,a.css)("flex-grow","flex-row flex-self-start","formatted-summary-string")},s.createElement("div",{className:(0,a.css)("secondary-text summary-line-compact"),id:(0,a.getSafeId)(t)},t,":"),s.createElement("div",{className:(0,a.css)("summary-line-smallWindow flex-center flex-column")},e," ",n))}_getCurrentWidthOfSummary(){this._refSummary&&(this._paneSize.value=this._refSummary.clientWidth)}_isAnyDifferenceValuePresentInNumberCharts(){let e=!1;return(this._currentState.totalTestsNumberChartProps&&this._currentState.totalTestsNumberChartProps.difference&&this._currentState.totalTestsNumberChartProps.difference.valueType!==R.ValueType.Unchanged||this._currentState.passPercentageNumberChartProps&&this._currentState.passPercentageNumberChartProps.difference&&this._currentState.passPercentageNumberChartProps.difference.valueType!==R.ValueType.Unchanged||this._currentState.runDurationNumberChartProps&&this._currentState.runDurationNumberChartProps.difference&&this._currentState.runDurationNumberChartProps.difference.valueType!==R.ValueType.Unchanged||this._currentState.totalAbortedTestsNumberChartProps&&this._currentState.totalAbortedTestsNumberChartProps.difference&&this._currentState.totalAbortedTestsNumberChartProps.difference.valueType!==R.ValueType.Unchanged||this._currentState.notReportedNumberChartProps&&this._currentState.notReportedNumberChartProps.difference&&this._currentState.notReportedNumberChartProps.difference.valueType!==R.ValueType.Unchanged)&&(e=!0),e}_getTotalTestsChart(){const e=this._getTotalTestsChartProps();let t=[];t.push({y:this._currentState.totalTestsChartProps.totalPassed,name:f.PassedText,color:u.TestReportColorPalette.Passed}),t.push({y:this._currentState.totalTestsChartProps.totalFailures,name:f.FailedText,color:u.TestReportColorPalette.Failed}),t.push({y:this._currentState.totalTestsChartProps.otherTests,name:f.OthersText,color:u.TestReportColorPalette.OtherOutcome}),t.push({y:this._currentState.totalTestsChartProps.totalNotImpactedTests,name:f.NotImpactedLegendText,color:u.TestReportColorPalette.NotImpacted});let a={width:this._chartDiameter,height:this._chartDiameter},o=[{data:t||[]}];const i=this._getDonutChartLegendProps(e);return s.createElement("div",{className:"summary-view-totaltests-chart"},s.createElement(r.WrappedComponent,{dependencies:["ms.vss-features.vss-charts-common"],wrappedType:"vss-chart",pageContext:this.context.pageContext,hostOptions:a,specializedOptions:{size:"120%",innerSize:"60%",showLabels:!1},title:f.TotalTestsHeading,chartType:"pie",series:o,suppressMargin:!0,suppressAnimation:!0,legend:{enabled:!1},xAxis:{labelFormatMode:"textual",labelValues:n._getXLables(t)}}),s.createElement(P.DonutChartLegendComponent,Object.assign({},i)))}static _getXLables(e){return e?e.map((e=>e.name||"")):[]}_getFailedTestsChart(){const e=this._getFailedTestsChartProps(),t=this._getDonutChartLegendProps(e);let a=[];a.push({y:this._currentState.testFailuresChartProps.newFailures,name:f.NewFailuresLegendText,color:u.TestReportColorPalette.Failed}),a.push({y:this._currentState.testFailuresChartProps.existingFailures,name:f.ExistingFailuresLegendText,color:u.TestReportColorPalette.ExistingFailures});let o={width:this._chartDiameter,height:this._chartDiameter},i=[{name:"FailedTests",data:a||[]}];return s.createElement("div",{className:"summary-view-failedtests-chart"},s.createElement(r.WrappedComponent,{dependencies:["ms.vss-features.vss-charts-common"],wrappedType:"vss-chart",pageContext:this.context.pageContext,hostOptions:o,specializedOptions:{size:"120%",innerSize:"60%",showLabels:!1},title:f.FailedTestsHeading,chartType:"pie",series:i,suppressMargin:!0,suppressAnimation:!0,legend:{enabled:!1},xAxis:{labelFormatMode:"textual",labelValues:n._getXLables(a)}}),s.createElement("div",{className:"failure-chart-legend-area"},this._getFailureChartLabelDiv(e),s.createElement(P.DonutChartLegendComponent,Object.assign({},t))))}_getAbortedTestsChart(){const e=this._getAbortedTestsChartProps(),t=this._getDonutChartLegendProps(e);return s.createElement("div",{className:"summary-view-abortedtests-chart"},s.createElement(P.DonutChartLegendComponent,Object.assign({},t)))}_getDonutChartLegendProps(e){return{legend:e.data.map((e=>({count:e.dataCount.toLocaleString(),label:e.dataValue,color:e.dataColor,sublabel:e.dataSubText})))}}_getFailureChartLabelDiv(e){let t,a,r,n;if(!this._currentState.testFailuresChartProps)return s.createElement("div",null,'"Failure Chart props are empty."');const i=this._currentState.testFailuresChartProps.increaseInFailures;return i>0?(a="failures-increased",t=(0,o.format)("(+{0})",i.toLocaleString()),n="Failures increased by "+i.toLocaleString()):i<0?(a="failures-decreased",t=(0,o.format)("({0})",i.toLocaleString()),n="Failures decreased by "+Math.abs(i).toLocaleString()):(a="failures-unchanged",t="",n="Failures unchanged"),r=e.totalCount.toString()+" "+e.title+" "+n,s.createElement("div",{className:"failure-chart-label-div"},s.createElement("div",{role:"img","aria-label":r,className:"failed-chart-total-count"},e.totalCount),s.createElement("div",{"aria-hidden":"true",className:"failed-chart-title"},e.title),s.createElement("div",{"aria-hidden":"true",className:`${a} failed-chart-test-increment`},t.toLocaleString()))}_getTotalTestsChartProps(){const e={};return this._currentState.totalTestsChartProps?(e.title=f.TotalTestsHeading,e.totalCount=this._currentState.totalTestsChartProps.aggregatedtotalTests,e.data=[],e.data.push({dataValue:f.PassedText,dataCount:this._currentState.totalTestsChartProps.totalPassed,dataColor:u.TestReportColorPalette.Passed,dataSubText:this._currentState.totalTestsChartProps.totalPassedOnRerun>0?(0,o.format)(f.PassedOnRerunLegendText,this._currentState.totalTestsChartProps.totalPassedOnRerun):null}),e.data.push({dataValue:f.FailedText,dataCount:this._currentState.totalTestsChartProps.totalFailures,dataColor:u.TestReportColorPalette.Failed}),e.data.push({dataValue:f.OthersText,dataCount:this._currentState.totalTestsChartProps.otherTests,dataColor:u.TestReportColorPalette.OtherOutcome}),this._currentState.totalTestsChartProps.totalNotImpactedTests>0&&e.data.push({dataValue:f.NotImpactedLegendText,dataCount:this._currentState.totalTestsChartProps.totalNotImpactedTests,dataColor:u.TestReportColorPalette.NotImpacted}),e):e}_getFailedTestsChartProps(){const e={};return this._currentState.testFailuresChartProps?(e.title=f.FailedTestsHeading,e.totalCount=this._currentState.testFailuresChartProps.totalFailures,e.data=[],e.data.push({dataValue:f.NewFailuresLegendText,dataCount:this._currentState.testFailuresChartProps.newFailures,dataColor:u.TestReportColorPalette.Failed}),e.data.push({dataValue:f.ExistingFailuresLegendText,dataCount:this._currentState.testFailuresChartProps.existingFailures,dataColor:u.TestReportColorPalette.ExistingFailures}),e):e}_getAbortedTestsChartProps(){const e={data:[]};return this._currentState.abortedTestsChartProps?(e.data.push({dataValue:f.PassedText,dataCount:this._currentState.abortedTestsChartProps.totalPassed,dataColor:u.TestReportColorPalette.Passed}),e.data.push({dataValue:f.FailedText,dataCount:this._currentState.abortedTestsChartProps.totalFailures,dataColor:u.TestReportColorPalette.Failed}),e.data.push({dataValue:f.TestOutcome_Aborted,dataCount:this._currentState.abortedTestsChartProps.totalAborted,dataColor:u.TestReportColorPalette.AbortedForLegend}),e.data.push({dataValue:f.OthersText,dataCount:this._currentState.abortedTestsChartProps.otherTests,dataColor:u.TestReportColorPalette.OtherOutcome}),this._currentState.abortedTestsChartProps.totalNotImpactedTests>0&&e.data.push({dataValue:f.NotImpactedLegendText,dataCount:this._currentState.abortedTestsChartProps.totalNotImpactedTests,dataColor:u.TestReportColorPalette.NotImpacted}),e):e}}t[e].CompletedSummaryView=n}("ComponentsCompletedSummaryView"),function(e){N=t[e]={};class a extends r.VssComponent{render(){return s.createElement("div",{className:"testresults-colored-number-chart"},s.createElement("div",{className:"chart-value",style:{color:this.props.color}},this.props.value),s.createElement("div",{className:"chart-title-legend"},this._getLegendCircleElement(this.props.color),s.createElement("span",{className:"legend-title"},this.props.title)))}_getLegendCircleElement(e){return s.createElement("span",{className:"legend-circle"},s.createElement("svg",{width:"14px",height:"14px"},s.createElement("circle",{className:"color-circle",cx:"7",cy:"7",r:"7",fill:e})))}}t[e].ResultSummaryColoredNumberChartComponent=a}("ComponentsResultSummaryColoredNumberChart"),function(e){x=t[e]={};class a extends r.VssComponent{constructor(e){super(e),this.state={}}componentDidMount(){(0,b.getTestAnalyticsLinkData)(this.context,this.props.artifactData.viewContext,this.props.store.getDefinitionId()).then((e=>{this._currentState.testAnalyticsLinkData=e,this.setState(this._currentState)})),this._logTelemetryForClick()}render(){return this.props.store&&(this._currentState=this.props.store.getState()),this._getInProgressSummaryViewBody()}_logTelemetryForClick(){let e=this.props.isBuildTimeline?m.featureTestTab_summaryInBuildTimelineRendered:m.featureTestTab_TestTabClicked;this._currentState.aggregatedTestsCount&&d.publishEvent(this.context.pageContext,this.props.artifactData,e,{[m.inProgress]:!0,[m.totalTestsExists]:this._currentState.aggregatedTestsCount.totalTests>0?"Yes":"No",[m.failedTestsExists]:this._currentState.aggregatedTestsCount.failedTests>0?"Yes":"No",[m.totalTests]:this._currentState.aggregatedTestsCount.totalTests,[m.failedTests]:this._currentState.aggregatedTestsCount.failedTests,[m.passedTests]:this._currentState.aggregatedTestsCount.passedTests})}_getInProgressSummaryViewBody(){if(this._currentState&&this._currentState.aggregatedRunsCount)return s.createElement("div",{className:"summary-view-container-parent"},s.createElement("div",{className:"summary-view-container-left"},s.createElement("div",{className:"summary-view-bar-left"},s.createElement("div",{className:"summary-view-bar-icon-run-count"},s.createElement(n.Icon,{iconName:"TestBeaker",className:"summary-view-test-icon"}),s.createElement("div",{className:"run-count-details"},s.createElement("span",{className:"run-count-details-count"},this._currentState.aggregatedRunsCount.totalRuns),s.createElement("span",{className:"run-count-details-name"},f.Runs))),s.createElement("div",{className:"separator-in-bar"})),s.createElement("div",{className:"inprogress-summary-view-body margin-left-side"},s.createElement(R.ResultSummaryNumberChartComponent,{title:f.TotalTestsText,value:null!=this._currentState.aggregatedTestsCount?this._currentState.aggregatedTestsCount.totalTests:0,difference:null,dataType:R.DataType.String,isVerticalAlignWithDifferencePresent:!1}),s.createElement("div",{className:"separator"}))),s.createElement("div",{className:"summary-view-container-right"},s.createElement("div",{className:"summary-view-bar-right"},s.createElement("div",{className:"inprogress-run-details"},s.createElement("span",{className:"inprogress-run-details-count"},this._currentState.aggregatedRunsCount.inProgressRuns),s.createElement("span",{className:"inprogress-run-details-name"},f.ResultStateInProgress)),!!this._currentState.aggregatedRunsCount.completedRuns&&s.createElement("div",{className:"completed-run-details"},s.createElement("span",{className:"comma"},f.CommaSeparator),s.createElement("span",{className:"completed-run-details-count"},this._currentState.aggregatedRunsCount.completedRuns),s.createElement("span",{className:"completed-run-details-name"},f.TestRunStateCompleted)),!!this._currentState.aggregatedRunsCount.abortedRuns&&s.createElement("div",{className:"aborted-run-details"},s.createElement("span",{className:"comma"},f.CommaSeparator),s.createElement("span",{className:"aborted-run-details-count",style:{color:u.TestReportColorPalette.Failed}},this._currentState.aggregatedRunsCount.abortedRuns),s.createElement("span",{className:"aborted-run-details-name"},f.TestRunStateAborted)),this.state.testAnalyticsLinkData&&this.state.testAnalyticsLinkData.testAnalyticsLinkMessage&&!this.props.isBuildTimeline&&s.createElement(g.FPSLinkComponent,{className:"failing-test-analytics-link",href:this.state.testAnalyticsLinkData.testAnalyticsLink,telemetrySource:m.featureAnalyticsInProductLink_UniqueFailingTests_TestTab,telemetryProperties:this.props.telemetryPropertiesForInProductLink},this.state.testAnalyticsLinkData.testAnalyticsLinkMessage),(0,T.isFeatureFlagEnabled)(this.context.pageContext,u.FeatureFlagConstants.ShowCloudTestLink)&&s.createElement(r.WrappedComponent,{dependencies:["ms.vss-test-web.test-cloud-test-link"],wrappedType:"cloud-test-link",wrappedProps:{artifactData:this.props.artifactData}})),s.createElement("div",{className:"inprogress-summary-view-body"},s.createElement(N.ResultSummaryColoredNumberChartComponent,{title:f.TestOutcome_Passed,value:null!=this._currentState.aggregatedTestsCount?this._currentState.aggregatedTestsCount.passedTests:0,color:u.TestReportColorPalette.Passed}),s.createElement(N.ResultSummaryColoredNumberChartComponent,{title:f.TestOutcome_Failed,value:null!=this._currentState.aggregatedTestsCount?this._currentState.aggregatedTestsCount.failedTests:0,color:u.TestReportColorPalette.Failed}),null!=this._currentState.aggregatedTestsCount&&!!this._currentState.aggregatedTestsCount.abortedTests&&s.createElement(N.ResultSummaryColoredNumberChartComponent,{title:f.TestOutcome_Aborted,value:null!=this._currentState.aggregatedTestsCount?this._currentState.aggregatedTestsCount.abortedTests:0,color:u.TestReportColorPalette.Aborted}),s.createElement("div",{className:"donut-chart-legend-container"},this._getDonutChartLegends()))));{let e=this.props.artifactData.data.mainData;if(2!==this.props.artifactData.data.mainData.status&&1!==e.status)return s.createElement("div",null,f.NoTestsMessageWhileBuildInProgress);let t=1===e.definition.type;if(!e.controller&&!t)return s.createElement("div",null,f.BuildDoesNotHaveTestReports);if(1===e.status)return s.createElement("div",null,f.NoTestsMessageWhileBuildInProgress);if(e.deleted)return s.createElement("div",null," ",f.BuildDeletedNoTestResults)}return s.createElement("div",null,f.NoTestResultsMessage)}_getDonutChartLegends(){let e={legend:[]};return this._currentState.aggregatedTestsCount&&(e.legend.push({count:this._currentState.aggregatedTestsCount.notExecutedTests,label:f.TestOutcome_NotExecuted,color:u.TestReportColorPalette.NotExecuted}),this._currentState.aggregatedTestsCount.notImpactedTests&&e.legend.push({count:this._currentState.aggregatedTestsCount.notImpactedTests,label:f.ResultStateNotImpacted,color:u.TestReportColorPalette.NotImpacted}),this._currentState.aggregatedTestsCount.notImpactedTests&&e.legend.push({count:this._currentState.aggregatedTestsCount.notImpactedTests,label:f.ResultStateNotImpacted,color:u.TestReportColorPalette.NotImpacted}),e.legend.push({count:this._currentState.aggregatedTestsCount.otherTests,label:f.OthersText,color:u.TestReportColorPalette.OtherOutcome})),s.createElement(P.DonutChartLegendComponent,Object.assign({},e))}}t[e].InProgressSummaryView=a}("ComponentsInProgressSummaryView"),function(e){w=t[e]={};t[e].TestResultSource=class{constructor(e){this._metricsAPIinunifiedPipeline="WebAccess.TestManagement.UnifiedPipelineMetricsAPI",this._inProgressDPRequestParams={state:"InProgress"},this._completedDPRequestParams={state:"Completed"},this.buildSummaryDataProviderName="ms.vss-test-web.test-tab-build-summary-data-provider",this.pipelineSummaryDataProviderName="ms.vss-test-web.test-tab-unifiedPipeline-summary-data-provider",this.releaseSummaryDataProviderName="ms.vss-test-web.test-tab-release-summary-data-provider",this._pageContext=e.pageContext}getTestReportFromDataProviderAsync(e,t){return new Promise((async(s,a)=>{try{const a=t.pageContext.getService("IVssContributionService");if(e.status===u.ViewContextStatus.InProgress){return s(await a.getDataAsync(this._getDataProviderName(e),this._inProgressDPRequestParams,!0))}const r=a.getData(this._getDataProviderName(e));return this._isDataProviderCacheValid(a,r,e)?s(r):s(await this._refreshAndGetDataProviderCache(a,e))}catch(e){a(e)}}))}getTestReportFromDataProviderForUnifiedPipelineAsync(e,t){return new Promise((async(s,a)=>{try{const a=t.pageContext.getService("IVssContributionService");if(e.status===u.ViewContextStatus.InProgress){return s(await a.getDataAsync(this.pipelineSummaryDataProviderName,this._inProgressDPRequestParams,!0))}const r=a.getData(this.pipelineSummaryDataProviderName);return this._isDataProviderCacheValidForUnifiedPipeline(a,r,e)?s(r):s(await this._refreshAndGetDataProviderCacheForUnifiedPipeline(a,e))}catch(e){a(e)}}))}_isDataProviderCacheValid(e,t,s){return!!t&&((s.viewContext!==u.ViewContext.Build||t.testResultsContext.build.id===s.data.mainData.id)&&((s.viewContext!==u.ViewContext.Release||t.testResultsContext.release.id===s.data.mainData.id&&t.testResultsContext.release.environmentId===s.data.subData.environment.id)&&!e.getData(this._getDataProviderName(s),this._inProgressDPRequestParams)))}_isDataProviderCacheValidForUnifiedPipeline(e,t,s){return!!t&&((s.viewContext!==u.ViewContext.Build||t.currentContext.pipelineId===s.data.mainData.id)&&s.contributionSource===u.ContributionSource.Pipeline&&!e.getData(this.pipelineSummaryDataProviderName,this._inProgressDPRequestParams))}async _refreshAndGetDataProviderCache(e,t){const s=e.getData(this._getDataProviderName(t),this._completedDPRequestParams);return this._isDataProviderCacheValid(e,s,t)?s:await e.getDataAsync(this._getDataProviderName(t),this._completedDPRequestParams,!0)}async _refreshAndGetDataProviderCacheForUnifiedPipeline(e,t){const s=e.getData(this.pipelineSummaryDataProviderName,this._completedDPRequestParams);return this._isDataProviderCacheValidForUnifiedPipeline(e,s,t)?s:await e.getDataAsync(this.pipelineSummaryDataProviderName,this._completedDPRequestParams,!0)}_getDataProviderName(e){return e.viewContext===u.ViewContext.Build?this.buildSummaryDataProviderName:this.releaseSummaryDataProviderName}}}("SourcesTestResultSource"),function(e){F=t[e]={};t[e].TestResultsReportActionsCreator=class{constructor(e,t,s){this._actionHub=e,this._context=t,this._viewContextData=s,this._metricsAPIInUnifiedPipeline="WebAccess.TestManagement.UnifiedPipelineMetricsAPI",this._testResultSource=new w.TestResultSource(t),this._pageContext=t.pageContext}initialize(e){this._shouldUsePipelineAPi(e)?this._testResultSource.getTestReportFromDataProviderForUnifiedPipelineAsync(e,this._context).then((t=>{t?this._invokeActionsForUnifiedPipeline(t,e):(this._actionHub.onSummaryLoaded.invoke({context:e,errorCode:1}),d.publishEvent(this._context.pageContext,this._viewContextData,m.featureTestTab_ErrorInSummaryDataProvider,{DataProviderName:"test-tab-unifiedPipeline-summary-data-provider",reason:"No data returned from the data provider"}))})).catch((t=>{console.error(t),this._actionHub.onSummaryLoaded.invoke({context:e,errorMessage:t,errorCode:2})})):this._testResultSource.getTestReportFromDataProviderAsync(e,this._context).then((t=>{t?this._invokeActions(t,e):(this._actionHub.onSummaryLoaded.invoke({context:e,errorCode:1}),d.publishEvent(this._context.pageContext,this._viewContextData,m.featureTestTab_ErrorInSummaryDataProvider,{DataProviderName:"test-tab-build-summary-data-provider",reason:"No data returned from the data provider"}))})).catch((t=>{console.error(t),this._actionHub.onSummaryLoaded.invoke({context:e,errorMessage:t,errorCode:2})}))}refreshTestResulstsSummary(e){this._shouldUsePipelineAPi(e)?this._testResultSource.getTestReportFromDataProviderForUnifiedPipelineAsync(e,this._context).then((t=>{this._invokeActionsForUnifiedPipeline(t,e)})).catch((t=>{console.error(t),this._actionHub.onSummaryLoaded.invoke({context:e,errorMessage:t,errorCode:2})})):this._testResultSource.getTestReportFromDataProviderAsync(e,this._context).then((t=>{this._invokeActions(t,e)})).catch((t=>{console.error(t),this._actionHub.onSummaryLoaded.invoke({context:e,errorMessage:t,errorCode:2})}))}_invokeActions(e,t){let s=!1;e.totalRunsCount>0&&e.noConfigRunsCount>0&&e.totalRunsCount===e.noConfigRunsCount&&(s=!0),this._checkForData(e)?(this._actionHub.initializeTestResultSummary.invoke({summaryData:e,viewContextStatus:t.status}),this._actionHub.onSummaryLoaded.invoke({context:t,isNoConfigRuns:s})):this._actionHub.onSummaryLoaded.invoke({context:t,errorCode:1,isNoConfigRuns:s})}_invokeActionsForUnifiedPipeline(e,t){let s=!1;e.runSummary&&e.runSummary.noConfigRunsCount>0&&e.runSummary.noConfigRunsCount===e.runSummary.totalRunsCount&&(s=!0),e.runSummary&&e.runSummary.totalRunsCount>0?(this._actionHub.initializeTestResultSummaryForUnifiedPipeline.invoke({summaryData:e,viewContextStatus:t.status}),this._actionHub.onSummaryLoaded.invoke({context:t,isNoConfigRuns:s})):this._actionHub.onSummaryLoaded.invoke({context:t,errorCode:1,isNoConfigRuns:s})}_checkForData(e){return e.aggregatedResultsAnalysis.totalTests>0||this._areThereNotImpactedTests(e)||this._areThereRunsByState(4,e)||this._areThereRunsByState(2,e)||e.totalRunsCount>0}_areThereRunsByState(e,t){return t.aggregatedResultsAnalysis.runSummaryByState&&t.aggregatedResultsAnalysis.runSummaryByState[e]&&t.aggregatedResultsAnalysis.runSummaryByState[e].runsCount>0}_areThereNotImpactedTests(e){return e.aggregatedResultsAnalysis.resultsByOutcome&&e.aggregatedResultsAnalysis.resultsByOutcome[14]&&e.aggregatedResultsAnalysis.resultsByOutcome[14].count>0}_shouldUsePipelineAPi(e){return e.contributionSource===u.ContributionSource.Pipeline&&(0,T.isFeatureFlagEnabled)(this._pageContext,this._metricsAPIInUnifiedPipeline,!1)}}}("ActionsTestResultsReportActionsCreator"),function(e){t[e]={};class a extends r.VssComponent{constructor(e,t){super(e,t),this.onSectionClicked=(e,t)=>{const s=t.isCollapsed;s.value=!s.value;let a=this._summaryViewStore.getState();a.summaryAccordianState=s.value,this.setState(a),this._summaryExpandedOrCollapsedTelemetry(this._testSummaryString,s.value)},this._handleStoreChange=()=>{const e=this._summaryViewStore.getState();e.refreshSummary?this._summaryActionsCreator.refreshTestResulstsSummary(this.props.artifactData):this.setState(e)},this._testSummaryString="TestSummary",this._performanceService=this.context.pageContext.getService("IVssPerformanceService"),this._summaryActionsCreator=new F.TestResultsReportActionsCreator(this.props.actionsHub,t,this.props.artifactData),this._summaryViewStore=new v.SummaryViewStore("TestTabInBuildComponent",t,this.props.actionsHub,this.props.artifactData),this.state=this._summaryViewStore.getState()}componentDidUpdate(e){(0,c.hasArtifactChanged)(this.props.artifactData,e.artifactData)&&this._summaryActionsCreator.initialize(this.props.artifactData)}componentDidMount(){this._summaryViewStore.addChangedListener(this._handleStoreChange),this._summaryActionsCreator.initialize(this.props.artifactData);let e=this.props.artifactData.contributionSource;e!==u.ContributionSource.Build&&e!==u.ContributionSource.Pipeline||this._performanceService.addSplitTiming(y.TestSummaryLoaded,e)}componentWillUnmount(){this._summaryViewStore.removeChangedListener(this._handleStoreChange),this._summaryViewStore.dispose()}render(){if(!this.state.shouldShowSummary)return null;const e=this.state.isInProgressView?s.createElement(x.InProgressSummaryView,{store:this._summaryViewStore,artifactData:this.props.artifactData,telemetryPropertiesForInProductLink:this._getTelemetryPropertiesForInProductLink()}):s.createElement(D.CompletedSummaryView,{store:this._summaryViewStore,artifactData:this.props.artifactData,telemetryPropertiesForInProductLink:this._getTelemetryPropertiesForInProductLink()}),t=[{isCollapsed:new p.ObservableValue(this.state.summaryAccordianState),key:this._testSummaryString,title:f.TestSummaryTitle,onRenderContent:()=>e}];let a=this.props.artifactData.contributionSource===u.ContributionSource.Pipeline?"test-results-summary-view pipeline-summary":"test-results-summary-view";return s.createElement("div",{className:a},s.createElement("div",{className:"test-summary-view depth-8"},s.createElement(_.Accordion,{sections:t,className:"summary-accordion",onSectionClicked:this.onSectionClicked})))}_summaryExpandedOrCollapsedTelemetry(e,t){e==this._testSummaryString&&d.publishEvent(this.context.pageContext,this.props.artifactData,m.featureTestTab_SummaryExpandCollapseClicked,{State:t})}_getTelemetryPropertiesForInProductLink(){return{[m.workflow]:u.ViewContext[this.props.artifactData.viewContext].toString(),[m.id]:this.props.artifactData.data.mainData.id.toString()}}}t[e].Summary=a}("ComponentsSummary")}),["Resources","Components/DonutChartLegend","Components/ResultSummaryDetailsChart","Components/TestAnalyticsLink","Actions/TestResultsReportActionsHub","Store/SummaryViewStore","Components/CompletedSummaryView","Components/ResultSummaryColoredNumberChart","Components/InProgressSummaryView","Sources/TestResultSource","Actions/TestResultsReportActionsCreator","Components/Summary"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-test-web.test-testSummary"}}));