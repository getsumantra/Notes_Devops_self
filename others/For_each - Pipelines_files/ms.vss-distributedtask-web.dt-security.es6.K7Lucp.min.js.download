"use strict";define("DistributedTaskUI/SecurityComponent",["require","exports","react","VSS/Platform/Layout","VSSUI/Button","VSSUI/Callout","VSSUI/PickList","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/Panel","VSSUI/Table","VSSUI/Utilities/Provider","VSSUI/Icon","VSSUI/TooltipEx","VSSUI/Dialog","VSS/Reflux/Action","VSS/Reflux/Store","VSSUI/ListBox","VSS/Core/Observable","VSS/Platform/Feature","VSS/Platform/Context","VSS/Platform/RestClientBase","VSS/Platform/Util/Serialization","Tfs/Platform/Page","VSS/Core/Util/String","VSSUI/Card","VSSUI/Link","VSSUI/Menu","VSSUI/Observer","VSSUI/MessageCard","VSS/Core/Util/Accessibility","VSS/Core/TimerManagement","VSS/Platform/Location","VSS/Features/PlatformUI/FPSLink","VSSUI/Image","VSS/Features/Identities/IdentityPickerProvider","VSSUI/IdentityPicker","VSSUI/FormItem","VSSUI/ButtonGroup","VSSUI/Tabs","VSS/Platform/Identity"],(function(e,t,i,s,n,o,r,a,l,c,d,h,p,m,u,g,_,P,A,C,f,S,R,D,v,b,z,E,I,y,N,j,w,x,T,L,k,U,B,M,O){var V,F,H,G,W,Y,q,K,J,$,Q,X,Z,ee,te,ie,se,ne,oe,re,ae;V=t[ae="Resources"]={},t[ae].OpenAccessDialogTitle="Confirm open access",t[ae].OpenAccessDialogCancelButton="Cancel",t[ae].OpenAccessDialogConfirmButton="Open access",t[ae].OpenAccessDialogWarning="Are you sure you want to continue?",t[ae].OpenAccessDialogMessage="This will allow all pipelines in the project to use this resource",t[ae].RestrictAccessPanelTitle="Granting permissions",t[ae].RestrictAccessPanelConfirmButton="Got it",t[ae].RestrictAccessPanelContecntLine1="For continuity, the following pipelines will automatically be granted permissions.",t[ae].RestrictAccessPanelContecntLine2="You may remove their permissions later at any time.",t[ae].PipelineString="Pipeline",t[ae].PipelinePermissionsTitle="Pipeline permissions",t[ae].ProjectPermissionsTitle="Project permissions",t[ae].PipelinePermissionsDescription="The following YAML pipelines are allowed to use this resource. YAML pipelines from other projects are not shown in this list. All Classic pipelines can use this resource.",t[ae].OpenAccessMenuItem="Open access",t[ae].ViewOptionsTooltip="More actions",t[ae].NoRestrictionsCardTitle="No restrictions",t[ae].NoRestrictionsCardContent="Any pipeline may use this resource",t[ae].RestrictAccessButtonText="Restrict permission",t[ae].NoAuthorizedPipelinesCardTitle="No permitted pipelines",t[ae].NoAuthorizedPipelinesCardContent="This resource cannot be used in a YAML pipeline until at least one pipeline has permission.",t[ae].NoAuthorizedPipelinesCardDesignerPipelinesContent="All Classic pipelines can use this resource.",t[ae].LearnMoreText="Learn more",t[ae].LearnMoreDescriptionForProjectPermissions="Learn more about project permissions",t[ae].LearnMoreDescriptionForPipelinePermissions="Learn more about pipeline authorizations",t[ae].RecentText="Recent",t[ae].AllText="All",t[ae].RevokeAccessTooltip="Revoke access",t[ae].AuthorizePipelinesTooltip="Add pipeline",t[ae].PipelinesDropdownLabel="Authorize pipelines dropdown",t[ae].PipelinesDropdownFilterPlaceholder="Search pipelines",t[ae].PipelinesDropdownfilteredNoResultsText="No pipelines matched the supplied filter. Continue typing or try refining your search.",t[ae].AccessAssigned="Assigned",t[ae].AccessInherited="Inherited",t[ae].AddUsersDialogTitle="Add User",t[ae].AddRoleInputField="Role",t[ae].AddButtonText="Add",t[ae].CloseButtonLabelText="Close",t[ae].UndoButtonText="Undo",t[ae].SaveButtonText="Save",t[ae].AddUserInputField="User or group",t[ae].CannotUpdateSecurityMessage="You dont have permission to update security for this connection.",t[ae].CannotUpdateOrganizationView="You dont have the permission to update organization level security.",t[ae].InheritanceButtonText="Inheritance",t[ae].InheritenceOnButtonText="On",t[ae].InheritenceOffButtonText="Off",t[ae].InheritenceOnButtonSelectText="Inheritence On is selected",t[ae].InheritenceOffButtonSelectText="Inheritence Off is selected",t[ae].InitialDataLoadError="Failed to load the authorization details.",t[ae].UpdateAuthorizationError="Updating pipelines authorization failed.",t[ae].ProjectButtonText="Project",t[ae].OrganizationButtonText="Organization",t[ae].ProjectPermissionsDescription="The projects below have access to this service connection.",t[ae].AdministratorRoleText="Administrator",t[ae].AuthorizeProjectTooltip="Add project",t[ae].AddProjectInfoDialogTitle="Information",t[ae].AddProjectInfoDialogText="You are about to share your service connection with other project(s). Any update to the details of the connection from other projects will be reflected everywhere. To learn more about the sharing, ",t[ae].AddProjectInfoDialogClickHere="click here.",t[ae].AddProjectInfoDialogLink="https://docs.microsoft.com/en-us/azure/devops/pipelines/library/service-endpoints?view=azure-devops&tabs=yaml#project-permissions---cross-project-sharing-of-service-connections",t[ae].AddProjectInfoDialogButtonText="Okay",t[ae].Removepermission="Remove permission",t[ae].NoProjectPermissionsCardTitle="Only current project",t[ae].NoProjectPermissionsCardContent="Share service connection with other projects.",t[ae].PipelineColumnHeading="Pipeline",t[ae].UserPermissionUserHeading="User",t[ae].UserPermissionRoleHeading="Role",t[ae].UserPermissionAccessHeading="Access",t[ae].UserPermissionsTableName="User Permissions Table",t[ae].ProjectPermissionsTableName="Project Permissions Table",t[ae].PipelinePermissionsTableName="Pipeline Permissions Table",t[ae].ProjectPermissionsProjectSharedText="Service endpoint is shared with Projects {0}",t[ae].ProjectPermissionsProjectDeletedText="Service endpoint is deleted from Projects {0}",t[ae].NotAuthorizedOpenAccess="You are not authorized to open access for this resource",function(e){F=t[e]={},t[e].viewParameter="view",t[e].definitionScopeParameter="definitionScope",t[e].buildDefinitionRequestTypeRecent="recent",t[e].buildDefinitionRequestTypeAllDefinitions="allDefinitions",t[e].recentGroupType="recent",t[e].allGroupType="all",t[e].YAMLProcessType=2,t[e].Area="PipelineAuthorization",function(e){e.OpenAccess="Open_Access",e.RestrictAccess="Restrict_Access",e.AddPipeline="Add_Pipeline",e.RemovePipeline="Remove_Pipeline",e.SearchMatchingPipelines="Search_Matching_Pipelines",e.LoadMorePipelines="Load_More_Pipelines"}(t[e].FeatureNames||(t[e].FeatureNames={}))}("Constants"),function(e){H=t[e]={};class a extends s.VssComponent{constructor(e,t){super(e,t),this._renderPipelinesList=(e,t,s,n,a,l,c)=>i.createElement(o.Callout,{className:"pipelines-permissions-add-dropdown-callout depth-8",anchorElement:s,anchorOffset:n,anchorOrigin:a,anchorPoint:l,calloutOrigin:c,onDismiss:e.collapse,escDismiss:!0,blurDismiss:!0,lightDismiss:!0},i.createElement(r.PickList,{className:"pipelines-permissions-add-dropdown-list",width:256,maxHeight:360,getListItem:e=>({name:e.name,key:e.id.toString(),iconProps:{iconName:"Rocket",className:"pipeline-list-icon"}}),ref:e=>{e&&e.focus()},items:this.props.items,isSearchable:!0,onSelectionChanged:t=>{this.props.onSelectionChanged(t),e.collapse()},onFocusLost:()=>{e.collapse()},minItemsForSearchBox:1,searchBoxAriaLabel:"Search pipelines"}))}render(){return i.createElement(n.ExpandableButton,{disabled:!this.props.items||0===this.props.items.length||!1===this.props.canEditPipelinePermission,className:"pipelines-permissions-card-header-add-button",id:"add-pipeline-permission",renderCallout:this._renderPipelinesList,iconProps:{iconName:"Add"},hideDropdownIcon:!0,ariaLabel:V.AuthorizePipelinesTooltip})}}t[e].PipelinesListComponent=a}("PipelinePermissionsAuthorizationComponentsPipelinesListComponent"),function(e){G=t[e]={};class n extends s.VssComponent{constructor(e,t){super(e,t),this.selection=new l.DropdownSelection,this.dropdown=i.createRef(),this.onBlur=()=>{this.props.onBlur?this.focus():this.collapse()},this.collapse=()=>{this.dropdown.current&&this.dropdown.current.collapse()}}render(){return i.createElement(a.Dropdown,{width:256,items:this.props.items,onSelect:(e,t)=>{this.props.onSelectionChanged(t.data),this.selection.value=[]},ariaLabel:V.PipelinesDropdownLabel,enforceSingleSelect:!0,selection:this.selection,dismissOnSelect:!0,showChecksColumn:!1,filterPlaceholderText:V.PipelinesDropdownFilterPlaceholder,filteredNoResultsText:V.PipelinesDropdownfilteredNoResultsText,filterThrottleWait:100,disabled:!this.props.items||0===this.props.items.length||!1===this.props.canEditPipelinePermission,ref:()=>this.focus(),renderExpandable:e=>i.createElement(a.DropdownExpandableButton,{buttonClassName:"pipelines-permissions-card-header-add-button expandable",id:"add-pipeline-permission",iconProps:{iconName:"Add",className:"no-padding"},hideDropdownIcon:!0,onBlur:this.onBlur,ariaLabel:V.AuthorizePipelinesTooltip,expandableRef:e.expandableRef,items:e.items,renderCallout:e.renderCallout,renderSelectedItems:e.renderSelectedItems,selection:e.selection,disabled:!this.props.items||0===this.props.items.length||!1===this.props.canEditPipelinePermission}),renderCallout:e=>i.createElement(a.DropdownCallout,Object.assign({searching:this.props.searching,listBoxClassName:"pipelines-permissions-dropdown-listbox",containerClassName:"pipelines-permissions-add-dropdown-list"},e,{onFilterTextChanged:(t,i)=>{this.props.onFilterTextChanged&&this.props.onFilterTextChanged(t,i),e.onFilterTextChanged&&e.onFilterTextChanged(t,i)}}))})}focus(){this.dropdown.current&&this.dropdown.current.focus()}}t[e].PipelinesAuthorizationDropdown=n}("PipelinePermissionsAuthorizationComponentsPipelinesAuthorizationDropdown"),function(e){W=t[e]={};class n extends s.VssComponent{constructor(e,t){super(e,t),this._renderNameCell=(e,t,s,n)=>i.createElement(d.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(p.Icon,{className:"pipeline-image",iconName:"Rocket",role:"presentation"}),i.createElement("span",null,i.createElement(m.Tooltip,{overflowOnly:!0,text:n.name},i.createElement("span",{className:"pipeline-name text-ellipsis"},n.name)),i.createElement("span",{className:"pipeline-type secondary-text body-s"},V.PipelineString)))}render(){return i.createElement(c.Panel,{onDismiss:()=>{this.props.onDismiss()},titleProps:{text:V.RestrictAccessPanelTitle,size:1},footerButtonProps:[{text:V.RestrictAccessPanelConfirmButton,primary:!0,onClick:()=>{this.props.primaryOnClick(!0)}}],lightDismiss:!0},i.createElement("div",null,i.createElement("div",null,V.RestrictAccessPanelContecntLine1),i.createElement("div",{style:{marginTop:"20px"}},V.RestrictAccessPanelContecntLine2),i.createElement(d.Table,{className:"toggle-access-panel-pipelines-list",itemProvider:new h.ArrayItemProvider(this.props.pipelineDefinitions),columns:[{id:"name",width:-100,name:V.PipelineString,className:"pipeline-name-cell",renderCell:this._renderNameCell,columnStyle:2}],showHeader:!1})))}}t[e].RestrictAllPipelinesConfirmationPanel=n}("PipelinePermissionsAuthorizationComponentsRestrictAllPipelinesConfirmationPanel"),function(e){Y=t[e]={};class n extends s.VssComponent{constructor(e,t){super(e,t)}render(){return i.createElement(u.Dialog,{titleProps:{text:V.OpenAccessDialogTitle,size:1},onDismiss:()=>{this.props.onDismiss()},footerButtonProps:[{text:V.OpenAccessDialogCancelButton,onClick:()=>{this.props.onDismiss()}},{text:V.OpenAccessDialogConfirmButton,primary:!0,onClick:()=>{this.props.primaryOnClick(!1)}}],contentSize:1},i.createElement("div",null,V.OpenAccessDialogMessage,i.createElement("br",null),i.createElement("br",null),V.OpenAccessDialogWarning))}}t[e].AuthorizeAllPipelinesConfirmationDialog=n}("PipelinePermissionsAuthorizationComponentsAuthorizeAllPipelinesConfirmationDialog"),function(e){q=t[e]={};t[e].PipelinesAuthorizationActionsHub=class{constructor(){this.initialize(),this._toggleAllPipelinesRestriction=new g.Action,this._initializeAuthorizedDefinitions=new g.Action,this._initializeAllPipelineDefinitions=new g.Action,this._initializeAuthorizedPipelineDefinitions=new g.Action,this._loadPipelineDefinitions=new g.Action,this._loadMatchingPipelineDefinitions=new g.Action,this._setErrorMessage=new g.Action,this._setLoading=new g.Action,this._setSearching=new g.Action}static getKey(){return"pipelines-security-actions"}initialize(e){}get toggleAllPipelinesRestriction(){return this._toggleAllPipelinesRestriction}get initializeAuthorizedDefinitions(){return this._initializeAuthorizedDefinitions}get initializeAllPipelineDefinitions(){return this._initializeAllPipelineDefinitions}get loadPipelineDefinitions(){return this._loadPipelineDefinitions}get loadMatchingPipelineDefinitions(){return this._loadMatchingPipelineDefinitions}get initializeAuthorizedPipelineDefinitions(){return this._initializeAuthorizedPipelineDefinitions}get setErrorMessage(){return this._setErrorMessage}get setLoading(){return this._setLoading}get setSearching(){return this._setSearching}}}("PipelinePermissionsAuthorizationActionsPipelinesAuthorizationActionsHub"),function(e){K=t[e]={};class n extends _.Store{constructor(e,t,i){super("PipelinesAuthorizationStore"),this._toggleAllPipelinesRestriction=e=>{this._initializeAuthorizedDefinitions(e),this._clearDeletedPipelines(),this.emitChanged()},this._initializeAuthorizedDefinitions=e=>{this._state.authorizedDefinitions=e,this._state.errorMessage="",this._state.authorizedPipelinesDictionary={},this._state.authorizedDefinitions.pipelines&&this._state.authorizedDefinitions.pipelines.forEach((e=>{this._state.authorizedPipelinesDictionary[e.id]=!0})),this.emitChanged()},this._initializeAllPipelineDefinitions=e=>{this._state.allPipelineDefinitions=e,this._state.errorMessage="",this.emitChanged()},this._setPipelineDefinitions=e=>{let t=0===this._state.allPipelineDefinitions.length&&e.length>0;this._state.continuationToken=e.continuationToken;const i=this._state.allPipelineDefinitions.value;for(const t of e.values())this._state.allPipelineDefinitionIds.has(t.id)||(i.push(this._buildDefinitionReferenceToListItem(t)),this._state.allPipelineDefinitionIds.add(t.id));this._state.continuationToken&&t&&i.push(this._getLoadingListBoxItem()),this._state.allPipelineDefinitions.value=i,this.emitChanged()},this._setMatchingPipelineDefinitions=e=>{let t=this._state.allPipelineDefinitions.value;const i=[];for(const t of e.values())this._state.allPipelineDefinitionIds.has(t.id)||(i.push(this._buildDefinitionReferenceToListItem(t)),this._state.allPipelineDefinitionIds.add(t.id));t=i.concat(t),this._state.allPipelineDefinitions.value=t,this.emitChanged()},this._initializeAuthorizedPipelineDefinitions=e=>{this._state.authorizedPipelineDefinitions=e,this._state.errorMessage="",this._clearDeletedPipelines(),this.emitChanged()},this._setErrorMessage=e=>{this._state.errorMessage=e,this.emitChanged()},this._setLoading=e=>{e&&this._setCollapseOnBlur(),this._state.loading=e;let t=this._state.allPipelineDefinitions.value,i=t.findIndex((e=>e.id===this._loaderId));e?-1===i&&null!=this._state.continuationToken&&t.push(this._getLoadingListBoxItem()):-1!==i&&(t.splice(i,1),null!=this._state.continuationToken&&t.push(this._getLoadingListBoxItem())),this._state.allPipelineDefinitions.value=t,this.emitChanged()},this._setSearching=e=>{this._state.isSearching=e;let t=this._state.allPipelineDefinitions.value,i=t.findIndex((e=>e.id===this._loaderId));e?(-1!==i&&t.splice(i,1),i=t.findIndex((e=>e.id===this._searchingLoaderId)),-1===i&&t.unshift(this._getLoadingListBoxItem(!0))):(i=t.findIndex((e=>e.id===this._searchingLoaderId)),t.splice(i,1)),this._state.allPipelineDefinitions.value=t,this.emitChanged()},this._setCollapseOnBlur=()=>{this._state.preventCollapseOnBlur=!0,this.emitChanged(),setTimeout((()=>{this._state.preventCollapseOnBlur=!1,this.emitChanged()}),100)},this._searchingLoaderId="search-loader",this._loaderId="scroll-loader",this._loadBuildDefinitionsCallback=i,this._newPipelinesPermissionDropdownEnabled=(0,C.isFeatureFlagEnabled)(e.pageContext,"DistributedTask.NewPipelinesPermissionDropdown",!1),this._state=n.getDefaultState(this._newPipelinesPermissionDropdownEnabled),this._actions=t,this._actions.toggleAllPipelinesRestriction.addListener(this._toggleAllPipelinesRestriction),this._actions.initializeAuthorizedDefinitions.addListener(this._initializeAuthorizedDefinitions),this._actions.initializeAllPipelineDefinitions.addListener(this._initializeAllPipelineDefinitions),this._actions.initializeAuthorizedPipelineDefinitions.addListener(this._initializeAuthorizedPipelineDefinitions),this._actions.loadPipelineDefinitions.addListener(this._setPipelineDefinitions),this._actions.loadMatchingPipelineDefinitions.addListener(this._setMatchingPipelineDefinitions),this._actions.setErrorMessage.addListener(this._setErrorMessage),this._actions.setLoading.addListener(this._setLoading),this._actions.setSearching.addListener(this._setSearching)}dispose(){this._actions.toggleAllPipelinesRestriction.removeListener(this._toggleAllPipelinesRestriction),this._actions.initializeAuthorizedDefinitions.removeListener(this._initializeAuthorizedDefinitions),this._actions.initializeAllPipelineDefinitions.removeListener(this._initializeAllPipelineDefinitions),this._actions.initializeAuthorizedPipelineDefinitions.removeListener(this._initializeAuthorizedPipelineDefinitions),this._actions.loadPipelineDefinitions.removeListener(this._setPipelineDefinitions),this._actions.loadMatchingPipelineDefinitions.removeListener(this._setMatchingPipelineDefinitions),this._actions.setSearching.removeListener(this._setLoading),this._actions.setSearching.removeListener(this._setSearching),this._actions.setErrorMessage.removeListener(this._setErrorMessage)}getState(){return this._state}static getDefaultState(e){return{authorizedDefinitions:null,authorizedPipelineDefinitions:[],allPipelineDefinitions:e?new A.ObservableArray:[],allPipelineDefinitionIds:new Set,authorizedPipelinesDictionary:{},errorMessage:"",loading:!1,isSearching:!1}}_clearDeletedPipelines(){this._state.authorizedDefinitions&&this._state.authorizedDefinitions.pipelines&&(this._state.authorizedDefinitions.pipelines=this._state.authorizedDefinitions.pipelines.filter((e=>this._state.authorizedPipelineDefinitions.find((t=>t.id===e.id)))))}_getLoadingListBoxItem(e=!1){return{id:e?this._searchingLoaderId:this._loaderId,disabled:!0,type:4,render:(t,s,n,o)=>i.createElement(P.LoadingCell,{key:o.id,columnIndex:s,tableColumn:n,tableItem:o,onMount:e?null:()=>{!this._state.loading&&this._loadBuildDefinitionsCallback&&this._loadBuildDefinitionsCallback()}})}}_buildDefinitionReferenceToListItem(e){const t="\\"!==e.path,n=this._stripPipelinePathLeadingBackSlash(e.path);return{id:e.id.toString(),iconProps:{iconName:"Rocket",className:"pipelinespermission-dropdown-item-icon"},text:e.name,data:e,type:1,render:(e,o,r,a)=>i.createElement(d.SimpleTableCell,{className:(0,s.css)(r.className,a.className,"flex-center"),columnIndex:o,key:a.id,role:"presentation",tableColumn:r},i.createElement("div",{className:"bolt-list-box-cell-container"},a&&i.createElement("span",{className:(0,s.css)("pipelines-permission-dropdown-pipeline-content","bolt-list-cell-text","bolt-list-cell-child")},i.createElement(p.Icon,Object.assign({},a.iconProps,{className:a.iconProps.className})),i.createElement("span",{className:"flex-column full-width"},i.createElement("span",{className:(0,s.css)("pipelines-permission-dropdown-text","body-m","text-ellipsis",t&&"margin-bottom-4")},i.createElement(m.Tooltip,{overflowOnly:!0,text:a.text},i.createElement("span",null,a.text))),t&&i.createElement(m.Tooltip,{overflowOnly:!0,text:n},i.createElement("span",{className:"pipelines-permission-dropdown-text text-ellipsis body-xs secondary-text"},i.createElement(p.Icon,{iconName:"Folder",className:"icon-margin v-align-middle"}),i.createElement("span",null,n)))))))}}_stripPipelinePathLeadingBackSlash(e){return e&&"\\"===e.charAt(0)?e.substring(1):e}}t[e].PipelinesAuthorizationStore=n}("PipelinePermissionsAuthorizationStoresPipelinesAuthorizationStore"),function(e){t[e]={};class i extends S.RestClientBase{constructor(e){super(e)}async getDefinitions(e,t,i,s,n,o,r,a,l,c,d,h,p,m,u,g,_){const P={name:t,repositoryId:i,repositoryType:s,queryOrder:n,$top:o,continuationToken:r,minMetricsTime:a,definitionIds:l&&l.join(","),path:c,builtAfter:d,notBuiltAfter:h,includeAllProperties:p,includeLatestBuilds:m,taskIdFilter:u,processType:g,yamlFilename:_};return this.beginRequest({apiVersion:"5.0-preview.7",routeTemplate:"{project}/_apis/build/definitions/{definitionId}",routeValues:{project:e},queryParams:P,returnRawResponse:!0}).then((async e=>{const t=await e.text().then(R.deserializeVssJsonObject);return t.continuationToken=e.headers.get("x-ms-continuationtoken"),t}))}}t[e].BuildClientName="dt-security.build.client.IBuildRestClient",t[e].getBuildClient=function(i,s){return i.getRestClient(t[e].BuildClientName,s)},f.RestClients.add(t[e].BuildClientName,{factory:i,options:{resourceAreaId:"965220d5-5bb9-42cf-8d67-9b146df2a5a4",serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}})}("PipelinePermissionsAuthorizationSourceBuildRestClientBuild"),function(e){J=t[e]={};t[e].PipelinesAuthorizationSource=class{constructor(e){this._pageContext=e,this._authorizationClient=this._pageContext.getRestClient("dt.pipeline.authorization.client.IPipelinePermissionsRestClient"),this._buildRestClient=this._pageContext.getRestClient("dt-security.build.client.IBuildRestClient");const t=(0,D.getTFSPageData)(this._pageContext);t&&t.project&&(this._projectId=t.project.id)}getPipelinePermissionsForResource(e,t){return this._authorizationClient.getPipelinePermissionsForResource(this._projectId,e,t)}updatePipelinePermisionsForResource(e,t,i){return this._authorizationClient.updatePipelinePermisionsForResource(i,this._projectId,e,t)}async getAllBuildDefinitions(){return this._buildRestClient.getDefinitions(this._projectId,null,null,null,null,null,null,null,null,null,null,null,null,null,null,F.YAMLProcessType)}async getBuildDefinitions(e,t,i){return this._buildRestClient.getDefinitions(this._projectId,t,null,null,2,i,e,null,null,null,null,null,null,null,null,F.YAMLProcessType)}getAuthorizedBuildDefinitions(e){return this._buildRestClient.getDefinitions(this._projectId,null,null,null,null,null,null,null,e)}}}("PipelinePermissionsAuthorizationSourcePipelinesAuthorizationSource"),function(e){$=t[e]={};t[e].PipelinesAuthorizationActionsCreator=class{constructor(e,t,i){this._matchingBuildDefinitionMaxCount=50,this._actions=t,this._source=i,this._newPipelinesPermissionDropdownEnabled=(0,C.isFeatureFlagEnabled)(e.pageContext,"DistributedTask.NewPipelinesPermissionDropdown",!1)}static getKey(){return"pipelines-security-actions-creator"}initializeAuthorizedDefinitions(e,t){this._source.getPipelinePermissionsForResource(e,t).then((e=>{this._actions.initializeAuthorizedDefinitions.invoke(e),this._loadAuthorizedBuildDefinitions(e)})).catch((e=>{this.setErrorMessage(e.message)})),this._newPipelinesPermissionDropdownEnabled?this._source.getBuildDefinitions(null,null).then((e=>{this._actions.loadPipelineDefinitions.invoke(e)})):this._source.getAllBuildDefinitions().then((e=>{this._actions.initializeAllPipelineDefinitions.invoke(e)}))}updatePipelinePermisionsForResource(e,t,i){i.resource.id=void 0,i.resource.type=void 0,i.allPipelines=void 0,this._source.updatePipelinePermisionsForResource(e,t,i).then((e=>{this._actions.initializeAuthorizedDefinitions.invoke(e),this._loadAuthorizedBuildDefinitions(e)})).catch((i=>{this.setErrorMessage(i.message),this._source.getPipelinePermissionsForResource(e,t).then((e=>{this._actions.initializeAuthorizedDefinitions.invoke(e),this.setErrorMessage(i.message)}))}))}toggleAllPipelinesRestriction(e,t,i){this._source.updatePipelinePermisionsForResource(e,t,i).then((e=>{this._actions.toggleAllPipelinesRestriction.invoke(e)})).catch((e=>{this.setErrorMessage(e.message)}))}loadMoreBuildDefinitions(e){this._setLoading(!0),this._source.getBuildDefinitions(e,null).then((e=>{this._actions.loadPipelineDefinitions.invoke(e),this._setLoading(!1)}))}loadMatchingBuildDefinitions(e){this._source.getBuildDefinitions(void 0,e,this._matchingBuildDefinitionMaxCount).then((e=>{this._actions.loadMatchingPipelineDefinitions.invoke(e),this.setSearching(!1)}))}addBackScrollLoader(){this._setLoading(!0),this._setLoading(!1)}setSearching(e){this._actions.setSearching.invoke(e)}_setLoading(e){this._actions.setLoading.invoke(e)}_loadAuthorizedBuildDefinitions(e){if(this._newPipelinesPermissionDropdownEnabled?e.pipelines&&e.pipelines.length>0:e.pipelines){let t=e.pipelines.map((e=>e.id));this._source.getAuthorizedBuildDefinitions(t).then((e=>{this._actions.initializeAuthorizedPipelineDefinitions.invoke(e)}))}}setErrorMessage(e){this._actions.setErrorMessage.invoke(e)}}}("PipelinePermissionsAuthorizationActionsPipelinesAuthorizationActionsCreator"),function(e){t[e]={};class o extends s.VssComponent{constructor(e,t){super(e,t),this._pipelinesAuthorizationComponentFeature="PipelinesAuthorizationComponent",this._pipelinesAuthorizationComponentScenario="PipelinesAuthorizationComponent.Loaded",this._loggedPerfEvent=!1,this._debounceMs=300,this._onStoreChanged=()=>{let e=this._store.getState();e.authorizedPipelineDefinitions&&e.authorizedPipelineDefinitions.length>0&&(this._permissionsProvider=new h.ArrayItemProvider(e.authorizedPipelineDefinitions)),this.setState(e)},this._getTableColumns=()=>[{id:"name",width:-80,name:V.PipelineColumnHeading,className:"pipeline-name-cell",renderCell:this._renderNameCell,columnStyle:2},{id:"menu",width:-20,className:"menu-item-cell",renderCell:this._renderMenuItemCell}],this._renderNameCell=(e,t,s,n)=>i.createElement(d.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(p.Icon,{className:"pipeline-image",iconName:"Rocket","aria-hidden":"true"}),i.createElement("span",null,i.createElement(m.Tooltip,{overflowOnly:!0,text:n.name},i.createElement("span",{className:"pipeline-name text-ellipsis"},n.name)),i.createElement("span",{className:"pipeline-type secondary-text body-s"},V.PipelineString))),this._renderMenuItemCell=(e,t,s,o)=>i.createElement(d.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(n.Button,{tooltipProps:{text:V.RevokeAccessTooltip},primary:!1,className:"bolt-table-cell-content-reveal pipeline-removal-button",subtle:!0,iconProps:{iconName:"Cancel"},ariaLabel:V.Removepermission,onClick:e=>{this._unAuthorizePipeline(o)}})),this._authorizePipeline=e=>{let t,i=this.state.authorizedDefinitions;t=this._newPipelinesPermissionDropdownEnabled?{authorized:!0,authorizedBy:null,authorizedOn:null,id:e.id}:{authorized:!0,authorizedBy:null,authorizedOn:null,id:e.selectedItems[0].id},i.pipelines?i.pipelines.push(t):i.pipelines=[t],this._pipelinesAuthorizationActionsCreator.updatePipelinePermisionsForResource(this.props.resourceType,this.props.resourceId,i),this._publishTelemetry(F.FeatureNames.AddPipeline)},this._toggleRestrictAllPipelinesFlag=e=>{let t=Object.assign({},this.state.authorizedDefinitions);t.allPipelines={authorized:!e,authorizedBy:null,authorizedOn:null},this._pipelinesAuthorizationActionsCreator.toggleAllPipelinesRestriction(this.props.resourceType,this.props.resourceId,t),this._showOpenAccessDialog.value=!1,this._expandToggleRestrictionPanel.value=!1,e?this._publishTelemetry(F.FeatureNames.RestrictAccess):this._publishTelemetry(F.FeatureNames.OpenAccess)},this._loadMoreBuildDefinitions=()=>{let e=this._store.getState().continuationToken;null!==e&&(this._pipelinesAuthorizationActionsCreator.loadMoreBuildDefinitions(e),this._publishTelemetry(F.FeatureNames.LoadMorePipelines))},this._onFilterTextChanged=(e,t)=>{if(null===e||null===t||0===t.length)return void this._pipelinesAuthorizationActionsCreator.addBackScrollLoader();null!==this._store.getState().continuationToken&&(this._pipelinesAuthorizationActionsCreator.setSearching(!0),this._throttledSearch(t))},this._menuButtonRef=i.createRef(),this._timerManagement=new j.TimerManagement,this._newPipelinesPermissionDropdownEnabled=(0,C.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.NewPipelinesPermissionDropdown",!1),this._performanceService=t.pageContext.getService("IVssPerformanceService"),this._performanceService.startScenario(this._pipelinesAuthorizationComponentScenario,!0),this._actionsHub=new q.PipelinesAuthorizationActionsHub,this._pipelinesAuthorizationSource=new J.PipelinesAuthorizationSource(this.context.pageContext),this._pipelinesAuthorizationActionsCreator=new $.PipelinesAuthorizationActionsCreator(this.context,this._actionsHub,this._pipelinesAuthorizationSource),this._pipelinesAuthorizationActionsCreator.initializeAuthorizedDefinitions(this.props.resourceType,this.props.resourceId),this._store=new K.PipelinesAuthorizationStore(this.context,this._actionsHub,this._newPipelinesPermissionDropdownEnabled?this._loadMoreBuildDefinitions:void 0),this.state=this._store.getState(),this._permissionsProvider=new h.ArrayItemProvider([]),this._expandToggleRestrictionPanel=new A.ObservableValue(!1),this._showOpenAccessDialog=new A.ObservableValue(!1);const s=(0,D.getTFSPageData)(this.context.pageContext);s&&s.project&&(this._projectId=s.project.id),this._timerManagement=new j.TimerManagement,this._throttledSearch=this._timerManagement.debounce((e=>{this._pipelinesAuthorizationActionsCreator.loadMatchingBuildDefinitions(e),this._publishTelemetry(F.FeatureNames.SearchMatchingPipelines)}),this._debounceMs)}componentDidMount(){this._store.addChangedListener(this._onStoreChanged)}componentDidUpdate(e,t){this.state===t||this._loggedPerfEvent||(this._performanceService.endScenario(this._pipelinesAuthorizationComponentFeature,this._pipelinesAuthorizationComponentScenario,!0),this._loggedPerfEvent=!0)}componentWillUnmount(){this._store.removeChangedListener(this._onStoreChanged),this._store.dispose(),this._timerManagement.dispose()}render(){return this.state.authorizedDefinitions&&!this.state.authorizedDefinitions.allPipelines?this._restrictionsView():this._noRestrictionsView()}_restrictionsView(){let e;e=this._newPipelinesPermissionDropdownEnabled?this.state.allPipelineDefinitions.value.filter((e=>!this.state.authorizedPipelinesDictionary[e.id])):this.state.allPipelineDefinitions.filter((e=>!this.state.authorizedPipelinesDictionary[e.id]));let t=this.state.authorizedDefinitions.pipelines&&this.state.authorizedDefinitions.pipelines.length>0?V.PipelinePermissionsDescription:"";return i.createElement("div",{className:this.props.className+" flex bolt-card flex-column"},this.state.errorMessage&&this._getErrorCardComponent(),i.createElement(b.Card,{className:"pipelines-permissions-card bolt-card-no-vertical-padding flex-column",contentProps:{contentPadding:!1,className:"pipelines-permissions-card-content"}},i.createElement("h2",{className:"pipelines-permissions-card-header"},V.PipelinePermissionsTitle),i.createElement("div",{className:"pipelines-permissions-card-header-button-group"},this._newPipelinesPermissionDropdownEnabled?i.createElement(G.PipelinesAuthorizationDropdown,{items:e,canEditPipelinePermission:this.props.canEditPipelinePermission,onSelectionChanged:this._authorizePipeline,onFilterTextChanged:this._onFilterTextChanged,onBlur:this.state.preventCollapseOnBlur,searching:this._store.getState().isSearching}):i.createElement(H.PipelinesListComponent,{items:e,canEditPipelinePermission:this.props.canEditPipelinePermission,onSelectionChanged:this._authorizePipeline}),this._getRestrictionsViewMenuButton()),i.createElement("div",{className:"pipeline-permissions-card-description secondary-text"},t),this.state.authorizedDefinitions.pipelines&&this.state.authorizedDefinitions.pipelines.length>0&&this._getPermissionsTableView(),(!this.state.authorizedDefinitions.pipelines||this.state.authorizedDefinitions.pipelines.length<=0)&&this._getNoAuthorizedPipelinesView()),this._getToggleRestrictionDialog())}_noRestrictionsView(){return i.createElement("div",{className:this.props.className+" flex bolt-card flex-column"},this.state.errorMessage&&this._getErrorCardComponent(),i.createElement(b.Card,{className:"pipelines-no-restrictions-permissions-card no-restrictions-card bolt-card-no-vertical-padding flex-column",contentProps:{contentPadding:!1,className:"pipelines-no-restrictions-permissions-card-content"}},i.createElement("h2",{className:"pipelines-no-restrictions-permissions-card-header"},V.PipelinePermissionsTitle),!0!==this.props.hideRestrictPermissionButton&&i.createElement(n.Button,{className:"pipelines-no-restrictions-permissions-card-header-button",id:"restrict-pipeline-permission",text:V.RestrictAccessButtonText,disabled:!this.props.canRestrictAccess,onClick:()=>{this.state.authorizedDefinitions.pipelines&&this.state.authorizedDefinitions.pipelines.length>0?this._expandToggleRestrictionPanel.value=!0:this._toggleRestrictAllPipelinesFlag(!0)}}),i.createElement("div",{className:"no-restrictions-view justify-center"},i.createElement(p.Icon,{iconName:"Unlock",className:"no-restrictions-icon","aria-hidden":"true"}),i.createElement("div",{className:"message-container"},i.createElement("span",{className:"message-header title-s"},V.NoRestrictionsCardTitle),i.createElement("span",null,V.NoRestrictionsCardContent,i.createElement("br",null)," ",i.createElement(z.Link,{ariaLabel:V.LearnMoreDescriptionForPipelinePermissions,href:this.props.noRestrictionsViewLearnMoreLink},V.LearnMoreText))))),this._getToggleRestrictionConfirmationPanel())}_getToggleRestrictionDialog(){return i.createElement(I.Observer,{isDialogOpen:this._showOpenAccessDialog},(e=>e.isDialogOpen?i.createElement(Y.AuthorizeAllPipelinesConfirmationDialog,{onDismiss:()=>{this._showOpenAccessDialog.value=!1,this._menuButtonRef.current&&this._menuButtonRef.current.focus()},primaryOnClick:this._toggleRestrictAllPipelinesFlag}):null))}_getToggleRestrictionConfirmationPanel(){return i.createElement(I.Observer,{isPanelOpen:this._expandToggleRestrictionPanel},(e=>e.isPanelOpen?i.createElement(W.RestrictAllPipelinesConfirmationPanel,{pipelineDefinitions:this.state.authorizedPipelineDefinitions,primaryOnClick:this._toggleRestrictAllPipelinesFlag,onDismiss:()=>{this._expandToggleRestrictionPanel.value=!1}}):null))}_getRestrictionsViewMenuButton(){return i.createElement(E.MenuButton,{className:"bolt-header-command-item-button fontSizeML pipelines-permissions-card-header-menu-button",disabled:!this.props.canOpenAccess,contextualMenuProps:{menuProps:{id:"open-resource-menu",items:[{id:"open-resource-menu-item",iconProps:{iconName:"Unlock"},text:V.OpenAccessMenuItem,onActivate:()=>{this._showOpenAccessDialog.value=!0}}]}},hideDropdownIcon:!0,iconProps:{iconName:"MoreVertical"},subtle:!0,ariaLabel:this.props.canOpenAccess?V.ViewOptionsTooltip:V.NotAuthorizedOpenAccess,ref:this._menuButtonRef})}_getNoAuthorizedPipelinesView(){let e=this.props.customNoAuthorizedPipelinesCardContent,t=V.NoAuthorizedPipelinesCardContent,s=e||t;return N.announce(V.NoAuthorizedPipelinesCardTitle),i.createElement("div",{className:"no-restrictions-view justify-center"},i.createElement(p.Icon,{iconName:"Lock",className:"no-restrictions-icon","aria-hidden":"true"}),i.createElement("div",{className:"message-container"},i.createElement("span",{className:"message-header title-s"},V.NoAuthorizedPipelinesCardTitle),i.createElement("span",null,s," ",i.createElement("br",null)," ",V.NoAuthorizedPipelinesCardDesignerPipelinesContent," ",i.createElement("br",null)," ",i.createElement(z.Link,{ariaLabel:V.LearnMoreDescriptionForPipelinePermissions,href:this.props.noAuthorizedPipelinesViewLearnMoreLink},V.LearnMoreText))))}_getPermissionsTableView(){return i.createElement(d.Table,{ariaLabel:V.PipelinePermissionsTableName,columns:this._getTableColumns(),itemProvider:this._permissionsProvider,scrollable:!0})}_unAuthorizePipeline(e){let t=this.state.authorizedDefinitions;t.pipelines.forEach((t=>{e.id===t.id&&(t.authorized=!1)})),this._pipelinesAuthorizationActionsCreator.updatePipelinePermisionsForResource(this.props.resourceType,this.props.resourceId,t),this._publishTelemetry(F.FeatureNames.RemovePipeline)}_getErrorCardComponent(){return i.createElement(y.MessageCard,{className:"error-message-card",onDismiss:()=>{this._pipelinesAuthorizationActionsCreator.setErrorMessage("")},severity:"Error"},this.state.errorMessage)}_publishTelemetry(e){const t=this.context.pageContext.getService("IVssTelemetryService"),i={ProjectAndResourceIdentifier:(0,v.format)("{0}:{1}:{2}",this._projectId,this.props.resourceType,this.props.resourceId)};t.publishEvent(F.Area,e,i)}}t[e].PipelinesAuthorizationComponent=o,s.VssComponent.register("pipelines-authorization-component",o)}("PipelinePermissionsAuthorizationComponentsPipelinesAuthorizationComponent"),function(e){Q=t[e]={};t[e].ProjectAuthorizationActionsHub=class{constructor(){this.inititlaize()}inititlaize(){this._serviceEndPoint=new g.Action,this._allProjects=new g.Action,this._setErrorMessage=new g.Action}get getServiceEndpointDetails(){return this._serviceEndPoint}get getProjectsData(){return this._allProjects}get setErrorMessage(){return this._setErrorMessage}}}("ProjectPermissionsAuthorizationActionsProjectAuthorizationActionsHub"),function(e){X=t[e]={};t[e].ProjectAuthorizationSource=class{constructor(e,t){this._restClient=e.getRestClient("ICoreRestClient"),this._serviceEndpointRestClient=e.getRestClient("ServiceEndpoint.IServiceEndpointRestClient"),this._projectId=t}getProjectsData(){return this._restClient.getProjects(1,null,null,null,!0)}getServiceEndpointDetails(e){return this._serviceEndpointRestClient.getServiceEndpointDetails(this._projectId,e,32)}deleteProjectReference(e,t){return this._serviceEndpointRestClient.deleteServiceEndpoint(e.id,t)}addProjectReference(e,t){return this._serviceEndpointRestClient.shareServiceEndpoint(t,e.id)}}}("ProjectPermissionsAuthorizationSourceProjectAuthorizationSource"),function(e){Z=t[e]={};t[e].ProjectAuthorizationActionsCreator=class{constructor(e,t,i,s){this._actionsHub=e,this._source=i,this._endpointId=t,this._updateServiceEndpointSharedFlag=s}initialize(){this._source.getProjectsData().then((e=>{this._actionsHub.getProjectsData.invoke(e)})),this._source.getServiceEndpointDetails(this._endpointId).then((e=>{this._actionsHub.getServiceEndpointDetails.invoke(e)}))}deleteProjectReference(e,t,i){let s=this.getProjectNameFromProjectNames(i);this._source.deleteProjectReference(e,t).then((()=>{this._source.getServiceEndpointDetails(this._endpointId).then((e=>{this._actionsHub.getServiceEndpointDetails.invoke(e),this._updateServiceEndpointSharedFlag(e),N.announce((0,v.localeFormat)(V.ProjectPermissionsProjectDeletedText,s))}))}),(e=>{this.setErrorMessage(e.message)}))}addProjectReference(e,t){let i=this.getProjectNameFromProjectReferences(t);this._source.addProjectReference(e,t).then((()=>{this._source.getServiceEndpointDetails(this._endpointId).then((e=>{this._actionsHub.getServiceEndpointDetails.invoke(e),this._updateServiceEndpointSharedFlag(e),N.announce((0,v.localeFormat)(V.ProjectPermissionsProjectSharedText,i))}))}),(e=>{this.setErrorMessage(e.message)}))}getProjectNameFromProjectNames(e){let t="";return e.forEach((e=>{t=t.concat(e+" ")})),t}getProjectNameFromProjectReferences(e){let t="";return e.map((e=>{t=t.concat(e.projectReference.name+" ")})),t}setErrorMessage(e){this._actionsHub.setErrorMessage.invoke(e)}}}("ProjectPermissionsAuthorizationActionsProjectAuthorizationActionsCreator"),function(e){ee=t[e]={};class i extends _.Store{constructor(e,t,i,s){super("ProjectAuthorizationStore"),this.getProjectsData=e=>{let t;e.map((e=>{t={projectImageIconUrl:e.defaultTeamImageUrl,projectName:e.name,projectId:e.id,serviceEndpointLink:this._onInlineLink(e.name)},this._defaultProjectImageIconUrl=e.defaultTeamImageUrl,this._projectDataDictionary[e.id]=t,this._projectList.push({projectImageIconUrl:e.defaultTeamImageUrl,projectName:e.name,projectId:e.id})}))},this.getServiceEndpointDetails=e=>{this._state.projectReferences=this._getProjectReferences(e),this._state.allProjects=this._getUpdatedProjectList(e),this._state.endpoint=e,this.emitChanged()},this.setErrorMessage=e=>{this._state.error=e,this.emitChanged()},this._getProjectReferences=e=>{let t=[];return e.serviceEndpointProjectReferences&&(e.serviceEndpointProjectReferences.map((e=>{e.projectReference.id!==this._projectId&&(this._projectDataDictionary[e.projectReference.id]?t.push(this._projectDataDictionary[e.projectReference.id]):t.push({projectImageIconUrl:this._defaultProjectImageIconUrl,projectName:e.projectReference.name,projectId:e.projectReference.id,serviceEndpointLink:this._onInlineLink(e.projectReference.name)}))})),t.sort(((e,t)=>e.projectName>t.projectName?1:-1))),t},this._onInlineLink=e=>{let t={project:e,resourceId:this._endpointId};return(0,w.routeUrl)(this._context.pageContext,"ms.vss-distributedtask-web.project-service-endpoint-route",t)},this._projectDataDictionary={},this._state={projectReferences:[],allProjects:[],endpoint:t,operation:"",error:""},this._actions=e,this._endpointId=t.id,this._context=i,this._projectId=s,this._projectList=[],this.initialize()}initialize(){this._actions.getProjectsData.addListener(this.getProjectsData),this._actions.getServiceEndpointDetails.addListener(this.getServiceEndpointDetails),this._actions.setErrorMessage.addListener(this.setErrorMessage)}dispose(){this._actions.getProjectsData.removeListener(this.getProjectsData),this._actions.getServiceEndpointDetails.removeListener(this.getServiceEndpointDetails),this._actions.setErrorMessage.removeListener(this.setErrorMessage)}getState(){return this._state}_getUpdatedProjectList(e){let t=this._projectList,i=!1;return e.serviceEndpointProjectReferences&&e.serviceEndpointProjectReferences.length>0&&e.serviceEndpointProjectReferences.map((e=>{i=t.some((t=>t.projectId===e.projectReference.id)),i&&(t=t.filter((t=>t.projectId!==e.projectReference.id)))})),t.sort(((e,t)=>e.projectName>t.projectName?1:-1)),t}}t[e].ProjectAuthorizationStore=i}("ProjectPermissionsAuthorizationStoreProjectAuthorizationStore"),function(e){te=t[e]={};class a extends s.VssComponent{constructor(e){super(e),this._renderProjectList=(e,t,s,n,a,l,c)=>i.createElement(o.Callout,{className:"project-permissions-add-dropdown-callout depth-8",anchorElement:s,anchorOffset:n,anchorOrigin:a,anchorPoint:l,calloutOrigin:c,onDismiss:e.collapse,escDismiss:!0,blurDismiss:!0,lightDismiss:!0},i.createElement(r.PickList,{className:"project-permissions-dropdown",width:256,maxHeight:360,getListItem:this.getPickListItem,ref:e=>{e&&e.focus()},items:this.props.item,isSearchable:!0,onSelectionChanged:t=>{this.onValueChanged(t),e.collapse()},onFocusLost:()=>{e.collapse()},minItemsForSearchBox:0,searchBoxAriaLabel:"Search projects"})),this.onValueChanged=e=>{let t=this.props.endpoint,i=v.format("{0}-{1}",t.name,e.selectedItems[0].projectName),s=!1;t.serviceEndpointProjectReferences.forEach((t=>{t.projectReference.id===e.selectedItems[0].projectId&&(s=!0)})),null!=t.serviceEndpointProjectReferences&&1===t.serviceEndpointProjectReferences.length&&(this._showDialog.value=!0),s||(this.setState({operation:"deletion_event"}),t.serviceEndpointProjectReferences=[],t.serviceEndpointProjectReferences.push({description:t.description,name:i,projectReference:{id:e.selectedItems[0].projectId,name:e.selectedItems[0].projectName}}),this.props.actionsCreator.addProjectReference(this.props.endpoint,t.serviceEndpointProjectReferences))},this.getDialog=()=>i.createElement(I.Observer,{isDialogOpen:this._showDialog},(e=>e.isDialogOpen?i.createElement(u.Dialog,{titleProps:{text:V.AddProjectInfoDialogTitle,size:1},onDismiss:()=>{this._showDialog.value=!1},footerButtonProps:[{text:V.AddProjectInfoDialogButtonText,primary:!0,onClick:()=>{this._showDialog.value=!1}}]},i.createElement("div",null,V.AddProjectInfoDialogText," ",i.createElement(z.Link,{target:"_blank",href:V.AddProjectInfoDialogLink},V.AddProjectInfoDialogClickHere))):null)),this.getPickListItem=e=>({name:e.projectName,key:e.projectId.toString(),iconProps:{iconType:3,imageProps:{src:e.projectImageIconUrl,style:{width:"20px",height:"20px"}}}}),this._showDialog=new A.ObservableValue(!1)}render(){return i.createElement("div",null,i.createElement(n.ExpandableButton,{id:"add-project-permission",disabled:!this.props.canShareProjects,renderCallout:this._renderProjectList,iconProps:{iconName:"Add"},hideDropdownIcon:!0,ariaLabel:V.AuthorizeProjectTooltip}),this._showDialog&&this.getDialog())}}t[e].ProjectListComponent=a}("ProjectPermissionsAuthorizationComponentsProjectListComponent"),function(e){t[e]={};class o extends s.VssComponent{constructor(e,t){super(e,t),this._onStoreChange=()=>{let e=this._store.getState();this.setState(e)},this._tableColumns=[{id:"project",width:-80,name:V.ProjectButtonText,className:"project-button-cell",renderCell:this._renderProjectCellContent.bind(this)},{id:"removeButton",width:-20,className:"cross-button-cell",renderCell:this._renderRemoveCellContent.bind(this)}];const i=(0,D.getTFSPageData)(t.pageContext);let s="";i&&i.project&&(s=i.project.id),this._actions=new Q.ProjectAuthorizationActionsHub,this._source=new X.ProjectAuthorizationSource(t.pageContext,s),this._actionsCreator=new Z.ProjectAuthorizationActionsCreator(this._actions,this.props.endpoint.id,this._source,this.props.updateServiceEndpointSharedFlag),this._actionsCreator.initialize(),this._store=new ee.ProjectAuthorizationStore(this._actions,this.props.endpoint,t,s),this.state=this._store.getState()}componentWillUnmount(){this._store.removeChangedListener(this._onStoreChange),this._store.dispose()}componentDidMount(){this._store.addChangedListener(this._onStoreChange)}render(){let e={item:this.state.allProjects,endpoint:this.state.endpoint,actionsCreator:this._actionsCreator,canShareProjects:this.props.canShareProjects};return i.createElement("div",{className:this.props.className+" flex flex-column"},this.state.error&&this._getErrorCardComponent(),i.createElement(b.Card,{className:"bolt-card-no-vertical-padding flex-column project-permissions-card",contentProps:{contentPadding:!1,className:"project-permissions-card-content"}},i.createElement("h2",{className:"project-permissions-card-header"},V.ProjectPermissionsTitle),i.createElement("div",{className:"project-permissions-card-header-button-group"},i.createElement(te.ProjectListComponent,Object.assign({},e))),i.createElement("div",{className:"project-permissions-card-description secondary-text"},V.ProjectPermissionsDescription),i.createElement("div",{className:"grid-container"},this.state.projectReferences&&this.state.projectReferences.length>0?this._getProjectPermissionsTable():this._getNoProjectPermissionsView())))}_getProjectPermissionsTable(){let e=new h.ArrayItemProvider(this.state.projectReferences);return i.createElement(d.Table,{ariaLabel:V.ProjectPermissionsTableName,className:"roles-grid",scrollable:!0,columns:this._tableColumns,itemProvider:e,pageSize:20,role:"presentation"})}_getNoProjectPermissionsView(){return N.announce(V.NoProjectPermissionsCardTitle),i.createElement("div",{className:"no-project-permissions-view justify-center"},i.createElement(p.Icon,{iconName:"Info",className:"no-restrictions-icon",ariaLabel:""}),i.createElement("div",{className:"message-container"},i.createElement("span",{className:"message-header title-s"},V.NoProjectPermissionsCardTitle),i.createElement("span",null,V.NoProjectPermissionsCardContent,i.createElement("br",null)," ",i.createElement(z.Link,{ariaLabel:V.LearnMoreDescriptionForProjectPermissions,href:this.props.noProjectPermissionsViewLearnMoreLink},V.LearnMoreText))))}_getErrorCardComponent(){return N.announce(this.state.error),i.createElement("div",null,i.createElement(y.MessageCard,{className:"error-message-card",onDismiss:()=>{this._actionsCreator.setErrorMessage("")},severity:"Error"},this.state.error))}_renderProjectCellContent(e,t,s,n){let o;return this.state.endpoint.serviceEndpointProjectReferences.forEach((e=>{e.projectReference.id===n.projectId&&(o=e.name)})),i.createElement(d.TwoLineTableCell,{columnIndex:t,key:"col-"+t,tableColumn:s,iconProps:{render:e=>this.renderProjectImage(n)},line1:i.createElement(m.Tooltip,{overflowOnly:!0,text:n.projectName},i.createElement("span",{className:"body-m text-ellipsis"},n.projectName)),line2:i.createElement(m.Tooltip,{overflowOnly:!0,text:o},i.createElement("span",{className:"secondary-text body-s text-ellipsis"},i.createElement(x.FPSLink,{className:"service-endpoint-link definition-link bolt-table-link bolt-link",supportsFPS:!1,href:n.serviceEndpointLink},o)))})}_renderRemoveCellContent(e,t,s,o){return i.createElement(d.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(n.Button,{tooltipProps:{text:V.RevokeAccessTooltip},primary:!1,className:"bolt-table-cell-content-reveal project-removal-button",subtle:!0,iconProps:{iconName:"Cancel",className:"removal-icon"},ariaLabel:V.Removepermission,onClick:e=>{this._onRemove(o)}}))}_onRemove(e){let t=[e.projectId],i=[e.projectName];this._actionsCreator.deleteProjectReference(this.state.endpoint,t,i)}renderProjectImage(e){return i.createElement(T.Image,{alt:"project-pic",className:"project-pic",src:e.projectImageIconUrl})}}t[e].ProjectAuthorizationComponent=o}("ProjectPermissionsAuthorizationComponentsProjectAuthorizationComponent"),function(e){ie=t[e]={};t[e].RoleAssignmentComponentSecurityActionsHub=class{constructor(){this.initialize()}initialize(){this._addNewUser=new g.Action,this._initializeRoles=new g.Action,this._initializeRoleAssignments=new g.Action,this._removeUser=new g.Action,this._updateRoleAssignment=new g.Action,this._roleScope=new g.Action,this._setErrorMessage=new g.Action}get addNewUser(){return this._addNewUser}get initializeRoles(){return this._initializeRoles}get initializeRoleAssignments(){return this._initializeRoleAssignments}get removeUser(){return this._removeUser}get updateRoleAssignment(){return this._updateRoleAssignment}get updateRoleScope(){return this._roleScope}get setErrorMessage(){return this._setErrorMessage}}}("UserPermissionsAuthorizationActionsRoleAssignmentComponentSecurityActionsHub"),function(e){se=t[e]={};class i extends _.Store{constructor(e,t){super("RoleAssignmentComponentSecurityStore"),this._onInitializeRoles=e=>{this._state.roles=e,this.emitChanged()},this._onInitializeRoleAssignments=e=>{this._roleAssignmentsList=new s(e);let t=this.getGridSource().filter((e=>e.role.identity.id===this._storeProps.userId))[0];t&&(this._userRoleAssignment=t.role),"boolean"!=typeof this._storeProps.canEditProjectView&&(this._storeProps.canEditProjectView||this._storeProps.manageRolesPermission&&this._userRoleAssignment&&(this._userRoleAssignment.role.allowPermissions&this._storeProps.manageRolesPermission)!==this._storeProps.manageRolesPermission||(this._state.canEdit=!0)),this._state.roleAssignments=this.getGridSource(),this._state.inherit=e.filter((e=>2===e.access)).length>0,this._state.isDirty=this.getDirtyRows().length>0,this.emitChanged()},this._onAddNewUser=e=>{e.forEach(((e,t,i)=>{this._roleAssignmentsList.updateItem(e,!0);let s=this._findRowByUserId(e.identity.id);s&&(s.isDirty=!1)})),this._state.roleAssignments=this.getGridSource(),this._state.isDirty=this.getDirtyRows().length>0,this.emitChanged()},this._onRemoveUser=e=>{this._roleAssignmentsList.removeRoleAssignment(e),this._state.roleAssignments=this.getGridSource(),this._state.isDirty=this.getDirtyRows().length>0,this.emitChanged()},this._onUpdateRoleAssignment=e=>{this._roleAssignmentsList.updateItem(e),this._state.roleAssignments=this.getGridSource(),this._state.isDirty=this.getDirtyRows().length>0,this.emitChanged()},this._updateRoleScope=e=>{this._state.roleScope=e,this._state.roleAssignments=[],e===V.OrganizationButtonText?this._state.canEdit=this._storeProps.canEditOrganizationView:this._state.canEdit=this._storeProps.canEditProjectView,this.emitChanged()},this.setErrorMessage=e=>{this._state.error=e,this.emitChanged()};let i=!1,n="";"boolean"==typeof t.canEditProjectView&&(i=t.canEditProjectView),t.roleScope&&(n=t.roleScope),this._state={canEdit:i,inherit:!0,roles:[],roleAssignments:[],selectedRole:null,isDirty:!1,showAddIdentityPicker:!1,roleScope:n,error:""},this._actions=e,this._storeProps=t,this.initialize()}initialize(){this._actions.addNewUser.addListener(this._onAddNewUser),this._actions.initializeRoles.addListener(this._onInitializeRoles),this._actions.initializeRoleAssignments.addListener(this._onInitializeRoleAssignments),this._actions.removeUser.addListener(this._onRemoveUser),this._actions.updateRoleAssignment.addListener(this._onUpdateRoleAssignment),this._actions.updateRoleScope.addListener(this._updateRoleScope),this._actions.setErrorMessage.addListener(this.setErrorMessage)}getState(){return this._state}getGridSource(){let e=[],t=this._roleAssignmentsList.getCurrentRoles();for(let i=0;i<t.length;i++){let s=t[i],n=this._roleAssignmentsList.userIsRemoved(s.identity.id),o=n||this._roleAssignmentsList.itemIsDirty(s.identity.id),r=this._getAccessDisplayName(s.access);e.push({role:s,displayName:s.identity.displayName,access:r,accessValue:s.access,roleName:s.role.displayName,isDirty:o,isRemoved:n})}return e.sort(((e,t)=>v.localeIgnoreCaseComparer(e.displayName,t.displayName)))}getUserRoleAssignment(){return this._userRoleAssignment}userIsRemoved(e){return this._roleAssignmentsList.userIsRemoved(e)}getRemovedUserIds(){return this._roleAssignmentsList.getRemovedUserIds()}getDirtyRows(){let e=[],t=this._state.roleAssignments;for(let i=0;i<t.length;i++){let s=t[i];s.isDirty&&e.push(s)}return e}__dispose(){this._actions.addNewUser.removeListener(this._onAddNewUser),this._actions.initializeRoles.removeListener(this._onInitializeRoles),this._actions.initializeRoleAssignments.removeListener(this._onInitializeRoleAssignments),this._actions.removeUser.removeListener(this._onRemoveUser),this._actions.updateRoleAssignment.removeListener(this._onUpdateRoleAssignment),this._actions.updateRoleScope.removeListener(this._updateRoleScope)}_getAccessDisplayName(e){switch(e){case 1:return V.AccessAssigned;case 2:return V.AccessInherited;default:return""}}_findRowByUserId(e){let t=this._findRowIndexByUserId(e);return t>=0?this._state.roleAssignments[t]:null}_findRowIndexByUserId(e){let t=this._state.roleAssignments;for(let i=0;i<t.length;i++){if(t[i].role.identity.id===e)return i}return-1}}t[e].RoleAssignmentComponentSecurityStore=i;class s{constructor(e){this._initialRolesLookup=new Map,this._currentRolesLookup=new Map,this._initialRoles=e,this._currentRoles=e,this._removedUserIds=[],e.forEach((e=>{this._initialRolesLookup.set(e.identity.id,e),this._currentRolesLookup.set(e.identity.id,e)}))}itemIsDirty(e){return this._initialRolesLookup.get(e).role.name!==this._currentRolesLookup.get(e).role.name||this._removedUserIds.indexOf(e)>-1}updateItem(e,t){this._removedUserIds=this._removedUserIds.filter((t=>t!==e.identity.id));let i=e.identity.id;this._removeItem(i,t),this._currentRoles.push(e),this._currentRolesLookup.set(i,e),t&&(this._initialRoles.push(e),this._initialRolesLookup.set(i,e))}_removeItem(e,t){this._currentRolesLookup.get(e);this._currentRoles=this._currentRoles.filter((t=>t.identity.id!==e)),this._currentRolesLookup.delete(e),t&&(this._initialRoles=this._initialRoles.filter((t=>t.identity.id!==e)),this._initialRolesLookup.delete(e))}removeRoleAssignment(e){this._removedUserIds.push(e)}userIsRemoved(e){return this._removedUserIds.filter((t=>t===e)).length>0}getCurrentRoles(){return this._currentRoles}getInitialRoles(){return this._initialRoles}getRemovedUserIds(){return this._removedUserIds}}t[e].RoleAssignmentsList=s}("UserPermissionsAuthorizationStoreRoleAssignmentComponentSecurityStore"),function(e){ne=t[e]={};t[e].RoleAssignmentComponentSecuritySource=class{constructor(e,t){this.context=e,this.serviceInstanceId=t;let i={serviceInstanceType:t};this._rolesClient=this.context.pageContext.getRestClient("dt.vssf.security-roles.client.ISecurityRolesRestClient",i)}getRoleDefinitions(e){return this._rolesClient.getRoleDefinitions(e)}getRoleAssignments(e,t){return this._rolesClient.getRoleAssignments(e,t)}setRoleAssignments(e,t,i){return this._rolesClient.setRoleAssignments(e,t,i)}removeRoleAssignments(e,t,i){return this._rolesClient.removeRoleAssignments(e,t,i)}beginSave(e,t,i){return this._rolesClient.setRoleAssignments(e,t,i)}changeInheritance(e,t,i){return this._rolesClient.changeInheritance(e,t,i)}}}("UserPermissionsAuthorizationSourceRoleAssignmentComponentSecuritySource"),function(e){oe=t[e]={};class n extends s.VssComponent{constructor(e,t){super(e),this.options=[],this.selectedIdentity=new A.ObservableValue(void 0);let i=this.props.roles[0];if(this.props.defaultRole){let e=this.props.roles.filter((e=>e.name===this.props.defaultRole));e&&e.length>0&&(i=e[0])}let s=!!this.props.hideRoleDescriptions&&this.props.hideRoleDescriptions;this.state={showDialog:!0,disableOkButton:!0,selectedRole:i,userid:null,hideRoleDescription:s},this.pickerProvider=new L.PeoplePickerProvider(t.pageContext,{autoFocus:!0,identityTypes:this.props.identityTypes,operationScopes:this.props.operationScopes,options:{MinResults:5,MaxResults:20}}),this.roleDropdownSelection=new l.DropdownSelection,this.options=this._getRoles()}render(){return this.props.roles.map(((e,t)=>{e.displayName===this.state.selectedRole.displayName&&this.roleDropdownSelection.select(t)})),i.createElement(u.Dialog,{className:"add-user-dialog",titleProps:{text:V.AddUsersDialogTitle},onDismiss:()=>{this.props.onCancel()},footerButtonProps:[{className:"cta",primary:!0,text:V.AddButtonText,onClick:()=>{this._tryAddUser()},disabled:!this.state.userid},{className:"cta",text:V.CloseButtonLabelText,onClick:()=>{this.props.onCancel()}}]},i.createElement("table",{className:"add-user-container",role:"presentation"},i.createElement("tbody",null,i.createElement("tr",{className:"user-row-input"},i.createElement("td",{className:"label"},i.createElement("label",{htmlFor:"identitySearch"},this._getAddUserInputFieldLabel())),i.createElement("td",null,i.createElement("div",{className:"identity-picker-container"},i.createElement(U.FormItem,{className:"identity-picker-label",label:this._getAddUserInputFieldLabel()},i.createElement(k.IdentityPickerDropdown,{className:"feed-identity-picker-dropdown",suggestionsItemClassName:"suggestions",pickerProvider:this.pickerProvider,onChange:e=>{this.setState({userid:e}),this.selectedIdentity.value=e},value:this.selectedIdentity}))))),i.createElement("tr",{className:"role-row-input"},i.createElement("td",{className:"label"},i.createElement("label",{htmlFor:"role"},V.AddRoleInputField)),i.createElement("td",null,i.createElement("div",{className:"select-roles-menu"},i.createElement(a.Dropdown,{ariaLabel:V.AddRoleInputField.concat(this.state.selectedRole.displayName).concat(this.state.selectedRole.description),items:this.options,onSelect:(e,t)=>{t&&this._onRoleChanged(null,t)},selection:this.roleDropdownSelection})))),i.createElement("tr",{className:"role-description-row"},i.createElement("td",{className:"label"},i.createElement("label",{htmlFor:"description"})),i.createElement("td",null,i.createElement("div",{className:"role-description-container",style:{display:this.state.hideRoleDescription?"none":"inline-block"}},i.createElement("div",{id:"description",className:"permission-description"},this.state.selectedRole.description)))))))}_tryAddUser(){let e=[];e.push({roleName:this.state.selectedRole.name,userId:this.state.userid.localId}),this.props.addCallback(e)}_getAddUserInputFieldLabel(){let e=V.AddUserInputField;return this.props.addUserDialogUserLabel&&(e=this.props.addUserDialogUserLabel),e}_getRoles(){let e=[];return this.props.roles.map((t=>{e.push({id:t.displayName,text:t.displayName})})),e}_onRoleChanged(e,t){this.props.roles.map((e=>{e.displayName===t.id&&this.setState({selectedRole:e})}))}}t[e].AddUserDialog=n}("UserPermissionsAuthorizationComponentsAddUserDialog"),function(e){re=t[e]={};t[e].RoleAssignmentComponentSecurityActionsCreator=class{constructor(e,t,i,s,n){this.tryAddUser=e=>this._source.setRoleAssignments(e,this._scopeId,this._resourceId).then((e=>{this._actions.addNewUser.invoke(e)}),(e=>{this.setErrorMessage(e.message)})),this._actions=e,this._resourceId=t,this._scopeId=i,this._source=n}initialize(){this._source.getRoleDefinitions(this._scopeId).then((e=>{this._actions.initializeRoles.invoke(e)})),this._source.getRoleAssignments(this._scopeId,this._resourceId).then((e=>{this._actions.initializeRoleAssignments.invoke(e)}))}beginSave(e,t){return this._source.beginSave(e,this._scopeId,this._resourceId).then((e=>this._source.removeRoleAssignments(t,this._scopeId,this._resourceId).then((()=>(this._source.getRoleAssignments(this._scopeId,this._resourceId).then((e=>{this._actions.initializeRoleAssignments.invoke(e)})),!0)))))}changeInheritance(e){this._source.changeInheritance(this._scopeId,this._resourceId,e).then((()=>{this._source.getRoleAssignments(this._scopeId,this._resourceId).then((e=>{this._actions.initializeRoleAssignments.invoke(e)}))}))}changeScope(e,t,i){this._actions.updateRoleScope.invoke(t),this._scopeId=i,this._resourceId=e,this._source.getRoleDefinitions(this._scopeId).then((e=>{this._actions.initializeRoles.invoke(e)})),this._source.getRoleAssignments(this._scopeId,this._resourceId).then((e=>{this._actions.initializeRoleAssignments.invoke(e)}))}setErrorMessage(e){this._actions.setErrorMessage.invoke(e)}}}("UserPermissionsAuthorizationActionsRoleAssignmentComponentSecurityActionsCreator"),function(e){t[e]={};let o=250,r=100,c=100;class p extends s.VssComponent{constructor(e,t){super(e,t),this._roleAssignmentComponentFeature="RoleAssignmentComponent",this._roleAssignmentComponentScenario="RoleAssignmentComponent.Loaded",this._loggedPerfEvent=!1,this._dropdownSelectionDictionary={},this.onSelectedTabChanged=e=>{this.selectedTabId.value=e,this._changeScope(e)},this._onSizeSizable=(e,t,i)=>{this._tableColumns[t].width.value=i},this._tableColumns=[{id:"user",minWidth:o,width:new A.ObservableValue(600),name:V.UserPermissionUserHeading,renderCell:this._renderUserCellContent.bind(this),onSize:this._onSizeSizable,ariaLabel:V.UserPermissionUserHeading},{id:"role",minWidth:r,width:new A.ObservableValue(250),name:V.UserPermissionRoleHeading,renderCell:this._renderRoleCellContent.bind(this),onSize:this._onSizeSizable,ariaLabel:V.UserPermissionRoleHeading},{id:"access",minWidth:c,width:new A.ObservableValue(300),name:V.UserPermissionAccessHeading,renderCell:this._renderAccessCellContent.bind(this),onSize:this._onSizeSizable,ariaLabel:V.UserPermissionAccessHeading}],this._onStoreChange=()=>{let e=this._store.getState();this.setState(e)},this._saveChanges=()=>{let e=this._store.getDirtyRows();e=e.filter((e=>!this._store.userIsRemoved(e.role.identity.id)));let t=this._makeRolesToAssign(e),i=this._store.getRemovedUserIds();this._actionsCreator.beginSave(t,i)},this._onRoleChanged=(e,t)=>{let i=t,s=this.state.roles.filter((e=>e.name===i)),n={access:e.role.access,accessDisplayName:e.role.accessDisplayName,identity:e.role.identity,role:s[0]};this._actionsCreator._actions.updateRoleAssignment.invoke(n)},this.context=t,this._performanceService=this.context.pageContext.getService("IVssPerformanceService"),this._performanceService.startScenario(this._roleAssignmentComponentScenario,!0),this._actions=new ie.RoleAssignmentComponentSecurityActionsHub,this._source=new ne.RoleAssignmentComponentSecuritySource(this.context,this.props.serviceInstanceId),this._actionsCreator=new re.RoleAssignmentComponentSecurityActionsCreator(this._actions,this.props.resourceId,this.props.scopeId,this.props.endpointId,this._source),this._actionsCreator.initialize();let i={userId:this.props.userId,canEditProjectView:this.props.canEditProjectView,manageRolesPermission:this.props.manageRolesPermission,roleScope:this.props.roleScope,canEditOrganizationView:this.props.canEditOrganizationView};this.selectedTabId=new A.ObservableValue(V.ProjectButtonText),this._store=new se.RoleAssignmentComponentSecurityStore(this._actions,i)}componentWillMount(){this._store.addChangedListener(this._onStoreChange);let e=this._store.getState();this.setState(e)}componentWillUnmount(){this._store.removeChangedListener(this._onStoreChange)}componentDidMount(){let e=document.getElementById("__bolt-security-page-back-button-id");e&&e.focus()}componentDidUpdate(e,t){this.state===t||this._loggedPerfEvent||(this._performanceService.endScenario(this._roleAssignmentComponentFeature,this._roleAssignmentComponentScenario,!0),this._loggedPerfEvent=!0)}render(){let e=this.state.canEdit?"grid-container":"grid-container no-edit",t=new h.ArrayItemProvider(this.state.roleAssignments),s=[{id:"Inheritance-On",text:V.InheritenceOnButtonText,checked:this.state.inherit,onActivate:()=>{this._changeInheritance(!0)},readonly:!0},{id:"Inheritance-Off",text:V.InheritenceOffButtonText,checked:!this.state.inherit,onActivate:()=>{this._changeInheritance(!1)},readonly:!0}],o=(V.ProjectButtonText,this.state.roleScope,V.ProjectButtonText,V.OrganizationButtonText,this.state.roleScope,V.OrganizationButtonText,"itemIconColor"),r="itemIconColor";this.state.canEdit&&(r="itemIconColor-add"),this.state.canEdit&&this.state.isDirty&&(o="itemIconColor-undo");let a=!0;"boolean"==typeof this.props.enableToggleInheritence&&(a=this.props.enableToggleInheritence);return i.createElement("div",{className:"flex flex-column"},!this.props.canEditOrganizationView&&this._getNoManagePermissionCardComponent(),this.state.error&&this._getErrorCardComponent(),i.createElement(b.Card,{className:"roles-permissions-card bolt-card-no-vertical-padding flex-column",contentProps:{contentPadding:!1,className:"user-permissions-card-content"}},this.props.title&&i.createElement("h2",{className:"roles-tab-title"},this.props.title),this.props.enableTogglingOrganizationButton&&i.createElement(B.ButtonGroup,{className:"projectCommandBar"},i.createElement("div",{className:"flex-column"},i.createElement(M.TabBar,{tabsClassName:"bolt-card-white",onSelectedTabChanged:this.onSelectedTabChanged,selectedTabId:this.selectedTabId,tabSize:"tall"},i.createElement(M.Tab,{name:V.ProjectButtonText,id:V.ProjectButtonText}),i.createElement(M.Tab,{name:V.OrganizationButtonText,id:V.OrganizationButtonText})))),i.createElement(B.ButtonGroup,{className:"commandBar"},i.createElement(n.Button,{className:"commandBar-Item",text:V.AddButtonText,iconProps:{iconName:"Add",className:r},disabled:!this.state.canEdit,subtle:!0,onClick:()=>{this.setState({showAddIdentityPicker:!0})}}),i.createElement(n.Button,{className:"commandBar-Item",text:V.UndoButtonText,iconProps:{iconName:"Undo",className:o},disabled:!this.state.canEdit||!this.state.isDirty,subtle:!0,onClick:()=>{this._actionsCreator.initialize()}}),i.createElement(n.Button,{className:"commandBar-Item",text:V.SaveButtonText,iconProps:{iconName:"Save",className:o},disabled:!this.state.canEdit||!this.state.isDirty,subtle:!0,onClick:()=>{this._saveChanges()}}),this.state.roleScope===V.ProjectButtonText&&this.props.enableToggleInheritence&&i.createElement(E.MenuButton,{className:"commandBar-Item",ariaLabel:this.state.inherit?V.InheritenceOnButtonSelectText:V.InheritenceOffButtonSelectText,text:V.InheritanceButtonText,disabled:!this.state.canEdit,subtle:!0,contextualMenuProps:{menuProps:{id:"inheritence",items:s}}})),i.createElement("div",{className:e},i.createElement(d.Table,{ariaLabel:V.UserPermissionsTableName,className:"roles-grid",scrollable:!0,columns:this._tableColumns,itemProvider:t,pageSize:20})),this.state.showAddIdentityPicker&&i.createElement(oe.AddUserDialog,{title:V.AddUsersDialogTitle,roles:this.state.roles,defaultRole:this.state.roleScope===V.OrganizationButtonText?V.AdministratorRoleText:null,addCallback:this._actionsCreator.tryAddUser,addUserDialogUserLabel:this.props.addUserDialogUserLabel,hideRoleDescriptions:this.props.hideRoleDescriptions,onCancel:()=>{this.setState({showAddIdentityPicker:!1})},identityTypes:this.props.identityTypes,operationScopes:this.props.operationScopes})))}_renderUserCellContent(e,t,s,n){const o=n.role.identity.uniqueName?n.role.identity.uniqueName:n.displayName,r=(0,O.getIdentityImageUrl)(this.context.pageContext,n.role.identity);let a="role-user-cell",l="user-pic",c="scroll-hidden role-name-cell avatar",h="scroll-hidden role-name-cell";return n.isRemoved&&(l+=" removed",c+=" removed",h+=" removed",a+=" removed"),n.isDirty&&(l+=" dirty",c+=" dirty",h+=" dirty",a+=" dirty"),i.createElement(d.SimpleTableCell,{ariaLabel:V.UserPermissionUserHeading+" "+n.displayName,className:a,columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement("div",{className:a},this.props.showAvatars&&i.createElement("img",{className:l,src:r,alt:"user pic"}),this.props.showAvatars&&i.createElement("div",{className:c,title:o},n.displayName),!this.props.showAvatars&&i.createElement("div",{className:h,title:o},n.displayName)))}_renderRoleCellContent(e,t,s,n){let o="role-menu-cell";n.isRemoved&&(o+=" removed"),n.isDirty&&(o+=" dirty");let r=[],c=n.role.identity.id;return this._dropdownSelectionDictionary[c]||(this._dropdownSelectionDictionary[c]=new l.DropdownSelection),this.state.roles&&this.state.roles.map(((e,t)=>{r.push({id:e.name,text:e.displayName}),e.displayName===n.roleName&&this._dropdownSelectionDictionary[c].select(t)})),this._store.getUserRoleAssignment()&&n.role.identity.id===this._store.getUserRoleAssignment().identity.id||!this.state.canEdit||!0===n.isRemoved?(this._dropdownSelectionDictionary[c].select(0),r=[],r.push({id:n.roleName,text:n.roleName}),i.createElement(d.SimpleTableCell,{className:o,columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(a.Dropdown,{ariaLabel:V.UserPermissionRoleHeading+" "+n.roleName,disabled:!this.state.canEdit,className:"propagate-keydown-event",selection:this._dropdownSelectionDictionary[c],items:r,onSelect:(e,t)=>{t&&this._onRoleChanged(n,t.text)}}))):i.createElement(d.SimpleTableCell,{className:o,columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement(a.Dropdown,{ariaLabel:V.UserPermissionRoleHeading+" "+n.roleName,disabled:!this.state.canEdit,className:"propagate-keydown-event",selection:this._dropdownSelectionDictionary[c],items:r,onSelect:(e,t)=>{t&&this._onRoleChanged(n,t.id)}}))}_renderAccessCellContent(e,t,s,o){let r="role-access-cell";return o.isRemoved&&(r+=" removed"),o.isDirty&&(r+=" dirty"),i.createElement(d.SimpleTableCell,{ariaLabel:V.UserPermissionAccessHeading+" "+o.role.accessDisplayName,className:r,columnIndex:t,tableColumn:s,key:"col-"+t},i.createElement("div",null,o.role.accessDisplayName),this.state.canEdit&&!0!==o.isRemoved&&o.role.identity.id!==this.props.userId&&2!==o.accessValue&&i.createElement(n.Button,{tooltipProps:{text:V.RevokeAccessTooltip},primary:!1,className:"bolt-table-cell-content-reveal user-removal-button",subtle:!0,iconProps:{iconName:"Cancel",className:"removal-icon"},ariaLabel:V.Removepermission,onClick:e=>{this._onRemove(o)},excludeTabStop:!0}))}_changeInheritance(e){this.state.inherit!==e&&this._actionsCreator.changeInheritance(e)}_changeScope(e){e===V.OrganizationButtonText?this._actionsCreator.changeScope("collection_"+this.props.endpointId,e,"distributedtask.collection.serviceendpointrole"):this._actionsCreator.changeScope(this.props.resourceId,e,this.props.scopeId)}_makeRolesToAssign(e){let t=[];for(let i=0;i<e.length;i++){let s=e[i];t.push({userId:s.role.identity.id,roleName:s.role.role&&s.role.role.name?s.role.role.name:s.roleName,uniqueName:s.role.accessDisplayName})}return t}_onRemove(e){this._actionsCreator._actions.removeUser.invoke(e.role.identity.id)}_getNoManagePermissionCardComponent(){let e="";return this.state.canEdit?this.state.roleScope!==V.OrganizationButtonText||this.props.canEditOrganizationView||(e=V.CannotUpdateOrganizationView):e=V.CannotUpdateSecurityMessage,""!==e?i.createElement(y.MessageCard,{className:"cant-manage-message-card",severity:"Warning"},this.props.noPermissionMessage?this.props.noPermissionMessage:e):null}_getErrorCardComponent(){return i.createElement("div",null,i.createElement(y.MessageCard,{className:"error-message-card",onDismiss:()=>{this._actionsCreator.setErrorMessage("")},severity:"Error"},this.state.error))}}t[e].RoleAssignmentComponentSecurityControl=p,p.componentType="vssRoleAssignmentComponentSecurityControl"}("UserPermissionsAuthorizationComponentsRoleAssignmentComponentSecurityControl")}),["Resources","Constants","PipelinePermissionsAuthorization/Components/PipelinesListComponent","PipelinePermissionsAuthorization/Components/PipelinesAuthorizationDropdown","PipelinePermissionsAuthorization/Components/RestrictAllPipelinesConfirmationPanel","PipelinePermissionsAuthorization/Components/AuthorizeAllPipelinesConfirmationDialog","PipelinePermissionsAuthorization/Actions/PipelinesAuthorizationActionsHub","PipelinePermissionsAuthorization/Stores/PipelinesAuthorizationStore","PipelinePermissionsAuthorization/Source/Build/RestClient/Build","PipelinePermissionsAuthorization/Source/PipelinesAuthorizationSource","PipelinePermissionsAuthorization/Actions/PipelinesAuthorizationActionsCreator","PipelinePermissionsAuthorization/Components/PipelinesAuthorizationComponent","ProjectPermissionsAuthorization/Actions/ProjectAuthorizationActionsHub","ProjectPermissionsAuthorization/Source/ProjectAuthorizationSource","ProjectPermissionsAuthorization/Actions/ProjectAuthorizationActionsCreator","ProjectPermissionsAuthorization/Store/ProjectAuthorizationStore","ProjectPermissionsAuthorization/Components/ProjectListComponent","ProjectPermissionsAuthorization/Components/ProjectAuthorizationComponent","UserPermissionsAuthorization/Actions/RoleAssignmentComponentSecurityActionsHub","UserPermissionsAuthorization/Store/RoleAssignmentComponentSecurityStore","UserPermissionsAuthorization/Source/RoleAssignmentComponentSecuritySource","UserPermissionsAuthorization/Components/AddUserDialog","UserPermissionsAuthorization/Actions/RoleAssignmentComponentSecurityActionsCreator","UserPermissionsAuthorization/Components/RoleAssignmentComponentSecurityControl"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-distributedtask-web.dt-security"}}));