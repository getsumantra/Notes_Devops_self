"use strict";define("Build/Admin/Pool",["require","exports","Build/Admin/Common/Actions/AgentActions","Build/Admin/Common/Actions/ConfirmationDialogActions","Build/Admin/Common/Actions/JobActions","Build/Admin/Common/Actions/NotificationActions","Build/Admin/Common/Actions/ProjectActions","Build/Admin/Common/Actions/ResourceLimitActions","Build/Admin/Common/Actions/ServiceEndpointActions","Build/Admin/Common/Actions/SignalRActions","VSS/Reflux/Action","DistributedTask/Client/RestClient/TaskAgent","DistributedTask/Client/RestClient/Elastic","Build/Admin/Common/Constants","VSS/Reflux/Store","VSS/Core/Util/String","Analytics/Common/Utilities/AnalyticsExceptionUtilities","Analytics/Shared/TrendChart/Common/ConfigurationUtility","Build/Admin/Checks/Stores/ChecksStore","Build/Admin/Common/Stores/AgentDefinitionStore","Build/Admin/Common/Stores/ConfirmationDialogStore","Build/Admin/Common/Stores/JobStore","Build/Admin/Common/Stores/NotificationStore","Build/Admin/Common/Stores/ProjectStore","Build/Admin/Common/Stores/ResourceLimitStore","Build/Admin/Common/Stores/ServiceEndpointStore","Build/Admin/Common/Stores/SignalRStore","Build/Admin/Common/Stores/VirtualMachineScaleSetStore","Build/Admin/Common/Actions/ConfirmationDialogActionCreator","Build/Admin/Common/Actions/NavigationActionCreator","Build/Admin/Common/Actions/NotificationActionCreator","Build/Admin/Common/Actions/ProjectActionCreator","Build/Admin/Common/Actions/ResourceLimitActionCreator","Build/Admin/Common/Actions/ServiceEndpointActionCreator","Build/Admin/Common/ElasticPoolUtils","Build/Admin/Common/TaskAgentPoolUtils","Analytics/Common/Utilities/DateSKParser","Analytics/Shared/Common/Sources/AnalyticsODataClientBase","Analytics/Shared/Common/Types","Analytics/Shared/Common/Utils/DateAdjuster","Analytics/Shared/Utils/DateUtils","Analytics/Shared/ChartSeries/ChartSeries","Analytics/Shared/Common/Utils/ChartDataConverter","Build/Admin/Common/Sources/AgentDefinitionSource","Build/Admin/Common/Sources/AgentPoolSource","Build/Admin/Common/Sources/AgentQueueSource","Build/Admin/Common/Sources/JobSource","Build/Admin/Common/Sources/SecuritySource","Build/Admin/Common/Sources/ServiceEndpointSource","DistributedTask/Common/SignalR/SignalRHubProxies","Build/Admin/Common/SignalRHubBase","react","VSSUI/Dialog","VSSUI/Spinner","VSS/Legacy/Legacy","VSS/Core/Observable","VSS/Platform/FPS","VSSUI/Ago","VSSUI/Link","VSSUI/Table","VSSUI/Toggle","VSSUI/TooltipEx","VSSUI/Utilities/Provider","VSSUI/ConditionalChildren","VSSUI/Panel","VSS/Platform/Layout","Build/Admin/Common/Components/ProjectPicker","Build/Admin/Common/Components/VMScaleSetSettings","Build/Admin/Common/Components/ReimageDisabledWarning","VSS/Features/MarkdownEditor/Commands/Shortcut","VSS/Features/MarkdownEditor/Components","VSSUI/Button","VSSUI/Status","VSSUI/Duration","VSS/Platform/Location","VSSUI/Card","VSSUI/ZeroData","VSS/Platform/Components/Format","Analytics/Shared/Analytics-Visuals-Common/ErrorComponent/ErrorComponent","Analytics/Shared/Analytics-Visuals-Common/LoadingComponent/LoadingComponent","Analytics/Shared/Common/Constants","Analytics/Shared/Visuals/AreaChartView/ControllerViews/AreaChartView","VSS/Features/Charts/Contracts","Analytics/Shared/Common/AnalyticsHeaderComponent","Analytics/Shared/Common/AnalyticsPage","VSSUI/Dropdown","VSSUI/FilterBar","VSSUI/HeaderCommandBar","VSSUI/Utilities/DropdownSelection","VSSUI/Utilities/Filter","Analytics/Shared/Common/AnalyticsExtensionValidator","Checks/ChecksOverview/ChecksOverview","VSS/Features/Identities/IdentityPickerProvider","VSS/Platform/Identity","VSSUI/IdentityPicker","Build/Admin/Common/Components/Owner","VSSUI/Util","Build/Admin/Common/Components/JobsFilterBar","Build/Admin/Common/Components/JobsList","VSS/Platform/Feature","Build/Admin/Common/Components/PoolRoles","DistributedTaskUI/SecurityComponent/PipelinePermissionsAuthorization/Components/PipelinesAuthorizationComponent","VSS/Features/SecurityUI/Roles/RoleAssignment","VSSUI/Checkbox","VSSUI/FormItem","VSSUI/Header","VSSUI/TextField","Build/Admin/Common/Components/ConfirmationDialog","Build/Admin/Common/Components/ElasticPoolSettings","Build/Admin/Common/Components/NotificationArea","Build/Admin/Common/Components/PoolTypeIcon","VSSUI/Page","VSSUI/Surface","VSSUI/Tabs","Checks/ChecksOverview/ChecksIssuesMessageComponent","Checks/ChecksOverview/Generated/Constants","VSS/Features/Charts/Chart"],(function(e,t,s,i,o,n,a,r,l,c,d,u,h,g,p,m,S,b,C,P,A,_,v,y,D,f,E,T,w,x,H,L,I,U,k,M,N,R,j,V,O,F,B,J,z,Q,q,K,Z,W,$,G,Y,X,ee,te,se,ie,oe,ne,ae,re,le,ce,de,ue,he,ge,pe,me,Se,be,Ce,Pe,Ae,_e,ve,ye,De,fe,Ee,Te,we,xe,He,Le,Ie,Ue,ke,Me,Ne,Re,je,Ve,Oe,Fe,Be,Je,ze,Qe,qe,Ke,Ze,We,$e,Ge,Ye,Xe,et,tt,st,it,ot,nt,at,rt,lt){var ct,dt,ut,ht,gt,pt,mt,St,bt,Ct,Pt,At,_t,vt,yt,Dt,ft,Et,Tt,wt,xt,Ht,Lt,It,Ut,kt,Mt,Nt,Rt,jt,Vt,Ot,Ft,Bt,Jt,zt,Qt,qt,Kt,Zt,Wt,$t,Gt,Yt,Xt,es,ts;ct=t[ts="Resources"]={},t[ts].AgentAcquisitionDialogTitle="Get the agent",t[ts].AgentInteractiveUIDialogTitle="Configure VMs to run interactive tests",t[ts].AgentInteractiveUIDialogBody="This setting only affects pools running a Windows Server operating system. When this option is enabled, the pipeline agent runs un-elevated with auto-login and interactive UI enabled. When this option is disabled, the pipeline agent runs with elevated permissions but cannot interact with the UI. Changing this setting requires reconfiguring the agents in this pool. Existing agents in the pool will be removed and new agents will come online to replace them. In progress jobs will not be interrupted. Queued jobs will be delayed until the reconfiguration completes.",t[ts].AgentListEmptyExperience="No agents are registered or you do not have permission to view the agents.",t[ts].Agents="Agents",t[ts].AgentUsage="Agent usage",t[ts].Analytics="Analytics",t[ts].AutoProvisioning="Auto-provisioning",t[ts].AutoProvisionSettingSwitchLabel="Auto-provision this agent pool in new projects",t[ts].AutoUpdate="Allow agents in this pool to automatically update",t[ts].AzureSubscriptionSettings="Azure subscription settings",t[ts].AzureSubscriptionSettingsDescription="Update the Azure subscription or virtual machine scale set used by this pool",t[ts].Checks="Approvals and checks",t[ts].Concurrency="Concurrency",t[ts].ConfigurationJobOperation="Configuration",t[ts].ConfigureAgentDarwinMarkdown="```bash\r\n~/myagent$ ./config.sh\r\n```",t[ts].ConfigureAgentLinuxMarkdown="```bash\r\n~/myagent$ ./config.sh\r\n```",t[ts].ConfigureAgentWindowsMarkdown="```powershell\r\nPS C:\\agent> .\\config.cmd\r\n```",t[ts].ConfirmDeleteAgentMessage="Are you sure you want to delete agent {0}?{1}{2}This action will remove the agent from agent pool {3}.",t[ts].ConfirmDeleteNodeMessage="Are you sure you want to delete agent {0}? This action will delete the agent from the pool and delete the associated virtual machine.",t[ts].ConfirmDeleteTitle="Confirm Deletion",t[ts].ConfirmUpdateAgentMessage="Are you sure you want to update agent {0}?{1}{2}All running jobs on this agent will complete before this action begins. All queued jobs for this agent will be delayed until the update is complete.",t[ts].ConfirmUpdateAllAgentsMessage="Are you sure you want to update all agents in agent pool {0}?{1}{2}All running jobs will complete before this action begins. All queued jobs will be delayed until the update is complete.",t[ts].ConfirmUpdateTitle="Confirm Update",t[ts].DayAbbreviationFriday="Fri",t[ts].DayAbbreviationMonday="Mon",t[ts].DayAbbreviationSaturday="Sat",t[ts].DayAbbreviationSunday="Sun",t[ts].DayAbbreviationThursday="Thurs",t[ts].DayAbbreviationTuesday="Tues",t[ts].DayAbbreviationWednesday="Wed",t[ts].Delete="Delete",t[ts].DeleteVMsOperation="Scaling in",t[ts].DeprecatedAgent="Deprecated agent version. Please migrate.",t[ts].Details="Details",t[ts].Diagnostics="Diagnostics",t[ts].DisableAgentAutoUpdate="Disable agent auto update",t[ts].DisableAgentAutoUpdateDetails="Azure Pipelines automatically updates agents as needed. By disabling automatic updates, pipelines which rely on updated tasks or new features will fail when using this pool. Are you sure you want to disable automatic agent updates for this pool?",t[ts].DownloadAgentDarwinMarkdown="```bash\r\n~/$ mkdir myagent && cd myagent\r\n~/myagent$ tar zxvf ~/Downloads/{0}\r\n```",t[ts].DownloadAgentLinuxMarkdown="```bash\r\n~/$ mkdir myagent && cd myagent\r\n~/myagent$ tar zxvf ~/Downloads/{0}\r\n```",t[ts].DownloadAgentWindowsMarkdown='```powershell\r\nPS C:\\> mkdir agent ; cd agent\r\nPS C:\\agent> Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory("$HOME\\Downloads\\{0}", "$PWD")\r\n```',t[ts].DownloadLogs="Download logs",t[ts].Duration="Duration",t[ts].Edit="Edit",t[ts].ElasticPoolOffline="We are unable to connect to your virtual machine scale set. Please go to the pool settings tab and verify your Azure Subscription settings.",t[ts].ElasticPoolSettings="Azure virtual machine scale set pool settings",t[ts].ElasticLogsCardTitle="Scaling and configuration logs",t[ts].ElasticLogsLearnMore="Learn more about troubleshooting Azure virtual machine scale set agents.",t[ts].Enabled="Enabled",t[ts].ErrorsAndWarnings="Errors and warnings",t[ts].ErrorsAndWarningsCellText="{0} errors, {1} warnings",t[ts].FourteenDays="14 days",t[ts].Id="ID",t[ts].Idle="Idle",t[ts].IncreaseCapacityOperation="Scaling out",t[ts].Jobs="Jobs",t[ts].JobsTrendTitle="Jobs trend",t[ts].LastRun="Last run",t[ts].Logs="Logs",t[ts].MaintenanceHistory="Maintenance History",t[ts].MaintenanceJob="Maintenance job",t[ts].MaintenanceJobConcurrencyLabel="Maximum percentage of agents running maintenance concurrently:",t[ts].MaintenanceJobDaysLabel="Run maintenance job on these days:",t[ts].MaintenanceJobDirectoryExpirationLabel="Days to keep unused working directories (0 indicates forever):",t[ts].MaintenanceJobEnableLabel="Enable agent maintenance job",t[ts].MaintenanceJobHistoryLabel="Number of maintenance job records to keep:",t[ts].MaintenanceJobHourAriaLabel="Maintenance job start time - hour",t[ts].MaintenanceJobMinuteAriaLabel="Maintenance job start time - minute",t[ts].MaintenanceJobMustBeIntegerError="Value must be an integer",t[ts].MaintenanceJobRequiredError="This field is required",t[ts].MaintenanceJobTimeLabel="Start maintenance job at this time:",t[ts].MaintenanceJobTimeoutLabel="Maintenance job timeout (minutes):",t[ts].MaintenanceJobTimeZoneAriaLabel="Maintenance job start time - time zone",t[ts].ManagePoolRolesNoPermissions="You do not have permission to manage this poolâ€™s roles.",t[ts].Message="Message",t[ts].Name="Name",t[ts].NewAgent="New agent",t[ts].NoDaySelected="No day selected",t[ts].Now="Now",t[ts].Off="Off",t[ts].Offline="Offline",t[ts].On="On",t[ts].OneDay="1 day",t[ts].OneHundrendAndEightyDays="180 days",t[ts].Online="Online",t[ts].OnlineAgents="Online agents",t[ts].Operation="Operation",t[ts].Pipeline="Pipeline",t[ts].PipelineSecurityTitle="Pipeline permissions",t[ts].PipelineSecurityAuthorizeAll="Grant access permission to all pipelines",t[ts].PoolConsumptionReport="Pool consumption report",t[ts].PoolDescriptionLabel="Description",t[ts].PoolDescriptionNotFound="No pool description found.",t[ts].PoolOwnerLabel="Owner",t[ts].PoolTrendYAxisLabel="Max jobs",t[ts].PrivateHostedConcurrency="Private hosted concurrency",t[ts].PrivateSelfHostedConcurrency="Private self-hosted concurrency",t[ts].Project="Project",t[ts].PublicHostedConcurrency="Public hosted concurrency",t[ts].PurchaseConcurrency="Purchase concurrency",t[ts].Queued="Queued",t[ts].QueuedJobs="Queued jobs",t[ts].RecycleAfterEachUseDialogTitle="Automatically tear down virtual machines after every use",t[ts].RecycleAfterEachUseDialogBody="Changing this setting requires reconfiguring the agents in this pool. Existing agents in the pool will be removed and new agents will come online to replace them. In progress jobs will not be interrupted. Queued jobs will be delayed until the reconfiguration completes.",t[ts].ReimageOperation="Reimaging",t[ts].ResourceUnavailable="Unavailable due to access restrictions, connectivity issues, or the resource was deleted.",t[ts].RolesScopeCollection="Collection",t[ts].RolesScopeOrganization="Organization",t[ts].RolesScopeProject="Project",t[ts].RunAgentDarwinMarkdown="```bash\r\n~/myagent$ ./run.sh\r\n```",t[ts].RunAgentLinuxMarkdown="```bash\r\n~/myagent$ ./run.sh\r\n```",t[ts].RunAgentWindowsMarkdown="```powershell\r\nPS C:\\agent> .\\run.cmd\r\n```",t[ts].RunningJobs="Running job(s)",t[ts].RunningRequestInformation="Running {0} {1}",t[ts].Save="Save",t[ts].Saved="Saved",t[ts].SavedAgents="Agents saved for investigation",t[ts].SavedAgentsDescription="We detected a problem with the following scale set agents and saved them for you to connect and debug.",t[ts].SavedAgentsLearnMore="Learn more about troubleshooting unhealthy scale set agents.",t[ts].Scheduling="Scheduling",t[ts].Security="Security",t[ts].SelectProjectHeader="Project for Service Connections:",t[ts].ServiceConnectionNameLabel="Service connection:",t[ts].Settings="Settings",t[ts].SevenDays="7 days",t[ts].SizingJobOperation="Scaling",t[ts].Started="Started",t[ts].Status="Current status",t[ts].StillAggregating="(Still aggregating)",t[ts].TargetAgents="Target agents",t[ts].TargetAgentsCellText="{0} agents",t[ts].TaskAgentJobNumberFormat="Job {0}",t[ts].Timestamp="Timestamp",t[ts].ThirtyDays="30 days",t[ts].TopFivePipelines="Consumption by the top five pipelines",t[ts].TopFivePipelinesOnlineAgents="Consumption by the top five pipelines for online agents",t[ts].TopFivePipelinesPrivate="Consumption by the top five pipelines (Private)",t[ts].TopFivePipelinesPublic="Consumption by the top five pipelines (Public)",t[ts].TopFivePipelinesYAxisLabel="Percentage",t[ts].UpdateElasticPoolFailure="Unable to update elastic pool settings",t[ts].UserSecurityTitle="User permissions",t[ts].Undo="Undo",t[ts].UpdateAgent="Update agent",t[ts].UpdateAllAgents="Update all agents",t[ts].UpdateSettings="Agent update settings",t[ts].Version="Agent version",t[ts].View="View",t[ts].VirtualMachineScaleSetNameLabel="Virtual machine scale set:",t[ts].VmssLogsLink="View the virtual machine scale set logs in the Azure portal for additional details.",t[ts].ZeroAgentsPrimaryText="Add your first agent",t[ts].ZeroAgentsSecondaryText="Manage agents and run pipeline jobs on this pool.",t[ts].ZeroElasticAgentsPrimaryText="No agents are connected",t[ts].ZeroElasticAgentsSecondaryText="Azure virtual machine scale set agents will appear here when they are created.",t[ts].ZeroFilteredJobsPrimaryText="No jobs have been run for the selected filter",t[ts].ZeroFilteredJobsSecondaryText="",t[ts].ZeroLogsPrimaryText="There are no recent diagnostic logs available for this pool",t[ts].ZeroMaintenanceJobsPrimaryText="No maintenance history",t[ts].ZeroMaintenanceJobsSecondaryText="No maintenance jobs have run on this agent pool. Enable and schedule the maintenance job in this pool's settings.",t[ts].ZeroPoolJobsPrimaryText="No jobs have run on this agent pool",t[ts].ZeroPoolJobsSecondaryText="Run a pipeline on this agent pool to see more details",t[ts].PurchaseConcurrencyButtonId="purchase-concurrency-button",function(e){dt=t[e]={},function(e){e.QueuedJobs="QueuedJobs",e.RunningJobs="RunningJobs",e.Concurrency="Concurrency"}(t[e].PoolDataStrings||(t[e].PoolDataStrings={})),function(e){e.Private="Private",e.Public="Public"}(t[e].Visibility||(t[e].Visibility={}))}("Types"),function(e){ut=t[e]={};t[e].ActionsHub=class{constructor(){this.agentActions=new s.AgentActions,this.confirmationDialogActions=new i.ConfirmationDialogActions,this.jobActions=new o.JobActions,this.notificationActions=new n.NotificationActions,this.projectActions=new a.ProjectActions,this.resourceLimitActions=new r.ResourceLimitActions,this.serviceEndpointActions=new l.ServiceEndpointActions,this.signalRActions=new c.SignalRActions,this.agentPoolDescriptionUpdated=new d.Action,this.descriptionStoreStatusUpdated=new d.Action,this.agentsUpdated=new d.Action,this.agentDeleted=new d.Action,this.maintenanceDefinitionsUpdated=new d.Action,this.maintenanceDefinitionAdded=new d.Action,this.maintenanceDefinitionUpdated=new d.Action,this.maintenanceJobUpdated=new d.Action,this.maintenanceJobsUpdated=new d.Action,this.maintenanceJobsStoreStatusUpdated=new d.Action,this.maintenanceStoreStatusUpdated=new d.Action,this.maintenanceTimeZonesUpdated=new d.Action,this.selectedAgentPoolUpdated=new d.Action,this.selectedAgentQueueUpdated=new d.Action,this.selectedElasticPoolUpdated=new d.Action,this.selectedServiceEndpointUpdated=new d.Action,this.selectedVirtualMachineScaleSetUpdated=new d.Action,this.selectedTabUpdated=new d.Action,this.securityStoreStatusUpdated=new d.Action,this.manageQueuePermissionUpdated=new d.Action,this.managePoolPermissionUpdated=new d.Action,this.manageAllQueuesPermissionUpdated=new d.Action,this.manageAllPoolsPermissionUpdated=new d.Action,this.agentQueuePipelinesAuthorizedUpdated=new d.Action,this.agentDefinitionsUpdated=new d.Action,this.dismissDownloadAgentDialog=new d.Action,this.showDownloadAgentDialog=new d.Action,this.elasticNodesUpdated=new d.Action,this.elasticNodeUpdated=new d.Action,this.elasticNodeStoreStatusUpdated=new d.Action,this.elasticPoolLogsUpdated=new d.Action,this.elasticPoolLogStoreStatusUpdated=new d.Action,this.checksStoreStatusUpdated=new d.Action,this.updateConfigurationValuesAction=new d.Action,this.updatePublicDataAction=new d.Action,this.updatePrivateDataAction=new d.Action,this.updateTopFivePipelinesAction=new d.Action,this.onPublicTrendError=new d.Action,this.onPrivateTrendError=new d.Action,this.onPipelineConsumptionError=new d.Action}}}("ActionsActionsHub"),function(e){ht=t[e]={};t[e].AgentSource=class{constructor(e){this._client=(0,u.getTaskAgentClient)(e)}async getAgent(e,t){return this._client.getAgent(t,e,!0,!0,!0)}async getAgentsForPool(e){return this._client.getAgents(e,void 0,!0,!0,!0)}async updateAgent(e,t){return this._client.updateAgent(e,t,e.id)}async deleteAgent(e,t){return this._client.deleteAgent(t,e.id)}async refreshAgent(e,t){return this._client.refreshAgent(t,e.id)}}}("SourcesAgentSource"),function(e){gt=t[e]={};t[e].ElasticPoolSource=class{constructor(e){this._pageContext=e,this._client=(0,h.getElasticClient)(e)}getCachedSelectedElasticPoolData(){return this._initializeElasticPoolData(),this._elasticPoolData?this._elasticPoolData:void 0}async updateElasticPoolAsync(e,t){return this._client.updateElasticPool(t,e)}async getElasticPoolLogsAsync(e){return this._client.getElasticPoolLogs(e.poolId)}async getElasticNodesAsync(e,t){return this._client.getElasticNodes(e.poolId,t)}async updateElasticNodeAsync(e,t,s){return this._client.updateElasticNode(s,e,t)}_initializeElasticPoolData(){if(!this._poolDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._elasticPoolData=e.getData(g.DataProviders.ElasticPool),this._poolDataInitialized=!0}}}}("SourcesElasticPoolSource"),function(e){pt=t[e]={};class s extends p.Store{constructor(){super("AgentStoreChanged"),this.state=[],this.updateAgents=e=>{const t=e?e.slice(0):[];this.state=this._sortAgents(t),this.emitChanged()},this.updateAgentStatus=(e,t)=>{const s=this.getAgent(e);s&&(s.status=t,this.updateAgent(s))},this.updateAgent=e=>{const t=this.state.filter((t=>t.id!==e.id));t.push(e),this.state=this._sortAgents(t),this.emitChanged()},this.agentDeleted=e=>{if(this.state.length>0){const t=this.state.filter((t=>t.id!==e.id));this.state=t,this.emitChanged()}},this.updateAssignedJobRequest=e=>{if(this.state.length>0&&e.reservedAgent){const t=this.state.filter((t=>t.id===e.reservedAgent.id))[0];if(t){const s=this.state.filter((e=>e.id!==t.id));e.finishTime?(delete t.assignedRequest,t.lastCompletedRequest=e):t.assignedRequest=e,s.push(t),this.state=this._sortAgents(s),this.emitChanged()}}}}getAgent(e){if(this.state.length>0){return this.state.filter((t=>t.id===e))[0]}}_sortAgents(e){return e.sort(((e,t)=>(0,m.localeIgnoreCaseComparer)(e.name,t.name)))}}t[e].AgentStore=s}("StoresAgentStore"),function(e){mt=t[e]={};class s extends p.Store{constructor(){super("DescriptionStoreChanged"),this.state={description:"",status:0},this.updateAgentPoolDescription=e=>{this.state={description:e,status:2},this.emitChanged()},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()}}}t[e].DescriptionStore=s}("StoresDescriptionStore"),function(e){St=t[e]={};class s extends p.Store{constructor(){super("DownloadAgentDialogStoreChanged"),this.showDialog=()=>{this.state={isOpen:!0},this.emitChanged()},this.dismissDialog=()=>{this.state={isOpen:!1},this.emitChanged()},this.state={isOpen:!1}}}t[e].DownloadAgentDialogStore=s}("StoresDownloadAgentDialogStore"),function(e){bt=t[e]={};class s extends p.Store{constructor(){super("ElasticNodeStoreChanged"),this.state={elasticNodes:[],status:0},this.updateElasticNodes=e=>{this.state={elasticNodes:e,status:2},this.emitChanged()},this.updateElasticNode=e=>{const t=this.state.elasticNodes.filter((t=>t.id!==e.id));t.push(e),this.state=Object.assign(Object.assign({},this.state),{elasticNodes:t}),this.emitChanged()},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()}}}t[e].ElasticNodeStore=s}("StoresElasticNodeStore"),function(e){Ct=t[e]={};class s extends p.Store{constructor(){super("ElasticPoolLogStoreChanged"),this.state={elasticPoolLogs:[],status:0},this.updateElasticPoolLogs=e=>{this.state={elasticPoolLogs:e,status:2},this.emitChanged()},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()}}}t[e].ElasticPoolLogStore=s}("StoresElasticPoolLogStore"),function(e){Pt=t[e]={};class s extends p.Store{constructor(){super("MaintenanceJobStoreChanged"),this.state={jobs:[],status:0},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()},this.updateJobs=e=>{this.state={status:2,jobs:this._sortJobs(e)},this.emitChanged()},this.updateJob=e=>{const t=this.state.jobs.filter((t=>t.jobId!==e.jobId));t.push(e),this.state=Object.assign(Object.assign({},this.state),{jobs:this._sortJobs(t)}),this.emitChanged()}}_sortJobs(e){return e.sort(((e,t)=>t.jobId-e.jobId))}}t[e].MaintenanceJobStore=s}("StoresMaintenanceJobsStore"),function(e){At=t[e]={};class s extends p.Store{constructor(){super("MaintenanceStoreChanged"),this.state={maintenanceDefinitions:[],validTimeZones:[],status:0},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()},this.updateMaintenanceDefinitions=e=>{this.state=Object.assign(Object.assign({},this.state),{status:2,maintenanceDefinitions:e}),this.emitChanged()},this.updateValidTimeZones=e=>{this.state=Object.assign(Object.assign({},this.state),{validTimeZones:e}),this.emitChanged()},this.addMaintenanceDefinition=e=>{0===this.state.maintenanceDefinitions.length?(this.state=Object.assign(Object.assign({},this.state),{maintenanceDefinitions:[e]}),this.emitChanged()):this.updateMaintenanceDefinition(e)},this.updateMaintenanceDefinition=e=>{const t=this.state.maintenanceDefinitions.filter((t=>t.id!==e.id));t.unshift(e),this.state=Object.assign(Object.assign({},this.state),{maintenanceDefinitions:t}),this.emitChanged()}}getMaintenanceDefinition(e){if(this.state.maintenanceDefinitions.length>0){return this.state.maintenanceDefinitions.filter((t=>t.id===e))[0]}}}t[e].MaintenanceStore=s}("StoresMaintenanceStore"),function(e){_t=t[e]={};class s extends p.Store{constructor(){super("PoolAnalyticsStoreChanged"),this._publicState={},this._privateState={},this._onErrorPublic=e=>{const t=(0,S.extractODataError)(e);this._publicState.errorText=t,this.emitChanged()},this._onErrorPrivate=e=>{const t=(0,S.extractODataError)(e);this._privateState.errorText=t,this.emitChanged()},this._onUpdateConfiguration=e=>{this._publicState.confValues&&b.ConfigurationUtility.areConfValuesEqual(this._publicState.confValues,e)||(this._publicState.errorText=void 0,this._publicState.data=void 0,this._publicState.confValues=Object.assign({},e),this.emitChanged()),this._privateState.confValues&&b.ConfigurationUtility.areConfValuesEqual(this._privateState.confValues,e)||(this._privateState.errorText=void 0,this._privateState.data=void 0,this._privateState.confValues=Object.assign({},e),this.emitChanged())},this._onUpdatePublicData=e=>{e&&(this._publicState.errorText=void 0,this._publicState.data=e,this.emitChanged())},this._onUpdatePrivateData=e=>{e&&(this._privateState.errorText=void 0,this._privateState.data=e,this.emitChanged())}}getPublicTrendState(){return this._publicState}getPrivateTrendState(){return this._privateState}}t[e].PoolAnalyticsStore=s}("StoresPoolAnalyticsStore"),function(e){vt=t[e]={};class s extends p.Store{constructor(){super("SecurityStoreChanged"),this.state={hasManageQueuePermission:!1,hasManagePoolPermission:!1,hasManageAllQueuesPermission:!1,hasManageAllPoolsPermission:!1,pipelinesAuthorizedForQueue:!1,status:0},this.updateStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{status:e}),this.emitChanged()},this.updateManageQueuePermission=e=>{this.state=Object.assign(Object.assign({},this.state),{hasManageQueuePermission:e}),this.emitChanged()},this.updateManagePoolPermission=e=>{this.state=Object.assign(Object.assign({},this.state),{hasManagePoolPermission:e}),this.emitChanged()},this.updateManageAllQueuesPermission=e=>{this.state=Object.assign(Object.assign({},this.state),{hasManageAllQueuesPermission:e}),this.emitChanged()},this.updateManageAllPoolsPermission=e=>{this.state=Object.assign(Object.assign({},this.state),{hasManageAllPoolsPermission:e}),this.emitChanged()},this.updatePipelinesAuthorizedForQueue=e=>{this.state=Object.assign(Object.assign({},this.state),{pipelinesAuthorizedForQueue:e,status:2}),this.emitChanged()}}}t[e].SecurityStore=s}("StoresSecurityStore"),function(e){yt=t[e]={};class s extends p.Store{constructor(){super("SelectionStoreChanged"),this.state={selectedAgentPool:void 0,selectedAgentQueue:void 0,selectedElasticPool:void 0,selectedServiceEndpoint:void 0,selectedVirtualMachineScaleSet:void 0,selectedTabId:g.PoolHubViewKeys.Jobs},this.updateSelectedAgentPool=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedAgentPool:e}),this.emitChanged()},this.updateSelectedAgentQueue=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedAgentQueue:e}),this.emitChanged()},this.updateSelectedElasticPool=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedElasticPool:e}),this.emitChanged()},this.updateSelectedServiceEndpoint=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedServiceEndpoint:e}),this.emitChanged()},this.updateSelectedVirtualMachineScaleSet=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedVirtualMachineScaleSet:e}),this.emitChanged()},this.updateSelectedTab=e=>{this.state=Object.assign(Object.assign({},this.state),{selectedTabId:e}),this.emitChanged()}}}t[e].SelectionStore=s}("StoresSelectionStore"),function(e){Dt=t[e]={};class s extends p.Store{constructor(){super("TopPipelinesStoreChanged"),this._state={},this._onError=e=>{const t=(0,S.extractODataError)(e);this._state.errorText=t,this.emitChanged()},this._onUpdateData=e=>{e&&(this._state.errorText=void 0,this._state.data=e,this.emitChanged())}}getConsumptionState(){return this._state}}t[e].TopPipelinesStore=s}("StoresTopPipelinesStore"),function(e){ft=t[e]={};t[e].StoresHub=class{constructor(e){this.agentStore=new pt.AgentStore,e.agentsUpdated.addListener(this.agentStore.updateAgents),e.agentActions.agentUpdated.addListener(this.agentStore.updateAgent),e.agentDeleted.addListener(this.agentStore.agentDeleted),e.agentActions.agentStatusUpdated.addListener((e=>this.agentStore.updateAgentStatus(e.agentId,e.status))),e.jobActions.jobUpdated.addListener(this.agentStore.updateAssignedJobRequest),this.agentDefinitionStore=new P.AgentDefinitionStore,e.agentDefinitionsUpdated.addListener(this.agentDefinitionStore.updateAgentDefinitions),this.confirmationDialogStore=new A.ConfirmationDialogStore,e.confirmationDialogActions.showConfirmationDialog.addListener(this.confirmationDialogStore.showDialog),e.confirmationDialogActions.dismissConfirmationDialog.addListener(this.confirmationDialogStore.dismissDialog),this.descriptionStore=new mt.DescriptionStore,e.agentPoolDescriptionUpdated.addListener(this.descriptionStore.updateAgentPoolDescription),e.descriptionStoreStatusUpdated.addListener(this.descriptionStore.updateStatus),this.downloadAgentDialogStore=new St.DownloadAgentDialogStore,e.dismissDownloadAgentDialog.addListener(this.downloadAgentDialogStore.dismissDialog),e.showDownloadAgentDialog.addListener(this.downloadAgentDialogStore.showDialog),this.elasticNodeStore=new bt.ElasticNodeStore,e.elasticNodesUpdated.addListener(this.elasticNodeStore.updateElasticNodes),e.elasticNodeUpdated.addListener(this.elasticNodeStore.updateElasticNode),e.elasticNodeStoreStatusUpdated.addListener(this.elasticNodeStore.updateStatus),this.elasticPoolLogStore=new Ct.ElasticPoolLogStore,e.elasticPoolLogsUpdated.addListener(this.elasticPoolLogStore.updateElasticPoolLogs),e.elasticPoolLogStoreStatusUpdated.addListener(this.elasticPoolLogStore.updateStatus),this.jobStore=new _.JobStore,e.jobActions.jobUpdated.addListener(this.jobStore.updateJob),e.jobActions.jobsUpdated.addListener(this.jobStore.updateJobs),this.maintenanceStore=new At.MaintenanceStore,e.maintenanceDefinitionAdded.addListener(this.maintenanceStore.addMaintenanceDefinition),e.maintenanceDefinitionUpdated.addListener(this.maintenanceStore.updateMaintenanceDefinition),e.maintenanceDefinitionsUpdated.addListener(this.maintenanceStore.updateMaintenanceDefinitions),e.maintenanceStoreStatusUpdated.addListener(this.maintenanceStore.updateStatus),e.maintenanceTimeZonesUpdated.addListener(this.maintenanceStore.updateValidTimeZones),this.maintenanceJobStore=new Pt.MaintenanceJobStore,e.maintenanceJobUpdated.addListener(this.maintenanceJobStore.updateJob),e.maintenanceJobsUpdated.addListener(this.maintenanceJobStore.updateJobs),e.maintenanceJobsStoreStatusUpdated.addListener(this.maintenanceJobStore.updateStatus),this.notificationStore=new v.NotificationStore,e.notificationActions.addNotification.addListener(this.notificationStore.addNotification),e.notificationActions.dismissNotification.addListener(this.notificationStore.dismissNotification),e.notificationActions.clearNotifications.addListener(this.notificationStore.clearNotifications),this.projectStore=new y.ProjectStore,e.projectActions.projectsUpdated.addListener(this.projectStore.updateProjects),this.resourceLimitStore=new D.ResourceLimitStore,e.resourceLimitActions.resourceLimitsUpdated.addListener(this.resourceLimitStore.resourceLimitsUpdated),e.resourceLimitActions.resourceLimitsStatusUpdated.addListener(this.resourceLimitStore.resourceLimitsStatusUpdated),this.securityStore=new vt.SecurityStore,e.securityStoreStatusUpdated.addListener(this.securityStore.updateStatus),e.manageQueuePermissionUpdated.addListener(this.securityStore.updateManageQueuePermission),e.managePoolPermissionUpdated.addListener(this.securityStore.updateManagePoolPermission),e.manageAllQueuesPermissionUpdated.addListener(this.securityStore.updateManageAllQueuesPermission),e.manageAllPoolsPermissionUpdated.addListener(this.securityStore.updateManageAllPoolsPermission),e.agentQueuePipelinesAuthorizedUpdated.addListener(this.securityStore.updatePipelinesAuthorizedForQueue),this.selectionStore=new yt.SelectionStore,e.selectedAgentPoolUpdated.addListener(this.selectionStore.updateSelectedAgentPool),e.selectedAgentQueueUpdated.addListener(this.selectionStore.updateSelectedAgentQueue),e.selectedElasticPoolUpdated.addListener(this.selectionStore.updateSelectedElasticPool),e.selectedServiceEndpointUpdated.addListener(this.selectionStore.updateSelectedServiceEndpoint),e.selectedVirtualMachineScaleSetUpdated.addListener(this.selectionStore.updateSelectedVirtualMachineScaleSet),e.selectedTabUpdated.addListener(this.selectionStore.updateSelectedTab),this.serviceEndpointStore=new f.ServiceEndpointStore,e.serviceEndpointActions.azureSubscriptionsUpdated.addListener(this.serviceEndpointStore.updateAzureSubscriptions),e.serviceEndpointActions.azureSubscriptionsStatusUpdated.addListener(this.serviceEndpointStore.updateAzureSubscriptionsStatus),e.serviceEndpointActions.serviceEndpointsUpdated.addListener((e=>this.serviceEndpointStore.updateServiceEndpoints(e.serviceEndpointScope,e.serviceEndpoints))),e.serviceEndpointActions.serviceEndpointsStatusUpdated.addListener(this.serviceEndpointStore.updateServiceEndpointStatus),e.serviceEndpointActions.serviceEndpointAuthorized.addListener(this.serviceEndpointStore.serviceEndpointAuthorized),this.signalRStore=new E.SignalRStore,e.signalRActions.signalRStateUpdated.addListener(this.signalRStore.updateSignalRState),this.virtualMachineScaleSetStore=new T.VirtualMachineScaleSetStore,e.serviceEndpointActions.virtualMachineScaleSetsUpdated.addListener(this.virtualMachineScaleSetStore.updateVirtualMachineScaleSets),e.serviceEndpointActions.virtualMachineScaleSetsErrorUpdated.addListener(this.virtualMachineScaleSetStore.updateVirtualMachineScaleSetsError),e.serviceEndpointActions.virtualMachineScaleSetsStatusUpdated.addListener(this.virtualMachineScaleSetStore.updateVirtualMachineScaleSetsStatus),this.poolAnalyticsStore=new _t.PoolAnalyticsStore,e.updateConfigurationValuesAction.addListener(this.poolAnalyticsStore._onUpdateConfiguration),e.updatePublicDataAction.addListener(this.poolAnalyticsStore._onUpdatePublicData),e.updatePrivateDataAction.addListener(this.poolAnalyticsStore._onUpdatePrivateData),e.onPrivateTrendError.addListener(this.poolAnalyticsStore._onErrorPrivate),e.onPublicTrendError.addListener(this.poolAnalyticsStore._onErrorPublic),this.topPipelinesStore=new Dt.TopPipelinesStore,e.onPipelineConsumptionError.addListener(this.topPipelinesStore._onError),e.updateTopFivePipelinesAction.addListener(this.topPipelinesStore._onUpdateData),this.checksStore=new C.ChecksStore,e.checksStoreStatusUpdated.addListener(this.checksStore.updateStatus)}}}("StoresStoresHub"),function(e){Et=t[e]={};const s=g.PoolHubViewKeys.Jobs;t[e].PoolActionCreator=class{constructor(e){this._actionsHub=e.actionsHub,this._agentPoolSource=e.agentPoolSource,this._agentQueueSource=e.agentQueueSource,this._agentSource=e.agentSource,this._agentDefinitionSource=e.agentDefinitionSource,this._elasticPoolSource=e.elasticPoolSource,this._jobSource=e.jobSource,this._securitySource=e.securitySource,this._serviceEndpointSource=e.serviceEndpointSource,this._storesHub=e.storesHub,this._pageContext=e.pageContext,this.confirmationDialogActionCreator=new w.ConfirmationDialogActionCreator({confirmationDialogActions:this._actionsHub.confirmationDialogActions}),this.navigationActionCreator=new x.NavigationActionCreator({pageContext:e.pageContext}),this.notificationActionCreator=new H.NotificationActionCreator({notificationActions:this._actionsHub.notificationActions}),this.projectActionCreator=new L.ProjectActionCreator({pageContext:e.pageContext,projectActions:this._actionsHub.projectActions}),this.resourceLimitActionCreator=new I.ResourceLimitActionCreator({pageContext:e.pageContext,agentPoolSource:this._agentPoolSource,resourceLimitActions:this._actionsHub.resourceLimitActions,resourceLimitStore:this._storesHub.resourceLimitStore}),this.serviceEndpointActionCreator=new U.ServiceEndpointActionCreator({pageContext:e.pageContext,notificationActionCreator:this.notificationActionCreator,serviceEndpointActions:this._actionsHub.serviceEndpointActions,serviceEndpointSource:this._serviceEndpointSource,serviceEndpointStore:this._storesHub.serviceEndpointStore})}dispose(){this.projectActionCreator.dispose()}initializePool(){const e=this._agentQueueSource.getCachedSelectedAgentQueue(),t=this._agentPoolSource.getCachedSelectedAgentPool(),i=this._elasticPoolSource.getCachedSelectedElasticPoolData();let o=this.navigationActionCreator.getTabIdParam();if(t){this._actionsHub.selectedAgentQueueUpdated.invoke(e),this._actionsHub.selectedAgentPoolUpdated.invoke(t),i&&(this._actionsHub.selectedElasticPoolUpdated.invoke(i.elasticPool),this._actionsHub.selectedServiceEndpointUpdated.invoke(i.serviceEndpoint),this._actionsHub.selectedVirtualMachineScaleSetUpdated.invoke(i.virtualMachineScaleSet),i.elasticPool&&1===i.elasticPool.state&&this.notificationActionCreator.addNotification(ct.ElasticPoolOffline,v.NotificationType.error,[{text:ct.Settings,onClick:()=>this.updateSelectedTab(g.PoolHubViewKeys.Settings)}])),o&&this._validateTabIdParam(o,t)?this._actionsHub.selectedTabUpdated.invoke(o):(o=s,this._actionsHub.selectedTabUpdated.invoke(s));const n=e?e.id:void 0;this.navigationActionCreator.replaceQueryParameters(n,t.id,o,void 0),this.projectActionCreator.initializeProjects();const a=this._jobSource.getCachedJobs();this._actionsHub.jobActions.jobsUpdated.invoke(a);const r=this._agentPoolSource.getCachedAgentPoolAgents();this._actionsHub.agentsUpdated.invoke(r);const l=this._agentDefinitionSource.getCachedAgentDefinitions();this._actionsHub.agentDefinitionsUpdated.invoke(l),this._fetchSecurityData(t.id,e?e.id:void 0),this._fetchTabData(o,t.id,e?e.id:t.id)}}dismissDownloadAgentDialog(){this._actionsHub.dismissDownloadAgentDialog.invoke()}showDownloadAgentDialog(){this._actionsHub.showDownloadAgentDialog.invoke()}updateSelectedTab(e){const t=this._storesHub.selectionStore.state.selectedAgentPool,s=this._storesHub.selectionStore.state.selectedAgentQueue;t&&this._validateTabIdParam(e,this._storesHub.selectionStore.state.selectedAgentPool)&&e!==this._storesHub.selectionStore.state.selectedTabId&&(this.navigationActionCreator.setTabIdParam(e),this._fetchTabData(e,t.id,s?s.id:t.id),this._actionsHub.selectedTabUpdated.invoke(e))}enableAgent(e,t,s){const i=Object.assign(Object.assign({},e),{enabled:s});this._actionsHub.agentActions.agentUpdated.invoke(i),this._agentSource.updateAgent({id:e.id,enabled:s},t).then((e=>{this._actionsHub.agentActions.agentUpdated.invoke(e)}),(t=>{this._actionsHub.agentActions.agentUpdated.invoke(e),this._handleError(t)}))}deleteAgent(e,t){this._agentSource.deleteAgent(e,t).then((()=>{this._actionsHub.agentDeleted.invoke(e)}),(e=>{this._handleError(e)}))}getAgentData(e,t){this._agentSource.getAgent(e,t).then((e=>{this._actionsHub.agentActions.agentUpdated.invoke(e)}),(e=>{this._handleError(e)}))}getRequestData(e,t){this._jobSource.getAgentRequest(e,t,!0).then((e=>{this._actionsHub.jobActions.jobUpdated.invoke(e)}),(e=>{this._handleError(e)}))}pushAllAgentsUpdateRequest(e){this._agentPoolSource.refreshAgents(e).catch((e=>{this._handleError(e)}))}pushAgentUpdateRequest(e,t){this._agentSource.refreshAgent(t,e).catch((e=>{this._handleError(e)}))}setPipelinesAuthorizedForQueue(e,t){const s=this._storesHub.securityStore.state.pipelinesAuthorizedForQueue;this._actionsHub.agentQueuePipelinesAuthorizedUpdated.invoke(t),this._securitySource.setPipelinesAuthorizedForQueue(e,t).then((e=>{this._actionsHub.agentQueuePipelinesAuthorizedUpdated.invoke(e)}),(e=>{this._actionsHub.agentQueuePipelinesAuthorizedUpdated.invoke(s),this._handleError(e)}))}setPoolAutoProvisioning(e){const t=this._storesHub.selectionStore.state.selectedAgentPool;if(t){const s=Object.assign(Object.assign({},t),{autoProvision:e});this._actionsHub.selectedAgentPoolUpdated.invoke(s),this._agentPoolSource.updateAgentPool({id:t.id,autoProvision:e}).then((e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(e)}),(e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(t),this._handleError(e)}))}}setPoolAutoUpdate(e){const t=this._storesHub.selectionStore.state.selectedAgentPool;if(t){const s=Object.assign(Object.assign({},t),{autoUpdate:e});this._actionsHub.selectedAgentPoolUpdated.invoke(s),this._agentPoolSource.updateAgentPool({id:t.id,autoUpdate:e}).then((e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(e)}),(e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(t),this._handleError(e)}))}}setPoolOwner(e){const t=this._storesHub.selectionStore.state.selectedAgentPool;if(t&&e.subjectDescriptor){const s={displayName:e.displayName?e.displayName:"",descriptor:e.subjectDescriptor,imageUrl:e.image?e.image:""},i=Object.assign(Object.assign({},t),{owner:s});this._actionsHub.selectedAgentPoolUpdated.invoke(i),this._agentPoolSource.updateAgentPool({id:t.id,owner:s}).then((e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(e)}),(e=>{this._actionsHub.selectedAgentPoolUpdated.invoke(t),this._handleError(e)}))}}setAgentPoolDescription(e,t){if(2===this._storesHub.descriptionStore.state.status){const s=this._storesHub.descriptionStore.state.description;this._actionsHub.agentPoolDescriptionUpdated.invoke(t),this._agentPoolSource.setAgentPoolMetadata(e.id,t).then(void 0,(e=>{this._actionsHub.agentPoolDescriptionUpdated.invoke(s),this._handleError(e)}))}}createOrUpdateMaintenanceDefinition(e,t){e.id<=0?this._agentPoolSource.createMaintenanceDefinition(e,t).then((e=>{this._actionsHub.maintenanceDefinitionAdded.invoke(e)}),(e=>{this._handleError(e)})):this._agentPoolSource.updateMaintenanceDefinition(e,t).then((e=>{this._actionsHub.maintenanceDefinitionUpdated.invoke(e)}),(e=>{this._handleError(e)}))}updateElasticPoolSettings(e,t,s,i,o,n){const a=this._storesHub.selectionStore.state.selectedElasticPool;if(a){const r=Object.assign(Object.assign({},a),{recycleAfterEachUse:e,maxSavedNodeCount:t,maxCapacity:s,desiredIdle:i,timeToLiveMinutes:o,agentInteractiveUI:n});this._actionsHub.selectedElasticPoolUpdated.invoke(r),this._elasticPoolSource.updateElasticPoolAsync(a.poolId,{recycleAfterEachUse:e,maxSavedNodeCount:t,maxCapacity:s,desiredIdle:i,timeToLiveMinutes:o,agentInteractiveUI:n}).then((e=>{this._actionsHub.selectedElasticPoolUpdated.invoke(e)}),(e=>{this._actionsHub.selectedElasticPoolUpdated.invoke(a),this._handleError(e)}))}}updateElasticPoolAzureSubscriptionSettings(e,t,s){const i=this._storesHub.selectionStore.state.selectedElasticPool,o=this._storesHub.selectionStore.state.selectedServiceEndpoint,n=this._storesHub.selectionStore.state.selectedVirtualMachineScaleSet;if(i){const a=(0,k.getVMScaleSetOSType)(s),r=Object.assign(Object.assign({},i),{serviceEndpointId:t.id,serviceEndpointScope:e,azureId:s.id,osType:a});this._actionsHub.selectedElasticPoolUpdated.invoke(r),this._actionsHub.selectedServiceEndpointUpdated.invoke(t),this._actionsHub.selectedVirtualMachineScaleSetUpdated.invoke(s),this._elasticPoolSource.updateElasticPoolAsync(i.poolId,{serviceEndpointId:t.id,serviceEndpointScope:e,azureId:s.id,osType:a}).then((e=>{this._actionsHub.selectedElasticPoolUpdated.invoke(e),e.serviceEndpointId===(null==o?void 0:o.id)&&this._actionsHub.selectedServiceEndpointUpdated.invoke(o),e.azureId===(null==n?void 0:n.id)&&this._actionsHub.selectedVirtualMachineScaleSetUpdated.invoke(n)}),(e=>{this._actionsHub.selectedElasticPoolUpdated.invoke(i),this._actionsHub.selectedServiceEndpointUpdated.invoke(o),this._actionsHub.selectedVirtualMachineScaleSetUpdated.invoke(n),this._handleError(e)}))}}deleteElasticNode(e){const t=this._storesHub.elasticNodeStore.state.elasticNodes.filter((t=>t.id===e.id))[0];if(t&&9===t.state){const s=Object.assign(Object.assign({},t),{state:8});this._actionsHub.elasticNodeUpdated.invoke(s),this._elasticPoolSource.updateElasticNodeAsync(e.poolId,e.id,{state:8}).then((e=>{this._actionsHub.elasticNodeUpdated.invoke(e)}),(e=>{this._actionsHub.elasticNodeUpdated.invoke(t),this._handleError(e)}))}}_fetchTabData(e,t,s){if(t)switch(e){case g.PoolHubViewKeys.Details:this._fetchAgentPoolDescription(t);break;case g.PoolHubViewKeys.Diagnostics:this._fetchPoolDiagnostics(t),this._fetchElasticNodes(t,9);break;case g.PoolHubViewKeys.MaintenanceHistory:this._fetchMaintenanceJobs(t);break;case g.PoolHubViewKeys.Security:break;case g.PoolHubViewKeys.Settings:this._actionsHub.maintenanceTimeZonesUpdated.invoke(this._agentPoolSource.getCachedValidTimezones()),this._fetchMaintenanceDefinitions(t),this.resourceLimitActionCreator.fetchResourceLimits();break;case g.PoolHubViewKeys.Agents:case g.PoolHubViewKeys.Jobs:case g.PoolHubViewKeys.Checks:s&&this._fetchCheckData(s);default:return}}_fetchAgentPoolDescription(e){0===this._storesHub.descriptionStore.state.status&&(this._actionsHub.descriptionStoreStatusUpdated.invoke(1),this._agentPoolSource.getAgentPoolMetadata(e).then((e=>{this._actionsHub.agentPoolDescriptionUpdated.invoke(e)}),(e=>{e&&e.message&&(e.status&&404===e.status||(0,m.caseInsensitiveContains)(e.message,"not found")||this._handleError(e)),this._actionsHub.agentPoolDescriptionUpdated.invoke("")})))}_fetchSecurityData(e,t){if(0===this._storesHub.securityStore.state.status){this._actionsHub.securityStoreStatusUpdated.invoke(1);if(this._pageContext.getService("IProjectDataService").hasProjectData()&&t){const s=this._securitySource.hasAgentQueuePermission(t,g.Permission.Manage);this._actionsHub.manageQueuePermissionUpdated.invoke(s);const i=this._securitySource.hasAgentPoolPermission(e,g.Permission.Manage);this._actionsHub.managePoolPermissionUpdated.invoke(i);const o=this._securitySource.hasAllAgentQueuesPermission(g.Permission.Manage);this._actionsHub.manageAllQueuesPermissionUpdated.invoke(o);const n=this._securitySource.hasAllAgentPoolsPermission(g.Permission.Manage);this._actionsHub.manageAllPoolsPermissionUpdated.invoke(n),this._securitySource.getPipelinesAuthorizedForQueue(t).then((e=>{this._actionsHub.agentQueuePipelinesAuthorizedUpdated.invoke(e)}),(e=>{this._handleError(e)}))}else{const t=this._securitySource.hasAgentPoolPermission(e,g.Permission.Manage);this._actionsHub.managePoolPermissionUpdated.invoke(t),this._actionsHub.agentQueuePipelinesAuthorizedUpdated.invoke(!1)}}}_fetchMaintenanceDefinitions(e){0===this._storesHub.maintenanceStore.state.status&&(this._actionsHub.maintenanceStoreStatusUpdated.invoke(1),this._agentPoolSource.getMaintenanceDefinitions(e).then((e=>{this._actionsHub.maintenanceDefinitionsUpdated.invoke(e)}),(e=>{this._handleError(e),this._actionsHub.maintenanceDefinitionsUpdated.invoke([])})))}_fetchMaintenanceJobs(e){0===this._storesHub.maintenanceJobStore.state.status&&(this._actionsHub.maintenanceJobsStoreStatusUpdated.invoke(1),this._jobSource.getAgentPoolMaintenanceJobs(e).then((e=>{this._actionsHub.maintenanceJobsUpdated.invoke(e)}),(e=>{this._handleError(e),this._actionsHub.maintenanceJobsUpdated.invoke([])})))}_fetchPoolDiagnostics(e){0===this._storesHub.elasticPoolLogStore.state.status&&(this._actionsHub.elasticPoolLogStoreStatusUpdated.invoke(1),this._elasticPoolSource.getElasticPoolLogsAsync({poolId:e}).then((e=>{this._actionsHub.elasticPoolLogsUpdated.invoke(e)}),(e=>{this._handleError(e),this._actionsHub.elasticPoolLogsUpdated.invoke([])})))}_fetchElasticNodes(e,t){0===this._storesHub.elasticNodeStore.state.status&&(this._actionsHub.elasticNodeStoreStatusUpdated.invoke(1),this._elasticPoolSource.getElasticNodesAsync({poolId:e},t).then((e=>{this._actionsHub.elasticNodesUpdated.invoke(e)}),(e=>{this._handleError(e),this._actionsHub.elasticNodesUpdated.invoke([])})))}_fetchCheckData(e){if(0===this._storesHub.checksStore.state.status){this._actionsHub.checksStoreStatusUpdated.invoke(1);this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-pipelinechecks.checks-data-provider",{queueId:e},!0).then((()=>this._actionsHub.checksStoreStatusUpdated.invoke(2))).catch(this._handleError)}}_validateTabIdParam(e,t){return!(e===g.PoolHubViewKeys.Agents&&!(0,M.showPoolAgents)(t))&&(!(e===g.PoolHubViewKeys.Diagnostics&&!(0,M.isElastic)(t))&&(e===g.PoolHubViewKeys.Details||e===g.PoolHubViewKeys.Jobs||e===g.PoolHubViewKeys.Security||e===g.PoolHubViewKeys.Agents||e===g.PoolHubViewKeys.Settings||e===g.PoolHubViewKeys.MaintenanceHistory||e===g.PoolHubViewKeys.Diagnostics||e===g.PoolHubViewKeys.Analytics||e===g.PoolHubViewKeys.Checks))}_handleError(e){if(e&&e.message){this.notificationActionCreator.addNotification(e.message,v.NotificationType.error);this._pageContext.getService("IVssTelemetryService").publishEvent(g.Telemetry.Area,g.Telemetry.PoolsAdminFeature,{message:e.message,error:e})}}}}("ActionsPoolActionCreator"),function(e){Tt=t[e]={};class s extends R.AnalyticsODataClientBase{constructor(e,t){super(e,t)}async _queryPublicPoolTrendData(e,t,s){return await this._queryPoolTrendData(e,t,s,dt.Visibility.Public)}async _queryPrivatePoolTrendData(e,t,s){return await this._queryPoolTrendData(e,t,s,dt.Visibility.Private)}async _queryPoolTrendData(e,t,s,i){const o={primaryChartData:{[dt.PoolDataStrings.RunningJobs]:[],[dt.PoolDataStrings.Concurrency]:[]},secondaryChartData:[],confValues:e},n=this._getTaskAgentRequestsQueryOptions(e,t,s,i,!0),a=await this.queryOData(n),r=[];a.value.forEach((t=>{const s=e.trendBy===j.TrendBy.Hours?this._convertSamplingHourToTimeString(t.SamplingHour):N.DateSKParser.parseDateSKAsDateString(t.SamplingDateSK);r.push({data:t.MaxCount,date:s})})),o.primaryChartData[dt.PoolDataStrings.RunningJobs]=this._adjustData(r,e.trendBy,e.period,0).map((e=>({aggrValue:e.data,date:e.date})));const l=this._getTaskAgentRequestsQueryOptions(e,t,s,i,!1),c=await this.queryOData(l),d=[];c.value.forEach((t=>{const s=e.trendBy===j.TrendBy.Hours?this._convertSamplingHourToTimeString(t.SamplingHour):N.DateSKParser.parseDateSKAsDateString(t.SamplingDateSK);d.push({data:t.MaxCount,date:s})})),o.primaryChartData[dt.PoolDataStrings.QueuedJobs]=this._adjustData(d,e.trendBy,e.period,0).map((e=>({aggrValue:e.data,date:e.date})));const u=this._getConcurrencyQueryOptions(e,t,s,i),h=await this.queryOData(u);let g=[];return h.value.forEach((t=>{g.push({data:s||i===dt.Visibility.Private?t.TotalCount:t.OnlineCount,date:e.trendBy===j.TrendBy.Hours?this._convertSamplingHourToTimeString(new Date(t.SamplingDate).getHours()):(0,O.convertDateToDateString)(new Date(t.SamplingDate))})})),g=this._adjustData(g,e.trendBy,e.period,-1),o.primaryChartData[dt.PoolDataStrings.Concurrency]=g.map(((e,t)=>{if(null==e.data||-1===e.data){const s=t-1,i=g[s];let o=g.slice(t+1).findIndex((e=>null!==e.data&&-1!==e.data));-1!==o&&(o+=t+1);const n=g[o];n&&n.data&&-1!==n.data?i&&i.data&&-1!==i.data?e.data=i.data+(n.data-i.data)/(o-s):e.data=n.data:i&&i.data&&-1!==i.data?e.data=i.data:e.data=0}return{aggrValue:e.data,date:e.date}})),o}_getTaskAgentRequestsQueryOptions(e,t,s,o,n){const a={entityType:i,oDataVersion:"v4.0-preview"};try{const e=super._getProjectId();a.project=e}catch(e){}const r=this._getTaskAgentRequestsFilter(e,t,s,o,n);let l=this._getTaskAgentRequestsInitialGrouping();return l+=`groupby((${this._getTaskAgentRequestsGrouping(e.trendBy)}),`,l+=`aggregate(${this._getTaskAgentRequestsAggregation()}))`,a.$apply=`${r}/${l}`,a.$orderby="SamplingDateSK asc ",a}_getTaskAgentRequestsInitialGrouping(){return"groupby((SamplingDateSK, SamplingHour, SamplingTime), aggregate($count as Count))/"}_getTaskAgentRequestsGrouping(e){return e==j.TrendBy.Hours?"SamplingDateSK, SamplingHour":"SamplingDateSK"}_getTaskAgentRequestsAggregation(){return"Count with max as MaxCount"}_getTaskAgentRequestsFilter(e,t,s,i,o){let n=`${(0,V.getDateFilter)(e.trendBy,e.period,"SamplingDateSK")}`;const a=(0,V.getLookBackDate)(e.trendBy,e.period),r=N.DateSKParser.dateStringToDateSK(N.DateSKParser.convertDateToDateString(a));let l;return e.trendBy===j.TrendBy.Hours&&(n=`((${n} AND SamplingHour gt ${a.getHours()}) OR SamplingDateSK gt ${r})`),l=s||i===dt.Visibility.Private?`AND Project/ProjectVisibility ${i===dt.Visibility.Public?"eq":"ne"} '${dt.Visibility.Public}' AND IsRunning eq ${o} AND IsHosted eq ${s}`:`AND PoolId eq ${t} AND IsRunning eq ${o}`,`filter(${n} ${l})`}_getConcurrencyQueryOptions(e,t,s,i){const a={entityType:s||i===dt.Visibility.Private?o:n,oDataVersion:"v4.0-preview"},r=(0,V.getLookBackDate)(e.trendBy,e.period);return s||i===dt.Visibility.Private?a.$apply=`filter(SamplingDate ge ${N.DateSKParser.convertDateToDateString(r)} AND IsHosted eq ${s} AND ParallelismTag ${i===dt.Visibility.Public?"eq":"ne"} '${dt.Visibility.Public}')`:a.$apply=`filter(SamplingDate ge ${N.DateSKParser.convertDateToDateString(r)} AND PoolId eq ${t})`,a.$orderby="SamplingDate asc",a}_convertSamplingHourToTimeString(e){return`${e||0}:00`}_adjustData(e,t,s,i){return t===j.TrendBy.Hours?this._adjustDataForHours(e,i):(0,V.adjustDataForAllPeriod)(e,t,s,i)}_adjustDataForHours(e,t){if(!e)return e;const s={},i={};e.forEach((e=>{s[e.date]||(s[e.date]=e.data,i[e.date]=e.customData)}));let o=new Date;o=(0,O.addDays)((0,O.getDate)(),-1,!0),o.setHours(o.getHours()+1,0,0,0);const n=[];for(let e=0;e<24;e++){let e=this._convertSamplingHourToTimeString(o.getHours());s.hasOwnProperty(e)?n.push({date:e,data:s[e],customData:i[e]}):n.push({date:e,data:t}),o.setHours(o.getHours()+1)}return n}}t[e].PoolAnalyticsSource=s;const i="TaskAgentRequestSnapshots",o="ParallelPipelineJobsSnapshot",n="TaskAgentPoolSizeSnapshots"}("SourcesPoolAnalyticsSource"),function(e){wt=t[e]={};t[e].PoolGraphActionsCreator=class{constructor(e){this._actionsHub=e.actionsHub,this._storesHub=e.storesHub,this._poolAnalyticsSource=e.poolAnalyticsSource}updateConfigurationValues(e){return this._actionsHub.updateConfigurationValuesAction.invoke(e),[this._updatePublicTrendChart(e),this._updatePrivateTrendChart(e)]}async _updatePublicTrendChart(e){if(this._storesHub.selectionStore.state.selectedAgentPool){const t=this._storesHub.selectionStore.state.selectedAgentPool.id,s=this._storesHub.selectionStore.state.selectedAgentPool.isHosted;try{const i=await this._poolAnalyticsSource._queryPublicPoolTrendData(e,t,s);this._actionsHub.updatePublicDataAction.invoke(i)}catch(e){return this._actionsHub.onPublicTrendError.invoke(e),Promise.reject(e)}}}async _updatePrivateTrendChart(e){if(this._storesHub.selectionStore.state.selectedAgentPool){const t=this._storesHub.selectionStore.state.selectedAgentPool.id,s=this._storesHub.selectionStore.state.selectedAgentPool.isHosted;try{const i=await this._poolAnalyticsSource._queryPrivatePoolTrendData(e,t,s);this._actionsHub.updatePrivateDataAction.invoke(i)}catch(e){return this._actionsHub.onPrivateTrendError.invoke(e),Promise.reject(e)}}}}}("ActionsPoolGraphActionCreator"),function(e){xt=t[e]={},t[e].ConcurrencyColorPalette="#a6a6a6",t[e].RunningJobsColorPalette="#0078d4",t[e].QueuedJobsColorPalette="#f58b1f",t[e].TopPipelinesColorPalette="#6b4c9a",t[e].PoolGraphGradientColorPalette="#000000"}("Colors"),function(e){Ht=t[e]={};class s extends F.ChartSeries{get name(){return ct.Concurrency}get color(){return xt.ConcurrencyColorPalette}get values(){return B.formatData(this._data)}}t[e].ConcurrencySeries=s}("ComponentsConcurrencySeries"),function(e){Lt=t[e]={};class s extends F.ChartSeries{get name(){return ct.QueuedJobs}get color(){return xt.QueuedJobsColorPalette}get values(){return B.formatData(this._data)}}t[e].QueuedJobsSeries=s}("ComponentsQueuedJobsSeries"),function(e){It=t[e]={};class s extends F.ChartSeries{get name(){return ct.RunningJobs}get color(){return xt.RunningJobsColorPalette}get values(){return B.formatData(this._data)}}t[e].RunningJobsSeries=s}("ComponentsRunningJobsSeries"),function(e){t[e]={};class s extends F.ChartSeries{get name(){return ct.TopFivePipelines}get color(){return xt.TopPipelinesColorPalette}get values(){return B.formatData(this._data)}}t[e].TopPipelinesSeries=s}("ComponentsTopPipelinesSeries"),function(e){Ut=t[e]={};t[e].Flux=class{constructor(e){this.actionsHub=new ut.ActionsHub,this.agentSource=new ht.AgentSource(e),this.agentPoolSource=new z.AgentPoolSource(e),this.agentQueueSource=new Q.AgentQueueSource(e),this.agentDefinitionSource=new J.AgentDefinitionSource(e),this.elasticPoolSource=new gt.ElasticPoolSource(e),this.jobSource=new q.JobSource(e),this.securitySource=new K.SecuritySource(e),this.serviceEndpointSource=new Z.ServiceEndpointSource(e),this.storesHub=new ft.StoresHub(this.actionsHub),this.poolActionCreator=new Et.PoolActionCreator({pageContext:e,actionsHub:this.actionsHub,agentSource:this.agentSource,agentPoolSource:this.agentPoolSource,agentQueueSource:this.agentQueueSource,agentDefinitionSource:this.agentDefinitionSource,elasticPoolSource:this.elasticPoolSource,jobSource:this.jobSource,securitySource:this.securitySource,serviceEndpointSource:this.serviceEndpointSource,storesHub:this.storesHub}),this.poolAnalyticsSource=new Tt.PoolAnalyticsSource("PoolJobAnalytics_ConcurrencyTrend",e),this.poolGraphActionCreator=new wt.PoolGraphActionsCreator({actionsHub:this.actionsHub,pageContext:e,poolAnalyticsSource:this.poolAnalyticsSource,storesHub:this.storesHub})}dispose(){this.poolActionCreator.dispose()}}}("Flux"),function(e){kt=t[e]={};class s{constructor(e){s.hub||(s.hub=new i(e))}listen(e){s.hub&&s.hub.listen(e)}dispose(){s.hub&&(s.hub.dispose(),s.hub=void 0)}}t[e].PoolSignalRHub=s;class i extends $.SignalRHubBase{constructor(e){super(W.HubNames.poolHub,e),this._initializeClient=e=>{e.client.notifyAgentAdded=(e,t)=>{this.options.actionCreator.getAgentData(t,e)},e.client.notifyAgentConnected=(e,t)=>{this.options.agentActions.agentStatusUpdated.invoke({agentId:t,status:2})},e.client.notifyAgentDisconnected=(e,t)=>{this.options.agentActions.agentStatusUpdated.invoke({agentId:t,status:1})},e.client.notifyAgentUpdated=(e,t)=>{this.options.actionCreator.getAgentData(t,e)},e.client.notifyAgentRequestAssigned=(e,t)=>{this.options.actionCreator.getRequestData(e,t)},e.client.notifyAgentRequestQueued=(e,t)=>{this.options.actionCreator.getRequestData(e,t)},e.client.notifyAgentRequestStarted=(e,t)=>{this.options.actionCreator.getRequestData(e,t)},e.client.notifyAgentRequestCompleted=(e,t)=>{this.options.actionCreator.getRequestData(e,t)}},this.initializeProxy(W.getDTProxyToRegister,this._initializeClient),this.addListener(this)}listen(e){this._poolId=e,this.listenTimer=window.setTimeout((()=>{this.subscribePromise=this.start().then((()=>{const e=this.hub;e&&this._poolId&&e.server.subscribe(this._poolId)}))}),1e3)}dispose(){this.clearTimer();const e=this.hub;e&&this.subscribePromise&&this.subscribePromise.then((()=>{this._poolId&&e.server.unsubscribe(this._poolId).then((()=>super.dispose()),(()=>super.dispose()))}))}}}("PoolSignalRHub"),function(e){Mt=t[e]={};const s=()=>G.createElement(X.Spinner,{size:"large"});var i;!function(e){e.Windows="windows",e.Linux="linux",e.Darwin="darwin"}(i||(i={}));class o extends G.PureComponent{constructor(e){super(e),this._platforms={},this._populatePlatformData()}render(){return G.createElement(Y.Dialog,{onDismiss:this.props.onCancel,showCloseButton:!0,calloutClassName:"pipelines-download-agent-dialog",calloutContentClassName:"pipelines-download-agent-dialog-content",titleProps:{text:ct.AgentAcquisitionDialogTitle}},G.createElement(ee.LegacyComponent,{agentAcquisitionGuidances:this._platforms,className:"pipelines-download-agent-dialog-host",wrappedType:"LegacyAgentAcquisitionDialog",modules:["DistributedTaskControls/Components/AgentAcquisitionDialog","VSS/LoaderPlugins/Css!Site"],loadingComponent:s}))}_populatePlatformData(){this._platforms[i.Windows]={prerequisites:g.FwLinks.PrerequisitesLinkWindows,createAgentScript:ct.DownloadAgentWindowsMarkdown,configureAgentScript:ct.ConfigureAgentWindowsMarkdown,runAgentScript:ct.RunAgentWindowsMarkdown,detailedInstructionsLink:g.FwLinks.DetailedInstructionsLinkWindows},this._platforms[i.Linux]={prerequisites:g.FwLinks.PrerequisitesLinkLinux,createAgentScript:ct.DownloadAgentLinuxMarkdown,configureAgentScript:ct.ConfigureAgentLinuxMarkdown,runAgentScript:ct.RunAgentLinuxMarkdown,detailedInstructionsLink:g.FwLinks.DetailedInstructionsLinkLinux},this._platforms[i.Darwin]={prerequisites:g.FwLinks.PrerequisitesLinkDarwin,createAgentScript:ct.DownloadAgentDarwinMarkdown,configureAgentScript:ct.ConfigureAgentDarwinMarkdown,runAgentScript:ct.RunAgentDarwinMarkdown,detailedInstructionsLink:g.FwLinks.DetailedInstructionsLinkDarwin}}}t[e].AgentAcquisitionDialog=o}("ComponentsAgentAcquisitionDialog"),function(e){Nt=t[e]={};class s extends G.PureComponent{constructor(){super(...arguments),this._onRowClicked=(e,t)=>{t.data.linkProps&&t.data.linkProps.href&&(0,se.onClickFPS)(this.props.pageContext,t.data.linkProps.href,!0,e)},this._getContextMenuItems=e=>{const t=[];return t.push({id:"update",text:ct.UpdateAgent,onActivate:()=>{this.props.onUpdateAgent(e.agent)}}),t.push({id:"delete",text:ct.Delete,onActivate:()=>{this.props.onDeleteAgent(e.agent)}}),{id:"agent-menu",items:t}},this._renderNameCell=(e,t,s,i)=>G.createElement(ne.TwoLineTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t,line1:this._renderPrimaryNameRowText(i.agent),line2:this._renderSecondaryNameRowText(i.agent)}),this._renderLastRunCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},this._getLastRunElement(i.agent)),this._renderStatusCell=(e,t,s,i)=>{const o=i.agent;return o.assignedRequest&&o.assignedRequest.planType&&o.assignedRequest.owner?G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},(0,m.format)(ct.RunningRequestInformation,o.assignedRequest.planType.toLocaleLowerCase(),o.assignedRequest.owner.name)))):o.pendingUpdate&&o.pendingUpdate.currentState?G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},o.pendingUpdate.currentState))):o.version&&o.version.search(/^1\.\d+/)>=0?G.createElement(ne.TwoLineTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t,line1:ct.DeprecatedAgent,line2:G.createElement(oe.Link,{href:g.FwLinks.DeprecatedAgentHelpLink,target:"_blank"},g.FwLinks.DeprecatedAgentHelpLink)}):G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("div",null,ct.Idle))},this._renderVersionCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.agent.version))),this._renderEnabledCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(ae.Toggle,{offText:ct.Off,onText:ct.On,checked:i.agent.enabled,onChange:(e,t)=>{this.props.onAgentEnabledChanged(i.agent,t),e.preventDefault()}}))}render(){const e=this._buildListItems();return G.createElement("div",null,e.length>0&&G.createElement(ne.Table,{className:"pipelines-agents-list",columns:this._getColumns(),itemProvider:new le.ArrayItemProvider(e),onActivate:this._onRowClicked}),0===e.length&&G.createElement("div",{className:"fontSizeM"},ct.AgentListEmptyExperience))}_buildListItems(){let e=[];return this.props.agents&&this.props.agents.forEach((t=>{const s={href:this.props.agentLinkProvider(t)};e.push({agent:t,linkProps:s})})),e}_getColumns(){const e=[{id:"name",name:ct.Name,width:new te.ObservableValue(-28),columnStyle:2,renderCell:this._renderNameCell},{id:"lastRun",name:ct.LastRun,width:new te.ObservableValue(-20),columnStyle:1,renderCell:this._renderLastRunCell},{id:"status",name:ct.Status,width:new te.ObservableValue(-20),columnStyle:1,renderCell:this._renderStatusCell},{id:"version",name:ct.Version,width:new te.ObservableValue(-20),columnStyle:1,renderCell:this._renderVersionCell},{id:"enabled",name:ct.Enabled,width:new te.ObservableValue(-12),columnStyle:3,renderCell:this._renderEnabledCell}];return this.props.selectedAgentPool&&!(0,M.isHostedOrPoolProviderBacked)(this.props.selectedAgentPool)&&e.push(new ne.ColumnMore(this._getContextMenuItems)),e}_renderPrimaryNameRowText(e){return G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"fontWeightSemiBold fontSizeM text-ellipsis"},e.name))}_renderSecondaryNameRowText(e){return G.createElement("span",{className:"fontSize secondary-text flex-row flex-baseline text-ellipsis"},this._getStateIcon(e),this._getStateText(e))}_getStateIcon(e){return this.props.selectedAgentPool&&(0,M.isHostedOrPoolProviderBacked)(this.props.selectedAgentPool)||2===e.status?G.createElement("div",{className:"agent-icon online"}):G.createElement("div",{className:"agent-icon offline"})}_getStateText(e){if(this.props.selectedAgentPool&&(0,M.isHostedOrPoolProviderBacked)(this.props.selectedAgentPool))return ct.Online;switch(e.status){case 1:return ct.Offline;case 2:return ct.Online;default:return""}}_getLastRunElement(e){return e.assignedRequest?G.createElement("span",null,ct.Now):e.lastCompletedRequest?e.lastCompletedRequest.finishTime?G.createElement(ie.Ago,{date:e.lastCompletedRequest.finishTime}):e.lastCompletedRequest.receiveTime?G.createElement(ie.Ago,{date:e.lastCompletedRequest.receiveTime}):e.lastCompletedRequest.assignTime?G.createElement(ie.Ago,{date:e.lastCompletedRequest.assignTime}):G.createElement(ie.Ago,{date:e.lastCompletedRequest.queueTime}):G.createElement("span",null)}}t[e].AgentList=s}("ComponentsAgentList"),function(e){Rt=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._getFooterButtonProps=()=>[{text:ct.Save,primary:!0,onClick:this._saveAzureSubscriptionSettings,disabled:this.state.disableSaveButton}],this._onProjectSelected=e=>{this.setState({projectId:e?e.id:void 0})},this._onVMScaleSetSettingsChanged=(e,t)=>{this.setState({serviceEndpoint:e,virtualMachineScaleSet:t,disableSaveButton:this._shouldDisableSubmitButton(Object.assign(Object.assign({},this.state),{serviceEndpoint:e,virtualMachineScaleSet:t}))})},this._saveAzureSubscriptionSettings=()=>{const e=this.props.storesHub.selectionStore.state.selectedServiceEndpoint,t=this.props.storesHub.selectionStore.state.selectedVirtualMachineScaleSet;this.state.projectId&&this.state.serviceEndpoint&&this.state.virtualMachineScaleSet&&(this.state.serviceEndpoint.id!==(null==e?void 0:e.id)||this.state.virtualMachineScaleSet.id!==(null==t?void 0:t.id))&&(this.props.actionCreator.updateElasticPoolAzureSubscriptionSettings(this.state.projectId,this.state.serviceEndpoint,this.state.virtualMachineScaleSet),this.props.onDismiss())},this._onStoreChanged=()=>{this.setState(this._getStateFromStores())},this._getStateFromStores=()=>({projectId:this._project?this._project.id:void 0,serviceEndpoint:void 0,virtualMachineScaleSet:void 0,disableSaveButton:!0}),this._restrictReimage=e=>(0,pe.reimageIsNotAvaialable)(e)&&!!this.props.recycleAfterEachUse,this._shouldDisableSubmitButton=e=>{var t,s;return!e.serviceEndpoint||!e.virtualMachineScaleSet||e.serviceEndpoint.id===(null===(t=this.props.storesHub.selectionStore.state.selectedServiceEndpoint)||void 0===t?void 0:t.id)&&e.virtualMachineScaleSet.id===(null===(s=this.props.storesHub.selectionStore.state.selectedVirtualMachineScaleSet)||void 0===s?void 0:s.id)||this._restrictReimage(e.virtualMachineScaleSet)};const s=t.pageContext.getService("IProjectDataService");this._project=s.getProjectData(),this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onStoreChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onStoreChanged)}render(){return G.createElement(ce.ConditionalChildren,{renderChildren:this.props.isOpen},G.createElement(de.Panel,{className:"pipelines-azure-subscription-settings-panel",titleProps:{text:ct.AzureSubscriptionSettings},description:ct.AzureSubscriptionSettingsDescription,onDismiss:()=>{this._onStoreChanged(),this.props.onDismiss()},footerButtonProps:this._getFooterButtonProps()},G.createElement("div",{className:"padding-top-8 flex-column flex-grow"},G.createElement(ce.ConditionalChildren,{renderChildren:void 0===this._project},G.createElement("div",{className:"padding-bottom-8"},ct.SelectProjectHeader),G.createElement(he.ProjectPicker,{projects:this.props.storesHub.projectStore.state,onProjectSelected:this._onProjectSelected})),G.createElement(ge.VMScaleSetSettings,{actionCreator:this.props.actionCreator.serviceEndpointActionCreator,serviceEndpointStore:this.props.storesHub.serviceEndpointStore,virtualMachineScaleSetStore:this.props.storesHub.virtualMachineScaleSetStore,projectId:this.state.projectId,onSettingsChanged:this._onVMScaleSetSettingsChanged}),G.createElement(pe.ReimageDisabledWarning,{isVisible:!!this.state.virtualMachineScaleSet&&this._restrictReimage(this.state.virtualMachineScaleSet)}))))}}t[e].AzureSubscriptionSettingsPanel=s}("ComponentsAzureSubscriptionSettingsPanel"),function(e){jt=t[e]={};class s extends G.PureComponent{constructor(e){super(e)}render(){return 2===this.props.status?this.props.editable?G.createElement(Se.MarkdownTextField,{formItemClassName:"flex-grow",shortcutCommands:me.shortcutCommands,value:this.props.agentPoolDescription,onChange:e=>this.props.onChanged(e),rows:10}):G.createElement(Se.MarkdownPreview,{className:"flex-grow",options:s.markdownOptions,value:this.props.agentPoolDescription||ct.PoolDescriptionNotFound}):G.createElement(X.Spinner,{className:"pool-details-spinner scroll-hidden flex-grow flex-self-center",size:"large"})}}t[e].Description=s,s.markdownOptions={breaks:!0,linkify:!0,typographer:!1,enableEmoji:!0,hideExternalImageIcon:!0,enableImageSize:!0,enableKatex:!1,linkifyTlds:["biz","com","edu","gov","net","org","pro","web","aero","asia","coop","info","museum","name","shop","Ñ€Ñ„","io"]}}("ComponentsDescription"),function(e){Vt=t[e]={};class s extends G.PureComponent{constructor(){super(...arguments),this._renderNameCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"fontWeightSemiBold fontSizeM text-ellipsis"},i.name))),this._renderSavedTimeCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},G.createElement(ce.ConditionalChildren,{renderChildren:void 0!==i.stateChangedOn},G.createElement(ie.Ago,{date:i.stateChangedOn,format:1})))),this._renderDeleteCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(ce.ConditionalChildren,{renderChildren:9===i.state},G.createElement(be.Button,{text:ct.Delete,onClick:()=>this.props.onDeleteNode(i),primary:!0})))}render(){return G.createElement(ne.Table,{className:"pipelines-agents-list",columns:this._getColumns(),itemProvider:new le.ArrayItemProvider(this.props.elasticNodes)})}_getColumns(){return[{id:"name",name:ct.Name,width:new te.ObservableValue(-80),columnStyle:2,renderCell:this._renderNameCell},{id:"saved",name:ct.Saved,columnStyle:3,width:new te.ObservableValue(-20),renderCell:this._renderSavedTimeCell},{id:"release",width:new te.ObservableValue(100),columnStyle:1,renderCell:this._renderDeleteCell}]}}t[e].ElasticNodeList=s}("ComponentsElasticNodeList"),function(e){Ot=t[e]={};class s extends ue.VssComponent{constructor(){super(...arguments),this._renderLevelCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(Ce.Status,Object.assign({},this._getStatusPropsForLog(i),{size:"16"}))),this._renderTimestampCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.timestamp&&G.createElement(ie.Ago,{date:i.timestamp,format:1}))),this._renderOperationCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},this._getOperationName(i)))),this._renderMessageCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.message)))}render(){return G.createElement(ne.Table,{className:"pipelines-elastic-pool-log-list",columns:this._getColumns(),itemProvider:new le.ArrayItemProvider(this.props.logs)})}_getColumns(){return[{id:"level",columnStyle:1,width:new te.ObservableValue(-3),renderCell:this._renderLevelCell},{id:"timestamp",name:ct.Timestamp,columnStyle:1,width:new te.ObservableValue(-12),renderCell:this._renderTimestampCell},{id:"operation",name:ct.Operation,columnStyle:1,width:new te.ObservableValue(-10),renderCell:this._renderOperationCell},{id:"message",name:ct.Message,columnStyle:2,width:new te.ObservableValue(-75),renderCell:this._renderMessageCell}]}_getStatusPropsForLog(e){switch(e.level){case 0:return Ce.Statuses.Failed;case 1:return Ce.Statuses.Warning;default:return Ce.Statuses.Information}}_getOperationName(e){switch(e.operation){case 0:return ct.ConfigurationJobOperation;case 1:return ct.SizingJobOperation;case 2:return ct.IncreaseCapacityOperation;case 3:return ct.ReimageOperation;case 4:return ct.DeleteVMsOperation;default:return""}}}t[e].ElasticPoolLogList=s}("ComponentsElasticPoolLogList"),function(e){Ft=t[e]={};class s extends ue.VssComponent{constructor(){super(...arguments),this._renderIdCell=(e,t,s,i)=>G.createElement(ne.TwoLineTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t,line1:this._renderPrimaryNameRowText(i.value),line2:"",iconProps:{render:e=>this._renderJobStatusIcon(i.value,e)}}),this._renderErrorsCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},2===i.value.status&&(0,m.format)(ct.ErrorsAndWarningsCellText,i.value.errorCount,i.value.warningCount))),this._renderQueuedTimeCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.value.queueTime&&G.createElement(ie.Ago,{date:i.value.queueTime,format:1}))),this._renderStartTimeCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.value.startTime&&G.createElement(ie.Ago,{date:i.value.startTime,format:1}))),this._renderDurationCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.value.finishTime&&G.createElement(Pe.Duration,{startDate:i.value.startTime,endDate:3!==this.props.signalRState||i.value.finishTime?i.value.finishTime:new Date(Date.now())}))),this._renderTargetAgentsCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},2===i.value.status&&(0,m.format)(ct.TargetAgentsCellText,i.value.targetAgents&&i.value.targetAgents.length||0))),this._renderLogsCell=(e,t,s,i)=>G.createElement(ne.SimpleTableCell,{columnIndex:t,tableColumn:s,key:"col-"+t},G.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},i.value.targetAgents&&i.value.targetAgents.length>0&&i.value.logsDownloadUrl&&G.createElement(oe.Link,{href:i.value.logsDownloadUrl,subtle:!0},ct.DownloadLogs))),this._columns=[{id:"id",name:ct.Id,columnStyle:2,width:new te.ObservableValue(-20),renderCell:this._renderIdCell},{id:"errorsAndWarnings",name:ct.ErrorsAndWarnings,columnStyle:1,width:new te.ObservableValue(-15),renderCell:this._renderErrorsCell},{id:"queued",name:ct.Queued,columnStyle:3,width:new te.ObservableValue(-15),renderCell:this._renderQueuedTimeCell},{id:"started",name:ct.Started,columnStyle:3,width:new te.ObservableValue(-15),renderCell:this._renderStartTimeCell},{id:"duration",name:ct.Duration,columnStyle:3,width:new te.ObservableValue(-10),renderCell:this._renderDurationCell},{id:"targetAgents",name:ct.TargetAgents,columnStyle:3,width:new te.ObservableValue(-15),renderCell:this._renderTargetAgentsCell},{id:"logs",name:ct.Logs,columnStyle:3,width:new te.ObservableValue(-15),renderCell:this._renderLogsCell}]}render(){return G.createElement(ne.Table,{className:"pipelines-maintenance-jobs-list",columns:this._columns,itemProvider:new le.ArrayItemProvider(this._buildListItems())})}_buildListItems(){return this.props.jobs?this.props.jobs.map((e=>({value:e}))):[]}_renderJobStatusIcon(e,t){return G.createElement(Ce.Status,Object.assign({},this._getStatusPropsForJob(e),{className:t,size:"24"}))}_renderPrimaryNameRowText(e){return G.createElement(re.Tooltip,{overflowOnly:!0},G.createElement("span",{className:"fontWeightSemiBold text-ellipsis bolt-list-cell-text link-left-padding"},(0,m.format)(ct.TaskAgentJobNumberFormat,e.jobId)))}_getStatusPropsForJob(e){if(2!==e.status)switch(e.status){case 4:case 1:return Ce.Statuses.Running;default:return Ce.Statuses.Queued}else switch(e.result){case 4:return Ce.Statuses.Canceled;case 2:return Ce.Statuses.Failed;default:return Ce.Statuses.Success}}}t[e].MaintenanceJobsList=s}("ComponentsMaintenanceJobsList"),function(e){Bt=t[e]={};const s=()=>G.createElement(X.Spinner,{className:"pipelines-pool-maintenance-spinner scroll-hidden flex-grow flex-self-center",size:"large"});class i extends ue.VssComponent{constructor(e){super(e),this._onChanged=()=>{this.setState(this._getStateFromStores())},this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onChanged),this.props.storesHub.maintenanceJobStore.addChangedListener(this._onChanged),this.props.storesHub.signalRStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onChanged),this.props.storesHub.maintenanceJobStore.removeChangedListener(this._onChanged),this.props.storesHub.signalRStore.removeChangedListener(this._onChanged)}render(){return G.createElement("div",{className:"pipelines-pool-jobs page-content page-content-top"},this.state.renderZeroData&&G.createElement(ve.ZeroData,{primaryText:ct.ZeroMaintenanceJobsPrimaryText,secondaryText:ct.ZeroMaintenanceJobsSecondaryText,actionText:ct.Settings,actionType:0,onActionClick:()=>this.props.actionCreator.updateSelectedTab(g.PoolHubViewKeys.Settings),imagePath:(0,Ae.getAssetLocation)(this.context.pageContext,g.Assets.ZeroDataPng),imageAltText:""}),!this.state.renderZeroData&&G.createElement(_e.Card,{className:"flex-grow bolt-card-no-vertical-padding",contentProps:{contentPadding:!1}},2===this.props.storesHub.maintenanceJobStore.state.status&&G.createElement(Ft.MaintenanceJobsList,{jobs:this.state.jobs,signalRState:this.state.signalRState}),2!==this.props.storesHub.maintenanceJobStore.state.status&&G.createElement(s,null)))}_getStateFromStores(){return{jobs:this.props.storesHub.maintenanceJobStore.state.jobs,signalRState:this.props.storesHub.signalRStore.state,renderZeroData:0===this.props.storesHub.maintenanceJobStore.state.jobs.length}}}t[e].MaintenanceHistoryContainer=i}("ComponentsMaintenanceHistoryContainer"),function(e){Jt=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._onChanged=()=>{this.setState(this._getStateFromStores())},this._getLinkToAgent=e=>{if(this.state.selectedAgentQueue||this.state.selectedAgentPool){return this.context.pageContext.getService("IPoolAdminLinkingService").getAgentUrl(this.state.selectedAgentQueue,this.state.selectedAgentPool,e)}},this._onAgentEnabledChanged=(e,t)=>{this.state.selectedAgentPool&&this.props.actionCreator.enableAgent(e,this.state.selectedAgentPool.id,t)},this._onUpdateAgent=e=>{const t=G.createElement(ye.FormatComponent,{format:ct.ConfirmUpdateAgentMessage},G.createElement("span",{className:"fontWeightSemiBold"},e.name),G.createElement("br",null),G.createElement("br",null));this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(e,ct.ConfirmUpdateTitle,t,1,this._confirmUpdateAgent,this._cancelConfirmationDialog)},this._confirmUpdateAgent=e=>{this.state.selectedAgentPool&&(this.props.actionCreator.pushAgentUpdateRequest(this.state.selectedAgentPool.id,e),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog())},this._onDeleteAgent=e=>{let t;if(this.state.selectedAgentQueue?t=this.state.selectedAgentQueue.name:this.state.selectedAgentPool&&(t=this.state.selectedAgentPool.name),t){const s=G.createElement(ye.FormatComponent,{format:ct.ConfirmDeleteAgentMessage},G.createElement("span",{className:"fontWeightSemiBold"},e.name),G.createElement("br",null),G.createElement("br",null),G.createElement("span",{className:"fontWeightSemiBold"},t));this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(e,ct.ConfirmDeleteTitle,s,2,this._confirmDeleteAgent,this._cancelConfirmationDialog)}},this._confirmDeleteAgent=e=>{this.state.selectedAgentPool&&(this.props.actionCreator.deleteAgent(e,this.state.selectedAgentPool.id),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog())},this._cancelConfirmationDialog=()=>{this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this.state=this._getStateFromStores()}render(){const e=(0,M.isElastic)(this.state.selectedAgentPool)?ct.ZeroElasticAgentsPrimaryText:ct.ZeroAgentsPrimaryText,t=(0,M.isElastic)(this.state.selectedAgentPool)?ct.ZeroElasticAgentsSecondaryText:ct.ZeroAgentsSecondaryText,s=!(0,M.isElastic)(this.state.selectedAgentPool);return G.createElement("div",{className:"pipelines-pool-agents page-content page-content-top"},this._shouldRenderZeroData()&&G.createElement(ve.ZeroData,{primaryText:e,secondaryText:t,actionType:s?0:void 0,actionText:s?ct.NewAgent:void 0,onActionClick:s?()=>this.props.actionCreator.showDownloadAgentDialog():void 0,imagePath:(0,Ae.getAssetLocation)(this.context.pageContext,g.Assets.ZeroDataPng),imageAltText:e}),!this._shouldRenderZeroData()&&G.createElement(_e.Card,{className:"flex-grow bolt-card-no-vertical-padding",contentProps:{contentPadding:!1}},G.createElement(Nt.AgentList,{agents:this.state.agents,agentLinkProvider:this._getLinkToAgent,onAgentEnabledChanged:this._onAgentEnabledChanged,onUpdateAgent:this._onUpdateAgent,onDeleteAgent:this._onDeleteAgent,pageContext:this.context.pageContext,selectedAgentPool:this.state.selectedAgentPool})))}componentDidMount(){this.props.storesHub.agentStore.addChangedListener(this._onChanged),this.props.storesHub.selectionStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.agentStore.removeChangedListener(this._onChanged),this.props.storesHub.selectionStore.removeChangedListener(this._onChanged)}_getStateFromStores(){return{agents:this.props.storesHub.agentStore.state,selectedAgentQueue:this.props.storesHub.selectionStore.state.selectedAgentQueue,selectedAgentPool:this.props.storesHub.selectionStore.state.selectedAgentPool}}_shouldRenderZeroData(){return 0===this.state.agents.length}}t[e].PoolAgentsContainer=s}("ComponentsPoolAgentsContainer"),function(e){zt=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._onDataRenderedCalled=!1,this._getChartOptions=e=>{const{isHosted:t,isPublic:s}=this.props;let i=e.primaryChartData[dt.PoolDataStrings.RunningJobs].map((e=>e.date));const o=[],n=e.primaryChartData[dt.PoolDataStrings.Concurrency].map((e=>e.aggrValue)),a=new Ht.ConcurrencySeries(n);o.push({data:n,color:a.color,name:!t&&s?ct.OnlineAgents:a.name,plotDashedStyle:!0});const r=e.primaryChartData[dt.PoolDataStrings.QueuedJobs],l=new Lt.QueuedJobsSeries(r.map((e=>e.aggrValue)));o.push({data:r.map((e=>void 0!==e.aggrValue?e.aggrValue:null)),color:l.color,name:l.name});const c=e.primaryChartData[dt.PoolDataStrings.RunningJobs].map((e=>e.aggrValue)),d=new It.RunningJobsSeries(c);return o.push({data:c,color:d.color,name:d.name}),{chartType:we.ChartTypesConstants.Area,hostOptions:{height:200},legend:{enabled:!0,rightAlign:!0},pageContext:this.context.pageContext,series:o,specializedOptions:{disableStacking:!0,gradientFill:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[{position:0,color:xt.PoolGraphGradientColorPalette,opacity:0},{position:1,color:xt.PoolGraphGradientColorPalette,opacity:0}]},includeMarkers:!0,lineWidth:2},suppressAnimation:!0,title:this._getChartTitle(),tooltip:{customTooltipMapping:e=>e.map(((t,s)=>{let i=`${Number(t.values[0]).toLocaleString(navigator.language)} ${t.seriesName}`;return s===e.length-1&&t.seriesDataIndex===c.length-1&&(i=`${i} ${ct.StillAggregating}`),{styleType:{color:t.color,type:1},text:i}}))},xAxis:{allowDecimals:!1,formatAccessibleLabelsUsingAxisCategories:!0,labelFormatMode:this.props.confValues.trendBy===j.TrendBy.Hours?we.LabelFormatModes.Textual:we.LabelFormatModes.DateTime_DayInMonth,labelsEnabled:!0,labelValues:i},yAxis:{gridLineOptions:{enabled:!0,gridLineColor:Ee.gridLineColor},labelsEnabled:!0,markingsEnabled:!1,title:(0,m.localeFormat)(ct.PoolTrendYAxisLabel.toLocaleUpperCase())}}},this._verifyChartData=e=>!!e&&e.primaryChartData[dt.PoolDataStrings.RunningJobs]&&e.primaryChartData[dt.PoolDataStrings.RunningJobs].length>0&&e.primaryChartData[dt.PoolDataStrings.Concurrency]&&e.primaryChartData[dt.PoolDataStrings.Concurrency].length>0,this._onStoreUpdate=()=>{const{isPublic:e,store:t}=this.props;this.setState(e?t.getPublicTrendState():t.getPrivateTrendState())},this._getChartTitle=()=>{const{isHosted:e,isPublic:t}=this.props;return e?t?ct.PublicHostedConcurrency:ct.PrivateHostedConcurrency:t?ct.AgentUsage:ct.PrivateSelfHostedConcurrency},this.state={errorText:this.props.errorText}}componentDidMount(){if(super.componentDidMount(),this.props){const{isPublic:e,store:t}=this.props;t.addChangedListener(this._onStoreUpdate),this.setState(e?t.getPublicTrendState():t.getPrivateTrendState()),this.performOnDataRendered()}}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.performOnDataRendered()}componentWillUnmount(){this.props&&this.props.store.removeChangedListener(this._onStoreUpdate),super.componentWillUnmount()}render(){return G.createElement(_e.Card,{className:this.props.className,titleProps:{text:this._getChartTitle()}},this.getElementToDisplay())}getElementToDisplay(){if(this.state.errorText)return G.createElement(De.ErrorComponent,{className:" flex-grow",errorMessage:this.state.errorText});if(null!=this.state.confValues&&null!=this.state.data){const e=this.state.data;return G.createElement("div",{className:"flex-row flex-wrap flex-grow"},G.createElement("div",{className:"flex-grow"},this._verifyChartData(e)&&G.createElement(Te.AreaChartView,{chartOptions:this._getChartOptions(e)})))}return G.createElement(fe.LoadingComponent,{className:"card-spinner flex-column flex-grow",size:"large"})}performOnDataRendered(){(this.state.data||this.state.errorText)&&this.props.onDataRendered&&!this._onDataRenderedCalled&&(this.props.onDataRendered(),this._onDataRenderedCalled=!0)}}t[e].PoolTrendCard=s}("ComponentsPoolTrendCard"),function(e){Qt=t[e]={};class s extends ue.VssComponent{constructor(e,t){var s;super(e,t),this._hasPrivateTrendRendered=!1,this._hasPublicTrendRendered=!1,this._hasTopPipelinesRendered=!1,this._reportRenderCount=0,this._timeRangeSelection=new ke.DropdownSelection,this._periods=[],this._showFilter=new te.ObservableValue(!1),this.filterChanged=()=>{this._getDataValidationPromises()},this._renderHeader=()=>{const e=[];if(this.context.pageContext.getService("IVssPageService").getData().isHosted){const t=(0,Ae.routeUrl)(this.context.pageContext,"ms.vss-admin-web.collection-admin-hub-route",{adminPivot:"billing"});e.push({id:ct.PurchaseConcurrencyButtonId,isPrimary:!0,text:ct.PurchaseConcurrency,href:t,onActivate:()=>this._logButtonClick(ct.PurchaseConcurrencyButtonId)})}return e.push((0,Ue.getFilterItem)((()=>{this._showFilter.value=!this._showFilter.value}),this._filter.hasChangesToReset())),G.createElement(xe.AnalyticsHeaderComponent,{title:this.props.headerTitle,showCommandBar:!0,commandBarItems:e})},this._getDataValidationPromises=()=>{const e=this._periods[this._timeRangeSelection.value[0].beginIndex];let t;switch(e.data){case j.Period.Days_1:t=j.TrendBy.Hours;break;case j.Period.Days_180:t=j.TrendBy.Weeks;break;default:t=j.TrendBy.Days}const s={period:e.data,trendBy:t};return this.setState(Object.assign(Object.assign({},this.state),{confValues:s})),this._actionsCreator.updateConfigurationValues(s)},this._handleError=e=>{this.setState({errorText:e})},this._onChanged=()=>{var e;this.setState(Object.assign(Object.assign({},this.state),{isHosted:null===(e=this.props.storesHub.selectionStore.state.selectedAgentPool)||void 0===e?void 0:e.isHosted}))},this._onPrivateTrendRendered=()=>{this._hasPrivateTrendRendered=!0,this._logPerformance()},this._onPublicTrendRendered=()=>{this._hasPublicTrendRendered=!0,this._logPerformance()},this._onTopPipelinesRendered=()=>{this._hasTopPipelinesRendered=!0,this._logPerformance()},this.state={confValues:{period:j.Period.Days_14,trendBy:j.TrendBy.Days},isHosted:null===(s=e.storesHub.selectionStore.state.selectedAgentPool)||void 0===s?void 0:s.isHosted},this._actionsCreator=e.actionCreator,this._storesHub=e.storesHub,this._filter=new Me.Filter,this._periods.push({id:"Days_1",text:ct.OneDay,data:j.Period.Days_1}),this._periods.push({id:"Days_7",text:ct.SevenDays,data:j.Period.Days_7}),this._periods.push({id:"Days_14",text:ct.FourteenDays,data:j.Period.Days_14}),this._periods.push({id:"Days_30",text:ct.ThirtyDays,data:j.Period.Days_30}),this._timeRangeSelection.select(2),this._filter.setFilterItemState("timeRangeFilter",{value:[2]}),this._filter.setDefaultState(this._filter.getState())}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onChanged),this._filter.subscribe(this.filterChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onChanged),this._filter.unsubscribe(this.filterChanged),super.componentWillUnmount()}render(){return G.createElement("div",{className:"relative flex-row flex-grow"},G.createElement(He.AnalyticsPage,{renderHeader:this._renderHeader,getDataValidationPromises:this._getDataValidationPromises,onError:this._handleError},G.createElement("div",{className:"flex-grow flex-column scroll-hidden"},G.createElement(ce.ConditionalChildren,{renderChildren:this._showFilter},G.createElement("div",{className:"margin-bottom-16"},G.createElement(Ie.FilterBar,{filter:this._filter},G.createElement(Le.DropdownFilterBarItem,{filterItemKey:"timeRangeFilter",filter:this._filter,hideClearAction:!0,items:this._periods,onSelect:()=>this._getDataValidationPromises(),selection:this._timeRangeSelection})))),G.createElement(zt.PoolTrendCard,{className:"flex-column",confValues:this.state.confValues,store:this._storesHub.poolAnalyticsStore,isHosted:this.state.isHosted,isPublic:!0,onDataRendered:this._onPublicTrendRendered}),G.createElement(zt.PoolTrendCard,{className:"flex-column margin-top-16",confValues:this.state.confValues,store:this._storesHub.poolAnalyticsStore,isHosted:this.state.isHosted,isPublic:!1,onDataRendered:this._onPrivateTrendRendered}))))}_logPerformance(){if(this._hasPrivateTrendRendered&&this._hasPublicTrendRendered&&0===this._reportRenderCount){this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(g.Telemetry.Area,g.Telemetry.AgentPoolAnalytics),this._reportRenderCount++}}_logButtonClick(e){this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(g.Telemetry.Area,g.Telemetry.AgentPoolAnalytics,void 0,{buttonAction:e})}}t[e].PoolGraph=s}("ComponentsPoolGraph"),function(e){qt=t[e]={};class s extends ue.VssComponent{render(){return G.createElement(Ne.AnalyticsExtensionValidator,null,this._renderComponent())}_renderComponent(){const e={actionCreator:this.props.actionCreator,contextType:"build",headerTitle:ct.PoolConsumptionReport,storesHub:this.props.storesHub};return G.createElement(Qt.PoolGraph,Object.assign({},e))}}t[e].PoolAnalytics=s}("ComponentsPoolAnalytics"),function(e){Kt=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._onChanged=()=>{this.setState(this._getStateFromStores())},this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.checksStore.addChangedListener(this._onChanged),this.props.storesHub.securityStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.checksStore.removeChangedListener(this._onChanged),this.props.storesHub.securityStore.removeChangedListener(this._onChanged)}render(){return this.state.agentQueue&&2===this.state.checksDataLoaded?G.createElement(Re.ChecksOverview,{resourceType:"queue",resourceId:this.state.agentQueue.id.toString(),resourceName:this.state.agentQueue.name,hasManagePermission:this.state.hasManagePermission,dataProviderRequestParameters:{queueId:this.state.agentQueue.id}}):null}_getStateFromStores(){return{checksDataLoaded:this.props.storesHub.checksStore.state.status,agentQueue:this.props.storesHub.selectionStore.state.selectedAgentQueue,hasManagePermission:this.props.storesHub.securityStore.state.hasManageQueuePermission}}}t[e].PoolChecksContainer=s}("ComponentsPoolChecksContainer"),function(e){Zt=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._getOwnerCommandBarItems=()=>[{id:"undo",text:ct.Undo,disabled:!this._ownerIsDirty(),onActivate:()=>{this.setState({owner:this._getOwnerIdentity(this.props.storesHub.selectionStore.state.selectedAgentPool),undoCount:this.state.undoCount+1})}},{important:!0,id:"save",text:ct.Save,disabled:!this._ownerIsDirty()||!this._ownerIsValid(),onActivate:()=>{this._ownerIsDirty()&&this._ownerIsValid()&&this.state.owner&&this.props.actionCreator.setPoolOwner(this.state.owner)},isPrimary:!0}],this._onOwnerChange=e=>{this.setState({owner:e})},this._getDescriptionCommandBarItems=()=>[{id:"edit-view",text:this.state.editingDescription?ct.View:ct.Edit,disabled:!this.state.hasManagePoolPermission,onActivate:()=>{this.setState({editingDescription:!this.state.editingDescription})}},{id:"undo",text:ct.Undo,disabled:!this._descriptionIsDirty(),onActivate:()=>{this.setState({agentPoolDescription:this.props.storesHub.descriptionStore.state.description})}},{important:!0,id:"save",text:ct.Save,disabled:!this._descriptionIsDirty(),onActivate:()=>{this._descriptionIsDirty()&&this.state.agentPool&&this.props.actionCreator.setAgentPoolDescription(this.state.agentPool,this.state.agentPoolDescription||"")},isPrimary:!0}],this._onDescriptionChanged=e=>{this.setState({agentPoolDescription:e})},this._onChanged=()=>{this.setState(this._getStateFromStores())},this.state=this._getStateFromStores(),this._peoplePickerProvider=new je.PeoplePickerProvider(t.pageContext,{identityTypes:["user","group"],options:{MinResults:5,MaxResults:20},operationScopes:["ims"]})}render(){return G.createElement("div",{className:"pipelines-pool-details"},this.state.agentPool&&this.state.agentPool.owner&&G.createElement("div",{className:"page-content-top page-content-left page-content-right"},G.createElement(_e.Card,{className:"owner-card flex-grow",titleProps:{text:ct.PoolOwnerLabel,size:0},headerCommandBarItems:this._getOwnerCommandBarItems()},this.state.hasManagePoolPermission&&G.createElement(Oe.IdentityPickerDropdown,{key:this.state.undoCount,pickerProvider:this._peoplePickerProvider,value:this.state.owner,onChange:this._onOwnerChange}),!this.state.hasManagePoolPermission&&G.createElement(Fe.Owner,{identity:this.state.agentPool.owner}))),G.createElement("div",{className:"page-content page-content-top"},G.createElement(_e.Card,{className:"description-card flex-grow",titleProps:{text:ct.PoolDescriptionLabel,size:0},headerCommandBarItems:this._getDescriptionCommandBarItems()},G.createElement(jt.Description,{agentPoolDescription:this.state.agentPoolDescription,status:this.state.status,editable:this.state.hasManagePoolPermission&&this.state.editingDescription,onChanged:this._onDescriptionChanged}))))}componentDidMount(){this.props.storesHub.descriptionStore.addChangedListener(this._onChanged),this.props.storesHub.selectionStore.addChangedListener(this._onChanged),this.props.storesHub.securityStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.descriptionStore.removeChangedListener(this._onChanged),this.props.storesHub.selectionStore.removeChangedListener(this._onChanged),this.props.storesHub.securityStore.removeChangedListener(this._onChanged)}_ownerIsDirty(){const e=this._getOwnerIdentity(this.state.agentPool);return(e?e.subjectDescriptor:void 0)!==(this.state.owner?this.state.owner.subjectDescriptor:void 0)}_ownerIsValid(){return void 0!==this.state.owner}_getOwnerIdentity(e){let t;return e&&(t=e.owner?e.owner:e.createdBy),t?{displayName:t.displayName,image:(0,Ve.getIdentityImageUrl)(this.context.pageContext,t),subjectDescriptor:t.descriptor}:void 0}_descriptionIsDirty(){return this.props.storesHub.descriptionStore.state.description!==this.state.agentPoolDescription}_getStateFromStores(){return{agentPool:this.props.storesHub.selectionStore.state.selectedAgentPool,hasManagePoolPermission:this.props.storesHub.securityStore.state.hasManagePoolPermission,agentPoolDescription:this.props.storesHub.descriptionStore.state.description,editingDescription:!1,status:this.props.storesHub.descriptionStore.state.status,owner:this._getOwnerIdentity(this.props.storesHub.selectionStore.state.selectedAgentPool),undoCount:0}}}t[e].PoolDetailsContainer=s}("ComponentsPoolDetailsContainer"),function(e){Wt=t[e]={};class s extends ue.VssComponent{constructor(e){super(e),this._onDeleteNode=e=>{this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(e,ct.ConfirmDeleteTitle,(0,m.format)(ct.ConfirmDeleteNodeMessage,e.name),2,this._confirmDeleteNode,this._cancelConfirmationDialog)},this._confirmDeleteNode=e=>{this.props.actionCreator.deleteElasticNode(e),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._cancelConfirmationDialog=()=>{this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._onChanged=()=>{this.setState(this._getStateFromStores())},this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.elasticNodeStore.addChangedListener(this._onChanged),this.props.storesHub.elasticPoolLogStore.addChangedListener(this._onChanged),this.props.storesHub.selectionStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.elasticNodeStore.removeChangedListener(this._onChanged),this.props.storesHub.elasticPoolLogStore.removeChangedListener(this._onChanged),this.props.storesHub.selectionStore.removeChangedListener(this._onChanged)}render(){return G.createElement("div",{className:"pipelines-pool-diagnostics page-content page-content-top"},G.createElement(ce.ConditionalChildren,{renderChildren:this.state.elasticNodes.length>0},G.createElement(_e.Card,{titleProps:{text:ct.SavedAgents,size:0},headerDescriptionProps:{text:this._getSavedAgentsCardDescription()},className:(0,Be.css)("flex-grow bolt-table-card",this.state.renderZeroData?void 0:"margin-bottom-16")},G.createElement(Vt.ElasticNodeList,{elasticNodes:this.state.elasticNodes,onDeleteNode:this._onDeleteNode}))),G.createElement(ce.ConditionalChildren,{renderChildren:this.state.renderZeroData},G.createElement(ve.ZeroData,{primaryText:ct.ZeroLogsPrimaryText,imagePath:(0,Ae.getAssetLocation)(this.context.pageContext,g.Assets.ZeroDataPng),imageAltText:ct.ZeroLogsPrimaryText})),G.createElement(ce.ConditionalChildren,{renderChildren:!this.state.renderZeroData},G.createElement(_e.Card,{titleProps:{text:ct.ElasticLogsCardTitle,size:0},headerDescriptionProps:{text:this._getLogsCardDescription()},className:"flex-grow bolt-table-card"},G.createElement(Ot.ElasticPoolLogList,{logs:this.state.logs}))))}_getSavedAgentsCardDescription(){return G.createElement("span",null,ct.SavedAgentsDescription,G.createElement(oe.Link,{className:"margin-left-4",href:g.FwLinks.ElasticPoolTroubleshooting,target:"_blank"},ct.SavedAgentsLearnMore))}_getLogsCardDescription(){return G.createElement(G.Fragment,null,G.createElement("div",null,this._getVirtualMachineScaleSetLogsLink(this.state.serviceEndpoint,this.state.virtualMachineScaleSet)),G.createElement("div",null,G.createElement(oe.Link,{href:g.FwLinks.ElasticPoolTroubleshooting,target:"_blank"},ct.ElasticLogsLearnMore)))}_getVirtualMachineScaleSetLogsLink(e,t){var s,i;return(null===(s=null==e?void 0:e.authorization)||void 0===s?void 0:s.parameters)&&(null===(i=null==e?void 0:e.authorization)||void 0===i?void 0:i.parameters[g.ServiceEndpointConstants.AzureTenantId])&&(null==t?void 0:t.id)?G.createElement(oe.Link,{href:(0,k.getAzurePortalVmssUrl)(e.authorization.parameters[g.ServiceEndpointConstants.AzureTenantId],t.id,"eventlogs"),target:"_blank"},ct.VmssLogsLink):G.createElement("span",null,ct.VmssLogsLink)}_getStateFromStores(){return{serviceEndpoint:this.props.storesHub.selectionStore.state.selectedServiceEndpoint,virtualMachineScaleSet:this.props.storesHub.selectionStore.state.selectedVirtualMachineScaleSet,logs:this.props.storesHub.elasticPoolLogStore.state.elasticPoolLogs,elasticNodes:this.props.storesHub.elasticNodeStore.state.elasticNodes.filter((e=>9===e.state)),renderZeroData:0===this.props.storesHub.elasticPoolLogStore.state.elasticPoolLogs.length}}}t[e].PoolDiagnosticsContainer=s}("ComponentsPoolDiagnosticsContainer"),function(e){$t=t[e]={};class s extends ue.VssComponent{constructor(e){super(e),this._renderFilterBar=()=>G.createElement(Je.JobsFilterBar,{agentColumnStyle:this.state.agentColumnStyle,agents:this.props.storesHub.agentStore.state,agentDefinitions:this.props.storesHub.agentDefinitionStore.state,projects:this.state.projects,filter:this.props.storesHub.jobStore.filter,onFilterToggled:this.props.onFilterToggled}),this._getLinkToAgent=e=>{const t=this.props.storesHub.selectionStore.state.selectedAgentQueue,s=this.props.storesHub.selectionStore.state.selectedAgentPool;if(e.reservedAgent&&(t||s)){return this.context.pageContext.getService("IPoolAdminLinkingService").getAgentUrl(t,s,e.reservedAgent)}},this._onChanged=()=>{this.setState(this._getStateFromStores())},this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.agentStore.addChangedListener(this._onChanged),this.props.storesHub.agentDefinitionStore.addChangedListener(this._onChanged),this.props.storesHub.selectionStore.addChangedListener(this._onChanged),this.props.storesHub.jobStore.addChangedListener(this._onChanged),this.props.storesHub.projectStore.addChangedListener(this._onChanged),this.props.storesHub.signalRStore.addChangedListener(this._onChanged),this.props.storesHub.jobStore.filter.subscribe(this._onChanged,Me.FILTER_CHANGE_EVENT)}componentWillUnmount(){this.props.storesHub.agentStore.removeChangedListener(this._onChanged),this.props.storesHub.agentDefinitionStore.removeChangedListener(this._onChanged),this.props.storesHub.selectionStore.removeChangedListener(this._onChanged),this.props.storesHub.jobStore.removeChangedListener(this._onChanged),this.props.storesHub.projectStore.removeChangedListener(this._onChanged),this.props.storesHub.signalRStore.removeChangedListener(this._onChanged),this.props.storesHub.jobStore.filter.unsubscribe(this._onChanged,Me.FILTER_CHANGE_EVENT)}render(){let e=ct.ZeroFilteredJobsPrimaryText,t=ct.ZeroFilteredJobsSecondaryText;return this.state.renderZeroData&&!this.state.renderFilterBar&&(e=ct.ZeroPoolJobsPrimaryText,t=ct.ZeroPoolJobsSecondaryText),G.createElement(G.Fragment,null,G.createElement(ce.ConditionalChildren,{renderChildren:this.state.renderFilterBar&&this.props.filterToggled},G.createElement("div",{className:"page-content-top page-content-left page-content-right"},this._renderFilterBar())),G.createElement("div",{className:"pipelines-pool-jobs page-content page-content-top"},this.state.renderZeroData&&G.createElement(ve.ZeroData,{primaryText:e,secondaryText:t,imagePath:(0,Ae.getAssetLocation)(this.context.pageContext,g.Assets.ZeroDataPng),imageAltText:""}),!this.state.renderZeroData&&G.createElement(_e.Card,{className:"flex-grow bolt-card-no-vertical-padding",contentProps:{contentPadding:!1}},G.createElement(ze.JobsList,{agentColumnStyle:this.state.agentColumnStyle,agentLinkProvider:this._getLinkToAgent,jobs:this.state.jobs,projects:this.state.projects,signalRState:this.state.signalRState}))))}_getStateFromStores(){const e=this.props.storesHub.selectionStore.state.selectedAgentPool,t=this.props.storesHub.projectStore.state,s=this.props.storesHub.jobStore.getFilteredJobs(t,!0);return{agentColumnStyle:this._getAgentColumnStyle(e),jobs:s,projects:t,signalRState:this.props.storesHub.signalRStore.state,renderZeroData:0===s.length,renderFilterBar:0!==this.props.storesHub.jobStore.state.length}}_getAgentColumnStyle(e){return(0,M.showPoolAgentSpecs)(e)?3:(0,M.showPoolAgents)(e)?2:1}}t[e].PoolJobsContainer=s}("ComponentsPoolJobsContainer"),function(e){Gt=t[e]={};class s extends G.PureComponent{constructor(e){super(e),this._onAuthorizeAllCheckboxChange=(e,t)=>{this.props.managePermission&&this.props.onSave(t)}}render(){return 2===this.props.status?G.createElement(ae.Toggle,{onChange:this._onAuthorizeAllCheckboxChange,checked:this.props.allPipelinesAuthorized,disabled:!this.props.managePermission,text:ct.PipelineSecurityAuthorizeAll}):G.createElement(X.Spinner,{className:"flex-grow flex-self-center",size:"large"})}}t[e].PoolPipelineSecurity=s}("ComponentsPoolPipelineSecurity"),function(e){Yt=t[e]={};const s="roles-scope-project",i="roles-scope-collection";class o extends ue.VssComponent{constructor(e,t){super(e,t),this._onRolesScopeMenuItemActivate=(e,t)=>{this.setState({selectedRolesScope:e.id})},this._onPipelineSecuritySave=e=>{this.state.selectedAgentQueue&&this._hasPipelineSecurityManagePermission()&&this.props.actionCreator.setPipelinesAuthorizedForQueue(this.state.selectedAgentQueue,e)},this._onChanged=()=>{this.setState(this._getStateFromStores())};const s=this.context.pageContext.getService("ITfsPageService");this._tfsPageData=s.getData();const i=t.pageContext.getService("IVssPageService"),o=t.pageContext.getService("IProjectDataService");this._vssPageData=i.getData(),this._vssPageData&&(this._onPrem=!this._vssPageData.isHosted),this._project=o.getProjectData(),this.state=this._getStateFromStores()}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onChanged),this.props.storesHub.securityStore.addChangedListener(this._onChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onChanged),this.props.storesHub.securityStore.removeChangedListener(this._onChanged)}render(){var e,t;const i=this.state.selectedRolesScope===s?this.state.selectedAgentQueue:this.state.selectedAgentPool,o={serviceInstanceId:null===(e=this._vssPageData)||void 0===e?void 0:e.serviceInstanceType,scopeId:this._getScopeId(),userId:null===(t=this._vssPageData)||void 0===t?void 0:t.user.id,resourceId:this._getResourceId(),canEdit:this.state.selectedRolesScope===s?this.state.hasManageQueuePermission:this.state.hasManagePoolPermission,manageRolesPermission:g.Permission.Manage,noPermissionMessage:ct.ManagePoolRolesNoPermissions,showAvatars:!0,enableToggleInheritence:void 0!==i,identityTypes:["user","group","servicePrincipal"]};return G.createElement("div",{className:"pipelines-pool-security"},G.createElement(ce.ConditionalChildren,{renderChildren:void 0!==this.state.selectedAgentQueue},G.createElement("div",{className:"page-content-top page-content-left page-content-right"},(0,Qe.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.Policy.AllowAuthorizingOnlySomePipelineForQueues",!1)?G.createElement(Ke.PipelinesAuthorizationComponent,{resourceId:this.state.selectedAgentQueue?this.state.selectedAgentQueue.id.toString():"",resourceType:"queue",noAuthorizedPipelinesViewLearnMoreLink:g.FwLinks.AgentPoolsSecurityUrl,noRestrictionsViewLearnMoreLink:g.FwLinks.AgentPoolsSecurityUrl,hideRestrictPermissionButton:this.state.selectedAgentPool&&this.state.selectedAgentPool.isHosted,canEditPipelinePermission:this._hasPipelineSecurityManagePermission(),canOpenAccess:this._hasPipelineSecurityManageAllPermission(),canRestrictAccess:this._hasPipelineSecurityManagePermission()}):G.createElement(_e.Card,{className:"flex-grow",titleProps:{text:ct.PipelineSecurityTitle,size:0}},G.createElement(Gt.PoolPipelineSecurity,{allPipelinesAuthorized:this._getPipelinesAuthorizedForQueue(),managePermission:this._hasPipelineSecurityManagePermission(),status:this.state.status,onSave:this._onPipelineSecuritySave})))),G.createElement("div",{className:"page-content-top page-content"},G.createElement(_e.Card,{className:"roles-card flex-grow",titleProps:{text:ct.UserSecurityTitle,size:0},headerCommandBarItems:this._getRolesCommandBarItems()},G.createElement(Ze.RoleAssignment,Object.assign({},o)))))}_getRolesCommandBarItems(){if(this._project){const e=this._onPrem?ct.RolesScopeCollection:ct.RolesScopeOrganization;return[{id:"roles-card-header",text:this.state.selectedRolesScope===s?ct.RolesScopeProject:e,subMenuProps:{id:"roles-scope-menu",items:[{id:s,text:ct.RolesScopeProject,onActivate:this._onRolesScopeMenuItemActivate},{id:i,text:e,onActivate:this._onRolesScopeMenuItemActivate}]}}]}return[]}_getPipelinesAuthorizedForQueue(){return!(!this.state.selectedAgentPool||!this.state.selectedAgentPool.isHosted)||this.state.pipelinesAuthorizedForQueue}_hasPipelineSecurityManagePermission(){return(!this.state.selectedAgentPool||!this.state.selectedAgentPool.isHosted)&&(this.state.selectedAgentQueue?this.state.hasManageQueuePermission:this.state.hasManagePoolPermission)}_hasPipelineSecurityManageAllPermission(){return(!this.state.selectedAgentPool||!this.state.selectedAgentPool.isHosted)&&(this.state.selectedAgentQueue?this.state.hasManageAllQueuesPermission:this.state.hasManageAllPoolsPermission)}_getStateFromStores(){return{selectedAgentQueue:this.props.storesHub.selectionStore.state.selectedAgentQueue,selectedAgentPool:this.props.storesHub.selectionStore.state.selectedAgentPool,hasManageQueuePermission:this.props.storesHub.securityStore.state.hasManageQueuePermission,hasManagePoolPermission:this.props.storesHub.securityStore.state.hasManagePoolPermission,hasManageAllQueuesPermission:this.props.storesHub.securityStore.state.hasManageAllQueuesPermission,hasManageAllPoolsPermission:this.props.storesHub.securityStore.state.hasManageAllPoolsPermission,pipelinesAuthorizedForQueue:this.props.storesHub.securityStore.state.pipelinesAuthorizedForQueue,status:this.props.storesHub.securityStore.state.status,selectedRolesScope:this._project?s:i}}_getResourceId(){const e=this.context.pageContext.getService("IProjectDataService"),t=this.state.selectedRolesScope===s?qe.PoolRolesScope.Queue:qe.PoolRolesScope.Pool,i=this.state.selectedRolesScope===s?this.state.selectedAgentQueue:this.state.selectedAgentPool;if(t===qe.PoolRolesScope.Queue&&e.hasProjectData()){let e;i&&(e=i.id);let t="";return this._tfsPageData&&this._tfsPageData.project&&(t=this._tfsPageData.project.id),(0,m.format)("{0}_{1}",t,e)}return i?i.id.toString():"0"}_getScopeId(){const e=this.state.selectedRolesScope===s?qe.PoolRolesScope.Queue:qe.PoolRolesScope.Pool,t=this.state.selectedRolesScope===s?this.state.selectedAgentQueue:this.state.selectedAgentPool;return e===qe.PoolRolesScope.Queue?t?"distributedtask.agentqueuerole":"distributedtask.globalagentqueuerole":t?"distributedtask.agentpoolrole":"distributedtask.globalagentpoolrole"}}t[e].SecurityContainer=o}("ComponentsSecurityContainer"),function(e){Xt=t[e]={};const s=()=>G.createElement(X.Spinner,{className:"pipelines-pool-settings-spinner scroll-hidden flex-grow flex-self-center",size:"large"});class i extends ue.VssComponent{constructor(e,t){super(e,t),this._dayCheckboxItems=[{value:1,label:ct.DayAbbreviationMonday},{value:2,label:ct.DayAbbreviationTuesday},{value:4,label:ct.DayAbbreviationWednesday},{value:8,label:ct.DayAbbreviationThursday},{value:16,label:ct.DayAbbreviationFriday},{value:32,label:ct.DayAbbreviationSaturday},{value:64,label:ct.DayAbbreviationSunday}],this._hourSelection=new ke.DropdownSelection,this._minuteSelection=new ke.DropdownSelection,this._timeZoneSelection=new ke.DropdownSelection,this._onStoreChanged=()=>{this.setState(this._getStateFromStores())},this._getElasticPoolCommandBarItems=()=>[{id:"undo",text:ct.Undo,disabled:!this._elasticPoolIsDirty(),onActivate:()=>{this.setState(this._getStateFromStores())}},{important:!0,id:"save",text:ct.Save,disabled:!this._elasticPoolIsDirty()||!this._elasticPoolIsValid(),onActivate:()=>{this.state.elasticPool&&this._elasticPoolIsValid()&&void 0!==this.state.maxCapacity&&void 0!==this.state.desiredIdle&&void 0!==this.state.timeToLiveMinutes&&this.props.actionCreator.updateElasticPoolSettings(this.state.recycleAfterEachUse,this.state.maxSavedNodeCount,this.state.maxCapacity,this.state.desiredIdle,this.state.timeToLiveMinutes,this.state.agentInteractiveUI)},isPrimary:!0}],this._getAzureSubscriptionCommandBarItems=()=>[{important:!0,id:"edit",text:ct.Edit,onActivate:()=>{this.setState({azureSubscriptionSettingsPanelIsOpen:!0})},isPrimary:!0}],this._setJobTimeout=(e,t)=>{this._onNumericTextFieldChanged(t,((e,t)=>{e.jobTimeout=t}),((e,t)=>{e.jobTimeoutError=t}))},this._setConcurrencyPercentage=(e,t)=>{this._onNumericTextFieldChanged(t,((e,t)=>{e.concurrencyPercentage=t}),((e,t)=>{e.concurrencyPercentageError=t}))},this._setHistoryToKeep=(e,t)=>{this._onNumericTextFieldChanged(t,((e,t)=>{e.historyToKeep=t}),((e,t)=>{e.historyToKeepError=t}))},this._setDirectoryExpiration=(e,t)=>{this._onNumericTextFieldChanged(t,((e,t)=>{e.directoryExpiration=t}),((e,t)=>{e.directoryExpirationError=t}))},this._onNumericTextFieldChanged=(e,t,s)=>{const i={};t(i,e),e?/^\d+$/.test(e)?s(i,""):s(i,ct.MaintenanceJobMustBeIntegerError):s(i,ct.MaintenanceJobRequiredError),this.setState(i)},this._onAutoProvisionChanged=(e,t)=>{this.props.actionCreator.setPoolAutoProvisioning(t)},this._onAutoUpdateChanged=(e,t)=>{t?this.props.actionCreator.setPoolAutoUpdate(t):this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(this.state.agentPool,ct.DisableAgentAutoUpdate,ct.DisableAgentAutoUpdateDetails,3,this._confirmDisableAgentAutoUpdate,this._dismissConfirmationDialog)},this._confirmDisableAgentAutoUpdate=()=>{this.props.actionCreator.setPoolAutoUpdate(!1),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._dismissConfirmationDialog=()=>{this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._onElasticPoolSettingsChanged=(e,t,s,i,o,n)=>{this.state.elasticPool&&this.state.elasticPool.recycleAfterEachUse!==e?(this.setState({maxSavedNodeCount:t?1:0,maxCapacity:s,desiredIdle:i,timeToLiveMinutes:o,agentInteractiveUI:n}),this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(this.state.agentPool,ct.RecycleAfterEachUseDialogTitle,ct.RecycleAfterEachUseDialogBody,3,this._confirmToggleRecycleAfterEachUse,this._dismissConfirmationDialog)):this.state.elasticPool&&this.state.elasticPool.agentInteractiveUI!==n?(this.setState({recycleAfterEachUse:e,maxSavedNodeCount:t?1:0,maxCapacity:s,desiredIdle:i,timeToLiveMinutes:o}),this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(this.state.agentPool,ct.AgentInteractiveUIDialogTitle,ct.AgentInteractiveUIDialogBody,3,this._confirmToggleAgentInteractiveUI,this._dismissConfirmationDialog)):this.setState({recycleAfterEachUse:e,maxSavedNodeCount:t?1:0,maxCapacity:s,desiredIdle:i,timeToLiveMinutes:o,agentInteractiveUI:n})},this._confirmToggleAgentInteractiveUI=()=>{this.setState({agentInteractiveUI:!!this.state.elasticPool&&!this.state.elasticPool.agentInteractiveUI}),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._confirmToggleRecycleAfterEachUse=()=>{this.setState({recycleAfterEachUse:!!this.state.elasticPool&&!this.state.elasticPool.recycleAfterEachUse}),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._createDefinitionFromSettings=()=>{const e=this.props.storesHub.maintenanceStore.state.maintenanceDefinitions[0];return{id:e?e.id:0,enabled:this.state.maintenanceJobEnabled,jobTimeoutInMinutes:Number(this.state.jobTimeout),maxConcurrentAgentsPercentage:Number(this.state.concurrencyPercentage),retentionPolicy:{numberOfHistoryRecordsToKeep:Number(this.state.historyToKeep)},options:{workingDirectoryExpirationInDays:Number(this.state.directoryExpiration)},scheduleSetting:{scheduleJobId:e&&e.scheduleSetting?e.scheduleSetting.scheduleJobId:(0,m.newGuid)(),startHours:this.state.hourToRun,startMinutes:this.state.minuteToRun,daysToBuild:this.state.daysToRun,timeZoneId:this.state.timeZoneId}}},this._definitionIsDirty=()=>{const e=this.props.storesHub.maintenanceStore.state.maintenanceDefinitions[0];return e?e.enabled!==this.state.maintenanceJobEnabled||e.jobTimeoutInMinutes.toString()!==this.state.jobTimeout||e.maxConcurrentAgentsPercentage.toString()!==this.state.concurrencyPercentage||e.retentionPolicy.numberOfHistoryRecordsToKeep.toString()!==this.state.historyToKeep||e.options.workingDirectoryExpirationInDays.toString()!==this.state.directoryExpiration||e.scheduleSetting.startHours!==this.state.hourToRun||e.scheduleSetting.startMinutes!==this.state.minuteToRun||e.scheduleSetting.daysToBuild!==this.state.daysToRun||e.scheduleSetting.timeZoneId!==this.state.timeZoneId:this.state.maintenanceJobEnabled},this._definitionIsValid=()=>!(this.state.jobTimeoutError||this.state.concurrencyPercentageError||this.state.directoryExpirationError||this.state.historyToKeepError||0===this.state.daysToRun),this._getMaintenanceCommandBarItems=()=>[{id:"undo",text:ct.Undo,disabled:!this._definitionIsDirty(),onActivate:()=>{this.setState(this._getStateFromStores())}},{important:!0,id:"save",text:ct.Save,disabled:!this._definitionIsDirty()||!this._definitionIsValid(),onActivate:()=>{if(this.state.agentPool){const e=this._createDefinitionFromSettings();this.props.actionCreator.createOrUpdateMaintenanceDefinition(e,this.state.agentPool.id)}},isPrimary:!0,tooltipProps:{text:this.state.maintenanceJobEnabled&&0===this.state.daysToRun?ct.NoDaySelected:void 0}}],this._getTimeOptions=e=>{const t=[];for(let s=0;s<e;s++)t.push({id:s.toString(),text:s<10?"0"+s.toString():s.toString()});return t},this.state=this._getStateFromStores(),this._hourOptions=this._getTimeOptions(24),this._minuteOptions=this._getTimeOptions(60)}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onStoreChanged),this.props.storesHub.maintenanceStore.addChangedListener(this._onStoreChanged),this.props.storesHub.resourceLimitStore.addChangedListener(this._onStoreChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onStoreChanged),this.props.storesHub.maintenanceStore.removeChangedListener(this._onStoreChanged),this.props.storesHub.resourceLimitStore.removeChangedListener(this._onStoreChanged)}render(){var e;return this.state.agentPool&&1!==this.props.storesHub.maintenanceStore.state.status?G.createElement("div",{className:"pipelines-pool-settings page-content page-content-top"},G.createElement(ce.ConditionalChildren,{renderChildren:void 0!==this.state.elasticPool},this._renderElasticPoolSettings(),G.createElement("div",{className:"card-spacer flex-grow"}),this._renderAzureSubscriptionSettings()),G.createElement(ce.ConditionalChildren,{renderChildren:void 0!==this.state.elasticPool&&!this.state.hasProjectData},G.createElement("div",{className:"card-spacer flex-grow"})),G.createElement(ce.ConditionalChildren,{renderChildren:!this.state.hasProjectData},this._renderAutoProvisionSettings(),G.createElement("div",{className:"card-spacer flex-grow"}),this._renderAutoUpdateSettings(),G.createElement("div",{className:"card-spacer flex-grow"}),this._renderMaintenanceJobSettings()),G.createElement(Xe.ConfirmationDialog,{confirmationDialogStore:this.props.storesHub.confirmationDialogStore}),G.createElement(Rt.AzureSubscriptionSettingsPanel,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub,isOpen:this.state.azureSubscriptionSettingsPanelIsOpen,onDismiss:()=>this.setState({azureSubscriptionSettingsPanelIsOpen:!1}),recycleAfterEachUse:null===(e=this.state.elasticPool)||void 0===e?void 0:e.recycleAfterEachUse})):G.createElement(s,null)}_renderElasticPoolSettings(){return void 0!==this.state.elasticPool?G.createElement(_e.Card,{className:"elastic-pool-setting-card flex-grow",titleProps:{text:ct.ElasticPoolSettings,size:0},headerCommandBarItems:this._getElasticPoolCommandBarItems()},G.createElement(et.ElasticPoolSettings,{showSaveFailedAgentCheckbox:!0,recycleAfterEachUse:this.state.recycleAfterEachUse,saveFailedAgents:this.state.maxSavedNodeCount>0,maxCapacity:this.state.maxCapacity,desiredIdle:this.state.desiredIdle,agentInteractiveUI:this.state.agentInteractiveUI,timeToLiveMinutes:this.state.timeToLiveMinutes,operatingSystem:this.state.operatingSystem,resourceLimits:this.state.resourceLimits,virtualMachineScaleSet:this.state.virtualMachineScaleSet,onSettingsChanged:this._onElasticPoolSettingsChanged})):void 0}_elasticPoolIsDirty(){return!!this.state.elasticPool&&(this.state.recycleAfterEachUse!==this.state.elasticPool.recycleAfterEachUse||this.state.maxSavedNodeCount!==this.state.elasticPool.maxSavedNodeCount||this.state.maxCapacity!==this.state.elasticPool.maxCapacity||this.state.desiredIdle!==this.state.elasticPool.desiredIdle||this.state.timeToLiveMinutes!==this.state.elasticPool.timeToLiveMinutes||this.state.agentInteractiveUI!==this.state.elasticPool.agentInteractiveUI)}_elasticPoolIsValid(){return!!this.state.elasticPool&&(void 0!==this.state.maxCapacity&&this.state.maxCapacity>=0&&this.state.maxCapacity<=1e3&&void 0!==this.state.desiredIdle&&this.state.desiredIdle>=0&&this.state.desiredIdle<=this.state.maxCapacity&&void 0!==this.state.timeToLiveMinutes&&this.state.timeToLiveMinutes>=0&&this.state.timeToLiveMinutes<=1e4)}_renderAzureSubscriptionSettings(){const e=this.state.elasticPool,t=this.state.serviceEndpoint,s=this.state.virtualMachineScaleSet;return e?G.createElement(_e.Card,{className:"azure-subscription-setting-card flex-grow",titleProps:{text:ct.AzureSubscriptionSettings,size:0},headerCommandBarItems:this._getAzureSubscriptionCommandBarItems()},G.createElement("div",{className:"flex-column"},G.createElement("div",null,ct.ServiceConnectionNameLabel,this._getServiceConnectionNameContent(e,t)),G.createElement("div",null,ct.VirtualMachineScaleSetNameLabel,this._getVirtualMachineScaleSetNameContent(t,s)))):void 0}_getServiceConnectionNameContent(e,t){if(null==t?void 0:t.name){const s=this.context.pageContext.getService("IPoolAdminLinkingService");return G.createElement(oe.Link,{className:"margin-left-4",href:s.getServiceConnectionUrl(e)},t.name)}return G.createElement("span",{className:"margin-left-4"},ct.ResourceUnavailable)}_getVirtualMachineScaleSetNameContent(e,t){var s,i;return(null===(s=null==e?void 0:e.authorization)||void 0===s?void 0:s.parameters)&&(null===(i=null==e?void 0:e.authorization)||void 0===i?void 0:i.parameters[g.ServiceEndpointConstants.AzureTenantId])&&(null==t?void 0:t.id)&&(null==t?void 0:t.name)?G.createElement(oe.Link,{className:"margin-left-4",href:(0,k.getAzurePortalVmssUrl)(e.authorization.parameters[g.ServiceEndpointConstants.AzureTenantId],t.id),target:"_blank"},t.name):(null==t?void 0:t.name)?G.createElement("span",{className:"margin-left-4"},t.name):G.createElement("span",{className:"margin-left-4"},ct.ResourceUnavailable)}_renderAutoProvisionSettings(){const e=void 0!==this.state.agentPool&&this.state.agentPool.autoProvision;return G.createElement(_e.Card,{className:"auto-provision-setting-card flex-grow",titleProps:{text:ct.AutoProvisioning,size:0}},G.createElement(ae.Toggle,{onChange:this._onAutoProvisionChanged,checked:e,text:ct.AutoProvisionSettingSwitchLabel}))}_renderAutoUpdateSettings(){const e=void 0===this.state.agentPool||this.state.agentPool.autoUpdate;return G.createElement(_e.Card,{className:"auto-provision-setting-card flex-grow",titleProps:{text:ct.UpdateSettings,size:0}},G.createElement(ae.Toggle,{onChange:this._onAutoUpdateChanged,checked:e,text:ct.AutoUpdate}))}_renderMaintenanceJobSettings(){const{maintenanceJobEnabled:e,jobTimeout:t,concurrencyPercentage:s,historyToKeep:i,directoryExpiration:o,daysToRun:n,jobTimeoutError:a,concurrencyPercentageError:r,historyToKeepError:l,directoryExpirationError:c}=this.state;return G.createElement(_e.Card,{className:"maintenance-job-settings-card flex-grow",titleProps:{text:ct.MaintenanceJob,size:0},headerCommandBarItems:this._getMaintenanceCommandBarItems()},G.createElement("div",{className:"flex-column"},G.createElement(ae.Toggle,{onChange:(e,t)=>this.setState({maintenanceJobEnabled:t}),checked:this.state.maintenanceJobEnabled,text:ct.MaintenanceJobEnableLabel}),e&&G.createElement("div",null,G.createElement(Ge.Header,{className:"maintenance-job-settings-header",title:ct.Settings,titleSize:0}),G.createElement($e.FormItem,{className:"maintenance-job-settings-form-item",message:a,error:Boolean(a)},G.createElement(Ye.TextField,{className:"maintenance-job-settings-text-field",label:ct.MaintenanceJobTimeoutLabel,value:t,required:!0,onChange:this._setJobTimeout})),G.createElement($e.FormItem,{className:"maintenance-job-settings-form-item",message:r,error:Boolean(r)},G.createElement(Ye.TextField,{className:"maintenance-job-settings-text-field",label:ct.MaintenanceJobConcurrencyLabel,value:s,required:!0,onChange:this._setConcurrencyPercentage})),G.createElement($e.FormItem,{className:"maintenance-job-settings-form-item",message:l,error:Boolean(l)},G.createElement(Ye.TextField,{className:"maintenance-job-settings-text-field",label:ct.MaintenanceJobHistoryLabel,value:i,required:!0,onChange:this._setHistoryToKeep})),G.createElement($e.FormItem,{className:"maintenance-job-settings-form-item",message:c,error:Boolean(c)},G.createElement(Ye.TextField,{className:"maintenance-job-settings-text-field",label:ct.MaintenanceJobDirectoryExpirationLabel,value:o,required:!0,onChange:this._setDirectoryExpiration})),G.createElement(Ge.Header,{className:"maintenance-job-settings-header",title:ct.Scheduling,titleSize:0}),G.createElement("div",{className:"flex-row maintenance-job-scheduling-time-container"},G.createElement("span",{className:"maintenance-job-scheduling-time-label"},ct.MaintenanceJobTimeLabel),G.createElement(Le.Dropdown,{className:"maintenance-job-scheduling-time-combobox",calloutContentClassName:"maintenance-job-scheduling-time-callout",ariaLabel:ct.MaintenanceJobHourAriaLabel,items:this._hourOptions,selection:this._hourSelection,onSelect:(e,t)=>this.setState({hourToRun:Number(t.id)}),showFilterBox:!1}),G.createElement("span",{className:"maintenance-job-scheduling-time-label"},":"),G.createElement(Le.Dropdown,{className:"maintenance-job-scheduling-time-combobox",calloutContentClassName:"maintenance-job-scheduling-time-callout",ariaLabel:ct.MaintenanceJobMinuteAriaLabel,items:this._minuteOptions,selection:this._minuteSelection,onSelect:(e,t)=>this.setState({minuteToRun:Number(t.id)}),showFilterBox:!1}),G.createElement(Le.Dropdown,{className:"maintenance-job-scheduling-timezone-combobox",calloutContentClassName:"maintenance-job-scheduling-timezone-callout",ariaLabel:ct.MaintenanceJobTimeZoneAriaLabel,items:this._timezoneOptions,selection:this._timeZoneSelection,onSelect:(e,t)=>this.setState({timeZoneId:t.id}),showFilterBox:!1})),G.createElement("div",{className:"flex-row maintenance-job-scheduling-days-label-container"},G.createElement("span",{className:"maintenance-job-scheduling-days-label"},ct.MaintenanceJobDaysLabel)),G.createElement("div",{className:"flex-row maintenance-job-scheduling-days-container"},this._dayCheckboxItems.map((e=>G.createElement(We.Checkbox,{key:e.value,checked:Boolean(n&e.value),onChange:()=>this.setState({daysToRun:n^e.value}),label:e.label})))))))}_getStateFromStores(){let e={};const t=this.props.storesHub.maintenanceStore.state.maintenanceDefinitions[0],s=this.props.storesHub.selectionStore.state.selectedAgentPool,i=this.props.storesHub.selectionStore.state.selectedElasticPool,o=this.props.storesHub.selectionStore.state.selectedServiceEndpoint,n=this.props.storesHub.selectionStore.state.selectedVirtualMachineScaleSet,a=this.props.storesHub.resourceLimitStore.state.resourceLimits,r=this.context.pageContext.getService("IProjectDataService");e=t?{hasProjectData:r.hasProjectData(),agentPool:s,elasticPool:i,serviceEndpoint:o,virtualMachineScaleSet:n,azureSubscriptionSettingsPanelIsOpen:!1,maintenanceJobEnabled:t.enabled,jobTimeout:t.jobTimeoutInMinutes.toString(),concurrencyPercentage:t.maxConcurrentAgentsPercentage.toString(),historyToKeep:t.retentionPolicy.numberOfHistoryRecordsToKeep.toString(),directoryExpiration:t.options.workingDirectoryExpirationInDays.toString(),hourToRun:t.scheduleSetting.startHours,minuteToRun:t.scheduleSetting.startMinutes,daysToRun:t.scheduleSetting.daysToBuild,jobTimeoutError:"",concurrencyPercentageError:"",historyToKeepError:"",directoryExpirationError:"",timeZoneId:t.scheduleSetting.timeZoneId,recycleAfterEachUse:!!i&&i.recycleAfterEachUse,maxSavedNodeCount:i?i.maxSavedNodeCount:0,maxCapacity:i?i.maxCapacity:void 0,desiredIdle:i?i.desiredIdle:void 0,timeToLiveMinutes:i?i.timeToLiveMinutes:void 0,agentInteractiveUI:!!i&&i.agentInteractiveUI,operatingSystem:i?i.osType:void 0,resourceLimits:a}:{hasProjectData:r.hasProjectData(),agentPool:s,elasticPool:i,serviceEndpoint:o,virtualMachineScaleSet:n,azureSubscriptionSettingsPanelIsOpen:!1,maintenanceJobEnabled:!1,jobTimeout:"60",concurrencyPercentage:"25",historyToKeep:"10",directoryExpiration:"30",hourToRun:1,minuteToRun:0,daysToRun:0,jobTimeoutError:"",concurrencyPercentageError:"",historyToKeepError:"",directoryExpirationError:"",timeZoneId:"UTC",recycleAfterEachUse:!!i&&i.recycleAfterEachUse,maxSavedNodeCount:i?i.maxSavedNodeCount:0,maxCapacity:i?i.maxCapacity:void 0,desiredIdle:i?i.desiredIdle:void 0,timeToLiveMinutes:i?i.timeToLiveMinutes:void 0,agentInteractiveUI:!!i&&i.agentInteractiveUI,operatingSystem:i?i.osType:void 0,resourceLimits:a},this._hourSelection.select(e.hourToRun),this._minuteSelection.select(e.minuteToRun),!this._timezoneOptions&&this.props.storesHub.maintenanceStore.state.validTimeZones&&(this._timezoneOptions=this.props.storesHub.maintenanceStore.state.validTimeZones.map((e=>({id:e.id,text:e.name}))));const l=this._timezoneOptions.findIndex((t=>t.id==e.timeZoneId));return this._timeZoneSelection.select(l),e}}t[e].SettingsContainer=i}("ComponentsSettingsContainer"),function(e){es=t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this.filterToggled=new te.ObservableValue(!1),this._renderAdditionalTabBarContent=()=>{if(this.state.selectedTabId===g.PoolHubViewKeys.Jobs)return this.props.storesHub.jobStore.state.length>0?G.createElement(Ue.HeaderCommandBarWithFilter,{items:[],filter:this.props.storesHub.jobStore.filter,filterToggled:this.filterToggled}):void 0},this._getTabContent=()=>{switch(this.state.selectedTabId){case g.PoolHubViewKeys.Details:return G.createElement(Zt.PoolDetailsContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Security:return G.createElement(Yt.SecurityContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Jobs:return G.createElement($t.PoolJobsContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub,filterToggled:this.filterToggled,onFilterToggled:this._onFilterBarToggled});case g.PoolHubViewKeys.Agents:return G.createElement(Jt.PoolAgentsContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Settings:return G.createElement(Xt.SettingsContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.MaintenanceHistory:return G.createElement(Bt.MaintenanceHistoryContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Diagnostics:return G.createElement(Wt.PoolDiagnosticsContainer,{actionCreator:this.props.actionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Analytics:return G.createElement(qt.PoolAnalytics,{actionCreator:this.props.graphActionCreator,storesHub:this.props.storesHub});case g.PoolHubViewKeys.Checks:return G.createElement("div",{className:"page-content page-content-top"},this.state.selectedAgentQueue&&G.createElement(Kt.PoolChecksContainer,{storesHub:this.props.storesHub}));default:return G.createElement("div",null)}},this._onFilterBarToggled=()=>{this.filterToggled.value=!this.filterToggled.value},this._onStoreChanged=()=>{this.setState(this._getStateFromStores())},this._onSelectedTabChanged=e=>{this.props.actionCreator.updateSelectedTab(e)},this._onNotificationDismissed=e=>{this.props.actionCreator.notificationActionCreator.dismissNotification(e)},this._confirmUpdateAgents=()=>{if(!this.state.selectedAgentPool)return;const e=G.createElement(ye.FormatComponent,{format:ct.ConfirmUpdateAllAgentsMessage},G.createElement("span",{className:"fontWeightSemiBold"},this.state.selectedAgentPool.name),G.createElement("br",null),G.createElement("br",null));this.props.actionCreator.confirmationDialogActionCreator.showConfirmationDialog(this.state.selectedAgentPool,ct.ConfirmUpdateTitle,e,1,this._updateAgents,this._dismissConfirmationDialog)},this._updateAgents=e=>{this.props.actionCreator.pushAllAgentsUpdateRequest(e.id),this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this._dismissConfirmationDialog=()=>{this.props.actionCreator.confirmationDialogActionCreator.dismissConfirmationDialog()},this.state=this._getStateFromStores(),this.enabledAgentPoolChecksTab=(0,Qe.isFeatureFlagEnabled)(t.pageContext,"DistributedTask.EnabledAgentPoolChecksTab",!1),this.showCheckIssueMessageCard=(0,Qe.isFeatureFlagEnabled)(t.pageContext,rt.FeatureFlagConstants.EnableChecksScalabilityResourceIssues,!1)}render(){return G.createElement(ot.Surface,{background:1},G.createElement(it.Page,{className:"pipelines-pool-hub flex-grow"},G.createElement(Ge.Header,{title:this._getPageTitle(),titleSize:1,titleIconProps:{className:"pool-hub-title-icon",render:e=>this._renderTitleIcon(e)},commandBarItems:this._getCommandBarItems()}),this._getCheckIssueCardComponent(),G.createElement(nt.TabBar,{renderAdditionalContent:this._renderAdditionalTabBarContent,onSelectedTabChanged:this._onSelectedTabChanged,selectedTabId:this.state.selectedTabId},G.createElement(nt.Tab,{name:ct.Jobs,id:g.PoolHubViewKeys.Jobs}),this.state.agentsTabVisible&&G.createElement(nt.Tab,{name:ct.Agents,id:g.PoolHubViewKeys.Agents}),G.createElement(nt.Tab,{name:ct.Details,id:g.PoolHubViewKeys.Details}),G.createElement(nt.Tab,{name:ct.Security,id:g.PoolHubViewKeys.Security}),this.state.selectedAgentQueue&&this.enabledAgentPoolChecksTab&&G.createElement(nt.Tab,{name:ct.Checks,id:g.PoolHubViewKeys.Checks}),this.state.selectedAgentPool&&(0,M.isElastic)(this.state.selectedAgentPool)&&G.createElement(nt.Tab,{name:ct.Diagnostics,id:g.PoolHubViewKeys.Diagnostics}),(!this.state.hasProjectData&&this.state.selectedAgentPool&&!(0,M.isHostedOrPoolProviderBacked)(this.state.selectedAgentPool)||this.state.selectedElasticPool)&&G.createElement(nt.Tab,{name:ct.Settings,id:g.PoolHubViewKeys.Settings}),!this.state.hasProjectData&&this.state.selectedAgentPool&&!(0,M.isHostedOrPoolProviderBacked)(this.state.selectedAgentPool)&&G.createElement(nt.Tab,{name:ct.MaintenanceHistory,id:g.PoolHubViewKeys.MaintenanceHistory}),this.state.selectedAgentPool&&G.createElement(nt.Tab,{name:ct.Analytics,id:g.PoolHubViewKeys.Analytics})),G.createElement(tt.NotificationArea,{notifications:this.state.notifications,onNotificationDismissed:this._onNotificationDismissed}),this._getTabContent(),this.state.downloadAgentDialogVisible&&G.createElement(Mt.AgentAcquisitionDialog,{onCancel:()=>this.props.actionCreator.dismissDownloadAgentDialog()}),G.createElement(Xe.ConfirmationDialog,{confirmationDialogStore:this.props.storesHub.confirmationDialogStore})))}_getCheckIssueCardComponent(){if(this.showCheckIssueMessageCard&&this.state.selectedAgentQueue)return G.createElement(at.ChecksIssuesMessageComponent,{resourceTypeName:rt.ResourceTypeNames.Queue,resourceIds:this.state.selectedAgentQueue.id.toString()})}componentDidMount(){this.props.storesHub.selectionStore.addChangedListener(this._onStoreChanged),this.props.storesHub.notificationStore.addChangedListener(this._onStoreChanged),this.props.storesHub.downloadAgentDialogStore.addChangedListener(this._onStoreChanged)}componentWillUnmount(){this.props.storesHub.selectionStore.removeChangedListener(this._onStoreChanged),this.props.storesHub.notificationStore.removeChangedListener(this._onStoreChanged),this.props.storesHub.downloadAgentDialogStore.removeChangedListener(this._onStoreChanged)}_getStateFromStores(){const e=this.context.pageContext.getService("IProjectDataService"),t=this.props.storesHub.selectionStore.state.selectedAgentPool;return{selectedAgentPool:t,selectedAgentQueue:this.props.storesHub.selectionStore.state.selectedAgentQueue,selectedElasticPool:this.props.storesHub.selectionStore.state.selectedElasticPool,selectedTabId:this.props.storesHub.selectionStore.state.selectedTabId,notifications:this.props.storesHub.notificationStore.state,downloadAgentDialogVisible:this.props.storesHub.downloadAgentDialogStore.state.isOpen,agentsTabVisible:(0,M.showPoolAgents)(t),hasProjectData:e.hasProjectData(),hasManagePoolPermission:this.props.storesHub.securityStore.state.hasManagePoolPermission}}_getPageTitle(){return this.state.selectedAgentQueue?this.state.selectedAgentQueue.name:this.state.selectedAgentPool?this.state.selectedAgentPool.name:""}_renderTitleIcon(e){return G.createElement(st.PoolTypeIcon,{isHosted:(0,M.isHostedOrPoolProviderBacked)(this.state.selectedAgentPool),isElastic:(0,M.isElastic)(this.state.selectedAgentPool),className:e})}_getCommandBarItems(){const e=[];if(this.state.selectedAgentPool&&!(0,M.isHostedOrPoolProviderBacked)(this.state.selectedAgentPool)){const t=(0,M.isElastic)(this.state.selectedAgentPool);e.push({text:ct.UpdateAllAgents,id:"updateAgents",isPrimary:t,onActivate:()=>this._confirmUpdateAgents()}),t||e.push({text:ct.NewAgent,id:"newAgent",isPrimary:!t,onActivate:()=>this.props.actionCreator.showDownloadAgentDialog()})}return this.state.selectedAgentQueue&&!this.enabledAgentPoolChecksTab&&e.push({text:ct.Checks,id:"checks",important:!1,iconProps:{iconName:"WaitlistConfirm"},onActivate:()=>{if(this.state.selectedAgentQueue){const e=this.context.pageContext.getService("IPoolAdminLinkingService").getQueueChecksUrl(this.state.selectedAgentQueue);e&&(0,se.onClickFPS)(this.context.pageContext,e,!0)}}}),e}}t[e].PoolHub=s}("ComponentsPoolHub"),function(e){t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._onDataRenderedCalled=!1,this._getChartOptions=e=>{const t=e[0].consumptionTimeline.map((e=>e.date)),s=[];e.forEach((e=>{s.push({name:e.name,data:e.consumptionTimeline.map((e=>e.consumption))})}));return{chartType:we.ChartTypesConstants.StackedColumn,hostOptions:{height:200},legend:{rightAlign:!0},pageContext:this.context.pageContext,series:s,suppressAnimation:!0,title:this._getChartTitle(),tooltip:{customTooltipMapping:e=>e.map((e=>({styleType:{color:e.color,type:1},text:`${e.seriesName}: ${e.values[0]}%`})))},xAxis:{labelFormatMode:we.LabelFormatModes.DateTime_DayInMonth,labelsEnabled:!0,labelValues:t},yAxis:{min:0,max:100,title:ct.TopFivePipelinesYAxisLabel.toLocaleUpperCase()}}},this._verifyChartData=e=>!!(e&&e.length>0),this._onStoreUpdate=()=>{this.setState(this.props.store.getConsumptionState())},this._getChartTitle=()=>{const{isHosted:e,isPublic:t}=this.props;return e?t?ct.TopFivePipelinesPublic:ct.TopFivePipelinesPrivate:t?ct.TopFivePipelinesOnlineAgents:ct.TopFivePipelinesPrivate},this.state={errorText:this.props.errorText}}componentDidMount(){super.componentDidMount(),this.props&&(this.props.store.addChangedListener(this._onStoreUpdate),this.setState(this.props.store.getConsumptionState()),this.performOnDataRendered())}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.performOnDataRendered()}componentWillUnmount(){this.props&&this.props.store.removeChangedListener(this._onStoreUpdate),super.componentWillUnmount()}render(){return G.createElement(_e.Card,{className:this.props.className,titleProps:{text:this._getChartTitle()}},this.getElementToDisplay())}getElementToDisplay(){if(this.state.errorText)return G.createElement(De.ErrorComponent,{className:"flex-grow",errorMessage:this.state.errorText});if(null!=this.state.data){const e=this.state.data;return G.createElement("div",{className:"flex-row flex-wrap flex-grow"},G.createElement("div",{className:"flex-grow"},this._verifyChartData(e)&&G.createElement(lt.Chart,Object.assign({},this._getChartOptions(e)))))}return G.createElement(fe.LoadingComponent,{className:"card-spinner flex-column flex-grow",size:"large"})}performOnDataRendered(){(this.state.data||this.state.errorText)&&this.props.onDataRendered&&!this._onDataRenderedCalled&&(this.props.onDataRendered(),this._onDataRenderedCalled=!0)}}t[e].TopPipelinesCard=s}("ComponentsTopPipelinesCard"),function(e){t[e]={};class s extends ue.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._dataReady=!1,this._markDataReady=()=>{this._dataReady=!0,this._markTti()},this._flux=new Ut.Flux(t.pageContext),this.state={dataReady:this._getInitialDataReady()},this._flux.actionsHub.agentQueuePipelinesAuthorizedUpdated.addListener(this._markDataReady),this._flux.actionsHub.agentsUpdated.addListener(this._markDataReady),this._flux.actionsHub.agentPoolDescriptionUpdated.addListener(this._markDataReady),this._flux.actionsHub.elasticPoolLogsUpdated.addListener(this._markDataReady),this._flux.poolActionCreator.initializePool(),this.initializeSignalR(t),this._breadcrumbService=t.pageContext.getService(g.ServiceIds.HeaderBreadcrumbService),this._breadcrumbService.refresh({agentPool:this._flux.storesHub.selectionStore.state.selectedAgentPool,agentQueue:this._flux.storesHub.selectionStore.state.selectedAgentQueue,agent:void 0})}componentDidMount(){this._markTti()}componentWillUnmount(){this._flux.actionsHub.agentQueuePipelinesAuthorizedUpdated.removeListener(this._markDataReady),this._flux.actionsHub.agentsUpdated.removeListener(this._markDataReady),this._flux.actionsHub.agentPoolDescriptionUpdated.removeListener(this._markDataReady),this._flux.actionsHub.elasticPoolLogsUpdated.removeListener(this._markDataReady),this._flux.dispose(),this._signalRHub&&this._signalRHub.dispose()}componentDidUpdate(){this._markTti()}render(){return G.createElement(es.PoolHub,{actionCreator:this._flux.poolActionCreator,graphActionCreator:this._flux.poolGraphActionCreator,storesHub:this._flux.storesHub})}initializeSignalR(e){const t=e.pageContext.getService("IProjectDataService"),s=e.pageContext.getService("IVssPageService").getData();if(s){const i=t.getProjectData(),o={hostId:s.hostId,isHosted:s.isHosted,hostPath:s.hostPath,projectId:i&&i.id};this._signalRHub=new kt.PoolSignalRHub({hostInformation:o,agentActions:this._flux.actionsHub.agentActions,actionCreator:this._flux.poolActionCreator,signalRActions:this._flux.actionsHub.signalRActions,pageContext:e.pageContext,removeApiPath:!i}),this._flux.storesHub.selectionStore.state.selectedAgentQueue?this._signalRHub.listen(this._flux.storesHub.selectionStore.state.selectedAgentQueue.pool.id):this._flux.storesHub.selectionStore.state.selectedAgentPool&&this._signalRHub.listen(this._flux.storesHub.selectionStore.state.selectedAgentPool.id)}}_markTti(){this._dataReady&&!this._ttiMarked&&(this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(g.Telemetry.Area,g.Telemetry.PoolView),this._ttiMarked=!0)}_getInitialDataReady(){switch(this._flux.poolActionCreator.navigationActionCreator.getTabIdParam()){case g.PoolHubViewKeys.Agents:case g.PoolHubViewKeys.Details:case g.PoolHubViewKeys.Security:case g.PoolHubViewKeys.Diagnostics:return!1;case g.PoolHubViewKeys.Jobs:case g.PoolHubViewKeys.Checks:default:return!0}}}t[e].PoolView=s,ue.VssComponent.register("ms.vss-build-web.admin-pool-view-component",s)}("PoolView")}),["Resources","Types","Actions/ActionsHub","Sources/AgentSource","Sources/ElasticPoolSource","Stores/AgentStore","Stores/DescriptionStore","Stores/DownloadAgentDialogStore","Stores/ElasticNodeStore","Stores/ElasticPoolLogStore","Stores/MaintenanceJobsStore","Stores/MaintenanceStore","Stores/PoolAnalyticsStore","Stores/SecurityStore","Stores/SelectionStore","Stores/TopPipelinesStore","Stores/StoresHub","Actions/PoolActionCreator","Sources/PoolAnalyticsSource","Actions/PoolGraphActionCreator","Colors","Components/ConcurrencySeries","Components/QueuedJobsSeries","Components/RunningJobsSeries","Components/TopPipelinesSeries","Flux","PoolSignalRHub","Components/AgentAcquisitionDialog","Components/AgentList","Components/AzureSubscriptionSettingsPanel","Components/Description","Components/ElasticNodeList","Components/ElasticPoolLogList","Components/MaintenanceJobsList","Components/MaintenanceHistoryContainer","Components/PoolAgentsContainer","Components/PoolTrendCard","Components/PoolGraph","Components/PoolAnalytics","Components/PoolChecksContainer","Components/PoolDetailsContainer","Components/PoolDiagnosticsContainer","Components/PoolJobsContainer","Components/PoolPipelineSecurity","Components/SecurityContainer","Components/SettingsContainer","Components/PoolHub","Components/TopPipelinesCard","PoolView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.admin.pool"}}));