"use strict";define("Pipeline/Analytics/Common",["require","exports","VSS/Reflux/Action","Analytics/Shared/Common/Types","Analytics/Shared/Common/Utils/Telemetry","VSS/Platform/Context","VSS/Features/Charts/Contracts","Analytics/Shared/Common/Constants","VSS/Core/Util/String","Analytics/Shared/Utils/URLHelper","Analytics/Shared/Utils/DateUtils","Analytics/Shared/Common/PipelineEntities","Analytics/Shared/Common/Sources/AnalyticsODataClientBase","Analytics/Shared/Common/Utils/DateAdjuster","Analytics/Shared/Utils/Number","Analytics/Common/Utilities/AnalyticsExceptionUtilities","Analytics/Shared/TrendChart/Common/ConfigurationUtility","VSS/Reflux/Store","Analytics/Shared/Common/AnalyticsPage","react","VSS/Platform/Layout"],(function(e,t,a,i,n,r,s,o,l,u,c,d,g,p,C,m,h,y,S,F,P){var f,_,D,T,k,A,b;f=t[b="Resources"]={},t[b].TotalPipelines="Total runs",t[b].DefaultStageName="Default",t[b].NotValidPipelineDefinition="The pipeline definition is not valid",t[b].TopFailingStageAndTaskLabel="{0} stage has the highest failure rate with {1} of its failures caused by task - {2}",t[b].TopFailingTaskLabel="{0} of pipeline failures are due to failures in task - {1}",t[b].Percentage="%",t[b].AllStageName="All Stages",function(e){t[e]={};t[e].PipelineReportBaseActions=class{constructor(){this.updateConfigurationValuesAction=new a.Action,this.updateDataAction=new a.Action,this.onError=new a.Action}}}("ActionsPipelineReportBaseActions"),function(e){_=t[e]={},t[e].area="PipelineAnalytics",t[e].feature_AnalyticsTab="AnalyticsTab",t[e].feature_PipelineAnalyticsFailureCard="PipelineAnalyticsFailureCard",t[e].feature_PipelineAnalyticsFailureHubFilter="PipelineAnalyticsFailureHubFilter",t[e].feature_PipelineAnalyticsOutcomeTrendChart="OutcomeTrendChart",t[e].feature_PipelineAnalyticsTasksFailedTrendChart="TasksFailedTrendChart",t[e].feature_PipelineAnalyticsDurationCard="PipelineAnalyticsDurationCard",t[e].feature_PipelineAnalyticsDurationHubFilter="PipelineAnalyticsDurationHubFilter",t[e].feature_PipelineDurationTrendChart="PipelineDurationTrendChart",t[e].feature_Analytics_PipelineFailures_CardLoaded="Analytics_PipelineFailures_CardLoaded",t[e].feature_Analytics_PipelineDuration_CardLoaded="Analytics_PipelineDuration_CardLoaded",t[e].feature_PipelineAnalyticsLeadTimeCard="PipelineAnalyticsLeadTimeCard",t[e].feature_PipelineAnalyticsLeadTimeCardNotOptedIn="PipelineAnalyticsLeadTimeCardNotOptedIn",t[e].feature_PipelineStepsDurationCard="PipelineStepsDurationCard",t[e].feature_PipelineTaskGrid="PipelineTaskGrid",t[e].ClickCount="ClickCount",t[e].LearnMoreClickCount="LearnMoreClickCount",t[e].PassRate="PassRate",t[e].TaskFailedRate="TaskFailedRate",t[e].TopFailingTask="TopFailingTask",t[e].DateFilterChangedValue="DateFilterChangedValue",t[e].StageFilterChangeCount="StageFilterChangeCount",t[e].BranchCount="BranchCount",t[e].TopFailingTasks="TopFailingTasks",t[e].TasksCount="TasksCount",t[e].TooltipUsageCount="TooltipUsageCount",t[e].LegendClickCount="LegendClickCount",t[e].OutcomeTrendChartData="OutcomeTrendChartData",t[e].TaskDurationPercentage="TaskDurationPercentage",t[e].PercentileDuration="PercentileDuration(Milliseconds)",t[e].DurationTrendChartData="DurationTrendChartData",t[e].RowClick="RowClick",t[e].RowToggle="RowToggle"}("TelemetryTelemetryConstants"),function(){t.TelemetryPipelineAnalyticsTelemetryService={};class e extends r.VssService{initialize(e){this._definitionId=e}publishEvent(t,a){const r={contextType:i.ContextType.Build,definitionId:this._definitionId};n.publishEvent(this._pageContext,e.area,t,r,a)}publishEventWithSingleKey(e,t,a){const i={};i[t]=a,this.publishEvent(e,i)}_serviceStart(e){this._pageContext=e,super._serviceStart(e)}}e.area=_.area,r.Services.add("IPipelineAnalyticsTelemetryService",{serviceFactory:e})}(),function(e){D=t[e]={},function(e){e.None="None",e.Succeed="Succeed",e.PartiallySucceeded="PartiallySucceeded",e.Failed="Failed",e.Canceled="Canceled"}(t[e].BuildOutcome||(t[e].BuildOutcome={})),function(e){e.Succeeded="Succeeded",e.SucceededWithIssues="SucceededWithIssues",e.Failed="Failed",e.Canceled="Canceled",e.Skipped="Skipped",e.Abandoned="Abandoned"}(t[e].BuildTaskOutcome||(t[e].BuildTaskOutcome={})),t[e].PullRequestBranchPrefix="refs/pull/",t[e].PullRequestBranchPlaceHolderSK=-1,t[e].PullRequestBranchName="refs/pull/*"}("Types"),function(e){t[e]={},t[e].getStackedBarChartData=function(e,t){return{title:t.title,pageContext:e,chartType:s.ChartTypesConstants.StackedBar,suppressAnimation:!0,xAxis:{labelsEnabled:!1,enabled:!1},yAxis:{labelFormatMode:s.LabelFormatModes.Percentage,min:0,max:100,allowDecimals:!0,markingsEnabled:!0},legend:{enabled:!1},hostOptions:{height:120,width:300},legendClick:a=>(function(e,t){const a=e.getService("IPipelineAnalyticsTelemetryService");a.publishEventWithSingleKey(t,_.LegendClickCount,1)}(e,t.telemetryArea||""),!0),series:t.series,tooltip:{customTooltipHeader:e=>"",customTooltipMapping:e=>function(e){return e.map((e=>{const t={styleType:{color:e.color,type:1},text:""},a=Number(e.values[0]).toLocaleString(navigator.language);return t.text=`${e.seriesName} : ${a}%`,t}))}(e)}}}}("ChartHelperStackedBarChartDataSelector"),function(e){t[e]={},t[e].getStackedColumnChartData=function(e,t){return{title:t.title,pageContext:e,chartType:s.ChartTypesConstants.StackedColumn,suppressAnimation:!0,xAxis:{formatAccessibleLabelsUsingAxisCategories:!0,labelFormatMode:s.LabelFormatModes.DateTime_DayInMonth,labelValues:t.xAxisLabelValues||[],min:0,max:t.xAxisLabelValues.length-1},yAxis:{labelFormatMode:s.LabelFormatModes.Linear,title:t.yAxisTitle.toUpperCase(),min:0,allowDecimals:!1,markingsEnabled:!1,gridLineOptions:{enabled:!0,gridLineColor:o.gridLineColor}},legend:{enabled:!1},legendClick:a=>(function(e,t){const a=e.getService("IPipelineAnalyticsTelemetryService");a.publishEventWithSingleKey(t,_.LegendClickCount,1)}(e,t.telemetryArea||""),!0),series:t.series}}}("ChartHelperStackedColumnChartDataSelector"),function(e){t[e]={};t[e].PipelineReportInsights=class{_getTopFailingStageAndTaskDisplayName(e,t){return this._hasStageAndTaskFailures(e)?(0,l.localeFormat)(f.TopFailingStageAndTaskLabel,"<span style='font-style: italic'>"+e.stageName+"</span>",t+f.Percentage,"<span style='font-style: italic'>"+e.taskName+"</span>"):this._hasTaskFailureWithoutStage(e)?(0,l.localeFormat)(f.TopFailingTaskLabel,t+f.Percentage,"<span style='font-style: italic'>"+e.taskName+"</span>"):""}_hasTaskFailureWithoutStage(e){return e&&!e.stageName&&e.taskName&&e.stageFailureCount}_hasStageAndTaskFailures(e){return e&&e.stageName&&e.taskName}}}("ComponentsPipelineReportInsights"),function(e){t[e]={},t[e].percentile_value="0.8",t[e].percentile_text="80",t[e].maxItemsToShowInCharts=10,t[e].colors=["#0078D4","#550036","#00A5B0","#004378","#E86E58","#5C2E91","#C19C00","#603D30","#E3008C","#331950"],t[e].enableSixMonthReportsFF="WebAccess.Pipeline.Analytics.EnableSixMonthReports",t[e].SuccessfulPipelines="Succeeded runs duration"}("Constants"),function(e){T=t[e]={},t[e].getAnalyticsDataService=async function(e){const t=(0,u.getContextTypeFromUrl)(e),a=e.getService("IVssContributionService");return"build"===t?(await a.getContributionAsync("ms.vss-analyticsshared-web.analytics-build-service"),e.getService("IBuildAnalyticsDataService")):(await a.getContributionAsync("ms.vss-test-analytics-web.release-helper"),e.getService("IReleaseAnalyticsDataService"))}}("LoadAnalyticsDataService"),function(e){function a(){const e=[{passPercentage:75,failedCount:55,taskFailures:[{taskName:"L0 tests",failedCount:50},{taskName:"L1 tests",failedCount:5}]},{passPercentage:100,failedCount:0,taskFailures:[]},{passPercentage:100,failedCount:0,taskFailures:[]},{passPercentage:80,failedCount:43,taskFailures:[{taskName:"L0 tests",failedCount:40},{taskName:"L1 tests",failedCount:3}]},{passPercentage:90,failedCount:21,taskFailures:[{taskName:"L0 tests",failedCount:20},{taskName:"L1 tests",failedCount:1}]},{passPercentage:100,failedCount:0,taskFailures:[]},{passPercentage:93,failedCount:20,taskFailures:[{taskName:"Build solution",failedCount:20}]},{passPercentage:96,failedCount:5,taskFailures:[{taskName:"Update artifacts",failedCount:5}]},{passPercentage:40,failedCount:90,taskFailures:[{taskName:"L0 tests",failedCount:90}]},{passPercentage:100,failedCount:0,taskFailures:[]},{passPercentage:100,failedCount:0,taskFailures:[]},{passPercentage:90,failedCount:5,taskFailures:[{taskName:"Publish to artifact services drop a very very long task name. So long that it can literally overflow",failedCount:5}]},{passPercentage:80,failedCount:23,taskFailures:[{taskName:"Publish test results",failedCount:23}]},{passPercentage:75,failedCount:23,taskFailures:[{taskName:"L0 tests",failedCount:23}]}],t=(0,c.getDate)(),a=(0,c.addDays)(t,-13);for(let t=0;t<e.length;t++)e[t].date=(0,c.convertDateToDateString)((0,c.addDays)(a,t));return e}k=t[e]={},t[e].useMockData=document.cookie.indexOf("pipelineAnalytics.useMockData=true")>=0,t[e].getMockReportData=a,t[e].mockReportData=a(),t[e].totalFailedCount=t[e].mockReportData.map((e=>e.failedCount||0)).reduce(((e,t)=>e+t)),t[e].totalCount=Math.round(t[e].mockReportData.map((e=>e.failedCount&&e.passPercentage?100*e.failedCount/(100-e.passPercentage):0)).reduce(((e,t)=>e+t))),t[e].taskFailureMap={},t[e].mockReportData.forEach((a=>{a.taskFailures.forEach((a=>{null==t[e].taskFailureMap[a.taskName]&&(t[e].taskFailureMap[a.taskName]=0),t[e].taskFailureMap[a.taskName]+=a.failedCount}))})),t[e].taskFailures=Object.keys(t[e].taskFailureMap).map((a=>({taskName:a,failedCount:t[e].taskFailureMap[a]}))).sort(((e,t)=>t.failedCount-e.failedCount)),t[e].stageFailureDistribution=[.5,.2,.2,.1],t[e].getMockStageData=function(){return[{fullName:"Build",name:"Build",dataCount:t[e].totalFailedCount*t[e].stageFailureDistribution[0]},{fullName:"_generatedDefaultForEmpty.stage1",name:"stage1",dataCount:t[e].totalFailedCount*t[e].stageFailureDistribution[1]},{fullName:"Staging",name:"Staging",dataCount:t[e].totalFailedCount*t[e].stageFailureDistribution[2]},{fullName:"Prod",name:"Prod",dataCount:t[e].totalFailedCount*t[e].stageFailureDistribution[3]}]},t[e].getMoreMockStageData=function(){return[{fullName:"Build",name:"Build",dataCount:.5*t[e].totalFailedCount},{fullName:"_generatedDefaultForEmpty.stage1",name:"stage1",dataCount:.1*t[e].totalFailedCount},{fullName:"Staging",name:"Staging",dataCount:.1*t[e].totalFailedCount},{fullName:"Prod",name:"Prod",dataCount:.1*t[e].totalFailedCount},{fullName:"Build1",name:"Build",dataCount:.03*t[e].totalFailedCount},{fullName:"_generatedDefaultForEmpty.stage2",name:"stage2",dataCount:.03*t[e].totalFailedCount},{fullName:"Staging1",name:"Staging1",dataCount:.03*t[e].totalFailedCount},{fullName:"Prod1",name:"Prod1",dataCount:.03*t[e].totalFailedCount},{fullName:"Build2",name:"Build2",dataCount:.03*t[e].totalFailedCount},{fullName:"_generatedDefaultForEmpty.stage3",name:"stage3",dataCount:.02*t[e].totalFailedCount},{fullName:"Staging2",name:"Staging2",dataCount:.02*t[e].totalFailedCount},{fullName:"Prod2",name:"Prod2",dataCount:.01*t[e].totalFailedCount}]}}("MockReportData"),function(e){t[e]={},t[e].Area="Build",t[e].PipelinesAnalyticsHub="Pipelines.Analytics.Hub",t[e].PipelinesDurationHub="Pipelines.Duration.Hub"}("PerfScenarios"),function(e){t[e]={};t[e].ContributionSource=class{constructor(e){this._pageContext=e.pageContext}getDataAsync(e,t,a=!1){return this._service.getDataAsync(e,t,a)}get _service(){return this._pageContext.getService("IVssContributionService")}}}("SourcesContributionSource"),function(e){A=t[e]={};class a extends g.AnalyticsODataClientBase{constructor(){super(...arguments),this.pipelineEntityEmptyNamePrefix="_generatedDefaultForEmpty.",this._buildEntityName=d.PipelineRuns,this._buildTaskResultsEntityName=d.PipelineRunActivityResults,this._defaultStage="__default",this._emptyString=""}_getTotalCountForAggregation(){return"$count as TotalCount"}_getGroupByTask(){return"TaskDisplayName"}_getGroupByBuildId(){return d.PipelineRunId}_getDurationPercentile(){return"DurationPercentile"}_getTotalDurationSeconds(){return"TotalDurationSeconds"}_getActivityDurationSeconds(){return"ActivityDurationSeconds"}_getGroupByBranch(){return"BranchSK, Branch/BranchName"}_getGroupByCompletedDate(){return"CompletedDateSK"}_getBuildCompletedDateSK(){return d.PipelineRunCompletedDateSK}_getPipelineJobStageName(){return"PipelineJob/StageName"}_getCountForAggregationAsFailedCount(){return"$count as FailedCount"}_getFailedCountForAggregation(){return"FailedCount with sum as FailedCount"}_getSucceededCountForAggregation(){return"SucceededCount with sum as SucceededCount"}_getPartiallySucceededCountForAggregation(){return"PartiallySucceededCount with sum as PartiallySucceededCount"}_getTotalDurationForAggregation(){return"TotalDurationSeconds with sum as TotalDuration"}_getActivityTotalDurationForAggregation(){return"ActivityDurationSeconds with sum as TotalDuration"}_getDurationPercentileForAggregation(){return"DurationPercentile with sum as TotalDuration"}_getFailedStageCountForAggregation(){return"cast(FailedCount gt 0,  Edm.Int32) with sum as FailedStageCount"}_getDurationPercentileForCompute(e){return"percentile_cont(TotalDurationSeconds, "+e+") as DurationPercentile"}_getTaskDurationPercentileForCompute(e){return"percentile_cont(ActivityDurationSeconds, "+e+") as DurationPercentile"}_getDurationPercentileWithGroupByForCompute(e,t,a){return(0,l.format)("percentile_cont({0}, {1}, {2}) as DurationPercentile",t,e,a)}_getPipelineContextFilter(e,t=!1){let a="",n=0;if(e.contextType===i.ContextType.Build)e.definitionSK?(a=d.PipelineSK,n=e.definitionSK):(a=t?`${d.Pipeline}/${d.PipelineId}`:d.PipelineId,n=e.definitionId);return`${a} eq ${n}`}_getBranchFilter(e){if(!e||0==e.length)return"";return` and (${e.map((e=>e.id===D.PullRequestBranchPlaceHolderSK?`startswith(Branch/BranchName, '${D.PullRequestBranchPrefix}')`:`BranchSK eq ${e.id}`)).join(" or ")})`}_getStageFilter(e){return e?`and (PipelineJob/StageName eq '${e}')`:""}_parseTaskDisplayName(e){return e?e.TaskDisplayName:""}_parseBuildId(e){return e?e[d.PipelineRunId]:""}_parseTotalCount(e){return e.TotalCount||0}_parseSucceededCount(e){return e.SucceededCount||0}_parseFailedCount(e){return e.FailedCount||0}_parsePartiallySucceededCount(e){return e.PartiallySucceededCount||0}_parseTotalDuration(e){return e.TotalDuration||0}_parseDurationPercentile(e){return e.DurationPercentile||0}_parseCompletedDateSK(e){return e.CompletedDateSK||0}_parseBuildCompletedDateSK(e){return e[d.PipelineRunCompletedDateSK]||0}_parseStageFailureCount(e){return e.FailedStageCount||0}_parsePipelineStageName(e){return e.PipelineJob.StageName}_getTotalPipelineFilter(){return"(CanceledCount ne 1)"}_getTotalPipelineFilterForTask(){return`(${d.PipelineRunOutcome} ne 'Canceled')`}_getSuccessfulPipelineFilter(){return"(SucceededCount eq 1 or PartiallySucceededCount eq 1)"}_getFailedPipelineFilter(){return"(FailedCount eq 1)"}_getTaskActivityQueryFilter(){return" (ActivityType eq null or ActivityType eq 'Task') "}_getBasicFilters(e,t){return`${this._getPipelineContextFilter(e,!0)} and \n                ${(0,p.getDateFilter)(t.trendBy,t.period,d.PipelineRunCompletedDateSK)} \n                ${this._getBranchFilter(t.branchItems)} \n                and ${this._getTaskActivityQueryFilter()}`}_getFailingTaskFilters(e,t){return`${this._getBasicFilters(e,t)} and  \n                ${d.PipelineRunOutcome} eq '${D.BuildOutcome.Failed}' and\n                TaskOutcome eq '${D.BuildTaskOutcome.Failed}'`}_getBasicQueryFilter(e,t){return`filter(${this._getBasicFilters(e,t)})`}_getTopFailingTaskQueryFilter(e,t){return`filter(${this._getFailingTaskFilters(e,t)})`}_getFailedPipelineRunsForTaskQueryFilter(e,t,a,i){return`filter(${this._getFailingTaskFilters(e,t)} \n        ${this._getStageFilter(i)} and TaskDisplayName eq '${a}')`}_getTopFailingTaskQueryFilterForStage(e,t,a){return a?`filter(${this._getFailingTaskFilters(e,t)} and PipelineJob/StageName eq '${a}')`:`filter(${this._getFailingTaskFilters(e,t)} \n                    and (PipelineJob/StageName eq null \n                    or PipelineJob/StageName eq '${this._defaultStage}'))`}_getMaxDurationTaskQueryFilter(e,t){return`filter(${this._getPipelineContextFilter(e,!0)} and \n                ${(0,p.getDateFilter)(t.trendBy,t.period,d.PipelineRunCompletedDateSK)}\n                ${this._getBranchFilter(t.branchItems)} and\n                (${d.PipelineRunOutcome} eq '${D.BuildOutcome.Succeed}' or \n                ${d.PipelineRunOutcome} eq '${D.BuildOutcome.PartiallySucceeded}') and \n                (CanceledCount ne 1 and SkippedCount ne 1 and AbandonedCount ne 1) and\n                ${this._getTaskActivityQueryFilter()})`}_getPassPercentage(e,t,a){const i=t+a;return(0,C.getPercentage)(e,i)}_getPercentageVariation(e,t){const a=Math.abs(e-t);return(0,C.getPercentage)(e,a)}_parseStageData(e){let t;return t=e&&e!==this._defaultStage?{name:e.replace(this.pipelineEntityEmptyNamePrefix,""),fullName:e,dataCount:0}:{name:f.DefaultStageName,fullName:"",dataCount:0},t}_parseStageName(e){let t;return t=e&&e!==this._defaultStage?e.replace(this.pipelineEntityEmptyNamePrefix,""):f.DefaultStageName,t}getStages(e,t,a=!1){const i=this._getProjectId(),n={entityType:this._buildEntityName,project:i};if(k.useMockData)return Promise.resolve(k.getMockStageData());n.entityType=this._buildTaskResultsEntityName;const r=a?this._getTopFailingTaskQueryFilter(e,t):this._getBasicQueryFilter(e,t),s=`groupby((${this._getGroupByBuildId()}, ${this._getPipelineJobStageName()}), aggregate(${this._getFailedCountForAggregation()}))`,o=`groupby((${this._getPipelineJobStageName()}), aggregate(${this._getFailedStageCountForAggregation()}))`;return n.$apply=`${r}/${s}/${o}`,this._queryStages(n)}async _queryStages(e){const t=await this.queryOData(e);if(!t||!t.value)throw new Error("data is empty.");const a=t.value,i={};a&&a.length>0&&a.forEach((e=>{const t=this._parsePipelineStageName(e),a=this._parseStageData(t);i[a.fullName]||(i[a.fullName]={name:a.name,fullName:a.fullName,dataCount:0}),i[a.fullName].dataCount+=this._parseStageFailureCount(e)}));return Object.keys(i).map((e=>i[e]))}}t[e].PipelineReportSource=a}("SourcesPipelineReportSource"),function(e){t[e]={};class a extends A.PipelineReportSource{async _queryPassRateTrendData(e,t){const a=await this.queryOData(e);if(!a||!a.value)throw new Error("Data is empty");let n;const r={primaryChartData:{[this._emptyString]:[]},secondaryChartData:[],confValues:t,isCachedData:a.isCachedData};let s,o=0,l=0,u=0,c=0;return a.value.forEach((e=>{const t=(0,p.parseReturnDateIntoDisplayForm)(i.TrendBy.Days,e),a=this._parseFailedCount(e),n=this._parseTotalCount(e);r.primaryChartData[this._emptyString].push({date:t,aggrValue:a,customData:{label:f.TotalPipelines,value:n}});const s=this._parseSucceededCount(e),d=this._parsePartiallySucceededCount(e),g=this._getPassPercentage(n,s,d);c+=n,o+=s,l+=d,u+=this._parseFailedCount(e),r.secondaryChartData||(r.secondaryChartData=[]),r.secondaryChartData.push({date:t,aggrValue:g})})),s={totalCount:c,failedCount:u,passedCount:o+l,passPercentage:this._getPassPercentage(c,o,l)},n={trendChartData:r,pipelineOutcomePassRateData:s},n}async getTopFailingStageAndTaskData(e,t){const a=this._getProjectId(),i={entityType:this._buildTaskResultsEntityName,project:a},n=await this.getStages(e,t,!1),r={stageName:"",stageFailureCount:0,taskName:"",failedCount:0};let s=this._getTopFailingTaskQueryFilter(e,t);const o=`groupby((${this._getGroupByBuildId()},${this._getGroupByTask()}), aggregate(${this._getCountForAggregationAsFailedCount()}))`,l=`groupby((${this._getGroupByTask()}), aggregate(${this._getCountForAggregationAsFailedCount()}))`;if(i.$orderby=" FailedCount desc ",n&&n.length>1){const a=n.sort(((e,t)=>t.dataCount-e.dataCount))[0];s=this._getTopFailingTaskQueryFilterForStage(e,t,a.fullName),r.stageName=a.name,r.stageFailureCount=a.dataCount}return i.$apply=`${s}/${o}/${l}`,this._getTopFailingTask(i,r)}async _getTopFailingTask(e,t){const a=await this.queryOData(e);if(!a||!a.value)throw new Error("data is empty.");const i=a.value;if(i&&i.length>0){const e=i[0];if(t.taskName=this._parseTaskDisplayName(e),t.failedCount=this._parseFailedCount(e),!t.stageFailureCount){const e=i.reduce(((e,t)=>e+t.FailedCount),0);t.stageFailureCount=e}}return t}}t[e].PipelineTrendSource=a}("SourcesPipelineTrendSource"),function(e){t[e]={};class a extends y.Store{constructor(e){super(""),this._actions=e,this._onError=e=>{const t=(0,m.extractODataError)(e);this._state.errorText=t,this.emitChanged()},this._onUpdateConfiguration=e=>{this._state.confValues&&h.ConfigurationUtility.areConfValuesEqual(this._state.confValues,e)&&this._state.confValues.stage===e.stage||(this._state.errorText=void 0,this._state.data=void 0,this._state.confValues=Object.assign({},e),this.emitChanged())},this._onUpdateData=e=>{e&&(this._state.errorText=void 0,this._state.data=e,this.emitChanged())},this._initialize()}getState(){return this._state}dispose(){this._actions.updateConfigurationValuesAction.removeListener(this._onUpdateConfiguration),this._actions.updateDataAction.removeListener(this._onUpdateData),this._actions.onError.removeListener(this._onError)}_initialize(){this._state={},this._actions.updateConfigurationValuesAction.addListener(this._onUpdateConfiguration),this._actions.updateDataAction.addListener(this._onUpdateData),this._actions.onError.addListener(this._onError)}}t[e].PipelineReportBaseStore=a}("StoresPipelineReportBaseStore"),function(e){t[e]={};class a extends P.VssComponent{componentDidMount(){super.componentDidMount(),this._getPipeline()}render(){return F.createElement(S.AnalyticsPage,Object.assign({},this.props))}_getPipelineId(){return(0,u.getDefinitionIdFromUrl)(this.context.pageContext)}async _getPipeline(){this._analyticsDataService=await(0,T.getAnalyticsDataService)(this.context.pageContext);const e=this._getPipelineId();if(e>0){const t=await this._analyticsDataService.fetchDefinitionName(e);this.props.onSetPipelineName(t);this.context.pageContext.getService("analytics-hub-breadcrumb-service").addDefinition(e)}else this.props.onError(f.NotValidPipelineDefinition);return e}}t[e].PipelineAnalyticsPage=a,P.Components.add("pipelineAnalyticsPage",a)}("ComponentsPipelineAnalyticsPage")}),["Resources","Actions/PipelineReportBaseActions","Telemetry/TelemetryConstants","Telemetry/PipelineAnalyticsTelemetryService","Types","ChartHelper/StackedBarChartDataSelector","ChartHelper/StackedColumnChartDataSelector","Components/PipelineReportInsights","Constants","LoadAnalyticsDataService","MockReportData","PerfScenarios","Sources/ContributionSource","Sources/PipelineReportSource","Sources/PipelineTrendSource","Stores/PipelineReportBaseStore","Components/PipelineAnalyticsPage"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-pipelineanalytics-web.analytics-common"}}));