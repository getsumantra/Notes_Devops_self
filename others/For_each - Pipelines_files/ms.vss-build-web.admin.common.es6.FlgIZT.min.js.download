"use strict";define("Build/Admin/Common",["require","exports","VSS/Reflux/Action","Tfs/Platform/Page","VSS/Platform/Context","VSS/Platform/Location","VSS/Platform/FPS","VSS/Reflux/Store","DistributedTask/Client/RestClient/TaskAgent","ServiceEndpoints/Client/Constants/ServiceEndpoint","ServiceEndpoints/Client/RestClient/ServiceEndpoint","VSS/Core/Util/String","VSS/Core/Observable","VSS/Features/SignalR/Hub","DistributedTask/Common/SignalR/SignalRHubProxies","VSSUI/Utilities/Filter","react","VSSUI/Dialog","VSSUI/Icon","VSSUI/ConditionalChildren","VSSUI/Link","VSS/Platform/Feature","VSS/Platform/Layout","VSSUI/Button","VSSUI/Checkbox","VSSUI/TextField","VSSUI/Util","VSSUI/Ago","VSSUI/Duration","VSSUI/Status","VSSUI/Table","VSSUI/TooltipEx","VSSUI/Utilities/Date","VSSUI/Utilities/Provider","VSSUI/Dropdown","VSSUI/FilterBar","VSSUI/TextFilterBarItem","VSSUI/Utilities/DropdownSelection","VSSUI/MessageCard","VSS/Platform/Identity","VSSUI/VssPersona","VSSUI/Spinner","VSS/Legacy/Legacy","VSSUI/Utilities/GroupedItemProvider"],(function(e,t,i,s,o,n,r,a,c,l,u,d,p,h,g,m,S,v,C,A,b,f,P,_,I,y,E,D,k,w,T,x,N,R,j,M,L,V,U,z,Q,F,O,J){var B,q,H,W,K,G,Y,Z;B=t[Z="Resources"]={},t[Z].Agent="Agent",t[Z].AgentSpecification="Agent Specification",t[Z].AgentInteractiveUI="Configure VMs to run interactive tests",t[Z].Authorize="Authorize",t[Z].Authorizing="Authorizing",t[Z].AzureConnectionGroupTitle="Service connections",t[Z].AzureSubscriptionGroupTitle="Subscriptions",t[Z].AzureSubscriptionLabel="Azure subscription:",t[Z].Cancel="Cancel",t[Z].Confirm="Confirm",t[Z].CreateRMTimeout="Timed out waiting for the service connection to be ready",t[Z].Delete="Delete",t[Z].DesiredIdleLabel="Number of agents to keep on standby",t[Z].Duration="Duration",t[Z].ElasticPoolIdleMoreThanMaxError="* Valid range is from 0 to the maximum number of virtual machines in the scale set.",t[Z].ElasticPoolInvalidMaxSizeError="* Valid range is from 0 to 1000.",t[Z].ElasticPoolInvalidTimeToLiveError="* Valid range is from 0 to 10000.",t[Z].GetVirtualMachineScaleSetDataError="Unknown error getting virtual machine scale sets.",t[Z].LearnMore="Learn more.",t[Z].ManagePoolRolesNoPermissions="You do not have permission to manage this poolâ€™s roles.",t[Z].MaxCapacityLabel="Maximum number of virtual machines in the scale set",t[Z].Name="Name",t[Z].NoAgentsAvailable="No agents available",t[Z].Project="Project",t[Z].Queued="Queued",t[Z].QueuedAtTime="Queued {0}",t[Z].RecycleAfterEachUse="Automatically tear down virtual machines after every use",t[Z].ReloadAzureSubscriptionsAriaLabel="Reload Azure subscriptions",t[Z].ReloadVirtualMachineScaleSetsAriaLabel="Reload virtual machine scale sets",t[Z].SaveFailedAgents="Save an unhealthy agent for investigation.",t[Z].SaveFailedAgentsLearnMore="Saved agents will be shown on the Diagnostics tab. Click to learn more.",t[Z].SelectAzureSubscriptionLabel="Select an Azure subscription",t[Z].SelectProjectLabel="Select a project for the Service Connection",t[Z].SelectVirtualMachineScaleSetLabel="Select a Virtual Machine Scale Set",t[Z].SelfHostedParallelJobs="You can run {0} private project parallel jobs and {1} public project parallel jobs.",t[Z].SubscriptionNeedsAuthorization="This subscription requires authorization",t[Z].TaskAgentJobNumberFormat="Job {0}",t[Z].TaskAgentJobNameFormat="{0} - {1}",t[Z].TaskAgentJobListUnknown="Unknown",t[Z].TimeToLiveMinutes="Delay in minutes before deleting excess idle agents",t[Z].UnlimitedText="unlimited",t[Z].Update="Update",t[Z].VirtualMachineScaleSetLabel="Virtual machine scale set:",t[Z].VirtualMachineScaleSetInUseError="* This virtual machine scale set is already in use by pool {0}",t[Z].WaitTime="Wait time",t[Z].EphemeralDiskWarning="The 'Automatically tear down virtual machines after every use' option is available only for scale sets with ephemeral disks",function(e){t[e]={};t[e].AgentActions=class{constructor(){this.agentUpdated=new i.Action,this.agentStatusUpdated=new i.Action}}}("ActionsAgentActions"),function(e){t[e]={};t[e].AgentCloudActions=class{constructor(){this.agentCloudsUpdated=new i.Action,this.agentCloudAdded=new i.Action,this.agentCloudDeleted=new i.Action}}}("ActionsAgentCloudActions"),function(e){t[e]={};t[e].ConfirmationDialogActions=class{constructor(){this.dismissConfirmationDialog=new i.Action,this.showConfirmationDialog=new i.Action}}}("ActionsConfirmationDialogActions"),function(e){t[e]={};t[e].ConfirmationDialogActionCreator=class{constructor(e){this._confirmationDialogActions=e.confirmationDialogActions}showConfirmationDialog(e,t,i,s,o,n){this._confirmationDialogActions.showConfirmationDialog.invoke({selectedItem:e,title:t,content:i,confirmButtonType:s,onConfirm:o,onCancel:n})}dismissConfirmationDialog(){this._confirmationDialogActions.dismissConfirmationDialog.invoke(void 0)}}}("ActionsConfirmationDialogActionCreator"),function(e){t[e]={};t[e].JobActions=class{constructor(){this.jobUpdated=new i.Action,this.jobsUpdated=new i.Action}}}("ActionsJobActions"),function(e){q=t[e]={},function(e){e.Capabilities="capabilities",e.Jobs="jobs"}(t[e].AgentHubViewKeys||(t[e].AgentHubViewKeys={})),function(e){e.DeprecatedAgentHelpLink="https://go.microsoft.com/fwlink/?linkid=851067",e.DetailedInstructionsLinkDarwin="https://go.microsoft.com/fwlink/?LinkID=825114",e.DetailedInstructionsLinkLinux="https://go.microsoft.com/fwlink/?LinkID=825115",e.DetailedInstructionsLinkWindows="https://go.microsoft.com/fwlink/?LinkID=825113",e.PrerequisitesLinkDarwin="https://aka.ms/vstsagentosxsystem",e.PrerequisitesLinkLinux="https://aka.ms/vstsagentlinuxsystem",e.PrerequisitesLinkWindows="https://aka.ms/vstsagentwinsystem",e.ElasticPoolTroubleshooting="https://go.microsoft.com/fwlink/?linkid=2145884",e.ElasticPoolInstructions="https://aka.ms/AAa5w5l",e.PrivatePoolInstructions="https://aka.ms/AAa5w94",e.MdpInstructions="https://aka.ms/mdp-docs",e.MdpPreview="https://aka.ms/mdp-preview",e.ParallelJobsDocs="https://aka.ms/AAab5b6",e.AgentPoolsSecurityUrl="https://aka.ms/agent-pools",e.EphemeralDiskInfo="https://aka.ms/AzPipelines/ephemeral-os-disks"}(t[e].FwLinks||(t[e].FwLinks={})),function(e){e.Build="build"}(t[e].PlanTypes||(t[e].PlanTypes={})),function(e){e.Agents="agents",e.Analytics="analytics",e.Checks="checks",e.Details="details",e.Diagnostics="diagnostics",e.Jobs="jobs",e.MaintenanceHistory="maintenancehistory",e.Security="security",e.Settings="settings"}(t[e].PoolHubViewKeys||(t[e].PoolHubViewKeys={})),function(e){e.AccountSettingsRouteId="ms.vss-admin-web.collection-admin-hub-route",e.ProjectSettingsRouteId="ms.vss-admin-web.project-admin-hub-route",e.BuildResultRouteId="ms.vss-build-web.ci-results-hub-route"}(t[e].Routes||(t[e].Routes={})),function(e){e.AccountPools="agentpools",e.ProjectPools="agentqueues",e.ServiceConnections="adminservices"}(t[e].RouteValues||(t[e].RouteValues={})),function(e){e.AdminPivot="adminPivot",e.AgentId="agentId",e.AgentCloudId="agentCloudId",e.BuildId="buildId",e.JobId="jobId",e.PoolId="poolId",e.Project="project",e.QueueId="queueId",e.ResourceId="resourceId",e.TabId="view"}(t[e].QueryParams||(t[e].QueryParams={})),function(e){e.AgentCloudsList="ms.vss-build-web.agent-clouds-list-data-provider",e.Jobs="ms.vss-build-web.agent-jobs-data-provider",e.Pools="ms.vss-build-web.agent-pools-data-provider",e.Pool="ms.vss-build-web.agent-pool-data-provider",e.Queues="ms.vss-build-web.agent-queues-data-provider",e.Queue="ms.vss-build-web.agent-queue-data-provider",e.QueueSecurity="ms.vss-build-web.agent-queue-security-data-provider",e.Agent="ms.vss-build-web.agent-data-provider",e.AgentDefinitions="ms.vss-build-web.admin-agent-definitions-data-provider",e.AgentPoolCreation="ms.vss-build-web.agent-pool-creation-data-provider",e.ElasticPool="ms.vss-build-web.elastic-pool-data-provider",e.CheckIssues="ms.vss-pipelinechecks.checks-issues-provider"}(t[e].DataProviders||(t[e].DataProviders={})),function(e){e.HeaderBreadcrumbService="pools-admin-header-breadcrumb-service"}(t[e].ServiceIds||(t[e].ServiceIds={})),function(e){e.Manage=8,e.View=1}(t[e].Permission||(t[e].Permission={})),function(e){e.Area="Build",e.AgentCloudsAdminFeature="Admin.AgentClouds",e.AgentCloudsView="Admin.AgentCloudsView",e.AgentPoolAnalytics="AgentPool.AnalyticsHub",e.PoolsAdminFeature="Admin.Pools",e.PoolsListView="Admin.PoolsListView",e.PoolView="Admin.PoolView",e.AgentView="Admin.AgentView",e.QueueChecksView="Admin.QueueChecksView"}(t[e].Telemetry||(t[e].Telemetry={})),function(e){e.Agent="agent",e.AgentSpec="agentSpec",e.Keyword="keyword",e.Name="name",e.PoolType="poolType",e.Project="project"}(t[e].FilterKeys||(t[e].FilterKeys={})),function(e){e.ZeroDataPng="ms.vss-build-web/admin.tabs/zerodata.png"}(t[e].Assets||(t[e].Assets={})),function(e){e.AzureRMConnectionType="azurerm",e.AzureTenantId="tenantId"}(t[e].ServiceEndpointConstants||(t[e].ServiceEndpointConstants={})),function(e){e.VmssTimestampValidityHours=4}(t[e].ConfigurationJob||(t[e].ConfigurationJob={}))}("Constants"),function(){t.ServicesProjectDataService={};class e extends o.VssService{_serviceStart(e){super._serviceStart(e);const t=(0,s.getTFSPageData)(this.pageContext);this._projectData=t&&t.project}hasProjectData(){return Boolean(this._projectData)}getProjectData(){return this._projectData}}o.Services.add("IProjectDataService",{serviceFactory:e})}(),function(){t.ServicesPoolAdminLinkingService={};class e extends o.VssService{getAccountPoolsUrl(){const e=this._getDefaultRouteValues();return(0,n.routeUrl)(this.pageContext,q.Routes.AccountSettingsRouteId,e)}getProjectPoolsUrl(){const e=this._getDefaultRouteValues();return(0,n.routeUrl)(this.pageContext,q.Routes.ProjectSettingsRouteId,e)}getAgentQueueUrl(e){const t=this._getDefaultRouteValues();return t[q.QueryParams.QueueId]=e.id.toString(),(0,n.routeUrl)(this.pageContext,q.Routes.ProjectSettingsRouteId,t)}getAgentPoolUrl(e){const t=this._getDefaultRouteValues();return t[q.QueryParams.PoolId]=e.id.toString(),(0,n.routeUrl)(this.pageContext,q.Routes.AccountSettingsRouteId,t)}getAgentUrl(e,t,i){const s=this._getDefaultRouteValues();return s[q.QueryParams.AgentId]=i.id.toString(),e?(s[q.QueryParams.QueueId]=e.id.toString(),(0,n.routeUrl)(this.pageContext,q.Routes.ProjectSettingsRouteId,s)):t?(s[q.QueryParams.PoolId]=t.id.toString(),(0,n.routeUrl)(this.pageContext,q.Routes.AccountSettingsRouteId,s)):""}getJobResultsUrl(e){const t={};return e.planType.toLowerCase()===q.PlanTypes.Build?(t[q.QueryParams.Project]=e.scopeId,t[q.QueryParams.BuildId]=e.owner.id.toString(),t[q.QueryParams.JobId]=e.jobId.toString(),(0,n.routeUrl)(this.pageContext,q.Routes.BuildResultRouteId,t)):e.owner&&e.owner._links&&e.owner._links.web?e.owner._links.web.href:""}getQueueChecksUrl(e){const t=this._getDefaultRouteValues();return t[q.QueryParams.QueueId]=e.id.toString(),t[q.QueryParams.TabId]=q.PoolHubViewKeys.Checks,(0,n.routeUrl)(this.pageContext,q.Routes.ProjectSettingsRouteId,t)}getServiceConnectionUrl(e){const t={};return t[q.QueryParams.Project]=e.serviceEndpointScope,t[q.QueryParams.AdminPivot]=q.RouteValues.ServiceConnections,t[q.QueryParams.ResourceId]=e.serviceEndpointId,(0,n.routeUrl)(this.pageContext,q.Routes.ProjectSettingsRouteId,t)}_getDefaultRouteValues(){const e={},t=this.pageContext.getService("IProjectDataService").getProjectData();return t?(e[q.QueryParams.Project]=t.name,e[q.QueryParams.AdminPivot]=q.RouteValues.ProjectPools):e[q.QueryParams.AdminPivot]=q.RouteValues.AccountPools,e}}o.Services.add("IPoolAdminLinkingService",{serviceFactory:e})}(),function(e){t[e]={};t[e].NavigationActionCreator=class{constructor(e){this._pageContext=e.pageContext,this._historyService=e.pageContext.getService("IVssHistoryService")}validateQueryParameterValues(){const e=this.getQueueIdParam(),t=this.getAgentIdParam();if(void 0!==e&&e<=0||void 0!==t&&t<=0){const e=this._pageContext.getService("IPoolAdminLinkingService").getProjectPoolsUrl();(0,r.FastPageSwitch)(this._pageContext,e,!1)}}replaceQueryParameters(e,t,i,s){const o=this._historyService.getState();e?o[q.QueryParams.QueueId]=e.toString():delete o[q.QueryParams.QueueId],t&&!e?o[q.QueryParams.PoolId]=t.toString():delete o[q.QueryParams.PoolId],i?o[q.QueryParams.TabId]=i:delete o[q.QueryParams.TabId],s?o[q.QueryParams.AgentId]=s.toString():delete o[q.QueryParams.AgentId],this._historyService.replaceState(o)}getTabIdParam(){return this._historyService.getState()[q.QueryParams.TabId]}setTabIdParam(e){const t=this._historyService.getState();t[q.QueryParams.TabId]=e,this._historyService.pushState(t)}getQueueIdParam(){const e=this._historyService.getState();return e[q.QueryParams.QueueId]?parseInt(e[q.QueryParams.QueueId],10):void 0}setQueueIdParam(e){const t=this._historyService.getState();e?t[q.QueryParams.QueueId]=e.toString():delete t[q.QueryParams.QueueId],this._historyService.pushState(t)}getAgentIdParam(){const e=this._historyService.getState();return e[q.QueryParams.AgentId]?parseInt(e[q.QueryParams.AgentId],10):void 0}setAgentIdParam(e){const t=this._historyService.getState();e?t[q.QueryParams.AgentId]=e.toString():delete t[q.QueryParams.AgentId],this._historyService.pushState(t)}getPoolIdParam(){const e=this._historyService.getState();return e[q.QueryParams.PoolId]?parseInt(e[q.QueryParams.PoolId],10):void 0}setPoolIdParam(e){const t=this._historyService.getState();e?t[q.QueryParams.PoolId]=e.toString():delete t[q.QueryParams.PoolId],this._historyService.pushState(t)}getAgentCloudIdParam(){const e=this._historyService.getState();return e[q.QueryParams.AgentCloudId]?parseInt(e[q.QueryParams.AgentCloudId],10):void 0}setAgentCloudIdParam(e){const t=this._historyService.getState();e?t[q.QueryParams.AgentCloudId]=e.toString():delete t[q.QueryParams.AgentCloudId],this._historyService.pushState(t)}}}("ActionsNavigationActionCreator"),function(e){H=t[e]={},function(e){e[e.info=0]="info",e[e.warning=1]="warning",e[e.error=2]="error"}(t[e].NotificationType||(t[e].NotificationType={}));class i extends a.Store{constructor(){super("NotificationStoreChanged"),this.state=[],this.dismissNotification=e=>{this.state=this.state.filter((t=>t!==e)),this.emitChanged()},this.clearNotifications=()=>{this.state=[],this.emitChanged()},this.addNotification=e=>{this.state=this.state.concat(e),this.emitChanged()}}}t[e].NotificationStore=i}("StoresNotificationStore"),function(e){t[e]={};t[e].NotificationActions=class{constructor(){this.addNotification=new i.Action,this.dismissNotification=new i.Action,this.clearNotifications=new i.Action}}}("ActionsNotificationActions"),function(e){t[e]={};t[e].NotificationActionCreator=class{constructor(e){this._notificationActions=e.notificationActions}addNotification(e,t,i){this._notificationActions.addNotification.invoke({notificationType:t,message:e,buttonProps:i})}dismissNotification(e){this._notificationActions.dismissNotification.invoke(e)}clearNotifications(){this._notificationActions.clearNotifications.invoke(void 0)}}}("ActionsNotificationActionCreator"),function(e){t[e]={};t[e].ProjectActions=class{constructor(){this.projectsUpdated=new i.Action}}}("ActionsProjectActions"),function(e){t[e]={};t[e].ProjectActionCreator=class{constructor(e){this._projectsEvent=e=>{this._projectActions.projectsUpdated.invoke(this._projectsArray.value)},this._initialized=!1,this._projectActions=e.projectActions,this._tfsProjectService=e.pageContext.getService("ITfsProjectService")}dispose(){this._projectsArray&&this._projectsArray.unsubscribe(this._projectsEvent)}initializeProjects(){this._initialized||(this._projectsArray=this._tfsProjectService.getAllProjects(),this._projectActions.projectsUpdated.invoke(this._projectsArray.value),this._projectsArray.subscribe(this._projectsEvent),this._initialized=!0)}}}("ActionsProjectActionCreator"),function(e){t[e]={};t[e].ResourceLimitActions=class{constructor(){this.resourceLimitsUpdated=new i.Action,this.resourceLimitsStatusUpdated=new i.Action}}}("ActionsResourceLimitActions"),function(e){t[e]={};t[e].AgentPoolSource=class{constructor(e){this._client=(0,c.getTaskAgentClient)(e),this._pageContext=e}getCachedAgentPools(){return this._initializeAgentPoolsData(),this._poolsData&&this._poolsData.taskAgentPools?this._poolsData.taskAgentPools:[]}getCachedAgentPoolStatuses(){return this._initializeAgentPoolsData(),this._poolsData&&this._poolsData.taskAgentPoolStatusList?this._poolsData.taskAgentPoolStatusList:[]}getCachedSelectedAgentPool(){return this._initializeAgentPoolData(),this._poolData&&this._poolData.selectedAgentPool?this._poolData.selectedAgentPool:void 0}getCachedValidTimezones(){return this._initializeAgentPoolData(),this._poolData&&this._poolData.validTimeZones?this._poolData.validTimeZones:[]}getCachedAgentPoolAgents(){return this._initializeAgentPoolData(),this._poolData&&this._poolData.agents?this._poolData.agents:[]}async addAgentPool(e){return this._client.addAgentPool(e)}async deleteAgentPool(e){return this._client.deleteAgentPool(e.id)}async updateAgentPool(e){return this._client.updateAgentPool(e,e.id)}async getAgentPoolMetadata(e){return this._client.getAgentPoolMetadata(e)}async setAgentPoolMetadata(e,t){return this._client.setAgentPoolMetadata(t,e)}async refreshAgents(e){return this._client.refreshAgents(e)}async getAgentPool(e){return this._client.getAgentPool(e)}async getAgentPools(){return this._client.getAgentPools()}async getMaintenanceDefinitions(e){return this._client.getAgentPoolMaintenanceDefinitions(e)}async createMaintenanceDefinition(e,t){return this._client.createAgentPoolMaintenanceDefinition(e,t)}async updateMaintenanceDefinition(e,t){return this._client.updateAgentPoolMaintenanceDefinition(e,t,e.id)}async getAgentPoolStatusAsync(e){const t={poolId:e,mode:"status"};return this._pageContext.getService("IVssContributionService").getDataAsync(q.DataProviders.Pools,t,!0)}async getResourceLimitsAsync(){return this._client.getResourceLimits()}_initializeAgentPoolsData(){if(!this._poolsDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._poolsData=e.getData(q.DataProviders.Pools),this._poolsDataInitialized=!0}}_initializeAgentPoolData(){if(!this._poolDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._poolData=e.getData(q.DataProviders.Pool),this._poolDataInitialized=!0}}}}("SourcesAgentPoolSource"),function(e){t[e]={};class i extends a.Store{constructor(){super("ResourceLimitStoreChanged"),this.resourceLimitsUpdated=e=>{this.state=Object.assign(Object.assign({},this.state),{resourceLimits:e,resourceLimitsStatus:2}),this.emitChanged()},this.resourceLimitsStatusUpdated=e=>{this.state=Object.assign(Object.assign({},this.state),{resourceLimitsStatus:e}),this.emitChanged()},this.state={resourceLimits:[],resourceLimitsStatus:0}}}t[e].ResourceLimitStore=i}("StoresResourceLimitStore"),function(e){t[e]={};t[e].ResourceLimitActionCreator=class{constructor(e){this._pageContext=e.pageContext,this._agentPoolSource=e.agentPoolSource,this._resourceLimitActions=e.resourceLimitActions,this._resourceLimitStore=e.resourceLimitStore}fetchResourceLimits(){0===this._resourceLimitStore.state.resourceLimitsStatus&&(this._resourceLimitActions.resourceLimitsStatusUpdated.invoke(1),this._agentPoolSource.getResourceLimitsAsync().then((e=>{this._resourceLimitActions.resourceLimitsUpdated.invoke(e)}),(e=>{if(this._resourceLimitActions.resourceLimitsUpdated.invoke([]),e&&e.message){this._pageContext.getService("IVssTelemetryService").publishEvent(q.Telemetry.Area,q.Telemetry.PoolsAdminFeature,{message:e.message,error:e})}})))}}}("ActionsResourceLimitActionCreator"),function(e){t[e]={};t[e].ServiceEndpointActions=class{constructor(){this.azureSubscriptionsUpdated=new i.Action,this.azureSubscriptionsStatusUpdated=new i.Action,this.serviceEndpointsUpdated=new i.Action,this.serviceEndpointsStatusUpdated=new i.Action,this.serviceEndpointAuthorized=new i.Action,this.virtualMachineScaleSetsUpdated=new i.Action,this.virtualMachineScaleSetsErrorUpdated=new i.Action,this.virtualMachineScaleSetsStatusUpdated=new i.Action}}}("ActionsServiceEndpointActions"),function(e){t[e]={};t[e].ServiceEndpointSource=class{constructor(e){this._sleepTimeAwaitingEndpoint=1e3,this._pageContext=e,this._serviceEndpointRestClient=(0,u.getServiceEndpointClient)(e)}async getAzureSubscriptions(){return this._serviceEndpointRestClient.getAzureSubscriptions().then((e=>e.value))}async getServiceEndpoints(e){let t,i=l.AzureEndpointConstants.AzureRmEndpointType;if(i.indexOf(":")>0){const e=i.split(":");i=e[0],t=e[1].split(",")}return this._serviceEndpointRestClient.getServiceEndpoints(e,i,t,undefined,undefined)}async createAzureRMConnection(e,t){const i={authorization:{parameters:{authenticationType:l.AzureEndpointConstants.SpnKeyAuthType,tenantId:t.subscriptionTenantId},scheme:l.EndpointAuthorizationSchemes.ServicePrincipal},data:{creationMode:l.AzureEndpointConstants.SpnCreationModeAutomatic,environment:l.AzureEndpointConstants.DefaultAzureEnvironment,scopeLevel:l.AzureEndpointConstants.SubscriptionString,subscriptionId:t.subscriptionId,subscriptionName:t.displayName},type:q.ServiceEndpointConstants.AzureRMConnectionType,name:t.displayName+"("+t.subscriptionId+")",serviceEndpointProjectReferences:[{name:t.displayName+"("+t.subscriptionId+")",projectReference:{id:e}}]},s=await this._serviceEndpointRestClient.createServiceEndpoint(i);return this._returnEndpointWhenReady(e,s.id)}async getVirtualMachineScaleSetsAsync(e,t){const i={serviceEndpointId:t.id,serviceEndpointScope:e,mode:"getVirtualMachineScaleSets"};return this._pageContext.getService("IVssContributionService").getDataAsync(q.DataProviders.ElasticPool,i,!0).then((e=>e?e.errorMessage?Promise.reject(new Error(e.errorMessage)):e.virtualMachineScaleSets:Promise.reject(new Error(B.GetVirtualMachineScaleSetDataError))))}async _returnEndpointWhenReady(e,t){let i=await this._serviceEndpointRestClient.getServiceEndpointDetails(e,t);let s=0;for(;!i.isReady;){if(i.operationStatus&&"Failed"===i.operationStatus.state)throw new Error(i.operationStatus.statusMessage);if(s>=120)throw new Error(B.CreateRMTimeout);s++,await this._sleep(this._sleepTimeAwaitingEndpoint),i=await this._serviceEndpointRestClient.getServiceEndpointDetails(e,t)}return i}async _sleep(e){return new Promise((t=>setTimeout(t,e)))}}}("SourcesServiceEndpointSource"),function(e){t[e]={};class i extends a.Store{constructor(){super("ServiceEndpointStoreChanged"),this.state={azureSubscriptions:[],azureSubscriptionsStatus:0,serviceEndpointScope:"",serviceEndpoints:[],serviceEndpointsStatus:0},this.updateAzureSubscriptions=e=>{this.state=Object.assign(Object.assign({},this.state),{azureSubscriptions:e.slice(0),azureSubscriptionsStatus:2}),this.emitChanged()},this.updateAzureSubscriptionsStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{azureSubscriptionsStatus:e}),this.emitChanged()},this.updateServiceEndpoints=(e,t)=>{this.state=Object.assign(Object.assign({},this.state),{serviceEndpointScope:e.slice(0),serviceEndpoints:t.slice(0),serviceEndpointsStatus:2}),this.emitChanged()},this.updateServiceEndpointStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{serviceEndpointsStatus:e}),this.emitChanged()},this.serviceEndpointAuthorized=e=>{const t=this.state.serviceEndpoints.filter((t=>t.id!==e.id));t.push(e),this.state=Object.assign(Object.assign({},this.state),{serviceEndpoints:t}),this.emitChanged()}}}t[e].ServiceEndpointStore=i}("StoresServiceEndpointStore"),function(e){t[e]={};t[e].ServiceEndpointActionCreator=class{constructor(e){this._pageContext=e.pageContext,this._notificationActionCreator=e.notificationActionCreator,this._serviceEndpointActions=e.serviceEndpointActions,this._serviceEndpointSource=e.serviceEndpointSource,this._serviceEndpointStore=e.serviceEndpointStore}loadAzureSubscriptions(e=!1){(e||0===this._serviceEndpointStore.state.azureSubscriptionsStatus)&&(this._serviceEndpointActions.azureSubscriptionsStatusUpdated.invoke(1),this._serviceEndpointSource.getAzureSubscriptions().then((e=>{this._serviceEndpointActions.azureSubscriptionsUpdated.invoke(e)}),(e=>{this._handleError(e)})))}loadServiceEndpoints(e,t=!1){(t||0===this._serviceEndpointStore.state.serviceEndpointsStatus||this._serviceEndpointStore.state.serviceEndpointScope!==e)&&(this._serviceEndpointActions.serviceEndpointsStatusUpdated.invoke(1),this._serviceEndpointSource.getServiceEndpoints(e).then((t=>{this._serviceEndpointActions.serviceEndpointsUpdated.invoke({serviceEndpointScope:e,serviceEndpoints:t})}),(e=>{this._handleError(e)})))}authorizeNewServiceEndpoint(e,t){const i=Object.assign({},t);let s=this.getSubscriptionDisplayName(i),o=1;const n=this._serviceEndpointStore.state.serviceEndpoints.map((e=>e.name));for(;n.indexOf(s)>=0;)i.displayName=t.displayName+"("+o+")",s=this.getSubscriptionDisplayName(i),o++;return this._serviceEndpointSource.createAzureRMConnection(e,i).then((t=>{this._serviceEndpointActions.serviceEndpointAuthorized.invoke(t),this.loadVirtualMachineScaleSets(e,t)}),(e=>{this._handleError(e)})),s}loadVirtualMachineScaleSets(e,t){this._serviceEndpointActions.virtualMachineScaleSetsUpdated.invoke([]),this._serviceEndpointActions.virtualMachineScaleSetsStatusUpdated.invoke(1),this._serviceEndpointSource.getVirtualMachineScaleSetsAsync(e,t).then((e=>{this._serviceEndpointActions.virtualMachineScaleSetsUpdated.invoke(e)}),(e=>{if(e&&e.message){this._serviceEndpointActions.virtualMachineScaleSetsUpdated.invoke([]),this._serviceEndpointActions.virtualMachineScaleSetsErrorUpdated.invoke(e.message);this._pageContext.getService("IVssTelemetryService").publishEvent(q.Telemetry.Area,q.Telemetry.PoolsAdminFeature,{message:e.message,error:e})}}))}getSubscriptionDisplayName(e){return e.displayName+"("+e.subscriptionId+")"}_handleError(e){if(e&&e.message){this._notificationActionCreator.addNotification(e.message,H.NotificationType.error);this._pageContext.getService("IVssTelemetryService").publishEvent(q.Telemetry.Area,q.Telemetry.PoolsAdminFeature,{message:e.message,error:e})}}}}("ActionsServiceEndpointActionCreator"),function(e){t[e]={};class i extends a.Store{constructor(){super("SignalRStoreChanged"),this.state=3,this.updateSignalRState=e=>{this.state=e,this.emitChanged()}}}t[e].SignalRStore=i}("StoresSignalRStore"),function(e){t[e]={};t[e].SignalRActions=class{constructor(){this.signalRStateUpdated=new i.Action}}}("ActionsSignalRActions"),t.ClientContractsDistributedTaskWrappers={},function(e){W=t[e]={},function(e){e.EnableChecksScalabilityPhase1Warnings="Pipelines.Checks.EnableChecksScalabilityPhase1Warnings",e.EnableChecksScalabilityPhase2Errors="Pipelines.Checks.EnableChecksScalabilityPhase2Errors",e.EnableChecksScalabilityPhase3FailCheckRuns="Pipelines.Checks.EnableChecksScalabilityPhase3FailCheckRuns",e.EnableChecksScalabilityResourceIssues="Pipelines.Checks.EnableChecksScalabilityResourceIssues",e.ResourceListOptimizations="Pipelines.Policy.ResourceListOptimizations",e.EnableBypassTaskChecks="Pipelines.Checks.EnableBypassTaskChecks",e.EnableBypassApprovals="Pipelines.Checks.EnableBypassApprovals",e.EnableRerunChecks="Pipelines.Checks.EnableRerunChecks",e.FixTimeoutJobWhenOrderingIsEnabled="Pipelines.Checks.FixTimeoutJobWhenOrderingIsEnabled",e.AllowChangingApprovalOrder="Pipelines.Checks.AllowChangingApprovalOrder",e.EnableOrderingChecks="Pipelines.Checks.EnableOrderingChecks",e.EnableCheckUpdatedHook="Pipelines.Checks.EnableCheckUpdatedHook",e.DoNotAllowChangingPoPCheckType="Pipelines.Checks.DoNotAllowChangingPoPCheckType",e.FixBranchCheckWhenPipelineIsNotCheckedOut="Pipelines.Checks.FixBranchCheckWhenPipelineIsNotCheckedOut",e.EnableProductionReadinessCheck="ProductionReadiness.EnableProductionReadinessCheck",e.EnableProductionReadinessCheckInShadowMode="ProductionReadiness.EnableProductionReadinessCheckInShadowMode",e.HandleMultipleExclusiveLocksInPeristedStages="Pipelines.Checks.HandleMultipleExclusiveLocksInPeristedStages",e.TimeoutAuthorizationCheckIn7Days="Pipelines.Checks.TimeoutAuthorizationCheckIn7Days",e.BetterTelemetryForPipelineLog="Pipelines.Checks.BetterTelemetryForPipelineLog",e.FixNotificationSentToExOrgMember="Pipelines.Checks.FixNotificationSentToExOrgMember",e.EnableViolationCreatorCannotApprove="ProductionReadinessEngine.EnableViolationCreatorCannotApprove"}(t[e].FeatureFlagConstants||(t[e].FeatureFlagConstants={})),function(e){e.ServiceEndpoint="endpoint",e.Queue="queue",e.SecureFile="securefile",e.VariableGroup="variablegroup",e.Environment="environment",e.AgentPool="agentpool",e.Repository="repository",e.PersistedStage="persistedstage"}(t[e].ResourceTypeNames||(t[e].ResourceTypeNames={}))}("ClientContractsGeneratedConstants"),function(e){t[e]={};t[e].getVMScaleSetOSType=function(e){var t,i,s,o,n,r;return void 0!==(null===(s=null===(i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.virtualMachineProfile)||void 0===i?void 0:i.osProfile)||void 0===s?void 0:s.windowsConfiguration)?0:void 0!==(null===(r=null===(n=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.virtualMachineProfile)||void 0===n?void 0:n.osProfile)||void 0===r?void 0:r.linuxConfiguration)?1:void 0},t[e].getAzurePortalVmssUrl=function(e,t,i){const s=(0,d.format)("https://portal.azure.com/#@{0}/resource{1}",e,t);return i?(0,d.format)("{0}/{1}",s,i):s}}("ElasticPoolUtils"),function(e){t[e]={};class i extends o.VssService{constructor(){super(...arguments),this.items=new p.ObservableArray,this._onFPSClick=(e,t)=>{(0,r.onClickFPS)(this.pageContext,e,!0,t,{telemetrySource:"pools-admin-breadcrumb"})}}getBreadcrumbItems(e){return this.items}refresh(e){this.items.removeAll();const t=this.pageContext.getService("IPoolAdminLinkingService");if(e.agentQueue){const i=t.getAgentQueueUrl(e.agentQueue);if(this.items.push({key:"agentQueue",text:e.agentQueue.name,href:i,onClick:e=>{this._onFPSClick(i,e)}}),e.agent){const i=t.getAgentUrl(e.agentQueue,void 0,e.agent);this.items.push({key:"agent",text:e.agent.name,href:i,onClick:e=>{this._onFPSClick(i,e)}})}}else if(e.agentPool){const i=t.getAgentPoolUrl(e.agentPool);if(this.items.push({key:"agentPool",text:e.agentPool.name,href:i,onClick:e=>{this._onFPSClick(i,e)}}),e.agent){const i=t.getAgentUrl(void 0,e.agentPool,e.agent);this.items.push({key:"agent",text:e.agent.name,href:i,onClick:e=>{this._onFPSClick(i,e)}})}}}}t[e].HeaderBreadcrumbService=i,o.Services.add(q.ServiceIds.HeaderBreadcrumbService,{serviceFactory:i})}("ServicesHeaderBreadcrumbService"),function(e){t[e]={};class i extends h.SignalRHub{constructor(e,t){super({name:e,pageContext:t.pageContext,hostInformation:t.hostInformation,userInactivityTimeoutMs:36e5,proxyToRegister:g.getDTProxyToRegister,removeApiPath:t.removeApiPath}),this.options=t,this.hubName=e}get hub(){return this.getHub(this.hubName)}clearTimer(){this.listenTimer&&clearTimeout(this.listenTimer)}isConnecting(){this.options.signalRActions.signalRStateUpdated.invoke(1)}isConnected(){this.options.signalRActions.signalRStateUpdated.invoke(2)}isDisconnected(){this.options.signalRActions.signalRStateUpdated.invoke(3)}isReconnected(){this.options.signalRActions.signalRStateUpdated.invoke(2)}isReconnecting(){this.options.signalRActions.signalRStateUpdated.invoke(1)}isSlow(){}isUserActive(){}isUserInactive(){}}t[e].SignalRHubBase=i}("SignalRHubBase"),function(e){t[e]={};t[e].AgentCloudSource=class{constructor(e){this._pageContext=e,this._client=(0,c.getTaskAgentClient)(e)}getCachedAgentClouds(){return this._initializeAgentCloudsData(),this._agentCloudsData&&this._agentCloudsData.taskAgentClouds?this._agentCloudsData.taskAgentClouds:[]}async getAgentCloud(e){return this._client.getAgentCloud(e)}async getAgentClouds(){return this._client.getAgentClouds()}async getAgentCloudTypes(){return this._client.getAgentCloudTypes()}async addAgentCloud(e){return this._client.addAgentCloud(e)}async deleteAgentCloud(e){return this._client.deleteAgentCloud(e)}_initializeAgentCloudsData(){if(!this._agentCloudsDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._agentCloudsData=e.getData(q.DataProviders.AgentCloudsList),this._agentCloudsDataInitialized=!0}}}}("SourcesAgentCloudSource"),function(e){t[e]={};t[e].AgentDefinitionSource=class{constructor(e){const t=e.getService("IVssContributionService");this._agentDefinitions=t.getData(q.DataProviders.AgentDefinitions)}getCachedAgentDefinitions(){return this._agentDefinitions?this._agentDefinitions:[]}}}("SourcesAgentDefinitionSource"),function(e){t[e]={};t[e].AgentQueueSource=class{constructor(e){this._queuesDataInitialized=!1,this._queueDataInitialized=!1,this._client=(0,c.getTaskAgentClient)(e),this._pageContext=e}getCachedAgentQueues(){return this._initializeAgentQueuesData(),this._queuesData&&this._queuesData.taskAgentQueues?this._queuesData.taskAgentQueues:[]}getCachedSelectedAgentQueue(){return this._initializeAgentQueueData(),this._queueData&&this._queueData.selectedAgentQueue?this._queueData.selectedAgentQueue:void 0}async addAgentQueue(e,t,i){return this._client.addAgentQueue(e,t,i)}async deleteAgentQueue(e,t){return this._client.deleteAgentQueue(e,t)}_initializeAgentQueuesData(){if(!this._queuesDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._queuesData=e.getData(q.DataProviders.Queues),this._queuesDataInitialized=!0}}_initializeAgentQueueData(){if(!this._queueDataInitialized){const e=this._pageContext.getService("IVssContributionService");this._queueData=e.getData(q.DataProviders.Queue),this._queueDataInitialized=!0}}getCheckIssuesForAgentQueues(e){let t={resourceTypeName:W.ResourceTypeNames.Queue,resourceIds:e.map((e=>e.id)).join(",")};return this._pageContext.getService("IVssContributionService").getDataAsync(q.DataProviders.CheckIssues,t)}}}("SourcesAgentQueueSource"),function(e){t[e]={};t[e].JobSource=class{constructor(e){this._client=(0,c.getTaskAgentClient)(e);const t=e.getService("IVssContributionService");this._jobsData=t.getData(q.DataProviders.Jobs)}getCachedJobs(){return this._jobsData&&this._jobsData.jobs?this._jobsData.jobs:[]}async getAgentPoolJobs(e,t,i){return this._client.getAgentRequests(e,t,i)}async getAgentPoolMaintenanceJobs(e){return this._client.getAgentPoolMaintenanceJobs(e)}async getAgentPoolJobsForAgent(e,t,i){return this._client.getAgentRequestsForAgent(e,t,i)}async getAgentRequest(e,t,i){return this._client.getAgentRequest(e,t,i)}async queueMaintenanceJob(e,t){return this._client.queueAgentPoolMaintenanceJob(e,t)}}}("SourcesJobSource"),function(e){t[e]={};const i="101EAE8C-1709-47F9-B228-0E476C35B3BA",s="queue";t[e].SecuritySource=class{constructor(e){this._securityService=e.getService("IVssSecurityService"),this._buildClient=e.getRestClient("IBuildRestClient");const t=e.getService("ITfsPageService");this._tfsPageData=t.getData()}hasAgentQueuePermission(e,t){return this._securityService.hasPermission(i,this._getAgentQueueSecurityToken(e),t)}hasAllAgentQueuesPermission(e){return this._securityService.hasPermission(i,this._getAgentQueueSecurityToken(void 0),e)}hasAgentPoolPermission(e,t){return this._securityService.hasPermission(i,this._getAgentPoolSecurityToken(e),t)}hasAllAgentPoolsPermission(e){return this._securityService.hasPermission(i,this._getAgentPoolSecurityToken(void 0),e)}async getPipelinesAuthorizedForQueue(e){return this._tfsPageData&&this._tfsPageData.project?this._buildClient.getProjectResources(this._tfsPageData.project.id,s,e.toString()).then((t=>this._handleResourceReferenceResponse(e,t))):Promise.resolve(!1)}async setPipelinesAuthorizedForQueue(e,t){if(this._tfsPageData&&this._tfsPageData.project){const i={authorized:t,id:e.id.toString(),name:e.name,type:s};return this._buildClient.authorizeProjectResources([i],this._tfsPageData.project.id).then((t=>this._handleResourceReferenceResponse(e.id,t)))}return Promise.resolve(!1)}_handleResourceReferenceResponse(e,t){const i=t.filter((t=>t.id===e.toString()));return!!i[0]&&i[0].authorized}_getAgentQueueSecurityToken(e){let t="AgentQueues";return this._tfsPageData&&this._tfsPageData.project&&(t=t.concat("/",this._tfsPageData.project.id)),e&&(t=t.concat("/",e.toString())),t}_getAgentPoolSecurityToken(e){let t="AgentPools";return e&&(t=t.concat("/",e.toString())),t}}}("SourcesSecuritySource"),function(e){t[e]={};class i extends a.Store{constructor(){super("AgentCloudStoreChanged"),this.state=[],this.updateAgentClouds=e=>{this.state=this._sortAgentClouds(e.slice(0)),this.emitChanged()},this.addOrUpdateAgentCloud=e=>{const t=this.state.filter((t=>t.agentCloudId!==e.agentCloudId));this.state=this._sortAgentClouds(t.concat([e])),this.emitChanged()},this.deleteAgentCloud=e=>{this.state=this.state.filter((t=>t.agentCloudId!==e.agentCloudId)),this.emitChanged()}}getAgentCloudById(e){return this.state.filter((t=>t.agentCloudId===e))[0]}_sortAgentClouds(e){return e.sort(((e,t)=>(0,d.localeIgnoreCaseComparer)(e.name,t.name)))}}t[e].AgentCloudStore=i}("StoresAgentCloudStore"),function(e){t[e]={};class i extends a.Store{constructor(){super("AgentDefinitionStore"),this.state=[],this.updateAgentDefinitions=e=>{this.state=e.splice(0),this.emitChanged()}}}t[e].AgentDefinitionStore=i}("StoresAgentDefinitionStore"),function(e){t[e]={};class i extends a.Store{constructor(){super("ConfirmationDialogStoreChanged"),this.showDialog=e=>{this.state={isOpen:!0,selectedItem:e.selectedItem,title:e.title,content:e.content,confirmButtonType:e.confirmButtonType,onConfirm:e.onConfirm,onCancel:e.onCancel},this.emitChanged()},this.dismissDialog=()=>{this.state={isOpen:!1,selectedItem:void 0,title:"",content:"",confirmButtonType:0},this.emitChanged()},this.state={isOpen:!1,selectedItem:void 0,title:"",content:"",confirmButtonType:0}}}t[e].ConfirmationDialogStore=i}("StoresConfirmationDialogStore"),function(e){K=t[e]={};const i={"macos-1013":"macOS-10.13","macos 1013":"macOS-10.13","macos 10.13":"macOS-10.13",macos:"macOS-10.14","macos 10.14":"macOS-10.14",ubuntu16:"ubuntu-16.04","ubuntu 16.04":"ubuntu-16.04",defaulthosted:"vs2015-win2012r2","vs2015 win2012r2":"vs2015-win2012r2",vs2017:"vs2017-win2016","vs2017 win2016":"vs2017-win2016",wincon:"win1803","windows-2019-vs2019":"windows-2019","windows 2019 vs2019":"windows-2019","windows 2019":"windows-2019",mac_int1013:"appcenter-macos-10.13","appcenter macos 10.13":"appcenter-macos-10.13",mac_int:"appcenter-macos-10.14","appcenter macos 10.14":"appcenter-macos-10.14","xcode9-macos1012":"internal-macos-10.12","xcode9 macos1012":"internal-macos-10.12","internal macos 10.12":"internal-macos-10.12",mac_internal:"internal-macos-10.13","internal macos 10.13":"internal-macos-10.13","internal-macos1014":"internal-macos-10.14","internal macos1014":"internal-macos-10.14","internal macos 10.14":"internal-macos-10.14",ubuntu18:"ubuntu-18.04","ubuntu 18.04":"ubuntu-18.04"};t[e].getAgentSpecificationName=function(e){if(e&&e.agentSpecification)for(const t of Object.keys(e.agentSpecification))if((0,d.equals)(t,"VMImage",!0)){let s=e.agentSpecification[t];return i[s.toLowerCase()]&&(s=i[s.toLowerCase()]),s}return""},t[e].getProjectName=function(e,t){const i=t.filter((t=>t.id===e.scopeId))[0];return i&&i.name?i.name:""},t[e].getJobNumber=function(e){return(0,d.format)(B.TaskAgentJobNumberFormat,e.requestId)}}("TaskAgentJobRequestUtils"),function(e){t[e]={};class i extends a.Store{constructor(){super("JobStoreChanged"),this.state=[],this.filter=new m.Filter,this.updateJobs=e=>{this.state=this._sortJobs(e),this.emitChanged()},this.updateJob=e=>{let t=this.state.filter((t=>t.requestId===e.requestId))[0];const i=this.state.filter((t=>t.requestId!==e.requestId));t?(t=Object.assign({definition:e.definition||t.definition,owner:e.owner||t.owner},e),i.push(t)):i.push(e),this.state=this._sortJobs(i),this.emitChanged()}}getFilteredJobs(e,t){if(this.filter.hasChangesToReset()){const i=this.filter.getFilterItemValue(q.FilterKeys.Keyword),s=this.filter.getFilterItemValue(q.FilterKeys.Project),o=this.filter.getFilterItemValue(q.FilterKeys.Agent),n=this.filter.getFilterItemValue(q.FilterKeys.AgentSpec);return this.state.filter((r=>{let a=!0;return r?(a&&o&&(a=this._filterByAgent(r,o)),a&&n&&(a=this._filterByAgentSpec(r,n)),a&&s&&(a=this._filterByProject(r,s)),a&&i&&(a=this._filterByKeyword(r,i,e,t))):a=!1,a}))}return this.state}_filterByAgent(e,t){if(0===t.length)return!0;for(const i of t)if(e.reservedAgent&&(0,d.equals)(e.reservedAgent.name,i,!1))return!0;return!1}_filterByAgentSpec(e,t){if(0===t.length)return!0;const i=(0,K.getAgentSpecificationName)(e);for(const e of t)if((0,d.equals)(i,e,!1))return!0;return!1}_filterByProject(e,t){if(0===t.length)return!0;for(const i of t)if((0,d.equals)(e.scopeId,i,!0))return!0;return!1}_filterByKeyword(e,t,i,s){const o=(0,K.getJobNumber)(e),n=(0,K.getProjectName)(e,i),r=(0,K.getAgentSpecificationName)(e);return(0,d.caseInsensitiveContains)(o,t)||e.owner&&(0,d.caseInsensitiveContains)(e.owner.name,t)||e.jobName&&(0,d.caseInsensitiveContains)(e.jobName,t)||e.definition&&(0,d.caseInsensitiveContains)(e.definition.name,t)||s&&e.reservedAgent&&(0,d.caseInsensitiveContains)(e.reservedAgent.name,t)||(0,d.caseInsensitiveContains)(n,t)||s&&(0,d.caseInsensitiveContains)(r,t)}_sortJobs(e){const t=[],i=[],s=[],o=[];for(const n of e)n.finishTime?o.push(n):n.receiveTime?s.push(n):n.assignTime?i.push(n):t.push(n);return s.sort(((e,t)=>e.receiveTime.getTime()-t.receiveTime.getTime())).concat(i.sort(((e,t)=>e.assignTime.getTime()-t.assignTime.getTime()))).concat(t.sort(((e,t)=>e.queueTime.getTime()-t.queueTime.getTime()))).concat(o.sort(((e,t)=>t.finishTime.getTime()-e.finishTime.getTime())))}}t[e].JobStore=i}("StoresJobStore"),function(e){t[e]={};class i extends a.Store{constructor(){super("ProjectStoreChanged"),this.state=[],this.updateProjects=e=>{this.state=e.splice(0),this.emitChanged()}}}t[e].ProjectStore=i}("StoresProjectStore"),function(e){t[e]={};class i extends a.Store{constructor(){super("VirtualMachineScaleSetStoreChanged"),this.state={serviceEndpoint:void 0,virtualMachineScaleSets:[],virtualMachineScaleSetsStatus:0,virtualMachineScaleSetsErrorMessage:void 0},this.updateVirtualMachineScaleSets=e=>{this.state=Object.assign(Object.assign({},this.state),{virtualMachineScaleSets:this._sortVirtualMachineScaleSets(e.slice(0)),virtualMachineScaleSetsStatus:2,virtualMachineScaleSetsErrorMessage:void 0}),this.emitChanged()},this.updateVirtualMachineScaleSetsError=e=>{this.state=Object.assign(Object.assign({},this.state),{virtualMachineScaleSetsErrorMessage:e}),this.emitChanged()},this.updateVirtualMachineScaleSetsStatus=e=>{this.state=Object.assign(Object.assign({},this.state),{virtualMachineScaleSetsStatus:e}),this.emitChanged()}}_sortVirtualMachineScaleSets(e){return e.sort(((e,t)=>(0,d.localeIgnoreCaseComparer)(e.name,t.name)))}}t[e].VirtualMachineScaleSetStore=i}("StoresVirtualMachineScaleSetStore"),function(e){G=t[e]={};t[e].isHostedOrPoolProviderBacked=function(e){return!!e&&(e.isHosted||e.agentCloudId>0)},t[e].isElastic=function(e){return!(!e||!e.options)&&!(1&~e.options)},t[e].showPoolAgents=function(e){return!(e&&!e.isHosted&&e.agentCloudId)},t[e].showPoolAgentSpecs=function(e){return!(!e||!e.isHosted||e.isLegacy||!e.agentCloudId)},t[e].getPoolOwnerDisplayName=function(e){const{displayName:t}=e;return t?(0,d.equals)(t,"Microsoft.VisualStudio.Services.TFS",!0)||(0,d.equals)(t,"Microsoft.TeamFoundation.System",!0)?"Azure Pipelines":t:""}}("TaskAgentPoolUtils"),function(e){t[e]={};class i extends S.PureComponent{constructor(e){super(e),this._onOkClick=e=>{this.props.confirmationDialogStore.state.onConfirm&&this.props.confirmationDialogStore.state.selectedItem&&this.props.confirmationDialogStore.state.onConfirm(this.props.confirmationDialogStore.state.selectedItem)},this._onDismiss=()=>{this.props.confirmationDialogStore.state.onCancel&&this.props.confirmationDialogStore.state.onCancel()},this._onStoreChanged=()=>{this.setState(this._getStateFromStores())},this._getStateFromStores=()=>({isOpen:this.props.confirmationDialogStore.state.isOpen,title:this.props.confirmationDialogStore.state.title,content:this.props.confirmationDialogStore.state.content,confirmButtonType:this.props.confirmationDialogStore.state.confirmButtonType}),this.state=this._getStateFromStores()}componentDidMount(){this.props.confirmationDialogStore.addChangedListener(this._onStoreChanged)}componentWillUnmount(){this.props.confirmationDialogStore.removeChangedListener(this._onStoreChanged)}render(){let e,t,i=!1,s=!1;switch(this.state.confirmButtonType){case 2:e=B.Delete,t="confirm-delete-button",i=!0;break;case 1:e=B.Update,s=!0;break;case 3:i=!0;default:e=B.Confirm,s=3!=this.state.confirmButtonType}return this.state.isOpen?S.createElement(v.Dialog,{className:"pipelines-confirm-action-container",titleProps:{text:this.state.title},footerButtonProps:[{onClick:this._onDismiss,text:B.Cancel},{className:t,danger:i,onClick:this._onOkClick,primary:s,text:e}],onDismiss:this._onDismiss},this.state.content):null}}t[e].ConfirmationDialog=i}("ComponentsConfirmationDialog"),function(e){Y=t[e]={};class i extends S.PureComponent{constructor(e){super(e)}render(){return S.createElement(A.ConditionalChildren,{renderChildren:this.props.isVisible},S.createElement("span",{className:"bolt-formitem-message body-xs"},S.createElement(C.Icon,{iconName:"Info"}),(0,d.format)(B.EphemeralDiskWarning),S.createElement(b.Link,{className:"margin-left-4",href:q.FwLinks.EphemeralDiskInfo,target:"_blank"},B.LearnMore)))}}t[e].ReimageDisabledWarning=i;t[e].reimageIsNotAvaialable=e=>{var t,i,s,o,n;return 1==(null==e?void 0:e.properties.orchestrationMode)&&"Local"!=(null===(n=null===(o=null===(s=null===(i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.virtualMachineProfile)||void 0===i?void 0:i.storageProfile)||void 0===s?void 0:s.osDisk)||void 0===o?void 0:o.diffDiskSettings)||void 0===n?void 0:n.option)}}("ComponentsReimageDisabledWarning"),function(e){t[e]={};class i extends P.VssComponent{constructor(e,t){super(e,t),this._disableReimageIfNoEphemeral=(0,f.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.ElasticPoolDisableRecycleForNonEphemeral")}render(){const e=void 0!==this.props.maxCapacity&&void 0!==this.props.desiredIdle&&(this.props.desiredIdle<0||this.props.desiredIdle>this.props.maxCapacity),t=void 0!==this.props.maxCapacity&&(this.props.maxCapacity<0||this.props.maxCapacity>1e3),i=void 0!==this.props.timeToLiveMinutes&&(this.props.timeToLiveMinutes<0||this.props.timeToLiveMinutes>1e4),s=this._disableReimageIfNoEphemeral&&(0,Y.reimageIsNotAvaialable)(this.props.virtualMachineScaleSet);return S.createElement("div",{className:"elastic-pool-settings flex-column"},S.createElement(I.Checkbox,{className:(0,E.css)("recycle-checkbox",s&&"disabled"),checked:this.props.recycleAfterEachUse,onChange:(e,t)=>!s&&this.props.onSettingsChanged(t,this.props.saveFailedAgents,this.props.maxCapacity,this.props.desiredIdle,this.props.timeToLiveMinutes,this.props.agentInteractiveUI),label:B.RecycleAfterEachUse}),S.createElement(Y.ReimageDisabledWarning,{isVisible:s}),S.createElement(A.ConditionalChildren,{renderChildren:this.props.showSaveFailedAgentCheckbox},S.createElement(I.Checkbox,{className:"save-failed-agents-checkbox",checked:this.props.saveFailedAgents,onChange:(e,t)=>this.props.onSettingsChanged(this.props.recycleAfterEachUse,t,this.props.maxCapacity,this.props.desiredIdle,this.props.timeToLiveMinutes,this.props.agentInteractiveUI),label:this._getSaveFailedAgentsLabel()})),S.createElement(A.ConditionalChildren,{renderChildren:0===this.props.operatingSystem},S.createElement(I.Checkbox,{className:"agentInteractiveUI-checkbox",checked:this.props.agentInteractiveUI,onChange:(e,t)=>this.props.onSettingsChanged(this.props.recycleAfterEachUse,this.props.saveFailedAgents,this.props.maxCapacity,this.props.desiredIdle,this.props.timeToLiveMinutes,t),label:B.AgentInteractiveUI})),S.createElement("div",{className:"pool-setting-label"},B.MaxCapacityLabel),S.createElement(y.TextField,{className:(0,E.css)("max-capacity-input",t?"bolt-textfield-error":void 0),value:void 0!==this.props.maxCapacity?this.props.maxCapacity.toString():void 0,onChange:(e,t)=>this.props.onSettingsChanged(this.props.recycleAfterEachUse,this.props.saveFailedAgents,this._parseSettingStringToNumber(t),this.props.desiredIdle,this.props.timeToLiveMinutes,this.props.agentInteractiveUI)}),S.createElement(A.ConditionalChildren,{renderChildren:t},S.createElement("div",{className:"bolt-formitem-message bolt-formitem-message-error body-xs"},B.ElasticPoolInvalidMaxSizeError)),S.createElement(A.ConditionalChildren,{renderChildren:void 0!==this.props.resourceLimits},this._getResourceLimitsString()),S.createElement("div",{className:"pool-setting-label"},B.DesiredIdleLabel),S.createElement(y.TextField,{className:(0,E.css)("desired-idle-input",e?"bolt-textfield-error":void 0),value:void 0!==this.props.desiredIdle?this.props.desiredIdle.toString():void 0,onChange:(e,t)=>this.props.onSettingsChanged(this.props.recycleAfterEachUse,this.props.saveFailedAgents,this.props.maxCapacity,this._parseSettingStringToNumber(t),this.props.timeToLiveMinutes,this.props.agentInteractiveUI)}),S.createElement(A.ConditionalChildren,{renderChildren:e},S.createElement("div",{className:"bolt-formitem-message bolt-formitem-message-error body-xs"},B.ElasticPoolIdleMoreThanMaxError)),S.createElement("div",{className:"pool-setting-label"},B.TimeToLiveMinutes),S.createElement(y.TextField,{className:(0,E.css)("time-to-live-input",i?"bolt-textfield-error":void 0),value:void 0!==this.props.timeToLiveMinutes?this.props.timeToLiveMinutes.toString():void 0,onChange:(e,t)=>this.props.onSettingsChanged(this.props.recycleAfterEachUse,this.props.saveFailedAgents,this.props.maxCapacity,this.props.desiredIdle,this._parseSettingStringToNumber(t),this.props.agentInteractiveUI)}),S.createElement(A.ConditionalChildren,{renderChildren:i},S.createElement("div",{className:"bolt-formitem-message bolt-formitem-message-error body-xs"},B.ElasticPoolInvalidTimeToLiveError)))}_getSaveFailedAgentsLabel(){return S.createElement("span",null,B.SaveFailedAgents,S.createElement(_.Button,{ariaLabel:B.SaveFailedAgentsLearnMore,className:"no-padding save-failed-agents-help-link",subtle:!0,iconProps:{iconName:"Info"},href:q.FwLinks.ElasticPoolTroubleshooting,target:"_blank"}))}_getResourceLimitsString(){let e=this._getSelfHostedParallelJobCount("Private"),t=this._getSelfHostedParallelJobCount("Public");return void 0!==e?(void 0===t&&(t=B.UnlimitedText),S.createElement("span",{className:"bolt-formitem-message body-xs"},(0,d.format)(B.SelfHostedParallelJobs,e,t),S.createElement(b.Link,{className:"margin-left-4",href:q.FwLinks.ParallelJobsDocs,target:"_blank"},B.LearnMore))):void 0}_getSelfHostedParallelJobCount(e){if(void 0!==this.props.resourceLimits){const t=this.props.resourceLimits.find((t=>!t.isHosted&&0===(0,d.localeIgnoreCaseComparer)(t.parallelismTag,e)));if(void 0!==(null==t?void 0:t.totalCount))return t.totalCount>=1e4?B.UnlimitedText:t.totalCount.toString()}}_parseSettingStringToNumber(e){const t=parseInt(e,10);return isNaN(t)?void 0:t}}t[e].ElasticPoolSettings=i}("ComponentsElasticPoolSettings"),function(e){t[e]={};class i extends P.VssComponent{constructor(){super(...arguments),this._onRowClicked=(e,t)=>{t.data.linkProps&&t.data.linkProps.href&&(0,r.onClickFPS)(this.context.pageContext,t.data.linkProps.href,!0,e)},this._renderNameCell=(e,t,i,s)=>S.createElement(T.TwoLineTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,line1:this._renderPrimaryNameRowText(s.value),line2:this._renderSecondaryNameRowText(s.value),iconProps:{render:e=>this._renderJobStatusIcon(s.value,e)}}),this._renderProjectCell=(e,t,i,s)=>S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement(x.Tooltip,{overflowOnly:!0},S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},(0,K.getProjectName)(s.value,this.props.projects)))),this._renderAgentCell=(e,t,i,s)=>{const o=s.value.reservedAgent?s.value.reservedAgent.name:"",n=this.props.agentLinkProvider?this.props.agentLinkProvider(s.value):void 0;let a;return a=n?S.createElement(b.Link,{className:"text-ellipsis",onClick:e=>(0,r.onClickFPS)(this.context.pageContext,n,!0,e),subtle:!0},o):S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},o),S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement(x.Tooltip,{overflowOnly:!0},a))},this._renderAgentSpecCell=(e,t,i,s)=>S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement(x.Tooltip,{overflowOnly:!0},S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},(0,K.getAgentSpecificationName)(s.value)))),this._renderQueuedTimeCell=(e,t,i,s)=>S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},s.value.queueTime&&S.createElement(D.Ago,{date:s.value.queueTime,format:1}))),this._renderWaitTimeCell=(e,t,i,s)=>{const o=s.value.assignTime||s.value.finishTime;return S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},s.value.queueTime&&S.createElement(k.Duration,{startDate:s.value.queueTime,endDate:3!==this.props.signalRState||o?o:new Date(Date.now()),tooltipProps:{text:(0,d.format)(B.QueuedAtTime,(0,N.tooltipString)(s.value.queueTime))}})))},this._renderDurationCell=(e,t,i,s)=>S.createElement(T.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},S.createElement("span",{className:"text-ellipsis bolt-list-cell-text"},s.value.receiveTime&&S.createElement(k.Duration,{startDate:s.value.receiveTime,endDate:3!==this.props.signalRState||s.value.finishTime?s.value.finishTime:new Date(Date.now())})))}render(){return S.createElement(T.Table,{className:"pipelines-jobs-list",columns:this._getColumns(),itemProvider:new R.ArrayItemProvider(this._buildListItems()),onActivate:this._onRowClicked})}_buildListItems(){const e=[];return this.props.jobs&&this.props.jobs.forEach((t=>{const i={value:t};if(t.owner){const e=this.context.pageContext.getService("IPoolAdminLinkingService");i.linkProps={href:e.getJobResultsUrl(t)}}e.push(i)})),e}_getColumns(){const e=1===this.props.agentColumnStyle?-38:-35,t=1===this.props.agentColumnStyle?-18:-15,i=1===this.props.agentColumnStyle?-18:-15,s=1===this.props.agentColumnStyle?-13:-10,o=1===this.props.agentColumnStyle?-13:-10,n=[{id:"name",name:B.Name,columnStyle:2,width:new p.ObservableValue(e),renderCell:this._renderNameCell},{id:"project",name:B.Project,columnStyle:1,width:new p.ObservableValue(t),renderCell:this._renderProjectCell}];return 2===this.props.agentColumnStyle?n.push({id:"agent",name:B.Agent,columnStyle:3,width:new p.ObservableValue(-15),renderCell:this._renderAgentCell}):3===this.props.agentColumnStyle&&n.push({id:"agentSpec",name:B.AgentSpecification,columnStyle:3,width:new p.ObservableValue(-15),renderCell:this._renderAgentSpecCell}),n.push({id:"queued",name:B.Queued,columnStyle:3,width:new p.ObservableValue(i),renderCell:this._renderQueuedTimeCell},{id:"waitTime",name:B.WaitTime,columnStyle:3,width:new p.ObservableValue(s),renderCell:this._renderWaitTimeCell},{id:"duration",name:B.Duration,columnStyle:3,width:new p.ObservableValue(o),renderCell:this._renderDurationCell}),n}_renderJobStatusIcon(e,t){return S.createElement(w.Status,Object.assign({},this._getStatusPropsForJob(e),{className:t,size:"24"}))}_renderPrimaryNameRowText(e){return S.createElement(x.Tooltip,{overflowOnly:!0},S.createElement("span",{className:"fontWeightSemiBold text-ellipsis bolt-list-cell-text link-left-padding"},(0,K.getJobNumber)(e)))}_renderSecondaryNameRowText(e){return S.createElement("div",{className:"fontSize secondary-text flex-row flex-baseline"},this._getJobNameContent(e),this._getPipelineNameContent(e))}_getJobNameContent(e){let t,i=B.TaskAgentJobListUnknown;return e.owner&&(i=e.jobName?(0,d.format)(B.TaskAgentJobNameFormat,e.owner.name,e.jobName):e.owner.name,e.owner._links&&e.owner._links.web&&(t=e.owner._links.web.href)),t?S.createElement(b.Link,{className:"text-ellipsis",href:t,subtle:!0},i):S.createElement("span",{className:"text-ellipsis link-padding"},i)}_getStatusPropsForJob(e){if(!e.finishTime)return e.receiveTime?w.Statuses.Running:w.Statuses.Queued;switch(e.result){case 2:return w.Statuses.Failed;case 5:case 3:return w.Statuses.Canceled;case 4:return w.Statuses.Skipped;case 1:return w.Statuses.Warning;default:return w.Statuses.Success}}_getPipelineNameContent(e){return e.definition?e.definition._links&&e.definition._links.web?S.createElement(b.Link,{className:"text-ellipsis",href:e.definition._links.web.href,subtle:!0},e.definition.name):S.createElement("span",{className:"text-ellipsis bolt-list-cell-text link-padding"},e.definition.name):S.createElement("span",{className:"text-ellipsis bolt-list-cell-text link-padding"},B.TaskAgentJobListUnknown)}}t[e].JobsList=i}("ComponentsJobsList"),function(e){t[e]={};class i extends S.Component{constructor(e){super(e),this._getProjectNames=()=>this.props.projects.map((e=>({text:e.name,id:e.id}))),this._getAgentNames=()=>this.props.agents.map((e=>e.name)),this._getAgentSpecNames=()=>this.props.agentDefinitions.map((e=>e.identifier)),this.agentSelection=new V.DropdownMultiSelection,this.agentSpecSelection=new V.DropdownMultiSelection,this.projectSelection=new V.DropdownMultiSelection}render(){return S.createElement(M.FilterBar,{className:"bolt-filterbar-white depth-8 flex-noshrink",filter:this.props.filter,onDismissClicked:this.props.onFilterToggled},S.createElement(L.KeywordFilterBarItem,{filterItemKey:q.FilterKeys.Keyword,filter:this.props.filter}),S.createElement(j.DropdownFilterBarItem,{filterItemKey:q.FilterKeys.Project,filter:this.props.filter,items:this._getProjectNames(),selection:this.projectSelection,placeholder:B.Project}),2===this.props.agentColumnStyle&&S.createElement(j.DropdownFilterBarItem,{noItemsText:B.NoAgentsAvailable,filterItemKey:q.FilterKeys.Agent,filter:this.props.filter,items:this._getAgentNames(),selection:this.agentSelection,placeholder:B.Agent}),3===this.props.agentColumnStyle&&S.createElement(j.DropdownFilterBarItem,{filterItemKey:q.FilterKeys.AgentSpec,filter:this.props.filter,items:this._getAgentSpecNames(),selection:this.agentSpecSelection,placeholder:B.AgentSpecification}))}}t[e].JobsFilterBar=i}("ComponentsJobsFilterBar"),function(e){t[e]={};const i={[H.NotificationType.info]:"Info",[H.NotificationType.warning]:"Warning",[H.NotificationType.error]:"Error"};class s extends S.Component{render(){return S.createElement("div",{"aria-live":"assertive"},this.props.notifications.map(((e,t)=>S.createElement("div",{key:t,className:"page-content-top page-content-left page-content-right"},S.createElement(U.MessageCard,{severity:i[e.notificationType],buttonProps:e.buttonProps,onDismiss:()=>this.props.onNotificationDismissed(e)},e.message)))))}}t[e].NotificationArea=s}("ComponentsNotificationArea"),function(e){t[e]={};class i extends P.VssComponent{constructor(e,t){super(e,t)}render(){return S.createElement("div",{className:"pipelines-owner flex-row flex-center"},!this.props.hidePersona&&S.createElement(Q.VssPersona,{cssClass:"owner-persona",size:"medium",showInitialsOnImageError:!0,identityDetailsProvider:{getDisplayName:()=>(0,G.getPoolOwnerDisplayName)(this.props.identity),getIdentityImageUrl:e=>(0,z.getIdentityImageUrl)(this.context.pageContext,this.props.identity)}}),S.createElement("span",{className:"display-name"},(0,G.getPoolOwnerDisplayName)(this.props.identity)))}}t[e].Owner=i}("ComponentsOwner"),function(e){t[e]={};class i extends S.PureComponent{render(){return S.createElement(C.Icon,{className:1===this.props.issue.type?"resource-error-icon":"resource-warning-icon",iconName:1===this.props.issue.type?"ErrorBadge":"Warning",tooltipProps:{text:this.props.issue.message}})}}t[e].PoolIssueIcon=i}("ComponentsPoolIssueIcon"),function(e){t[e]={};const i=()=>S.createElement(F.Spinner,{className:"pool-security-spinner scroll-hidden",size:"large"});var s;!function(e){e[e.Pool=0]="Pool",e[e.Queue=1]="Queue"}(s=t[e].PoolRolesScope||(t[e].PoolRolesScope={}));class o extends P.VssComponent{constructor(e,t){super(e,t),this._getAvatarUrl=e=>this._identityService.getIdentityImageUrl(e);const i=this.context.pageContext.getService("ITfsPageService");this._tfsPageData=i.getData();const s=this.context.pageContext.getService("IVssPageService");this._vssPageData=s.getData(),this._identityService=this.context.pageContext.getService("IVssIdentityService")}render(){return S.createElement("div",{className:"pipelines-roles-component flex-grow flex-column"},S.createElement(O.LegacyComponent,{key:this.props.selectedRolesScope.toString(),loadingComponent:i,modules:["VSSPreview/Flux/Components/RoleAssignmentControl"],wrappedType:"vssRoleAssignmentControl",serviceInstanceId:this._getServiceInstanceId(),userId:this._getUserId(),resourceId:this._getResourceId(),resourceName:this._getResourceName(),scopeId:this._getScopeId(),manageRolesPermission:q.Permission.Manage,noPermissionsMessage:B.ManagePoolRolesNoPermissions,canEdit:this.props.hasManagePermission,canInherit:void 0!==this.props.selectedAgentQueueOrPool,operationScope:this._getOperationScope(),materializeIdentities:!0,showAvatars:!0,formAvatarUrl:this._getAvatarUrl}))}_getServiceInstanceId(){return this._vssPageData?this._vssPageData.serviceInstanceType:void 0}_getUserId(){return this._vssPageData?this._vssPageData.user.id:void 0}_getResourceId(){const e=this.context.pageContext.getService("IProjectDataService");if(this.props.selectedRolesScope===s.Queue&&e.hasProjectData()){let e;this.props.selectedAgentQueueOrPool&&(e=this.props.selectedAgentQueueOrPool.id);let t="";return this._tfsPageData&&this._tfsPageData.project&&(t=this._tfsPageData.project.id),(0,d.format)("{0}_{1}",t,e)}return this.props.selectedAgentQueueOrPool?this.props.selectedAgentQueueOrPool.id.toString():"0"}_getResourceName(){return this.props.selectedAgentQueueOrPool?this.props.selectedAgentQueueOrPool.name:void 0}_getScopeId(){return this.props.selectedRolesScope===s.Queue?this.props.selectedAgentQueueOrPool?"distributedtask.agentqueuerole":"distributedtask.globalagentqueuerole":this.props.selectedAgentQueueOrPool?"distributedtask.agentpoolrole":"distributedtask.globalagentpoolrole"}_getOperationScope(){const e={IMS:!0,Source:!0};return this._vssPageData&&!this._vssPageData.isHosted?(e.AD=!0,e.WMD=!0):e.AAD=!0,e}}t[e].PoolRoles=o}("ComponentsPoolRoles"),function(e){t[e]={};class i extends S.PureComponent{render(){let e;return e=this.props.isElastic?"AzureLogo":this.props.isHosted?"CloudWeather":"Server",S.createElement("div",{className:(0,E.css)(this.props.className,"pipelines-pool-type-icon flex-row flex-center justify-center")},S.createElement(C.Icon,{className:"fontSizeML",iconName:e}))}}t[e].PoolTypeIcon=i}("ComponentsPoolTypeIcon"),function(e){t[e]={};class i extends S.PureComponent{constructor(e){super(e),this._onProjectSelectionChanged=(e,t)=>{this.props.onProjectSelected(t.data)}}render(){return S.createElement(j.Dropdown,{className:"project-picker-dropdown",disabled:0===this.props.projects.length,placeholder:B.SelectProjectLabel,items:this._getProjectItems(),onSelect:this._onProjectSelectionChanged})}_getProjectItems(){return this.props.projects.map((e=>({id:e.id,text:e.name,data:e})))}}t[e].ProjectPicker=i}("ComponentsProjectPicker"),function(e){t[e]={};const i="__AzureDevOpsElasticPool",s="connections",o="subscriptions";class n extends P.VssComponent{constructor(e,t){super(e,t),this._subscriptionItemProvider=new J.GroupedItemProvider([],[{id:s,loading:!0,name:B.AzureConnectionGroupTitle},{id:o,loading:!0,name:B.AzureSubscriptionGroupTitle}],!0),this._subscriptionSelection=new V.DropdownSelection,this._vmssItemProvider=new p.ObservableArray,this._onConnectionOptionSelectionChanged=(e,t)=>{if(t.groupId===o)this.props.onSettingsChanged(void 0,void 0),this._vmssItemProvider.removeAll(),this.setState({authorizing:!1,needAuthorizing:!0,authorizingEndpointName:"",vmssErrorMessage:void 0});else if(t.groupId===s){const i=t.data;this.props.onSettingsChanged(i,void 0),this._vmssItemProvider.removeAll(),this.setState({authorizing:!1,needAuthorizing:!1,authorizingEndpointName:"",vmssErrorMessage:void 0}),void 0!==e&&this.props.projectId&&this.props.actionCreator.loadVirtualMachineScaleSets(this.props.projectId,i)}},this._reloadAzureSubscriptions=e=>{this.props.actionCreator.loadAzureSubscriptions(!0),void 0!==this.props.projectId&&(this._vmssItemProvider.removeAll(),this.props.actionCreator.loadServiceEndpoints(this.props.projectId,!0),this.props.onSettingsChanged(void 0,void 0))},this._onVirtualMachineScaleSetSelected=(e,t)=>{var o,n,r,a;if(!this._subscriptionSelection.selectedCount)return;const c=this._subscriptionItemProvider.value[this._subscriptionSelection.value[0].beginIndex];if(c.groupId===s){const e=this._isVmssTimeStampTagValid(null===(n=null===(o=t.data)||void 0===o?void 0:o.tags)||void 0===n?void 0:n.__AzureDevOpsElasticPoolTimeStamp);void 0!==(null===(a=null===(r=t.data)||void 0===r?void 0:r.tags)||void 0===a?void 0:a[i])&&e?(this.setState({vmssErrorMessage:(0,d.format)(B.VirtualMachineScaleSetInUseError,t.data.tags[i])}),this.props.onSettingsChanged(c.data,void 0)):(this.setState({vmssErrorMessage:this.props.virtualMachineScaleSetStore.state.virtualMachineScaleSetsErrorMessage}),this.props.onSettingsChanged(c.data,t.data))}},this._isVmssTimeStampTagValid=e=>{if(null==e)return!0;const t=new Date(e),i=this._shiftToUTC(new Date).getTime()-t.getTime();return!(Math.trunc(i/36e5)>=q.ConfigurationJob.VmssTimestampValidityHours)},this._shiftToUTC=e=>new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),this._reloadVirtualMachineScaleSets=e=>{if(void 0!==this.props.projectId&&this._subscriptionSelection.selectedCount>0){const e=this._subscriptionItemProvider.value[this._subscriptionSelection.value[0].beginIndex];if(e.groupId===s){const t=e.data;this.props.actionCreator.loadVirtualMachineScaleSets(this.props.projectId,t),this.props.onSettingsChanged(t,void 0)}}},this._updateVirtualMachineScaleSetOptions=()=>{this._vmssItemProvider.removeAll();const e=this.props.virtualMachineScaleSetStore.state.virtualMachineScaleSetsErrorMessage,t=1===this.props.virtualMachineScaleSetStore.state.virtualMachineScaleSetsStatus;if(t)this._vmssItemProvider.push({id:"loading",type:4});else{const e=this.props.virtualMachineScaleSetStore.state.virtualMachineScaleSets.map((e=>({id:e.id,text:e.name,data:e})));this._vmssItemProvider.push(...e)}this.setState({vmssLoading:t,vmssErrorMessage:e})},this._updateConnectionOptions=(e=!0)=>{let t;if(this._subscriptionSelection.selectedCount>0&&(t=this._subscriptionItemProvider.value[this._subscriptionSelection.value[0].beginIndex].id),this._subscriptionItemProvider.removeAll(),2===this.props.serviceEndpointStore.state.serviceEndpointsStatus&&this.props.serviceEndpointStore.state.serviceEndpointScope===this.props.projectId){const e=this.props.serviceEndpointStore.state.serviceEndpoints.map((e=>({id:e.id,text:e.name,groupId:s,data:e})));e.sort(((e,t)=>e.text.localeCompare(t.text,navigator.language))),e&&(this._subscriptionItemProvider.pushGroups({id:s,name:B.AzureConnectionGroupTitle}),this._subscriptionItemProvider.push(...e))}else this._subscriptionItemProvider.pushGroups({id:s,name:B.AzureConnectionGroupTitle,loading:!0});if(2===this.props.serviceEndpointStore.state.azureSubscriptionsStatus){const e=this.props.serviceEndpointStore.state.azureSubscriptions.map((e=>({id:e.subscriptionId,text:this.props.actionCreator.getSubscriptionDisplayName(e),groupId:o,data:e})));e.sort(((e,t)=>e.text.localeCompare(t.text,navigator.language))),e&&(this._subscriptionItemProvider.pushGroups({id:o,name:B.AzureSubscriptionGroupTitle}),this._subscriptionItemProvider.push(...e))}else this._subscriptionItemProvider.pushGroups({id:o,name:B.AzureSubscriptionGroupTitle,loading:!0});if(void 0!==t){const e=this._subscriptionItemProvider.value.findIndex((e=>e.id===t));-1!==e&&this._subscriptionSelection.select(e)}if(this.state.authorizingEndpointName){const e=this._subscriptionItemProvider.value.findIndex((e=>e.text===this.state.authorizingEndpointName));-1!==e&&(this._subscriptionSelection.select(e),this._onConnectionOptionSelectionChanged(void 0,this._subscriptionItemProvider.value[e]))}if(e){const e=1===this.props.serviceEndpointStore.state.azureSubscriptionsStatus,t=1===this.props.serviceEndpointStore.state.serviceEndpointsStatus;this.setState({azureSubscriptionsLoading:e,serviceEndpointsLoading:t})}},this._onAuthorize=()=>{if(!this._subscriptionSelection.selectedCount)return;const e=this._subscriptionItemProvider.value[this._subscriptionSelection.value[0].beginIndex];if(e.groupId!==o||!e.data)return;const t=e.data;if(this.props.projectId){const e=this.props.actionCreator.authorizeNewServiceEndpoint(this.props.projectId,t);this.setState({authorizing:!0,authorizingEndpointName:e})}},this.state={authorizing:!1,needAuthorizing:!1,authorizingEndpointName:"",azureSubscriptionsLoading:1===e.serviceEndpointStore.state.azureSubscriptionsStatus,serviceEndpointsLoading:1===e.serviceEndpointStore.state.serviceEndpointsStatus,vmssLoading:1===e.virtualMachineScaleSetStore.state.virtualMachineScaleSetsStatus,vmssErrorMessage:void 0},this._updateConnectionOptions(!1)}componentDidMount(){this.props.serviceEndpointStore.addChangedListener(this._updateConnectionOptions),this.props.virtualMachineScaleSetStore.addChangedListener(this._updateVirtualMachineScaleSetOptions),this.props.actionCreator.loadAzureSubscriptions(),this.props.projectId&&this.props.actionCreator.loadServiceEndpoints(this.props.projectId)}componentWillUnmount(){this.props.serviceEndpointStore.removeChangedListener(this._updateConnectionOptions),this.props.virtualMachineScaleSetStore.removeChangedListener(this._updateVirtualMachineScaleSetOptions)}componentDidUpdate(e){this.props.projectId!==e.projectId&&(this._vmssItemProvider.removeAll(),void 0!==this.props.projectId&&this.props.actionCreator.loadServiceEndpoints(this.props.projectId))}render(){const e=this.state.needAuthorizing,t=this.state.authorizing?B.Authorizing:B.Authorize,i=this.state.authorizing,s=0===this._vmssItemProvider.length&&!this.state.vmssLoading;return S.createElement("div",{className:"vm-scale-set-settings"},S.createElement("div",{className:"pool-setting-label"},B.AzureSubscriptionLabel),S.createElement("div",{className:"flex-row"},S.createElement(j.Dropdown,{className:"azure-subscription-dropdown flex-grow",disabled:0===this._subscriptionItemProvider.length||void 0===this.props.projectId,placeholder:B.SelectAzureSubscriptionLabel,items:this._subscriptionItemProvider,selection:this._subscriptionSelection,onSelect:this._onConnectionOptionSelectionChanged}),S.createElement(_.Button,{ariaLabel:B.ReloadAzureSubscriptionsAriaLabel,className:"reload-button",disabled:this.state.azureSubscriptionsLoading||this.state.serviceEndpointsLoading||!this.props.projectId||this.state.authorizing,iconProps:{iconName:"Refresh"},onClick:this._reloadAzureSubscriptions})),S.createElement(A.ConditionalChildren,{renderChildren:e},S.createElement("div",{className:"font-size secondary-text margin-top-8"},B.SubscriptionNeedsAuthorization),S.createElement(_.Button,{className:"authorize-button flex-self-start",onClick:this._onAuthorize,primary:!0,disabled:this.state.authorizing},i&&S.createElement(F.Spinner,{size:"small"}),t)),S.createElement("div",{className:"pool-setting-label"},B.VirtualMachineScaleSetLabel),S.createElement("div",{className:"flex-row"},S.createElement(j.Dropdown,{className:(0,E.css)("virtual-machine-scale-set-dropdown flex-grow",void 0!==this.state.vmssErrorMessage?"bolt-textfield-error":void 0),disabled:s,placeholder:B.SelectVirtualMachineScaleSetLabel,items:this._vmssItemProvider,onSelect:this._onVirtualMachineScaleSetSelected,loading:this.state.vmssLoading}),S.createElement(_.Button,{ariaLabel:B.ReloadVirtualMachineScaleSetsAriaLabel,className:"reload-button",disabled:this.state.azureSubscriptionsLoading||this.state.serviceEndpointsLoading||this.state.vmssLoading||!this.props.projectId||!this._subscriptionSelection.selectedCount,iconProps:{iconName:"Refresh"},onClick:this._reloadVirtualMachineScaleSets})),S.createElement(A.ConditionalChildren,{renderChildren:void 0!==this.state.vmssErrorMessage},S.createElement("div",{className:"bolt-formitem-message bolt-formitem-message-error body-xs"},this.state.vmssErrorMessage)))}}t[e].VMScaleSetSettings=n}("ComponentsVMScaleSetSettings")}),["Resources","Actions/AgentActions","Actions/AgentCloudActions","Actions/ConfirmationDialogActions","Actions/ConfirmationDialogActionCreator","Actions/JobActions","Constants","Services/ProjectDataService","Services/PoolAdminLinkingService","Actions/NavigationActionCreator","Stores/NotificationStore","Actions/NotificationActions","Actions/NotificationActionCreator","Actions/ProjectActions","Actions/ProjectActionCreator","Actions/ResourceLimitActions","Sources/AgentPoolSource","Stores/ResourceLimitStore","Actions/ResourceLimitActionCreator","Actions/ServiceEndpointActions","Sources/ServiceEndpointSource","Stores/ServiceEndpointStore","Actions/ServiceEndpointActionCreator","Stores/SignalRStore","Actions/SignalRActions","Client/Contracts/DistributedTask/Wrappers","Client/Contracts/Generated/Constants","ElasticPoolUtils","Services/HeaderBreadcrumbService","SignalRHubBase","Sources/AgentCloudSource","Sources/AgentDefinitionSource","Sources/AgentQueueSource","Sources/JobSource","Sources/SecuritySource","Stores/AgentCloudStore","Stores/AgentDefinitionStore","Stores/ConfirmationDialogStore","TaskAgentJobRequestUtils","Stores/JobStore","Stores/ProjectStore","Stores/VirtualMachineScaleSetStore","TaskAgentPoolUtils","Components/ConfirmationDialog","Components/ReimageDisabledWarning","Components/ElasticPoolSettings","Components/JobsList","Components/JobsFilterBar","Components/NotificationArea","Components/Owner","Components/PoolIssueIcon","Components/PoolRoles","Components/PoolTypeIcon","Components/ProjectPicker","Components/VMScaleSetSettings"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.admin.common"}}));