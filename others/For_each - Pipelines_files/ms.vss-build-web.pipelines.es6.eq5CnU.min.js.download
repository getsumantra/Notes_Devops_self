"use strict";define("Build/Pipelines",["require","exports","Build/Flux/Action","Build/Common/Library/ErrorHandler","react","Build/Common/Library/Resources","VSSUI/Button","VSS/Core/Util/String","VSSUI/Ago","VSSUI/Duration","VSSUI/Icon","VSSUI/Table","VSSUI/Utilities/Date","VSS/Core/Observable","VSS/Platform/Context","VSS/Platform/Components/Format","VSS/Platform/Layout","VSSUI/Card","VSSUI/Link","VSSUI/List","VSSUI/MessageCard","VSSUI/Observer","VSSUI/Panel","VSSUI/Spinner","VSSUI/Utilities/Provider","VSS/Features/PlatformUI/FPSLink","VSSUI/Status","VSSUI/TooltipEx","VSSUI/Util","Build/Flux/Actions/ContributionData","Build/Flux/Sources/Contribution","Build/Flux/Store","VSS/Core/TimerManagement","Build/Common/Library/Constants","Build/Common/Library/Indicator","Build/Common/Library/PipelineRunNameFormatter","Tfs/Platform/Page","VSS/Core/Util/Accessibility","VSS/Platform/FPS","VSSUI/Dropdown","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","Build/Common/Library/Components/BranchLink","Build/Common/Library/Components/CommitLink","Build/Common/Library/Components/RepoLink","Build/Common/Library/Components/StagesPanel","Build/Common/Library/Legacy/Components/BranchDropdown","Build/SourceProviders/Common","VSSUI/FocusZone","VSSUI/PickList","VSSUI/TextField","VSSUI/Utilities/DropdownSelection","VSSUI/Header","VSSUI/Page","VSS/Platform/Feature","VSS/Platform/Location","VSSUI/Pill","VSSUI/Tabs","Build/Common/Library/Components/CommandComponent","Build/Common/Library/SignalRHubProxies","VSS/Features/SignalR/Hub","Build/Shared/Components/Histogram/index","VSS/Features/Identities/IdentityService","VSSUI/FilterBar","VSSUI/ListBox","VSSUI/VssPersona","Build/Common/Library/Duration","Build/Run/Components/PipelineRunLink","Build/Common/Library/Components/RetentionPanel","Build/SourceProviders/GitHub","VSS/Features/PlatformUI/ContributedMenu","VSSUI/ZeroData","VSSUI/Utilities/TreeItemProvider","VSSUI/TreeEx","Traceability/StageChanges/UpcomingChangesPanel","Build/Common/Library/Components/UpdateBitbucketServiceConnectionHeader","Build/Common/Library/Components/UpgradeServiceConnectionHeader","Build/Common/Library/Legacy/Components/PipelineSettingsPanel","Build/Common/Library/Legacy/ObservablePivotActionArray","Build/Common/Library/Legacy/PivotItemToTabProvider","Build/Common/Library/Security","Build/Common/Library/StateHandler","Build/Common/Library/Stores/Permissions","VSS/Features/PlatformUI/ContributedPillGroup","VSSUI/ConditionalChildren","VSSUI/HeaderCommandBar","VSSUI/Navigation/VssHubViewState","VSSUI/Surface","VSSUI/Utilities/ScreenSize","Build/Common/Library/String","VSS/Platform/UserClaims"],(function(e,t,i,s,r,n,a,o,l,d,c,u,h,p,g,m,f,b,v,S,_,C,y,T,I,P,R,x,F,w,E,N,D,B,k,L,A,V,U,M,O,H,j,z,q,K,W,G,Z,Y,Q,$,J,X,ee,te,ie,se,re,ne,ae,oe,le,de,ce,ue,he,pe,ge,me,fe,be,ve,Se,_e,Ce,ye,Te,Ie,Pe,Re,xe,Fe,we,Ee,Ne,De,Be,ke,Le,Ae){var Ve,Ue,Me,Oe,He,je,ze,qe,Ke,We,Ge,Ze,Ye,Qe,$e,Je,Xe,et,tt,it,st,rt,nt,at,ot,lt,dt,ct,ut,ht,pt,gt,mt,ft,bt,vt,St,_t,Ct,yt;Ve=t[yt="Resources"]={},t[yt].AnnounceFilterResults="Showing {0} filtered items.",t[yt].AddToMyFavorites="Add to my favorites",t[yt].AgoTooltip="Last run: {0}",t[yt].AriaHistogramBuildsList="History of builds for this branch",t[yt].BranchColumnName="Branch",t[yt].BranchesHeader="Branches",t[yt].BranchesTabName="Branches",t[yt].BranchPlaceholderText="Branch",t[yt].BuildStatus="Build Status",t[yt].Cancel="Cancel",t[yt].Canceled="Canceled",t[yt].CancelRun="Cancel Run",t[yt].Changes="Changes",t[yt].Clone="Clone",t[yt].Commits="Commits",t[yt].ConfirmCancelRun="Are you sure you want to cancel run '{0}'",t[yt].ConfirmDeleteRun="Are you sure you want to delete everything in run '{0}', including its logs, artifacts, test results, symbols, and label?",t[yt].Date="Date",t[yt].DefaultBranchLabel="default",t[yt].Delete="Delete",t[yt].DeleteRun="Delete Run",t[yt].DescriptionHeader="Description",t[yt].Draft="DRAFT",t[yt].DraftDescription="This pipeline is a draft",t[yt].DurationTooltip="Started: {0}",t[yt].EditPipeline="Edit",t[yt].EmptyFolder="This folder is empty.",t[yt].EmptyFolderLink="Create a new pipeline here.",t[yt].ErrorMessage="Error loading pipelines. Please try again.",t[yt].Export="Export to JSON",t[yt].ExportToYaml="Export to YAML",t[yt].Failed="Failed",t[yt].Favorite="Favorite",t[yt].FilteredFolderView="Filtered folder view",t[yt].FilteredPipelinesView="Filtered pipelines",t[yt].FilteredRunsView="Filtered runs",t[yt].FolderAriaLabel="{0} folder",t[yt].FolderCreated="Folder '{0}' created.",t[yt].FolderDeleted="Folder '{0}' deleted.",t[yt].FolderRenamed="Folder '{0}' renamed to '{1}'.",t[yt].FoldersTabName="All",t[yt].FolderView="All pipelines",t[yt].FolderViewForFolder="Pipelines in {0}",t[yt].GroupByRepository="Pivot repository:",t[yt].HistogramResultCanceled="canceled",t[yt].HistogramResultFailed="failed",t[yt].HistogramResultPartiallySucceeded="succeeded with issues",t[yt].HistogramResultSucceeded="succeeded",t[yt].HistogramTooltipCompleted="Build {0} {1} {2} (ran for {3})",t[yt].HistogramTooltipInProgress="Build {0} in progress (running for {1})",t[yt].HistogramTooltipNotStarted="Build {0} queued {1}",t[yt].HistoryColumn="History",t[yt].ImportAPipeline="Import a pipeline",t[yt].Issues="Issues",t[yt].InBranch="in branch",t[yt].KeywordFilterPlaceholderText="Filter by pipeline name or run number",t[yt].LatestRun="Latest pipeline run",t[yt].LastRunColumnName="Last run",t[yt].LearnMore="Learn more",t[yt].Loading="Loading...",t[yt].MoreTooltip="More...",t[yt].Name="Name",t[yt].NeedApproval="Needs approval",t[yt].NewFolder="New folder",t[yt].NewPipeline="New pipeline",t[yt].NewPipelineShort="New",t[yt].NewRun="Load 1 new run",t[yt].NewRuns="Load {0} new runs",t[yt].None="None",t[yt].NoResultsFound="No results found",t[yt].NoRunsFound="No runs found",t[yt].NoRunsGetStarted="Get started and run this pipeline for the first time!",t[yt].NoRunsYet="No runs yet",t[yt].NoStages="No stage groups",t[yt].NoTagsAvailable="No tags available",t[yt].NoTriggerIssuesFound="No Trigger Issues Found",t[yt].NoStagesFound="No logs available",t[yt].NotShowingBranchFilter="Removing branch filter",t[yt].OnDefinition="on {0}",t[yt].OkButtonText="OK",t[yt].OtherReason="Other build reason",t[yt].PartiallySucceeded="Partially succeeded",t[yt].PausePipeline="Pause pipeline",t[yt].PipelineColumnName="Pipeline",t[yt].PipelineDetailsTitle="Pipeline details",t[yt].PipelineNotFound="Pipeline not found",t[yt].PipelinePaused="Pipeline paused",t[yt].PipelineResumed="Pipeline resumed",t[yt].PipelineScheduledRunsPanelTitle="Scheduled runs",t[yt].PipelinesFilterPlaceholderText="Filter pipelines",t[yt].PipelinesHeader="Pipelines",t[yt].PipelinesTabName="Pipelines",t[yt].Queued="Queued",t[yt].ReasonBatchedCI="Batched CI",t[yt].ReasonBatchedCIFor="Batched CI for ",t[yt].ReasonBuildCompletion="Build completion",t[yt].ReasonBuildCompletionFor="Build completion for ",t[yt].ReasonCheckInShelveset="Check-in shelveset",t[yt].ReasonCheckInShelvesetFor="Check-in shelveset for ",t[yt].ReasonIndividualCI="Individual CI",t[yt].ReasonIndividualCIFor="Individual CI for ",t[yt].ReasonManual="Manually triggered",t[yt].ReasonManualFor="Manually run by",t[yt].ReasonPullRequest="PR automated",t[yt].ReasonPullRequestFor="PR automated for ",t[yt].ReasonSchedule="Scheduled",t[yt].ReasonScheduleFor="Scheduled for ",t[yt].ReasonResourceTrigger="Automatically triggered",t[yt].ReasonResourceTriggerFor="Automatically triggered for ",t[yt].ReasonValidateShelveset="Validate shelveset",t[yt].ReasonValidateShelvesetFor="Validate shelveset for ",t[yt].Recalculate="Recalculate",t[yt].RecalculateTooltip="Recalculate resource triggers",t[yt].RecalculateTooltipDisabled="Recalculate button is disabled for 5 minutes",t[yt].RecentPipelines="Recent pipelines",t[yt].RecentTabName="Recent",t[yt].RecentView="Recently run pipelines",t[yt].RemoveFromMyFavorites="Remove from my favorites",t[yt].Rename="Rename",t[yt].RenameMove="Rename/move",t[yt].RepositoryDropdownLabel="Repository",t[yt].RepositoryPlaceholderText="Repository",t[yt].RequestedFor="Requested for",t[yt].ResumePipeline="Resume pipeline",t[yt].Retained="Retained",t[yt].RetainRun="Retain",t[yt].RunBy="Run by",t[yt].RunLabel="Run {0}",t[yt].Running="Running",t[yt].RunPipeline="Run pipeline",t[yt].RunPipelineShort="Run",t[yt].RunStartTime="Run start time / elapsed",t[yt].RunQueued="{0} queued",t[yt].RunsTabName="Runs",t[yt].RunsView="All pipeline runs",t[yt].RunsViewForFolder="Pipeline runs in {0}",t[yt].SaveAsTemplate="Save as a template",t[yt].ScheduledRunsPanelDescWithData="The next few runs of this pipeline scheduled for this week are shown below. See <a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=2143163&amp;clcid=0x409' target='_blank'>schedules</a> to diagnose problems with scheduled runs.",t[yt].ScheduledRunsPanelDescWithoutData="There are no scheduled runs for this week. See <a class='bolt-link' href='https://go.microsoft.com/fwlink/?linkid=2143163&amp;clcid=0x409' target='_blank'>schedules</a> to learn about configuring or diagnosing problems with scheduled runs. If you believe this to be incorrect, select 'Sync Schedules' to read the schedules from the YAML file in default branch.",t[yt].ScheduledRunsPanelDesignerSchedule="Schedule configured in the UI",t[yt].ScheduledRunsPanelExceededJobLimit="This schedule has exceeded the maximum number of runs for this week. {0}",t[yt].ScheduledRunsPanelJobCount="This schedule has {0} runs remaining.",t[yt].SearchPipelines="Search all pipelines",t[yt].Security="Manage security",t[yt].Settings="Settings",t[yt].ShowingBranchFilter="Adding branch filter",t[yt].ShowingRepositoriesFilter="Adding repositories filter",t[yt].ShowMore="Show more",t[yt].Stages="Stages",t[yt].StagesHeader="Stages",t[yt].StagesHidden="{0} stages hidden",t[yt].State="State",t[yt].StatusLabel="Status",t[yt].StatusBadge="Status badge",t[yt].StatusBadgeBranch="Branch",t[yt].StatusBadgeEntirePipeline="Pipeline",t[yt].StatusBadgeImageAltText="Example status badge for this pipeline.",t[yt].StatusBadgeMarkdownLabel="Sample markdown",t[yt].StatusBadgePanelTitle="Status badge",t[yt].StatusBadgeScope="Scope",t[yt].StatusBadgeUrlLabel="Image URL",t[yt].StopRetainingRun="Stop retaining run",t[yt].Succeeded="Succeeded",t[yt].SwitchToListView="Switch to list view",t[yt].SwitchToFolderView="Switch to folder view",t[yt].SyncSchedules="Sync schedules",t[yt].Tags="Tags",t[yt].TimeAndDuration="Time and duration",t[yt].TitlePipelineBranches="Pipelines - Branches for {0}",t[yt].TitlePipelineRuns="Pipelines - Runs for {0}",t[yt].TitleFolders="Pipelines - All",t[yt].TitleRecent="Pipelines - Recent",t[yt].TitleRuns="Pipelines - Runs",t[yt].Title="Pipelines - {0}",t[yt].TriggerIssuesCardMessage="Some recent issues detected related to pipeline trigger.",t[yt].TriggerIssues="Trigger issues",t[yt].TriggerIssuesColumnName="Issues",t[yt].TriggerIssuesErrorMessage="An unspecified error occurred while fetching trigger issues data.",t[yt].Triggers="Triggers",t[yt].TriggersAlias="Alias",t[yt].TriggersAutoCancel="Auto-cancel",t[yt].TriggersBatched="Batched",t[yt].TriggersContinuousIntegration="Continuous integration triggers",t[yt].TriggersDisabled="Trigger: Disabled for this branch",t[yt].TriggersScheduleDisabled="There are no schedule triggers defined for this branch",t[yt].TriggersEnabled="Trigger: Enabled for this branch",t[yt].TriggersExcludedBranches="Excluded branches",t[yt].TriggersExcludeNoBranches="No branches are excluded",t[yt].TriggersExcludeNoPaths="No paths are excluded",t[yt].TriggersExcludeNoTags="No tags are excluded",t[yt].TriggersExcludedPaths="Excluded paths",t[yt].TriggersExcludedTags="Excluded tags",t[yt].TriggersIncludeAllBranches="All branches are included",t[yt].TriggersIncludeAllPaths="All paths are included",t[yt].TriggersIncludeAllTags="All tags are included",t[yt].TriggersIncludeNoBranches="No branch filter are defined",t[yt].TriggersIncludeNoTags="No tags filter are defined",t[yt].TriggersIncludedBranches="Included branches",t[yt].TriggersIncludedPaths="Included paths",t[yt].TriggersIncludedTags="Included tags",t[yt].TriggersLearnMore="{0} about {1}.",t[yt].TriggersNoTriggerFoundForBranch="No {0} found for the specified branch",t[yt].TriggersNotInDefaultBranch="Resource triggers defined in this branch are ignored. Whether the pipeline runs on this branch in response to a resource trigger is defined in the default branch, {0}.",t[yt].TriggersNotInYAML="This trigger is not defined anymore in the YAML file in this branch, but it will still trigger a pipeline run. To resolve this warning, please click on the 'Synchronized' button located at the top of this page",t[yt].TriggersNotMatching="This trigger is not synchronized, so it will not trigger a pipeline run. To resolve this warning, please click on the 'Synchronized' button located at the top of this page",t[yt].TriggersNoTriggerFoundForPipeline="No {0} defined for the pipeline",t[yt].TriggersNotSupportedPullRequest="Pull request triggers are not supported for Azure Repos. Please use build validation policies.",t[yt].TriggersNotSynchronized="Not synchronized",t[yt].TriggerPageNotLoaded="Something went wrong when trying to load the triggers information. Please retry in a few minutes or ensure your pipeline is valid and you have the proper permissions",t[yt].TriggersPullRequest="Pull request triggers",t[yt].TriggersSchedule="Schedule triggers",t[yt].TriggersScheduleEnabled="There are schedule triggers defined for this branch",t[yt].TriggersScheduleExceedingLimits="Cron schedule exceeds the schedule limits for a week",t[yt].TriggersScheduleExceededWeeklyLimit="This pipeline has exceeeded the limit of runs for this week so no schedule information are available for the rest of the week",t[yt].TriggersScheduleExceededWeek="No more runs scheduled for this week",t[yt].TriggersScheduleNextSchedule="Next schedule",t[yt].TriggersScheduleNotAvailable="Not available",t[yt].TriggersSchedulesNotSynced="Your schedules are not properly synchronized. See more details on the troublesome schedules in this page or click on the button in this warning to synchronize them. If you have recently updated/synchronized your schedule, wait a few minutes.",t[yt].TriggersScheduleOnlyWithChangesEnabled="Schedule will only trigger the pipeline if there are changes in the repository or in pipeline settings",t[yt].TriggersScheduleOnlyWithChangesProperty="Schedule only with changes",t[yt].TriggersScheduleOverwrittenInClassicView="Schedules are overwritten in the classic view. Cron schedules defined in the YAML file will be ignored",t[yt].TriggersScheduleCronSyntax="Cron expression",t[yt].TriggersScheduleNumber="Schedule {0}",t[yt].TriggersRepositoryName="Repository name",t[yt].TriggersRepositoryResourceType="Repository resource triggers",t[yt].TriggersRepositoryTriggerNotInDefaultBranch="Repository triggers are unavailable for this branch.",t[yt].TriggersResource="Resource triggers",t[yt].TriggersResourceTriggerBuildCompletion="Build completion triggers (classic UI)",t[yt].TriggersResourceTriggerBuildResourceType="Build resource triggers",t[yt].TriggersResourceTriggerContainerResourceType="Container resource triggers",t[yt].TriggersResourceTriggerNotSynced="Your resource triggers are not properly synchronized. See more details on the troublesome triggers in this page or click on the button in this warning to synchronize them. If you have recently updated/synchronized your resource triggers, come back in a few minutes.",t[yt].TriggersResourceTriggerPackageResourceType="Package resource triggers",t[yt].TriggersResourceTriggerPipelineResourceType="Pipeline resource triggers",t[yt].TriggersResourceTriggerWebhookResourceType="Webhook resource triggers",t[yt].TriggersResourcePropertyEnvironment="Environment",t[yt].TriggersResourcePropertyImage="Image",t[yt].TriggersResourcePropertyName="Name",t[yt].TriggersResourcePropertyOwner="Owner",t[yt].TriggersResourceSourcePipeline="Source pipeline",t[yt].TriggersResourcePropertyRepository="Repository",t[yt].TriggersSelectBranch="Select branch: ",t[yt].TriggerServiceConnection="Service connection",t[yt].TriggersSource="Trigger definition",t[yt].TriggersSourceClassicView="Triggers Classic UI",t[yt].TriggersSourceYAML="YAML",t[yt].TriggersSynchronize="Synchronize",t[yt].TriggersWarningClassicView="Triggers are overwritten in the classic view. Triggers defined in the YAML file will be ignored",t[yt].TriggersWillRunStatusDefaultBranch="It will always run for the default branch, {0}.",t[yt].TriggersWillRunStatusDefaultBranchCondition="Based on the conditions defined in the default branch, {0}.",t[yt].TriggersWillRunStatusUI="Based on the conditions defined in the triggers classic UI.",t[yt].TriggersWillRunStatusNoYamlFileFound="No YAML file was found for branch {0}.",t[yt].TriggersWillRunStatusUnsynchronized="The trigger is currently unsynchronized.",t[yt].TriggersWillItRun="Triggers pipeline run",t[yt].TriggersYAMLParsingWithErrors="There were errors when trying to process the pipeline YAML code. This could result in incomplete triggers information. Please ensure your pipeline is valid and you have the proper permissions.",t[yt].UnexpectedTriggerIssue="Trigger calculation failed. Click recalculate to try again.",t[yt].ViewDeletedPipelines="View deleted pipelines",t[yt].ViewDetails="View Details",t[yt].ViewPipeline="View",t[yt].ViewRetentionLeases="View retention leases",t[yt].WorkItems="Work items",t[yt].ZeroDataNoCreatePipelinesPrimary="No pipelines found",t[yt].YAMLCommit="YAML Commit",t[yt].ZeroDataNoCreatePipelinesAltText="Image of no pipelines found",t[yt].ZeroDataPipelinesPrimary="Create your first Pipeline",t[yt].ZeroDataPipelinesSecondary="Automate your build and release processes using our wizard, and go from code to cloud-hosted within minutes.",t[yt].ZeroDataPipelinesButtonText="Create Pipeline",t[yt].ZeroDataPipelinesAltText="Image of create your first Pipeline",function(e){Ue=t[e]={};t[e].DefinitionFavoritesActionCreator=class{constructor(e){this._actionHub=e.actionHub,this._favoritesService=e.favoritesService,this._project=e.project,this._currentUser=e.currentUser}favoriteDefinition(e){let t={id:this._project.id,name:this._project.name,type:"Project"},i={artifactId:e.uri,artifactName:e.name,artifactScope:t,artifactType:"Microsoft.TeamFoundation.Build.Definition",owner:this._currentUser};this._actionHub.favoriteDefinition.invoke({definition:e}),this._favoritesService.addFavorite(i).catch((t=>{this._actionHub.unfavoriteDefinition.invoke({definition:e}),(0,s.handleError)(t)}))}unfavoriteDefinition(e){let t={id:this._project.id,name:this._project.name,type:"Project"};this._actionHub.unfavoriteDefinition.invoke({definition:e}),this._favoritesService.getFavorites("Microsoft.TeamFoundation.Build.Definition",t.type,t.id,!1).then((t=>{t.value.forEach((t=>{t.artifactId===e.uri&&this._favoritesService.removeFavorite(t).catch((t=>{this._actionHub.favoriteDefinition.invoke({definition:e}),(0,s.handleError)(t)}))}))}),(t=>{this._actionHub.favoriteDefinition.invoke({definition:e}),(0,s.handleError)(t)}))}};t[e].DefinitionFavoritesActionHub=class{constructor(){this._favoriteDefinition=new i.Action,this._unfavoriteDefinition=new i.Action}get favoriteDefinition(){return this._favoriteDefinition}get unfavoriteDefinition(){return this._unfavoriteDefinition}}}("ActionsFavorites"),function(e){Me=t[e]={};t[e].BuildSignalRActionCreator=class{constructor(e){this._actionHub=e.actionHub}buildUpdated(e,t,i){this._actionHub.buildUpdated.invoke({buildId:e,definitionId:t,definitionScope:i})}stagesUpdated(e,t,i){this._actionHub.stagesUpdated.invoke({buildId:e,timelineId:t,stageUpdates:i})}get actionHub(){return this._actionHub}isUserInactive(){return this._actionHub.isUserInactive.invoke(void 0)}};t[e].BuildSignalRActionHub=class{constructor(){this._isUserInactive=new i.Action,this._buildUpdated=new i.Action,this._stagesUpdated=new i.Action}get buildUpdated(){return this._buildUpdated}get isUserInactive(){return this._isUserInactive}get stagesUpdated(){return this._stagesUpdated}}}("ActionsSignalR"),function(e){Oe=t[e]={};class i extends r.Component{constructor(e){super(e),this._buttonWrapper=r.createRef(),this._onShowCopyClicked=()=>{this.setState({isCalloutVisible:!0});const e=this.props.textToCopy();if(window.clipboardData)return void window.clipboardData.setData("text",e);const t=t=>{t.clipboardData&&(t.clipboardData.setData("text",e),t.preventDefault())};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)},this._onCalloutDismiss=()=>{this.setState({isCalloutVisible:!1})},this.state={isCalloutVisible:!1}}render(){return r.createElement("div",{ref:this._buttonWrapper,className:this.props.className},this._getRenderContents())}_getRenderContents(){return this.state.isCalloutVisible?this._getButton(n.CopiedToClipboardText):this._getButton(n.CopyToClipboardText)}_getButton(e){return r.createElement(a.Button,{subtle:!0,ariaLabel:n.ARIALabelCopyToClipboard,iconProps:{iconName:"Copy"},onClick:this._onShowCopyClicked,onBlur:this._onCalloutDismiss,tooltipProps:{showOnFocus:!0,text:e}})}}t[e].CopyToClipboardButton=i}("ComponentsCopyToClipboardButton"),function(e){He=t[e]={};class i extends r.Component{render(){const{columnIndex:e,finishTime:t,queueTime:i,startTime:s,tableColumn:n}=this.props,a=r.createElement("div",{className:"flex-row flex-center fontSize"},r.createElement(c.Icon,{iconName:"DateTime2",className:"icon-margin"}),r.createElement(l.Ago,{date:i,format:0,tooltipProps:{renderContent:function(){return(0,o.format)(Ve.AgoTooltip,(0,h.tooltipString)(i))}}}));if(!s)return r.createElement(u.SimpleTableCell,{columnIndex:e,tableColumn:n},a);const p=r.createElement("div",{className:"flex-row flex-center fontSize bolt-table-two-line-cell-item"},r.createElement(c.Icon,{iconName:"Stopwatch",className:"icon-margin"}),r.createElement(d.Duration,{startDate:s,endDate:t,tooltipProps:{renderContent:function(){return(0,o.format)(Ve.DurationTooltip,(0,h.tooltipString)(s))}}}));return r.createElement(u.TwoLineTableCell,{columnIndex:e,tableColumn:n,line1:a,line2:p})}}t[e].DateAndDuration=i}("ComponentsDateAndDuration"),function(){t.PipelineScheduledRunsDataService={};class e extends g.VssService{get data(){return this._data}get hasDesignerSchedule(){return this._hasDesignerSchedule}refreshData(e,t){const i=this.pageContext.getService("IVssContributionService");this._data.ready.value=!1,this._hasDesignerSchedule=new p.ObservableValue(!1),i.getDataAsync("ms.vss-build-web.pipeline-scheduled-runs-data-provider",{definitionId:e.toString(),syncSchedulesNow:t},!0).then((e=>{e&&(this._data.value=e.scheduledRuns,this._hasDesignerSchedule.value=e.hasDesignerSchedule,this._data.ready.value=!0)}))}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_initialize(){this._data=new p.ReadyableObservableArray(void 0)}}g.Services.add("IPipelineScheduledRunsDataService",{serviceFactory:e})}(),function(e){je=t[e]={};const i="https://go.microsoft.com/fwlink/?linkid=2138707";class s extends f.VssComponent{constructor(e,t){super(e,t),this.renderRow=(e,t,s,n)=>{let a,l,d="";if(t.scheduledTime){if(a=t.scheduledTime.map((e=>r.createElement("span",{className:"scheduled-run-card scheduled-time fontSizeMS font-size-ms text-ellipsis secondary-text"},e.toLocaleString()))),t.jobCount){var u=(0,o.format)(Ve.ScheduledRunsPanelJobCount,t.jobCount);l=r.createElement(_.MessageCard,{severity:"Info",className:"scheduled-run-card info-card-padding info-margins"},u,r.createElement(v.Link,{href:i,target:"_blank"},Ve.LearnMore))}t.scheduleName||t.cronSyntax||(t.scheduleName=Ve.ScheduledRunsPanelDesignerSchedule)}else a=r.createElement(_.MessageCard,{severity:"Warning",className:"scheduled-run-card"},r.createElement(m.FormatComponent,{format:Ve.ScheduledRunsPanelExceededJobLimit},r.createElement(v.Link,{href:i,target:"_blank"},Ve.LearnMore)));return t.cronSyntax&&(d="["+t.cronSyntax+"]"),r.createElement(S.ListItem,{key:n||"list-item"+e,index:e,details:s},r.createElement("span",{className:"list-example-row flex-row h-scroll-hidden title-s"},r.createElement("div",{style:{marginLeft:"0px",padding:"10px 0px"},className:"flex-column h-scroll-hidden"},r.createElement("span",{className:"scheduled-run-card rhythm-horizontal-8 text-ellipsis"},r.createElement(c.Icon,{iconName:"Calendar",size:"small"}),r.createElement("span",null,t.scheduleName),r.createElement("span",null,d)),r.createElement("span",{className:"rhythm-horizontal-8 padding-bottom-4 fontSizeMS font-size-ms text-ellipsis secondary-text"},r.createElement(c.Icon,{iconName:"OpenSource",size:"small"}),r.createElement("span",null,t.branch)),a,r.createElement("span",{className:"padding-top-8"},l))))},this._onDismiss=()=>{this.props.onDismiss()},this._dataService=this.context.pageContext.getService("IPipelineScheduledRunsDataService"),this._dataService.refreshData(this.props.definitionId,!1)}render(){return r.createElement(C.Observer,{data:this._dataService.data,ready:this._dataService.data.ready,hasDesignerSchedule:this._dataService.hasDesignerSchedule},(e=>{const t=[{text:Ve.SyncSchedules,primary:!0,disabled:!e.ready||e.data.length>0||1==e.hasDesignerSchedule,onClick:()=>{this._dataService.refreshData(this.props.definitionId,!0)}},{text:Ve.OkButtonText,disabled:!1,onClick:this.props.onDismiss}];return r.createElement("div",null,this.props.isOpen&&r.createElement(y.Panel,{titleProps:{text:Ve.PipelineScheduledRunsPanelTitle,size:1},onDismiss:this._onDismiss,footerButtonProps:t},e.ready?this._renderBody(e.data):r.createElement("div",{className:"justify-center"},r.createElement(T.Spinner,{className:"absolute-fill",size:"large"}))))}))}_renderBody(e){return r.createElement("div",{className:"ci-scheduled-runs-panel-body"},null!=e&&e.length>0&&r.createElement(b.Card,{className:"scheduled-run-card flex-grow secondary-text"},r.createElement("div",null,r.createElement("span",{dangerouslySetInnerHTML:{__html:Ve.ScheduledRunsPanelDescWithData}}),r.createElement(S.ScrollableList,{itemProvider:new I.ArrayItemProvider(e||[]),renderRow:this.renderRow,width:"90%"}))),(null==e||0==e.length)&&r.createElement(b.Card,{className:"scheduled-run-card flex-grow secondary-text"},r.createElement("span",{dangerouslySetInnerHTML:{__html:Ve.ScheduledRunsPanelDescWithoutData}})))}}t[e].ScheduledRunsPanel=s}("ComponentsScheduledRunsPanel"),function(e){ze=t[e]={};class i extends r.Component{render(){return r.createElement("div",{className:"flex-row scroll-hidden"},this.props.stages.map(((e,t)=>{var i,n;const a=e.length>1,u=t<this.props.stages.length-1&&this.props.stages[t+1].length>1,h=(null===(n=null===(i=e[e.length-1][e[e.length-1].length-1])||void 0===i?void 0:i.status)||void 0===n?void 0:n.color)||"neutral";let p=null;return t<this.props.stages.length-1&&(p=a&&u?r.createElement(c,{color:h}):a?r.createElement(d,{color:h}):u?r.createElement(l,{color:h}):r.createElement(o,{color:h})),r.createElement("span",{className:"flex-row flex-center",key:t},r.createElement("span",{className:(0,F.css)("flex-row",a&&"stage-graph-parallel",a&&h),key:"stages_"+t},r.createElement(s,{size:this.props.size,stages:e})),p)})))}}t[e].StageGraph=i;class s extends r.Component{render(){return r.createElement("span",{className:"flex-row"},this.props.stages.map(((e,t)=>r.createElement("span",{key:"stages_"+t,className:"flex-row"},e.map(((t,i)=>t.hiddenStageCount?r.createElement(a,Object.assign({key:"stage_"+i,hiddenStageCount:t.hiddenStageCount,size:this.props.size},t)):r.createElement(n,Object.assign({key:"stage_"+i,size:this.props.size,showSeparator:i<e.length-1},t)))),t<this.props.stages.length-1&&r.createElement("span",{className:"stage-graph-empty-separator"},"Â ")))))}}class n extends f.VssComponent{render(){return this.props.status?r.createElement("span",{className:"flex-row flex-center"},r.createElement(x.Tooltip,{anchorOrigin:{horizontal:"start",vertical:"end"},text:this.props.tooltip,tooltipOrigin:{horizontal:"start",vertical:"start"}},r.createElement("span",{className:"flex-row flex-center stage-status"},this.props.href&&r.createElement(P.FPSLink,{subtle:!0,excludeTabStop:!0,href:this.props.href,className:"flex-row flex-center no-h-padding",telemetrySource:this.props.telemetrySource,telemetryProperties:this.props.telemetryProperties},r.createElement(R.Status,Object.assign({size:this.props.size},this.props.status,{ariaLabel:this.props.ariaLabel}))),!this.props.href&&r.createElement("span",{className:"flex-row flex-center no-h-padding"},r.createElement(R.Status,Object.assign({size:this.props.size},this.props.status,{"aria-label":this.props.ariaLabel}))))),this.props.showSeparator&&r.createElement(o,{color:this.props.status.color})):r.createElement(r.Fragment,null)}}class a extends f.VssComponent{render(){var e,t;const i=(null===(t=null===(e=this.props)||void 0===e?void 0:e.status)||void 0===t?void 0:t.color)||"neutral";return r.createElement("span",{className:"flex-row flex-center",onClick:e=>h(e,this.props.onClick),"aria-label":this.props.ariaLabel,role:"button"},r.createElement(x.Tooltip,{anchorOrigin:{horizontal:"start",vertical:"end"},text:this.props.tooltip,tooltipOrigin:{horizontal:"start",vertical:"start"}},r.createElement("span",{className:(0,F.css)("flex-row","flex-center","status-pill","border",i)},r.createElement("span",{className:"stage-pill-count"},"+",this.props.hiddenStageCount),this.props.status&&r.createElement(R.Status,Object.assign({size:this.props.size},this.props.status,{"aria-label":this.props.status.ariaLabel})))))}}const o=e=>r.createElement(u,{color:e.color,width:10,left:1,right:5}),l=e=>r.createElement(u,{color:e.color,width:6,left:3,right:6}),d=e=>r.createElement(u,{color:e.color,width:6,left:0,right:3}),c=e=>r.createElement(u,{color:e.color,width:2,left:0,right:2,viewBox:"0 0 2 2"});class u extends r.Component{render(){return r.createElement("svg",{className:(0,F.css)("bolt-status flex-noshrink",this.props.color),width:this.props.width,height:"2",viewBox:this.props.viewBox||"0 0 6 2",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.createElement("line",{x1:this.props.left,y1:"1",x2:this.props.right,y2:"1",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}))}}const h=(e,t)=>{e.preventDefault(),t&&t()};t[e].calculateVisibleStageCount=(e,t,i)=>{const s=parseInt("16")+10;if(!t)return null==i?e:i;const r=Math.floor(t/s);if(r>=e)return e;const n=60+(e=>{const t=e.toString().length;return t>2?10*(t-2):0})(e-r);return Math.floor((t-n)/s)}}("ComponentsStageGraph"),function(e){qe=t[e]={},function(e){e.BranchFilter="branchFilter",e.KeywordFilter="keywordFilter",e.RepositoryFilter="repositoryFilter",e.RequestedForFilter="requestedForFilter",e.ResultFilter="resultFilter",e.StatusFilter="statusFilter",e.TagFilter="tagFilter"}(t[e].RunFilterKeys||(t[e].RunFilterKeys={})),function(e){e.NameFilter="NameFilter"}(t[e].PipelineFilterKeys||(t[e].PipelineFilterKeys={})),function(e){e.BranchSearch="branchName",e.DefinitionId="definitionId",e.KnownBranches="knownBranches",e.KnownRepositories="knownRepos",e.RepositorySearch="repoName"}(t[e].FilterRouteKeys||(t[e].FilterRouteKeys={})),function(e){e.TriggerType="triggerType",e.BranchName="branchName"}(t[e].TriggersPageRouteKeys||(t[e].TriggersPageRouteKeys={})),t[e].BatchingDelayInMs=3e3,t[e].MaxUpdates=25}("Constants"),function(e){Ke=t[e]={};class i extends N.Store{constructor(e){super(),this._runs=[],this._isLoading=!0,this._runsWithUpdates=[],this._newRuns=[],this._initialRouteValues={},this._dataParser=e=>e,this._triggerRunsUpdateBatch=()=>{if(this._runsWithUpdates.length>0){const e={buildIds:this._runsWithUpdates.join(",")};this._runsWithUpdates=[],this._contributionActionCreator.fetchContributionData("ms.vss-build-web.stage-history-data-provider",e,!0,this._onUpdatedRunsAvailable)}},this._onDataAvailable=(e,t)=>{this._newRuns=[],this._isLoading=!1,this._runs=e.buildsForStage||[],this._continuationToken=e.continuationToken||void 0,this._lastState=e.lastState,this.emitChanged()},this._onMoreRunsAvailable=(e,t)=>{this._isLoading=!1,this._runs=this._runs.concat(e.buildsForStage),this._continuationToken=e.continuationToken||void 0,this._lastState=e.lastState,this.emitChanged()},this._buildUpdated=e=>{this._definitionId&&e.definitionId!=this._definitionId||this._stageName&&e.definitionScope!=this._stageName||(this._runs.filter((t=>t&&t.buildId===e.buildId)).length>0?this._runsWithUpdates.indexOf(e.buildId)<0&&(this._runsWithUpdates.push(e.buildId),this._triggerRunsUpdateBatch()):this._newRuns.length<qe.MaxUpdates&&this._newRuns.indexOf(e.buildId)<0&&(this._newRuns.push(e.buildId),this.emitChanged()))},this._onUpdatedRunsAvailable=e=>{if(e&&e.buildsForStage&&e.buildsForStage.length>0){const t={};this._runs.forEach(((e,i)=>{e.buildId&&(t[e.buildId]=i)})),e.buildsForStage.forEach((e=>{if(e){const i=t[e.buildId];void 0!==i&&(this._runs[i]=e)}})),this.emitChanged()}},this._updateStages=e=>{let t=this.getLoadedRunsId();e&&e.buildId&&e.stageUpdates&&t.find((t=>t===e.buildId))&&this._updateRuns(e.buildId.toString(),this._stageName)},this._updateRuns=(e,t)=>{this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.stage-history-data-provider",{buildIds:e,stageName:t},!0).then((e=>{var t;let i=!1;null===(t=null==e?void 0:e.buildsForStage)||void 0===t||t.forEach((e=>{const t=this._runs.findIndex((t=>!!t&&t.buildId==e.buildId));-1!=t&&(this._runs[t]=e,i=!0)})),i&&this.emitChanged()}))},this._definitionId=e.definitionId,this._stageName=e.stageName,this._signalRActionHub=e.signalRActionHub,this._signalRActionHub.stagesUpdated.addListener(this._updateStages),this._signalRActionHub.buildUpdated.addListener(this._buildUpdated),this._definitionId&&(this._initialRouteValues.definitionId=this._definitionId.toString()),this._stageName&&(this._initialRouteValues.stageName=this._stageName),this._contributionActionCreator=new w.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:e.contributionActionHub,dataParser:this._dataParser}),this._timerManagement=new D.TimerManagement,this._triggerRunsUpdateBatch=this._timerManagement.debounce(this._triggerRunsUpdateBatch,qe.BatchingDelayInMs);const t=new E.ContributionSource({pageContext:e.pageContext}).getData("ms.vss-build-web.stage-history-data-provider",this._initialRouteValues);t&&(this._isLoading=!1,this._runs=t.buildsForStage||[],this._continuationToken=t.continuationToken||void 0,this._lastState=t.lastState),this._pageContext=e.pageContext}dispose(){super.dispose(),this._signalRActionHub.stagesUpdated.removeListener(this._updateStages),this._signalRActionHub.buildUpdated.removeListener(this._buildUpdated)}fetchData(){this._runs=[],this._runsWithUpdates=[],this._newRuns=[],this._continuationToken="",this._isLoading=!0;let e={};this._definitionId&&this._stageName&&(e.definitionId=this._definitionId.toString(),e.stageName=this._stageName,this._contributionActionCreator.fetchContributionData("ms.vss-build-web.stage-history-data-provider",e,!0,this._onDataAvailable),this.emitChanged())}fetchMoreRuns(){if(!this._isLoading&&this._continuationToken){let e={continuationToken:this._continuationToken,lastState:this._lastState};this._definitionId&&this._stageName&&(e.definitionId=this._definitionId.toString(),e.stageName=this._stageName,this._isLoading=!0,this._contributionActionCreator.fetchContributionData("ms.vss-build-web.stage-history-data-provider",e,!0,this._onMoreRunsAvailable),this.emitChanged())}}getStageHistoryData(){return this._runs}hasMore(){return!!this._continuationToken}isLoading(){return this._isLoading}getNewRunsCount(){return this._newRuns.length}getLoadedRunsId(){return this._runs.map((e=>e.buildId))}}t[e].StageHistoryStore=i}("StoresStageHistoryStore"),function(e){We=t[e]={},t[e].getReasonIcon=function(e){switch(e){case 1:return"Contact";case 8:return"Calendar";case 256:return"BranchPullRequest";case 4:case 2:default:return"Tag";case 512:return"Build"}},t[e].getReasonText=function(e,t){if(t)switch(e){case 1:return Ve.ReasonManualFor;case 8:return Ve.ReasonScheduleFor;case 256:return Ve.ReasonPullRequestFor;case 4:return Ve.ReasonBatchedCIFor;case 2:return Ve.ReasonIndividualCIFor;case 512:return Ve.ReasonBuildCompletionFor;case 128:return Ve.ReasonCheckInShelvesetFor;case 64:return Ve.ReasonValidateShelvesetFor;case 1024:return Ve.ReasonResourceTriggerFor;default:return Ve.OtherReason}switch(e){case 1:return Ve.ReasonManual;case 8:return Ve.ReasonSchedule;case 256:return Ve.ReasonPullRequest;case 4:return Ve.ReasonBatchedCI;case 2:return Ve.ReasonIndividualCI;case 512:return Ve.ReasonBuildCompletion;case 128:return Ve.ReasonCheckInShelveset;case 64:return Ve.ReasonValidateShelveset;case 1024:return Ve.ReasonResourceTrigger;default:return Ve.OtherReason}}}("ToolsBuildReasonTools"),function(e){Ge=t[e]={};const i="Build",s="Pipelines.Pipelines";let r=!1;t[e].disposeFPS=function(){r=!1};t[e].Performance=class{constructor(e){this._service=e.getService("IVssPerformanceService")}onFPS(){this._service.startScenario(s,!0),r=!0}mark(e,t,n){const a=Object.assign({view:e},t||n?{definitionId:t,definitionScope:n}:{});r?this._service.endScenario(i,s,!0,void 0,a):this._service.markTimeToInteractive(i,s,void 0,a)}}}("Performance"),function(e){Ze=t[e]={};class i extends r.Component{constructor(e){var t;super(e),this._sendTelemetryForSearch=!0,this._titleFilterKey="titleFilter",this._statusFilterKey="statusFilter",this._ttiMarked=!1,this._onFilterChanged=()=>{const e=this._stageFilter.getFilterItemState(this._titleFilterKey),t=this._stageFilter.getFilterItemState(this._statusFilterKey);let i=[...this._itemProvider.value];(e||t)&&(i=this._performSearch(null==e?void 0:e.value,null==t?void 0:t.value,this._runs.value)),this._itemProvider.splice(0,this._itemProvider.length,...i),this.state.foundResultCount!=i.length&&this.setState({foundResultCount:i.length})},this._performSearch=(e,t,i)=>{if(e){const t=null==e?void 0:e.toLowerCase();i=i.filter((e=>-1!==e.buildName.toLowerCase().indexOf(t)||-1!==e.buildNumber.toString().toLowerCase().indexOf(t))),this._sendTelemetryForSearch&&(this._publishTelemetryEvent(B.TelemetryConstants.StagesHistoryPanelSearch),this._sendTelemetryForSearch=!1)}return t&&t.length>0&&(i=i.filter((e=>{const i=(0,k.getTimelineStatusIndicatorData)(e.stageState,e.stageResult,e.stageStateData?e.stageStateData.pendingChecks:void 0,e.stageStateData?!e.stageStateData.pendingDependencies:void 0);return t.includes(i.type)||t.includes(i.label.toLowerCase())})),this._currentStatusesSelected!=t&&(this._publishTelemetryEvent(B.TelemetryConstants.StagesHistoryPanelFilter,{States:t}),this._currentStatusesSelected=t)),e||t&&0!=t.length||this._stageFilter.reset(),i},this._publishTelemetryEvent=(e,t={})=>{const i=this.props.pageContext.getService("IVssTelemetryService"),s={ProjectId:this._projectId,BuildId:this.props.buildId,DefinitionName:this.props.pipelineName},r=Object.assign(s,t);i.publishEvent(B.TelemetryConstants.Area,e,r)},this._onActivateRow=(e,t,i,s)=>{var r,n;if(!t.data)return;t.data&&t.data.isNewRunsRow?this._store.fetchData():t.data&&(null===(r=t.data.linkProps)||void 0===r?void 0:r.href)&&(e.ctrlKey||e.metaKey?window.open(t.data.linkProps.href,"_blank"):(0,U.onClickFPS)(s,null===(n=t.data.linkProps)||void 0===n?void 0:n.href,!0,e));const a={};if(!t.data.linkProps||!t.data.linkProps.href)return void console.warn("linkProps or href is undefined for row:",t);a[B.NavConstants.stage]=t.data.linkProps.href;const o=s.getService("IBuildLinkingService").getBuildUrl(i,B.NavConstants.logs,void 0,void 0,a),l={ProjectId:this._projectId,BuildId:this.props.buildId,DefinitionName:this.props.pipelineName};(0,U.onClickFPS)(s,o,!0,e,{telemetrySource:B.TelemetryConstants.StagesHistoryPanelLogs,telemetryProperties:l})},this._renderStageStatusCell=(e,t,i,s,n)=>{const a=s.stageState.toString();return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("span",{className:"stages-panel-status-icon"},this._renderBuildStatus(s)),r.createElement("span",{"aria-label":a},s.renderRow))},this._renderTimeStartedAndElapsedCell=(e,t,i,s,n)=>{var a,o;let l=null!==(a=s.stageStartTime)&&void 0!==a?a:void 0,d=null!==(o=s.stageFinishTime)&&void 0!==o?o:void 0;return l&&(l||d)?r.createElement(He.DateAndDuration,{queueTime:l,startTime:l,finishTime:d,key:"col-"+t,columnIndex:t,tableColumn:i}):r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null))},this._renderBuildStatus=e=>{const t=(0,k.getTimelineStatusIndicatorData)(e.stageState,e.stageResult,e.stageStateData?e.stageStateData.pendingChecks:void 0,e.stageStateData?!e.stageStateData.pendingDependencies:void 0);return r.createElement(x.Tooltip,{text:t.label},r.createElement("span",{className:"flex-row"},r.createElement(R.Status,Object.assign({size:"16"},t.statusProps,{ariaLabel:t.label}))))},this._renderDescriptionCell=(e,t,i,s)=>{const n=s;if(n){let e;e=n.triggeringRepository?n.triggeringRepository:{id:n.repositoryId,name:n.repositoryName,alias:"self",connectionId:n.repositoryUrl,refName:n.sourceBranch,version:n.sourceVersion,type:n.repositoryType,projectId:"",projectName:"",url:""};let a=e.refName,l=e.version;256==n.buildReason&&(a=n.sourceBranch,l=n.sourceVersion);const d=n.buildNumber?"#"+n.buildNumber+" ":"",c=(0,L.formatPipelineRunName)(n.buildNumber,n.sourceVersionMessage,this.props.appendCommitMessageToRunName),h=n.definitionName?(0,o.format)("on {0}",n.definitionName):"",p=r.createElement(q.RepoLink,{sourceRepositoryId:e.id,sourceRepositoryName:e.name,sourceRepositoryType:e.type,sourceRepositoryUrl:e.connectionId}),g=r.createElement("span",{className:"text-ellipsis flex-row"},We.getReasonText(n.buildReason,!1)),m=r.createElement(j.BranchLink,{repositoryType:e.type,repositoryName:e.name,repositoryId:e.id,repositoryUrl:e.connectionId,branch:a,monospace:!0,readonly:!1}),f=r.createElement(z.CommitLink,{repositoryName:e.name,repositoryId:e.id,repositoryType:e.type,commitId:l,monospace:!0,readonly:!1});let b,S;if(this.props.definitionId)b=r.createElement(v.Link,{className:"fontWeightSemiBold bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:s.linkProps.href,tooltipProps:{overflowOnly:!0},onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,s.linkProps.href,!0,e)}},c),S=r.createElement("span",{className:"fontSizeMS secondary-text flex-row flex-baseline text-ellipsis bolt-table-inline-link-left-padding pipeline-firefox-fix"},p,m,f);else{let e=s.sourceVersion;e&&0!==e.length||(e=(0,o.format)("Run {0}",d)),b=r.createElement(v.Link,{className:"fontWeightSemiBold bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:s.linkProps.href,tooltipProps:{overflowOnly:!0},onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,s.linkProps.href,!0,e)}},e),S=r.createElement("span",{className:"fontSizeMS secondary-text flex-row flex-baseline text-ellipsis bolt-table-inline-link-left-padding pipeline-firefox-fix"},d,g,h,m,f)}let _={render:()=>this._renderBuildStatus(s)};return r.createElement(u.TwoLineTableCell,{className:"bolt-table-cell-content-with-inline-link no-v-padding",columnIndex:t,tableColumn:i,key:"col-"+t,iconProps:_,line1:b,line2:S})}return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null))},this._initTableColumns=()=>{this._columns=[{id:"runs",width:-90,ariaLabel:n.StagesHistoryTablePipelineRuns,name:n.StagesHistoryTablePipelineRuns,className:"stages-table-cell",renderCell:this._renderDescriptionCell,columnStyle:2},{id:"description",width:-30,ariaLabel:n.StagesHistoryTableStageStatus,name:n.StagesHistoryTableStageStatus,className:"stages-table-cell",renderCell:this._renderStageStatusCell,columnStyle:2},{id:"started/elapsed",width:-45,ariaLabel:n.StagesTableStarted+"/"+n.StagesTableElapsed,name:n.StagesTableStarted+"/"+n.StagesTableElapsed,className:"stages-table-cell",renderCell:this._renderTimeStartedAndElapsedCell}],this._signalRActionHub=this.props.signalRActionHub,this._store=this.props.store?this.props.store:new Ke.StageHistoryStore({pageContext:this.props.pageContext,contributionActionHub:new w.ContributionDataActionHub,signalRActionHub:this._signalRActionHub,definitionId:this.props.definitionId,stageName:this.props.stageName}),this._store.fetchData();const e=this._store.getStageHistoryData().slice();this._itemProvider=new p.ObservableArray(e)},this._renderNewRunsRow=(e,t,i)=>{const s=this._store.getNewRunsCount(),n=s<qe.MaxUpdates?s.toString():s.toString()+"+",a=s>1?(0,o.format)("NewRuns",n):"NewRuns";return r.createElement(u.TableRow,{index:e,details:i,className:"runs-new-row"},r.createElement(u.SimpleTableCell,{className:"no-v-padding",columnIndex:1,colspan:5},r.createElement("div",{className:"runs-new-row-content"},a)))},this._onStoreChanged=()=>{let e=[];if(this._store.getNewRunsCount()&&e.push({isNewRunsRow:!0,renderRow:this._renderNewRunsRow}),e=e.concat(this._store.getStageHistoryData().slice()),this._itemProvider.splice(0,this._itemProvider.length,...e),this._store.hasMore()){const e=new p.ObservableValue(void 0);this._itemProvider.push(e)}this._runs.splice(0,this._runs.length,...e),this.setState({loading:this._store.isLoading(),foundResultCount:this._runs.length});const t=e.length;t>0&&V.announce((0,o.format)("AnnounceFilterResults",t))},this._renderStagesTable=e=>{if(0==this.state.foundResultCount){const e=n.NoResultsFound;return V.announce(e),r.createElement("div",{className:"stages-panel-no-results"},e)}return r.createElement(u.Table,{ariaLabel:e,className:"stages-table sticky-table",columns:this._columns,itemProvider:this._itemProvider,onActivate:(e,t)=>this._onActivateRow(e,t,this.props.buildId,this.props.pageContext),renderLoadingRow:this._renderLoadRow,showHeader:e=>e>=1,spacerWidth:8,showScroll:!0,scrollable:!0})},this._renderLoadRow=(e,t)=>(this._store.fetchMoreRuns(),r.createElement(u.TableRow,{className:"bolt-list-row-loading",details:t,index:e},this._columns.map(((e,t)=>(0,u.TwoLineTableCell)({columnIndex:t,line1:(0,u.renderLoadingCell)(e.columnLayout),line2:(0,u.renderLoadingCell)(e.columnLayout)}))))),this._runs=new p.ObservableArray,this._itemProvider=new p.ObservableArray,this._initTableColumns(),this._stageFilter=new H.Filter;const i=(0,A.getTFSPageData)(this.props.pageContext);this._projectId=null===(t=null==i?void 0:i.project)||void 0===t?void 0:t.id,this.state={foundResultCount:this._runs.length,loading:this._store.isLoading()}}componentDidMount(){this._store.addListener(this._onStoreChanged),this._runs.subscribe(this._onFilterChanged),this._markTTI(),this._stageFilter.subscribe(this._onFilterChanged,H.FILTER_CHANGE_EVENT),this._publishTelemetryEvent(B.TelemetryConstants.StagesHistoryPanelShow)}componentDidUpdate(){this._markTTI()}_markTTI(){this._ttiMarked||this._store.isLoading()||(this._ttiMarked=!0,new Ge.Performance(this.props.pageContext).mark("stageshistory",this.props.definitionId))}componentDidUnMount(){this._store.dispose(),this._runs.unsubscribe(this._onFilterChanged),this._markTTI(),this._stageFilter.unsubscribe(this._onFilterChanged,H.FILTER_CHANGE_EVENT)}render(){const e=this.props.displayName;return r.createElement(y.CustomPanel,{onDismiss:this.props.onDismiss,className:"stages-panel",size:2},r.createElement(y.PanelHeader,{titleProps:{text:e},description:n.StagesPanelDescription,onDismiss:this.props.onDismiss}),r.createElement(y.PanelContent,{className:"panel-content-container"},r.createElement("div",{className:"stages-panel-filter-bar"},r.createElement(O.KeywordFilterBarItem,{className:"stages-panel-title-filter",placeholder:n.FilterByRunName,filterItemKey:this._titleFilterKey,filter:this._stageFilter}),r.createElement(M.DropdownFilterBarItem,{className:"stages-panel-status-filter",filterItemKey:this._statusFilterKey,placeholder:n.StagesFilterStatus,containerClassName:"status-dropdown",items:(0,K.getStateFilterItems)(),filter:this._stageFilter,selection:new S.ListSelection({multiSelect:!0,alwaysMerge:!0,selectOnFocus:!1})})),this._renderStagesTable(e)))}}t[e].StagesHistoryPanel=i}("ComponentsStagesHistoryPanel"),function(e){var i,r;Ye=t[e]={},function(e){e.BuildIds="buildIds",e.ContinuationToken="continuationToken",e.DefinitionId="definitionId",e.DefinitionIds="definitionIds",e.Path="definitionScope",e.Timestamp="timestamp",e.View="view",e.HubQuery="hubQuery",e.BranchSearch="branchName",e.BranchFilter="branchFilter",e.KeywordFilter="keywordFilter",e.RepositoryFilter="repositoryFilter",e.Repository="repo",e.KnownBranches="knownBranches",e.KnownRepositories="knownRepos",e.RequestedForFilter="requestedForFilter",e.ResultFilter="resultFilter",e.StatusFilter="statusFilter",e.TagFilter="tagFilter"}(i=t[e].RouteKeys||(t[e].RouteKeys={})),function(e){e.Branches="branches",e.DeletedHistory="deletedBuildsHistory",e.Folders="folders",e.History="buildsHistory",e.Recent="recent",e.RecycleBin="deletedDefinitions",e.FilterBar="filterBar",e.StatusBadge="statusBadge"}(r=t[e].Views||(t[e].Views={}));const n="ms.vss-build-web.status-badge-data-provider";class a extends N.Store{constructor(e){super(),this.onBranchFilterChange=e=>{const t={[i.View]:r.StatusBadge,[i.DefinitionId]:this._definitionId,[i.BranchSearch]:e};this._source.getDataAsync(n,t,!0).then((t=>{this._initializeBadgeOptions(t.stages),this._branchSelection=this._getBranchName(e),this._updateStatusBadgeLinkCollection(),this.emitChanged()}),s.handleError)},this.onRepositoryChange=e=>{this._repository.value=e,this._updateStatusBadgeLinkCollection(),this.emitChanged(),this.onBranchFilterChange(this._repository.value.refName)},this.onScopeChange=e=>{this._scopeSelection=e.selectedItems[0],this._updateStatusBadgeLinkCollection(),this.emitChanged()},this._onShowPanel=e=>{const t={[i.View]:r.StatusBadge,[i.DefinitionId]:e.id.toString()};this._source.getDataAsync(n,t,!0).then((e=>{const t=e.buildDefinition;if(this._repositories=e.repositories,this._repositories&&this._repositories.length)this._repository=new p.ObservableValue(this._repositories[0]);else{const e=t.repository;this._repository=new p.ObservableValue({alias:"self",connectionId:e.properties.connectedServiceId,id:e.id,name:e.name,projectId:t.project.id,projectName:t.project.name,refName:e.defaultBranch,type:e.type,version:"",url:""})}this._branchSelection=this._getDefaultBranch(),this._initializeBadgeOptions(e.stages);const i=t.id.toString();this._definitionId=i;const s=(0,A.getTFSPageData)(this._pageContext);if(s&&s.project){const e=encodeURI(t._links.badge.href.replace(s.project.id,s.project.name));this._baseStatusBadgeUrl=e.substr(0,e.length-(i.length+1))+this._getDefinitionPath(t),this._latestBuildUrl=e.replace(a.StatusPath,a.LatestPath),this._updateStatusBadgeLinkCollection(),this.emitChanged()}}),s.handleError)},this._onHidePanel=()=>{this._branchSelection="master",this._scopeSelection=void 0,this._scopeOptions=[],this._statusBadgeLinkCollection=void 0,this.emitChanged()},this._pageContext=e.pageContext,this._branchSelection="master",this._statusBadgeLinkCollection=void 0,this._source=new E.ContributionSource({pageContext:e.pageContext})}_getDefinitionPath(e){let t=a.PathSeparator;if(e.path){t=this._normalizeSeparators(e.path);(t?t.lastIndexOf(a.PathSeparator):-1)!==t.length-a.PathSeparator.length&&(t+=a.PathSeparator)}const i=this._containsIllegalPathCharacter(e.name)?e.id:encodeURIComponent(e.name);return encodeURIComponent(t)+i}_getDefaultBranch(){return this._repository&&this._repository.value.refName?this._getBranchName(this._repository.value.refName):"master"}_getBranchName(e){return e.replace("refs/heads/","")}_normalizeSeparators(e){return e.replace(/\\+/g,a.PathSeparator)}_containsIllegalPathCharacter(e){return a.IllegalPathCharacters.some((t=>-1!==e.indexOf(t)))}get repositorySelection(){return this._repository}get scopeOptions(){return this._scopeOptions}get scopeSelection(){return this._scopeSelection}get badgeUrls(){return this._statusBadgeLinkCollection}get branchSelection(){return this._branchSelection}get repositories(){return this._repositories}_initializeBadgeOptions(e){var t=0;var i=[{id:(t++).toString(),displayName:Ve.StatusBadgeEntirePipeline}];(e||[]).forEach((s=>{if(e.length>1){var r={id:(t++).toString(),displayName:s.name,stageName:s.name};i.push(r)}(s.jobs||[]).forEach((r=>{var n=e.length>1?s.name+" / "+r.name:r.name,a=e.length>1?s.name:void 0,o=r.name;if(r.configurations&&r.configurations.length>1)r.configurations.forEach((e=>{var s={id:(t++).toString(),displayName:n+" ("+e+")",stageName:a,jobName:o,configuration:e};i.push(s)}));else{var l={id:(t++).toString(),displayName:n,stageName:a,jobName:o};i.push(l)}}))})),this._scopeOptions=i,this._scopeSelection=this._scopeOptions[0],this.emitChanged()}_updateStatusBadgeLinkCollection(){let e=this._baseStatusBadgeUrl,t=this._latestBuildUrl,i={};this._repositories&&this._repositories.length>1&&this._repository&&(i.repoName=encodeURIComponent(this._repository.value.name)),this._branchSelection&&(i.branchName=encodeURIComponent(this._branchSelection)),this._scopeSelection&&(this._scopeSelection.stageName&&(i.stageName=encodeURIComponent(this._scopeSelection.stageName)),this._scopeSelection.jobName&&(i.jobName=encodeURIComponent(this._scopeSelection.jobName)),this._scopeSelection.configuration&&(i.configuration=encodeURIComponent(this._scopeSelection.configuration)));const s=Object.keys(i).map((e=>e+"="+i[e])).join("&");e+=s?"?"+s:"",t+=i.repoName?"&repoName="+i.repoName:"",t+=i.branchName?"&branchName="+i.branchName:"";const r="[!["+Ve.BuildStatus+"]("+e+")]("+t+")";this._statusBadgeLinkCollection={statusBadgeUrl:e,sampleMarkdown:r},this.emitChanged()}showPanel(e){this._onShowPanel(e)}hidePanel(){this._onHidePanel()}}t[e].StatusBadgePanelStore=a,a.PathSeparator="/",a.StatusPath="_apis/build/status/",a.LatestPath="_build/latest?definitionId=",a.IllegalPathCharacters=["+","%","*"]}("StoresStatusBadgePanelStore"),function(e){Qe=t[e]={};class i extends f.VssComponent{constructor(e){super(e),this._errorMessage=new p.ObservableValue(""),this._repoDropdownSelection=new $.DropdownSelection,this._getListItem=e=>({key:e.id,name:e.displayName}),this._getPickListItems=()=>this._store.scopeOptions,this._onDismissed=()=>{this._store.hidePanel()},this._onStoreChanged=()=>{this._store.badgeUrls?this.setState({statusBadgeUrl:this._store.badgeUrls.statusBadgeUrl,sampleMarkdown:this._store.badgeUrls.sampleMarkdown,isOpen:!0}):this.setState({statusBadgeUrl:"",sampleMarkdown:"",isOpen:!1})},this._onError=e=>{this._errorMessage.value=e},this._store=e.statusBadgePanelStore,this._repoDropdownSelection.select(0),this.state={statusBadgeUrl:"",sampleMarkdown:"",isOpen:!1}}componentWillMount(){this._store.addListener(this._onStoreChanged)}componentWillUnmount(){this._store.removeListener(this._onStoreChanged)}render(){return this.state.isOpen?r.createElement(y.Panel,{titleProps:{text:Ve.StatusBadgePanelTitle},size:2,onDismiss:this._onDismissed},r.createElement("div",{className:"flex-grow"},r.createElement(C.Observer,{errorMessage:this._errorMessage},(e=>""!==e.errorMessage&&r.createElement(_.MessageCard,{className:"margin-bottom-16",severity:"Error"},e.errorMessage))),r.createElement("img",{className:"status-badge-image",src:this.state.statusBadgeUrl,alt:Ve.StatusBadgeImageAltText}),r.createElement(Z.FocusZone,{direction:2,handleTabKey:!0,circularNavigation:!0},this._store.repositories&&this._store.repositories.length>1&&r.createElement("div",{className:"margin-top-16"},this._getRepositorySelector()),r.createElement("div",{className:"margin-top-16"},r.createElement(C.Observer,{repository:this._store.repositorySelection},(e=>this._getBranchSelector(e.repository)))),r.createElement("div",{className:"margin-top-16"},this._getScopeSelector()),r.createElement("div",{className:"status-badge-text-wrapper"},r.createElement(Q.TextField,{className:"status-badge-url-textfield",label:Ve.StatusBadgeUrlLabel,value:this.state.statusBadgeUrl,readOnly:!0}),r.createElement(Oe.CopyToClipboardButton,{className:"status-badge-url-copy-button",textToCopy:()=>this.state.statusBadgeUrl})),r.createElement("div",{className:"status-badge-text-wrapper"},r.createElement(Q.TextField,{className:"status-badge-url-textfield",label:Ve.StatusBadgeMarkdownLabel,value:this.state.sampleMarkdown,readOnly:!0}),r.createElement(Oe.CopyToClipboardButton,{className:"status-badge-url-copy-button",textToCopy:()=>this.state.sampleMarkdown}))))):null}_getRepositorySelector(){const e=this._store.repositories.map((e=>{const t=this.context.pageContext.getService("ISourceProviderService").getSourceProvider(e.type),i=t?t.getRepoIconName():"";return{id:e.id||e.name,text:e.name,iconProps:{iconName:i},data:e}}));return r.createElement("div",null,r.createElement("label",{htmlFor:(0,F.getSafeId)("statusbadge-repository"),className:"status-badge-label"},Ve.RepositoryDropdownLabel),r.createElement("div",{id:(0,F.getSafeId)("statusbadge-repository")},r.createElement(M.Dropdown,{items:new I.ArrayItemProvider(e),onSelect:(e,t)=>t.data&&this._store.onRepositoryChange(t.data),selection:this._repoDropdownSelection})))}_getBranchSelector(e){const t=e?e.connectionId:"",i=this._store.branchSelection,s=e&&e.type&&e.type.toLowerCase()===G.RepositoryTypes.TfsVersionControl.toLowerCase();if(e)return r.createElement("div",null,r.createElement("div",{id:(0,F.getSafeId)("statusbadge-branch"),className:"status-badge-branch-selector"},r.createElement(W.BranchDropdown,{key:e.id||e.name,className:"vertical-spacing flex-column label",label:Ve.StatusBadgeBranch,repositoryType:e.type,repositoryId:e.id||e.name,defaultBranch:i,connectionId:t,sourceVersion:s?i:void 0,onVersionSelected:s?this._store.onBranchFilterChange:void 0,onBranchSelected:this._store.onBranchFilterChange,onError:this._onError,isDrodownFullWidth:!0})))}_getScopeSelector(){return r.createElement("div",null,r.createElement("label",{htmlFor:(0,F.getSafeId)("statusbadge-scope"),className:"status-badge-label"},Ve.StatusBadgeScope),r.createElement("div",{id:(0,F.getSafeId)("statusbadge-scope")},r.createElement(Y.PickListDropdown,{getListItem:this._getListItem,getPickListItems:this._getPickListItems,selectedItems:[this._store.scopeSelection],onSelectionChanged:this._store.onScopeChange})))}}t[e].StatusBadgePanel=i}("ComponentsStatusBadgePanel"),function(e){$e=t[e]={};class i extends N.Store{constructor(e,t){super(),this._getTriggerIssuesData=(e=!1)=>new Promise(((t,i)=>{const s=this._pageContext.getService("IVssContributionService"),r={pipelineDefinitionId:this.definitionId.toString(),isRecalculate:e.toString()};s.getDataAsync("ms.vss-build-web.trigger-issues-data-provider",r,!0).then((e=>{if(e)t(e);else{const e=s.getDataProviderExceptions()[this.definitionId.toString()],t=e&&e.message||Ve.TriggerIssuesErrorMessage;i(new Error(t))}}))})),this.checkTriggerIssueExists=(e,t)=>{var i=!1;return e.isError&&t.map((t=>{t.statusType==R.Statuses.Failed&&t.yamlCommit==e.sourceVersion&&(i=!0)})),i},this.definitionId=t,this._pageContext=e,this._state={triggerIssueData:[]},this._initialize()}_initialize(){this._loadTriggerIssues()}_loadTriggerIssues(e=!1){let t=[];this._getTriggerIssuesData(e).then((e=>{if(e&&e.pipelineTriggerIssues){let i=!0;e.pipelineTriggerIssues.map((e=>{e&&e.sourceVersion&&!this.checkTriggerIssueExists(e,t)&&(this._state.triggerIssueData&&this._state.triggerIssueData.length>0&&this._state.triggerIssueData.some((t=>t.date.getTime()===e.createdOn.getTime()))&&(i=!1),t.push({statusType:e.isError?R.Statuses.Failed:R.Statuses.Warning,errorMessage:e.errorMessage,alias:e.alias,source:e.buildNumber,yamlCommit:e.sourceVersion,repositoryUrl:e.repositoryUrl,date:e.createdOn}))})),t.length>0&&i&&(this._state.triggerIssueData=t,this.emitChanged())}}))}getState(){return this._state}fetchTriggerIssueData(e=!1){this._loadTriggerIssues(e)}}t[e].PipelineTriggerIssuesStore=i}("StoresPipelineTriggerIssuesStore"),function(e){Je=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._renderIssuesCell=(e,t,i,s)=>{let n="";s.alias||s.source||(n="trigger-issue-error-message");var a=s.source.split(" "),o=a[1],l=Number(a[2]);let d=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(l,"",o);return r.createElement(u.TwoLineTableCell,{columnIndex:t,key:"col-"+t,tableColumn:i,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},s.statusType,{key:s.statusType+"",size:"24",className:"flex-self-center margin-right-8"}))},className:n,line1:r.createElement("span",{className:"flex-row scroll-hidden flex-center"},r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"fontWeightSemiBold font-weight-semibold fontSizeM font-size-m text-ellipsis"},s.errorMessage))),line2:s.alias||s.source?r.createElement("span",{className:"fontSize font-size secondary-text flex-row scroll-hidden flex-center"},r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("div",null,!s.source&&r.createElement("span",{className:"padding-left-4 text-ellipsis"},s.alias),s.source&&a&&a[0]&&r.createElement(P.FPSLink,{className:"icon-margin bolt-table-link text-ellipsis",href:d},s.alias+"/#"+a[0])))):null})},this._renderYAMLCommitCell=(e,t,i,s)=>{let n=s.yamlCommit.substring(0,8);return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement(P.FPSLink,{className:"icon-margin bolt-table-link text-ellipsis",href:s.repositoryUrl.concat("/commit/"+s.yamlCommit+"/")},n))))},this._renderDateCell=(e,t,i,s)=>r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement(l.Ago,{date:s.date,format:0})))),this._tableColumns=[{id:"issues",width:new p.ObservableValue(-75),name:Ve.Issues,renderCell:this._renderIssuesCell.bind(this),ariaLabel:Ve.TriggerIssuesColumnName},{id:"yaml-commit",width:new p.ObservableValue(-25),name:Ve.YAMLCommit,renderCell:this._renderYAMLCommitCell.bind(this),ariaLabel:Ve.YAMLCommit}]}render(){return r.createElement(X.Page,{className:"flex-grow"},r.createElement("div",{className:"pipeline-trigger-issues page-content page-content-top page-content-left"},r.createElement(J.Header,{title:Ve.TriggerIssues,titleClassName:"flex-row flex-center",titleSize:1,backButtonProps:{onClick:this.props.onBackButton},commandBarItems:this._getCommandbarItems()}),r.createElement(b.Card,{className:"flex-grow bolt-table-card margin-top-16 margin-left-8 bolt-card-no-vertical-padding",contentProps:{contentPadding:!1}},this.props.triggerIssuesData.length>0?this._getTriggerIssuesView():this._getNoTriggerIssuesView())))}_getIsLessThan5MinutesSinceTriggerIssueCreation(e){var t=Date.now()-3e5;return Date.parse(e)>t}_getCommandbarItems(){if(!(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.RecalculatePipelineTriggerIssue",!1))return;var e=!1;this.props.triggerIssuesData&&this.props.triggerIssuesData.length>0&&this.props.triggerIssuesData.forEach((t=>{this._getIsLessThan5MinutesSinceTriggerIssueCreation(t.date.toUTCString())&&(e=!0),t.errorMessage.toLocaleLowerCase().startsWith("circuit breaker")&&(t.errorMessage=Ve.UnexpectedTriggerIssue)}));const t=e||this.props.recalculateClicked;return[{id:"recalculate",text:Ve.Recalculate,disabled:t,tooltipProps:{text:t?Ve.RecalculateTooltipDisabled:Ve.RecalculateTooltip},onActivate:()=>{this.props.fetchTriggerIssueData(!0)}}]}_getTriggerIssuesView(){let e=new I.ArrayItemProvider(this.props.triggerIssuesData);return r.createElement(u.Table,{ariaLabel:Ve.TriggerIssues,className:"trigger-issues-table",columns:this._tableColumns,itemProvider:e,scrollable:!0})}_getNoTriggerIssuesView(){return r.createElement("div",{className:"no-trigger-issues"},r.createElement(c.Icon,{iconName:"Info",className:"no-restrictions-icon flex-self-center",ariaLabel:"no-restrictions-icon"}),r.createElement("div",{className:"message-container"},r.createElement("span",{className:"message-header title-s"},Ve.NoTriggerIssuesFound)))}}t[e].PipelineTriggerIssuesPage=i}("ComponentsPipelineTriggerIssuesPage"),function(e){function i(e,t){return(0,o.format)("{0}: {1}",e,t)}Xe=t[e]={},t[e].formatPropertyValuePair=i,t[e].renderTriggerTable=function(e){return r.createElement("div",null,r.createElement(u.Table,{ariaLabel:"Triggers",className:"triggers-table",columns:s,itemProvider:new I.ArrayItemProvider(e),scrollable:!0}))},t[e].handleCommonProperties=function(e,t){let s=i(e,t),r="";switch(e){case Ve.TriggersIncludedPaths:"/*"===t&&(r=(0,o.format)(Ve.TriggersIncludeAllPaths,s));break;case Ve.TriggersExcludedPaths:0===t.length&&(s=i(Ve.TriggersExcludedPaths,Ve.None),r=(0,o.format)(Ve.TriggersExcludeNoPaths,s));break;case Ve.TriggersIncludedTags:"refs/tags/*"===t?r=(0,o.format)(Ve.TriggersIncludeAllTags,s):0===t.length&&(s=i(Ve.TriggersIncludedTags,Ve.None),r=(0,o.format)(Ve.TriggersIncludeNoTags,s));break;case Ve.TriggersExcludedTags:0===t.length&&(s=i(Ve.TriggersExcludedTags,Ve.None),r=(0,o.format)(Ve.TriggersExcludeNoTags,s));break;case Ve.TriggersIncludedBranches:"refs/heads/*"===t?r=(0,o.format)(Ve.TriggersIncludeAllBranches,s):0===t.length&&(s=i(Ve.TriggersIncludedBranches,Ve.None),r=(0,o.format)(Ve.TriggersIncludeNoBranches,s));break;case Ve.TriggersExcludedBranches:0===t.length&&(s=i(Ve.TriggersExcludedBranches,Ve.None),r=(0,o.format)(Ve.TriggersExcludeNoBranches,s))}return{property:s,status:r}},t[e].renderHeader=function(e,t,i,s=!1){const n=s?Ve.TriggersNotMatching:Ve.TriggersNotInYAML,a=i&&r.createElement(ie.Pill,{className:"not-synchronized-pill"},Ve.TriggersNotSynchronized);return r.createElement("div",null,t?r.createElement("h3",{className:"triggers-table-title"},e,a):r.createElement("h4",{className:"triggers-table-title"},e,a),i&&r.createElement("div",{className:"flex-row scroll-hidden warning-status"},r.createElement(c.Icon,{iconName:"Warning",className:"icon-margin"}),r.createElement("span",{className:"text-ellipsis","aria-label":n},n)))},t[e].getServiceEndpointUrl=function(e,t){let i={adminPivot:d.ServiceConnection,resourceId:t};return function(e,t,i){const s=n(e);let r=Object.assign({project:s.project},i);s.team&&(r.team=s.team);return(0,te.routeUrl)(e,t,r)}(e,a,i)},t[e].getPipelineDefinitionUrl=function(e,t,i){const s={};return s[d.DefinitionId]=t+"",s[d.Project]=i||n(e).project,(0,te.routeUrl)(e,l,s)};const s=[{id:"property",width:new p.ObservableValue(-50),name:"Property",renderCell:function(e,t,i,s){return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(x.Tooltip,{overflowOnly:!0},s.link&&s.link.length>0?r.createElement("a",{className:"icon-margin bolt-table-link bolt-link text-ellipsis padding-0",href:s.link},s.property):r.createElement("span",{className:"text-ellipsis"},s.property))))}},{id:"status",width:new p.ObservableValue(-50),name:"Status",renderCell:function(e,t,i,s){return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:"flex-row scroll-hidden"},r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("div",null,r.createElement("span",{className:"text-ellipsis","aria-label":s.status||""},s.status)))))}}];function n(e){return e.getService("IVssNavigationService").getCurrentRoute().routeValues}const a="ms.vss-admin-web.project-admin-hub-route",l="ms.vss-build-web.pipelines-hub-route";var d;!function(e){e.DefinitionId="definitionId",e.Project="project",e.ServiceConnection="adminservices"}(d||(d={}))}("ComponentsPipelineTriggersPipelineTriggersHelper"),function(e){et=t[e]={};class i extends f.VssComponent{render(){var e,t;if(null==this.props.CITriggerData)return this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForBranch,Ve.TriggersContinuousIntegration));if((null===(e=this.props.CITriggerData)||void 0===e?void 0:e.enabled)||1==(null===(t=this.props.CITriggerData)||void 0===t?void 0:t.triggerSource)){const e=this._transformData(this.props.CITriggerData);return(0,Xe.renderTriggerTable)(e)}return this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForBranch,Ve.TriggersContinuousIntegration))}_transformData(e){let t=[];const i=1==e.triggerSource;return e.enabled?t=[{property:Ve.TriggersEnabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,i?Ve.TriggersSourceClassicView:Ve.TriggersSourceYAML),status:i?Ve.TriggersWarningClassicView:""},(0,Xe.handleCommonProperties)(Ve.TriggersIncludedPaths,e.includePaths.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersExcludedPaths,e.excludePaths.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersIncludedTags,e.includeTags.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersExcludedTags,e.excludeTags.join(", "))]:i&&(t=[{property:Ve.TriggersDisabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,Ve.TriggersSourceClassicView),status:Ve.TriggersWarningClassicView}]),t}}t[e].CITriggerComponent=i}("ComponentsPipelineTriggersCITriggerComponent"),function(){t.PipelineTriggersDataService={};class e extends g.VssService{async refreshDataAsync(e,t,i,s){return this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.pipeline-triggers-data-provider",{definitionId:e.toString(),selectedBranch:t,syncSchedulesNow:i,syncResourcesNow:s},!0).then((e=>{if(e)return e;throw new Error})).catch((()=>{throw new Error}))}_serviceStart(e){super._serviceStart(e)}_serviceRestart(e){super._serviceRestart(e)}}g.Services.add("IPipelineTriggersDataService",{serviceFactory:e})}(),function(e){tt=t[e]={};class i extends f.VssComponent{render(){var e,t;if(!this.props.isExternalSourceProvider)return this.props.getNoTriggersView(Ve.TriggersNotSupportedPullRequest);if(null==this.props.PRTriggerData)return this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForBranch,Ve.TriggersPullRequest));if((null===(e=this.props.PRTriggerData)||void 0===e?void 0:e.enabled)||1==(null===(t=this.props.PRTriggerData)||void 0===t?void 0:t.triggerSource)){const e=this._transformData(this.props.PRTriggerData);return(0,Xe.renderTriggerTable)(e)}return this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForBranch,Ve.TriggersPullRequest))}_transformData(e){let t=[];const i=1==e.triggerSource;return e.enabled?t=[{property:Ve.TriggersEnabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,i?Ve.TriggersSourceClassicView:Ve.TriggersSourceYAML),status:i?Ve.TriggersWarningClassicView:""},(0,Xe.handleCommonProperties)(Ve.TriggersIncludedPaths,e.includePaths.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersExcludedPaths,e.excludePaths.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersIncludedTags,e.includeTags.join(", ")),(0,Xe.handleCommonProperties)(Ve.TriggersExcludedTags,e.excludeTags.join(", ")),{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersAutoCancel,e.autoCancel.toString()),status:""}]:i&&(t=[{property:Ve.TriggersDisabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,Ve.TriggersSourceClassicView),status:Ve.TriggersWarningClassicView}]),t}}t[e].PRTriggerComponent=i}("ComponentsPipelineTriggersPRTriggerComponent"),function(e){it=t[e]={};class i extends f.VssComponent{constructor(){super(...arguments),this._onSyncButtonClick=()=>{this.props.onButtonClicked(!0)}}render(){return this.props.scheduleTriggerData.synchronizedSchedulesDetails.length>0||this.props.scheduleTriggerData.unsynchronizedSchedulesDetails.length>0||this.props.scheduleTriggerData.hasDesignerSchedule?this._getTriggersView():r.createElement(b.Card,{className:"flex-column margin-8 padding-0",contentProps:{contentPadding:!1}},this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForBranch,Ve.TriggersSchedule)))}_getTriggersView(){const e=this._transformData(this.props.scheduleTriggerData);let t=0;const i=this.props.scheduleTriggerData.hasDesignerSchedule;return r.createElement("div",null,this.props.scheduleTriggerData.unsynchronizedSchedulesDetails&&this.props.scheduleTriggerData.unsynchronizedSchedulesDetails.length>0&&r.createElement("div",{className:(0,f.css)("flex-row","flex-noshrink","padding-8","padding-top-16")},r.createElement(_.MessageCard,{className:"flex-grow",severity:"Warning",buttonProps:[{text:Ve.TriggersSynchronize,onClick:this._onSyncButtonClick}]},Ve.TriggersSchedulesNotSynced)),r.createElement(b.Card,{className:"flex-column margin-8 padding-0",contentProps:{contentPadding:!1}},(0,Xe.renderTriggerTable)(e)),this.props.scheduleTriggerData.synchronizedSchedulesDetails&&this.props.scheduleTriggerData.synchronizedSchedulesDetails.map(((e,s)=>{const n=this._transformSchedule(e,i,!1),a=this._getScheduleDisplayName(e.displayName,t++);return r.createElement(b.Card,{className:"flex-column margin-8 padding-0",key:a,renderHeader:()=>this._renderScheduleHeader(a,!1),contentProps:{contentPadding:!1}},(0,Xe.renderTriggerTable)(n))})),this.props.scheduleTriggerData.unsynchronizedSchedulesDetails&&this.props.scheduleTriggerData.unsynchronizedSchedulesDetails.map(((e,s)=>{const n=this._transformSchedule(e,this.props.scheduleTriggerData.hasDesignerSchedule,!0),a=this._getScheduleDisplayName(e.displayName,t++);return r.createElement(b.Card,{className:"flex-column margin-8 padding-0",key:a,renderHeader:()=>this._renderScheduleHeader(a,!0,!!i||e.isUnsyncronizedScheduleFromYAML),contentProps:{contentPadding:!1}},(0,Xe.renderTriggerTable)(n))})))}_renderScheduleHeader(e,t,i=!1){return(0,Xe.renderHeader)(e,!0,t,i)}_getScheduleDisplayName(e,t){return null!=e?e:(0,o.format)(Ve.TriggersScheduleNumber,(t+1).toString())}_transformData(e){return this.props.scheduleTriggerData.synchronizedSchedulesDetails.length>0||this.props.scheduleTriggerData.unsynchronizedSchedulesDetails.length>0?[{property:Ve.TriggersScheduleEnabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,e.hasDesignerSchedule?Ve.TriggersSourceClassicView:Ve.TriggersSourceYAML),status:e.hasDesignerSchedule?Ve.TriggersScheduleOverwrittenInClassicView:""}]:[{property:Ve.TriggersScheduleDisabled,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersSource,Ve.TriggersSourceClassicView),status:Ve.TriggersScheduleOverwrittenInClassicView}]}_transformSchedule(e,t,i){var s,r;return t?[{property:Ve.ScheduledRunsPanelDesignerSchedule,status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersScheduleNextSchedule,(null!==(r=e.nextSchedule)&&void 0!==r?r:Ve.TriggersScheduleNotAvailable).toString()),status:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersScheduleOnlyWithChangesProperty,e.scheduleOnlyWithChanges.toString()),status:e.scheduleOnlyWithChanges?Ve.TriggersScheduleOnlyWithChangesEnabled:""}]:[{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersScheduleCronSyntax,e.cronSyntax),status:e.isExceedingLimit?Ve.TriggersScheduleExceedingLimits:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersScheduleNextSchedule,(null!==(s=e.nextSchedule)&&void 0!==s?s:Ve.TriggersScheduleNotAvailable).toString()),status:e.nextSchedule||i?"":e.isExceedingLimit?Ve.TriggersScheduleExceededWeeklyLimit:Ve.TriggersScheduleExceededWeek},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersScheduleOnlyWithChangesProperty,e.scheduleOnlyWithChanges.toString()),status:e.scheduleOnlyWithChanges?Ve.TriggersScheduleOnlyWithChangesEnabled:""},{property:(0,Xe.formatPropertyValuePair)(Ve.TriggersBatched,e.batched.toString()),status:""}]}}t[e].ScheduleTriggerComponent=i}("ComponentsPipelineTriggersScheduleTriggerComponent"),function(e){st=t[e]={};class i extends f.VssComponent{render(){return r.createElement(b.Card,{className:(0,F.css)("flex-column margin-8 padding-0",{"repository-triggers-not-default":!this.props.isDefaultBranch}),renderHeader:()=>r.createElement("h3",{className:"triggers-table-title"},Ve.TriggersRepositoryResourceType),contentProps:{contentPadding:!1}},this.props.isDefaultBranch?0===this.props.repositoryTriggersData.length?this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForPipeline,Ve.TriggersRepositoryResourceType),Ve.TriggersRepositoryResourceType):this._getTriggersView(this.props.repositoryTriggersData):this.props.getNoTriggersView(Ve.TriggersRepositoryTriggerNotInDefaultBranch,Ve.TriggersRepositoryResourceType))}_getTriggersView(e){return e.map(((e,t)=>{var i=this._transformData(e);return r.createElement("div",{key:e.alias},r.createElement("h4",{className:"triggers-table-title"},e.alias),(0,Xe.renderTriggerTable)(i))}))}_transformData(e){const t=[];return t.push({property:(0,Xe.formatPropertyValuePair)(Ve.TriggersRepositoryName,e.repositoryName),status:""}),t.push((0,Xe.handleCommonProperties)(Ve.TriggersIncludedBranches,e.includeBranches.join(", "))),t.push((0,Xe.handleCommonProperties)(Ve.TriggersExcludedBranches,e.excludeBranches.join(", "))),t.push((0,Xe.handleCommonProperties)(Ve.TriggersIncludedPaths,e.includePaths.join(", "))),t.push((0,Xe.handleCommonProperties)(Ve.TriggersExcludedPaths,e.excludePaths.join(", "))),t.push((0,Xe.handleCommonProperties)(Ve.TriggersIncludedTags,e.includeTags.join(", "))),t.push((0,Xe.handleCommonProperties)(Ve.TriggersExcludedTags,e.excludeTags.join(", "))),t.push({property:(0,Xe.formatPropertyValuePair)(Ve.TriggersBatched,e.batched.toString()),status:""}),t}}t[e].RepositoryTriggerComponent=i}("ComponentsPipelineTriggersRepositoryTriggerComponent"),function(e){rt=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._onRecalculateButtonClicked=()=>{this.setState({wasRecalculated:!0}),this.props.onButtonClicked(!1)},this._propertyKeys={env:Ve.TriggersResourcePropertyEnvironment,image:Ve.TriggersResourcePropertyImage,name:Ve.TriggersResourcePropertyName,owner:Ve.TriggersResourcePropertyOwner,repo:Ve.TriggersResourcePropertyRepository},this.state={wasRecalculated:!1}}render(){return this._getTriggersView()}_getTriggersView(){var e=this.props.resourceTriggerData.synchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"PipelineCompletion",!0))),t=this.props.resourceTriggerData.synchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"WebhookTriggeredEvent",!0))),i=this.props.resourceTriggerData.synchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"ContainerImage",!0))),s=this.props.resourceTriggerData.synchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"PackageUpdate",!0))),n=this.props.resourceTriggerData.synchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"BuildResourceCompletion",!0))),a=this.props.resourceTriggerData.unsynchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"PipelineCompletion",!0))).sort(((e,t)=>e.alias.localeCompare(t.alias))),l=this.props.resourceTriggerData.unsynchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"WebhookTriggeredEvent",!0))).sort(((e,t)=>e.alias.localeCompare(t.alias))),d=this.props.resourceTriggerData.unsynchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"ContainerImage",!0))).sort(((e,t)=>e.alias.localeCompare(t.alias))),c=this.props.resourceTriggerData.unsynchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"PackageUpdate",!0))).sort(((e,t)=>e.alias.localeCompare(t.alias))),u=this.props.resourceTriggerData.unsynchronizedTriggers.filter((e=>(0,o.equals)(e.triggerType,"BuildResourceCompletion",!0))).sort(((e,t)=>e.alias.localeCompare(t.alias)));return r.createElement("div",{className:"flex-column flex-grow"},this.props.resourceTriggerData.unsynchronizedTriggers.length>0&&r.createElement("div",{className:(0,f.css)("margin-8","flex-row","flex-noshrink")},r.createElement(_.MessageCard,{className:"flex-grow",severity:"Warning",buttonProps:[{text:Ve.TriggersSynchronize,disabled:this.state.wasRecalculated,onClick:this._onRecalculateButtonClicked}]},Ve.TriggersResourceTriggerNotSynced)),!this.props.isDefaultBranch&&r.createElement("div",{className:(0,f.css)("margin-8","flex-row","flex-noshrink")},r.createElement(_.MessageCard,{className:"flex-grow",severity:"Warning"},(0,o.format)(Ve.TriggersNotInDefaultBranch,this.props.defaultBranch))),r.createElement(st.RepositoryTriggerComponent,{repositoryTriggersData:this.props.resourceTriggerData.repositoryTriggersDetails,isDefaultBranch:this.props.isDefaultBranch,getNoTriggersView:this.props.getNoTriggersView}),this._renderTriggerType(e,a,Ve.TriggersResourceTriggerPipelineResourceType),this._renderTriggerType(t,l,Ve.TriggersResourceTriggerWebhookResourceType),this._renderTriggerType(i,d,Ve.TriggersResourceTriggerContainerResourceType),this._renderTriggerType(s,c,Ve.TriggersResourceTriggerPackageResourceType),this._renderTriggerType(n,u,Ve.TriggersResourceTriggerBuildResourceType),this._renderTriggerType(this.props.resourceTriggerData.buildCompletionTriggers,[],Ve.TriggersResourceTriggerBuildCompletion,!0))}_renderTriggerType(e,t,i,s=!1){return r.createElement(b.Card,{className:"flex-column margin-8 padding-0",renderHeader:()=>r.createElement("h3",{className:"triggers-table-title"},i),contentProps:{contentPadding:!1}},r.createElement("div",{className:"flex-column"},e&&e.map(((e,t)=>{const i=this._transformData(e,s);return r.createElement("div",{key:e.alias+"_"+t},r.createElement("h4",{className:"triggers-table-title"},e.alias),(0,Xe.renderTriggerTable)(i))})),t&&t.length>0&&t.map(((e,t)=>{const i=this._transformData(e,s);return r.createElement("div",{key:e.alias+"_"+t},(0,Xe.renderHeader)(e.alias,!1,!0,e.isUnsynchronizedTriggerFromYAML),(0,Xe.renderTriggerTable)(i))})),(!e||0==e.length)&&(!t||0==t.length)&&this.props.getNoTriggersView((0,o.format)(Ve.TriggersNoTriggerFoundForPipeline,i))))}_transformData(e,t=!1){const i=[];return e.alias&&i.push({property:(0,Xe.formatPropertyValuePair)(Ve.TriggersAlias,e.alias),status:""}),e.source&&i.push({property:e.sourceName?(0,Xe.formatPropertyValuePair)(Ve.TriggersResourceSourcePipeline,e.sourceName):Ve.TriggersResourceSourcePipeline,status:"",link:(0,Xe.getPipelineDefinitionUrl)(this.context.pageContext,e.source,e.project)}),e.connectionId&&i.push({property:Ve.TriggerServiceConnection,status:"",link:(0,Xe.getServiceEndpointUrl)(this.context.pageContext,e.connectionId)}),i.push({property:(0,Xe.formatPropertyValuePair)(Ve.TriggersWillItRun,e.willItRun.toString()),status:this._getWillItRunStatus(e.runReason,t)}),e.properties&&Object.keys(e.properties).forEach((t=>{this._propertyKeys[t]&&i.push({property:(0,Xe.formatPropertyValuePair)(this._propertyKeys[t],e.properties[t]),status:""})})),i}_getWillItRunStatus(e,t){return 1==e?t?Ve.TriggersWillRunStatusUI:(0,o.format)(Ve.TriggersWillRunStatusDefaultBranchCondition,this.props.defaultBranch):0==e?(0,o.format)(Ve.TriggersWillRunStatusDefaultBranch,this.props.defaultBranch):2==e?(0,o.format)(Ve.TriggersWillRunStatusNoYamlFileFound,this.props.currentBranch):Ve.TriggersWillRunStatusUnsynchronized}}t[e].ResourceTriggerComponent=i}("ComponentsPipelineTriggersResourceTriggerComponent"),function(e){var i;nt=t[e]={},function(e){e.CITrigger="CITrigger",e.PRTrigger="PRTrigger",e.ScheduleTrigger="ScheduleTrigger",e.ResourceTrigger="ResourceTrigger"}(i||(i={}));class s extends f.VssComponent{constructor(e,t){super(e,t),this._fetchData=(e,t=!1,i=!1)=>{this._dataService.refreshDataAsync(this.props.definitionId,e,t,i).then((e=>{this.setState({isPageLoaded:!0,triggersData:e})})).catch((()=>{this.setState({isPageLoaded:!0,triggersData:void 0})}))},this._onTabChanged=e=>{let t=this._historyService.getState();t[qe.TriggersPageRouteKeys.TriggerType]=e,this._historyService.replaceState(t),this.setState({selectedTab:e})},this._onButtonClicked=e=>{this._fetchData(this.state.selectedBranch,e,!e)},this.triggersGenericLink="https://learn.microsoft.com/en-us/azure/devops/pipelines/build/triggers?view=azure-devops",this.ciTriggerInfoLinkTFSGit="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops&tabs=yaml#ci-triggers",this.ciTriggerInfoLinkGitHub="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/github?view=azure-devops&tabs=yaml#ci-triggers",this.ciTriggerInfoLinkBitbucket="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/bitbucket?view=azure-devops&tabs=yaml#ci-triggers",this.prTriggerInfoLinkTFSGit="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops#pr-triggers",this.prTriggerInfoLinkGitHub="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/github?view=azure-devops&tabs=yaml#pr-triggers",this.prTriggerInfoLinkBitbucket="https://learn.microsoft.com/en-us/azure/devops/pipelines/repos/bitbucket?view=azure-devops&tabs=yaml#pr-triggers",this.scheduleTriggerInfoLink="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/scheduled-triggers?view=azure-devops&tabs=yaml",this.resourceTriggerInfoLink="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/resources?view=azure-devops",this._dataService=this.context.pageContext.getService("IPipelineTriggersDataService"),this._historyService=this.context.pageContext.getService("IVssHistoryService");const s=this._historyService.getState()[qe.TriggersPageRouteKeys.BranchName],r=this._historyService.getState()[qe.TriggersPageRouteKeys.TriggerType];this.state={selectedTab:r||i.CITrigger,isPageLoaded:!1,triggersData:void 0,selectedBranch:s||""}}componentDidMount(){this._fetchData(this.state.selectedBranch)}render(){return r.createElement(X.Page,{className:"flex-grow"},r.createElement("div",{className:"pipeline-triggers page-content page-content-top page-content-left"},r.createElement(X.Page,{selectedTabId:this.state.selectedTab},r.createElement(J.Header,{title:Ve.Triggers,titleClassName:"flex-row flex-center",titleSize:1,backButtonProps:{onClick:this.props.onBackButton}}),this._renderBranchDropdown(),r.createElement(se.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged},r.createElement(se.Tab,{name:Ve.TriggersContinuousIntegration,id:i.CITrigger,key:i.CITrigger}),r.createElement(se.Tab,{name:Ve.TriggersPullRequest,id:i.PRTrigger,key:i.PRTrigger}),r.createElement(se.Tab,{name:Ve.TriggersSchedule,id:i.ScheduleTrigger,key:i.ScheduleTrigger,iconProps:this.state.triggersData&&this.state.triggersData.scheduleTriggerData.unsynchronizedSchedulesDetails.length>0?{iconName:"Warning",className:"warning-icon"}:void 0}),r.createElement(se.Tab,{name:Ve.TriggersResource,id:i.ResourceTrigger,key:i.ResourceTrigger,iconProps:this.state.triggersData&&this.state.triggersData.resourceTriggersData.unsynchronizedTriggers.length>0?{iconName:"Warning",className:"warning-icon"}:void 0})),r.createElement(se.TabContent,null,r.createElement("div",{className:"flex-grow bolt-table-card margin-top-16 margin-left-8 bolt-card-no-vertical-padding trigger-details"},!this.state.isPageLoaded&&r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement(T.Spinner,{className:"pipelines-filter-spinner",size:"large",label:Ve.Loading})),this.state.isPageLoaded&&this.state.triggersData&&(this.state.triggersData.parsingErrors||!this.state.triggersData.isBranchRunnable)&&r.createElement("div",{className:(0,f.css)("margin-8","flex-row","flex-noshrink")},r.createElement(_.MessageCard,{className:"flex-grow",severity:"Warning"},Ve.TriggersYAMLParsingWithErrors)),this.state.isPageLoaded&&!this.state.triggersData&&r.createElement("div",{className:(0,f.css)("margin-8","flex-row","flex-noshrink")},r.createElement(_.MessageCard,{className:"flex-grow",severity:"Warning"},Ve.TriggerPageNotLoaded)),this.state.isPageLoaded&&this.state.triggersData&&this.state.selectedTab===i.CITrigger&&r.createElement(b.Card,{className:"flex-column margin-8 padding-0",contentProps:{contentPadding:!1}},r.createElement(et.CITriggerComponent,{CITriggerData:this.state.triggersData.continousIntegrationData,getNoTriggersView:this._getNoTriggersView})),this.state.isPageLoaded&&this.state.triggersData&&this.state.selectedTab===i.PRTrigger&&r.createElement(b.Card,{className:"flex-column margin-8 padding-0",contentProps:{contentPadding:!1}},r.createElement(tt.PRTriggerComponent,{PRTriggerData:this.state.triggersData.pullRequestTriggerData,isExternalSourceProvider:!(0,o.equals)(this.state.triggersData.definitionRepositoryData.type,"TfsGit",!0),getNoTriggersView:this._getNoTriggersView})),this.state.isPageLoaded&&this.state.triggersData&&this.state.selectedTab===i.ScheduleTrigger&&r.createElement(it.ScheduleTriggerComponent,{scheduleTriggerData:this.state.triggersData.scheduleTriggerData,onButtonClicked:this._onButtonClicked,getNoTriggersView:this._getNoTriggersView}),this.state.isPageLoaded&&this.state.triggersData&&this.state.selectedTab===i.ResourceTrigger&&r.createElement("div",{className:"flex-column flex-grow"},r.createElement(rt.ResourceTriggerComponent,{isDefaultBranch:this.state.triggersData.isDefaultBranch,resourceTriggerData:this.state.triggersData.resourceTriggersData,onButtonClicked:this._onButtonClicked,getNoTriggersView:this._getNoTriggersView,defaultBranch:this.state.triggersData.definitionRepositoryData.defaultBranch,currentBranch:this.state.selectedBranch})))),this.state.isPageLoaded&&this.state.triggersData&&this._getMoreInfoLink(this.state.triggersData.definitionRepositoryData.type))))}_getMoreInfoLink(e){let t=this.triggersGenericLink,s="";switch(this.state.selectedTab){case i.CITrigger:switch(s=Ve.TriggersContinuousIntegration,e.toLowerCase()){case G.RepositoryTypes.TfsGit:t=this.ciTriggerInfoLinkTFSGit;break;case G.RepositoryTypes.GitHub:case G.RepositoryTypes.GitHubEnterprise:t=this.ciTriggerInfoLinkGitHub;break;case G.RepositoryTypes.Bitbucket:t=this.ciTriggerInfoLinkBitbucket;break;default:t=this.triggersGenericLink}break;case i.PRTrigger:switch(s=Ve.TriggersPullRequest,e.toLowerCase()){case G.RepositoryTypes.TfsGit:t=this.prTriggerInfoLinkTFSGit;break;case G.RepositoryTypes.GitHub:case G.RepositoryTypes.GitHubEnterprise:t=this.prTriggerInfoLinkGitHub;break;case G.RepositoryTypes.Bitbucket:t=this.prTriggerInfoLinkBitbucket;break;default:t=this.triggersGenericLink}break;case i.ScheduleTrigger:s=Ve.TriggersSchedule,t=this.scheduleTriggerInfoLink;break;case i.ResourceTrigger:s=Ve.TriggersResource,t=this.resourceTriggerInfoLink;break;default:s=Ve.Triggers}return r.createElement(m.FormatComponent,{className:"triggers-learn-more",format:Ve.TriggersLearnMore},r.createElement(v.Link,{href:t,target:"_blank",className:"margin-left-16"},Ve.LearnMore),s)}_renderBranchDropdown(){if(!this.state.isPageLoaded)return r.createElement(T.Spinner,null);if(this.state.triggersData){var e=this.state.triggersData.definitionRepositoryData;return r.createElement("div",{className:"flex-row flex-right branch-picker-container"},r.createElement("label",{className:"ms-label branchDropdown--label",id:"branch-dropdown"},Ve.TriggersSelectBranch),r.createElement(W.BranchDropdown,{className:"branch-picker flex-row flex-center",ariaLabel:Ve.TriggersSelectBranch,repositoryType:e.type,repositoryId:e.id,defaultBranch:this._getBranchForPicker(e.defaultBranch),connectionId:e.properties&&e.properties.connectedServiceId,isDrodownFullWidth:!1,comboBoxMinWidth:120,comboBoxMaxWidth:350,onBranchSelected:e=>this._switchBranch(e)}))}return null}_getBranchForPicker(e){let t=this.state.selectedBranch;""==this.state.selectedBranch&&(t=e);let i="refs/heads/";return t.startsWith(i)?t.substring(11):t}_switchBranch(e){let t=this._historyService.getState();t[qe.TriggersPageRouteKeys.BranchName]=e,this._historyService.replaceState(t),this.setState({isPageLoaded:!1,selectedBranch:e,triggersData:void 0}),this._fetchData(e)}_getNoTriggersView(e){return r.createElement("div",{className:"flex-grow no-triggers-view"},r.createElement(c.Icon,{iconName:"Info",className:"icon-margin no-triggers-info-icon"}),r.createElement("span",{className:"no-triggers-info-text"},e))}}t[e].PipelineTriggersPage=s}("ComponentsPipelineTriggersPage"),function(e){at=t[e]={},t[e].GetEditViewMenuItem=function(e,t,i){return{id:"edit-pipeline-command",text:t?Ve.EditPipeline:Ve.ViewPipeline,important:!0,href:i,onActivate:(t,s)=>{(0,U.onClickFPS)(e,i,!0,s)}}},t[e].GetRunMenuItem=function(e,t,i){return{id:"run-pipeline-command",text:Ve.RunPipeline,important:!0,isPrimary:!0,onActivate:(n,a)=>{e.getRestClient("IBuildRestClient").getDefinition(t,i).then((t=>{e.getService("IVssLayoutManager").renderCallout((i=>{const s={definition:t,repository:t.repository,processType:t.process.type,pageContext:e,project:t.project.id,source:"definitions",onSuccess:()=>{},definitionVariables:t.variables,queue:t.queue,defaultSourceBranch:t.repository?t.repository.defaultBranch:void 0,onDismiss:i};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent"},s),null)}))}),s.handleError)}}},t[e].GetSecurityMenuItem=function(e,t,i){return{text:Ve.Security,id:"pipeline-menu-security",important:!1,onActivate:()=>{e.getRestClient("IBuildRestClient").getDefinition(t,i).then((t=>{const i={definition:t};e.getService("IVssLayoutManager").renderCallout((e=>r.createElement(re.CommandComponent,Object.assign({commandType:"ciPermissionsComponent"},i),null)))}),s.handleError)}}},t[e].GetRenameMoveMenuItem=function(e,t,i,n){return{id:"rename-pipeline-command",text:Ve.RenameMove,important:!1,onActivate:(a,o)=>{e.getRestClient("IBuildRestClient").getDefinition(t,i).then((t=>{e.getService("IVssLayoutManager").renderCallout((i=>{const s={pageContext:e,definition:t,projectId:t.project.id,saveAsTemplate:!1,onClose:i,onDefinitionSaved:n};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciSaveDefinitionComponent"},s),null)}))}),s.handleError)}}},t[e].GetDeleteMenuItem=function(e,t,i,n){return{id:"delete-pipeline-command",text:Ve.Delete,important:!1,onActivate:(a,o)=>{e.getRestClient("IBuildRestClient").getDefinition(t,i).then((t=>{e.getService("IVssLayoutManager").renderCallout((i=>{const s={pageContext:e,definition:t,projectId:t.project.id,onClose:i,onDefinitionDeleted:n};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciDeleteDefinitionComponent"},s),null)}))}),s.handleError)}}}}("PipelineActions"),function(){t.PipelineDetailsDataService={};class e extends g.VssService{get data(){return this._data}updateData(e){this._data.value=e}refreshData(){this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.pipeline-details-data-provider",{definitionId:this._data.value.definitionId.toString()},!0).then((e=>{e&&(this._data.value=e)}))}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_initialize(){const e=this.pageContext.getService("IVssContributionService").getData("ms.vss-build-web.pipeline-details-data-provider");e&&(this._data?this._data.value=e:this._data=new p.ObservableValue(e))}}g.Services.add("IPipelineDetailsDataService",{serviceFactory:e})}(),function(e){t[e]={};class i extends g.VssService{constructor(){super(...arguments),this.items=new p.ObservableArray}getBreadcrumbItems(e){return this.items}setPipeline(e,t,i){this.items.removeAll();const s=this.pageContext.getService("IBuildLinkingService"),r=i.split("\\").filter(Boolean);let n="";for(let e=0;e<r.length;e++){n+=`\\${r[e]}`;const t=s.getFolderUrl(n);this.items.push({key:`pipeline-path-breadcrumb-${e}`,text:r[e],href:t,onClick:e=>{(0,U.onClickFPS)(this.pageContext,t,!0,e,{telemetrySource:"pipelines-breadcrumb"})}})}this.items.push({key:"pipeline-breadcrumb",text:e,href:t,onClick:e=>{(0,U.onClickFPS)(this.pageContext,t,!0,e,{telemetrySource:"pipelines-breadcrumb"})}})}clearPipeline(){this.items.removeAll()}}t[e].PipelinesHeaderBreadcrumbService=i,g.Services.add("pipelines-header-breadcrumb-service",{serviceFactory:i})}("PipelinesHeaderBreadcrumbService"),function(e){ot=t[e]={};class i extends ae.SignalRHub{constructor(e){super({hostInformation:e.hostInformation,name:ne.HubNames.buildDetailHub,listener:e.listener||new s(e.actionCreator),userInactivityTimeoutMs:i.s_userInactivityTimeoutMs,pageContext:e.pageContext}),this._initializeClient=e=>{e.client.buildUpdated2=(e,t,i)=>{this._options.actionCreator.buildUpdated(t,e,i)},e.client.stagesUpdated=(e,t,i)=>{this._options.actionCreator.stagesUpdated(e,t,i)}},this._options=e,this.initializeProxy(ne.getBuildProxyToRegister,this._initializeClient)}watchProject(){this.start().then((()=>{const e=this.hub;e&&e.server.watchProject(this._options.projectId)}))}stopWatchingProject(){const e=this.hub;e&&e.server.stopWatchingProject(this._options.projectId)}}t[e].BuildSignalRHub=i,i.s_userInactivityTimeoutMs=18e5;class s{constructor(e){this._isDisconnectivityTriggered=!1,this._isUserInactivityTriggered=!1,this._actionCreator=e}isConnecting(){}isConnected(){}isDisconnected(){this._isUserInactivityTriggered||this._isDisconnectivityTriggered||(this._isDisconnectivityTriggered=!0)}isReconnected(){}isReconnecting(){}isSlow(){}isUserActive(){}isUserInactive(){this._isDisconnectivityTriggered||(this._isUserInactivityTriggered=!0,this._actionCreator.isUserInactive())}}}("SignalRHub"),function(e){t[e]={};class i extends g.VssService{get data(){return this._data}fetchData(e,t,i){const r=i?{definitionId:e,repositoryId:t}:{};this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.branches-data-provider",r,i).then((t=>{if(t){const i=this.pageContext.getService("IBuildLinkingService");this._data.value=s(t,e,i)}}))}_serviceStart(e){super._serviceStart(e),this._initialize()}_serviceRestart(e){super._serviceRestart(e),this._initialize()}_initialize(){this._data=new p.ObservableValue([])}}function s(e,t,i){const s=[];for(const o of e){const e=o.branchHistory.map((e=>Object.assign(Object.assign({},e),{value:r(e.queueTime,e.startTime,e.finishTime),state:n(e.status,e.result),href:i.getBuildUrl(e.id),tooltip:a(e.status,e.result,e.buildNumber,e.queueTime,e.startTime,e.finishTime)})));e.sort(((e,t)=>(e.startTime?e.startTime.getTime():e.queueTime.getTime())-(t.startTime?t.startTime.getTime():t.queueTime.getTime()))),s.push(Object.assign(Object.assign({},o),{latestBuild:o.branchHistory.find((e=>e.id===o.latestBuildId)),href:i.getPipelinesUrl(t,o.repositoryId,o.branchId),builds:e.slice(-15)}))}return s.sort(((e,t)=>e.isDefaultBranch?-1:t.isDefaultBranch?1:(0,o.localeIgnoreCaseComparer)(e.sourceBranch,t.sourceBranch))),s}function r(e,t,i){return i?i.getTime()-(void 0!==t?t.getTime():e.getTime()):t?Date.now()-t.getTime():0}function n(e,t){switch(e){case 4:case 1:return oe.HistogramStates.Running;case 2:switch(t){case 32:case 8:return oe.HistogramStates.Failure;case 4:return oe.HistogramStates.Warning;case 2:return oe.HistogramStates.Success;default:return oe.HistogramStates.Unknown}default:return oe.HistogramStates.Unknown}}function a(e,t,i,s,r,n){switch(e){case 2:const e=function(e){switch(e){case 32:return Ve.HistogramResultCanceled;case 8:return Ve.HistogramResultFailed;case 4:return Ve.HistogramResultPartiallySucceeded;case 2:return Ve.HistogramResultSucceeded;default:return""}}(t||0),a=(0,h.ago)(n).toLocaleLowerCase();return(0,o.format)(Ve.HistogramTooltipCompleted,i,e,a,(0,h.duration)(r,n));case 1:case 4:return(0,o.format)(Ve.HistogramTooltipInProgress,i,(0,h.duration)(r,new Date));default:return(0,o.format)(Ve.HistogramTooltipNotStarted,i,(0,h.ago)(s))}}t[e].processData=s,g.Services.add("IBranchesDataService",{serviceFactory:i})}("TabsBranchesBranchesDataService"),function(e){lt=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._renderTitleCell=(e,t,i,s)=>{const n=this.sourceProviderService.getSourceProvider(s.repositoryType),a=n?n.getBranchText(s.sourceBranch):s.sourceBranch;return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("span",{className:"fontWeightSemiBold"},a),s.isDefaultBranch&&r.createElement(ie.Pill,{className:"margin-left-8",excludeTabStop:!0},Ve.DefaultBranchLabel))},this._renderHistoryCell=(e,t,i,s)=>r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement(oe.Histogram,{excludeTabStopOnItems:!0,className:"branches-view-histogram",items:s.builds,ariaLabelForList:Ve.AriaHistogramBuildsList,width:8,height:40,renderTooltip:e=>r.createElement("div",{className:"rhythm-vertical-16"},r.createElement("div",null,e.tooltip),e.usedRepositoryBranches&&e.usedRepositoryBranches.length>1&&r.createElement("div",{className:"flex-column rhythm-vertical-8"},e.usedRepositoryBranches.map((e=>{const t=this.sourceProviderService.getSourceProvider(e.repository.type);return r.createElement("div",{key:e.branchId,className:"flex-row flex-center rhythm-horizontal-4"},r.createElement(c.Icon,{iconName:t?t.getRepoIconName():""}),r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"text-ellipsis"},e.repository.name)),r.createElement(c.Icon,{iconName:t?t.getBranchIconName(e.branchName):"OpenSource"}),r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"fontWeightSemiBold text-ellipsis"},t?t.getBranchText(e.branchName):e.branchName)))})))),selectRightMost:!0,minimumLength:15,noBorderElement:!0,noFocusZone:!0})),this._renderDetailsCell=(e,t,i,s)=>{const{latestBuild:n}=s;if(n){const e=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(n.id),a=(0,L.formatPipelineRunName)(n.buildNumber,s.sourceVersionMessage,s.appendCommitMessageToRunName),o=(0,k.getBuildStatusIndicatorData)(n.status,n.result);return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"bolt-table-cell-content-with-link scroll-hidden"},r.createElement(R.Status,Object.assign({ariaLabel:o.statusProps.ariaLabel||o.label},o.statusProps,{className:"icon-large-margin",size:"16"})),r.createElement(x.Tooltip,{overflowOnly:!0,text:a},r.createElement(P.FPSLink,{excludeTabStop:!0,className:"bolt-table-link bolt-table-inline-link fontSizeM text-ellipsis",href:e,removeUnderline:!0},a)))}return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t}," ")},this._onActivateRow=(e,t)=>{const i=this.context.pageContext,s=i.getService("IBuildLinkingService"),r=this.props.branches[t.index];this.context.pageContext.getService("IVssHistoryService");if(r){const n=s.getPipelinesUrl(this.props.definitionId,r.repositoryId,r.branchId);(0,U.onClickFPS)(i,t.data.href||n,!0,e)}},this.columns=[{id:"title",width:400,name:Ve.BranchColumnName,className:"pipelines-cell",renderCell:this._renderTitleCell,columnStyle:2},{id:"history",width:240,name:Ve.HistoryColumn,className:"pipelines-cell",renderCell:this._renderHistoryCell},{id:"details",width:-100,minWidth:240,name:Ve.LastRunColumnName,className:"pipelines-cell",renderCell:this._renderDetailsCell}],this.sourceProviderService=this.context.pageContext.getService("ISourceProviderService")}render(){const e=new I.ArrayItemProvider(this.props.branches);return r.createElement(b.Card,{className:"bolt-table-card flex-grow",contentProps:{contentPadding:!1,className:"branches-table-scroll"}},r.createElement(u.Table,{ariaLabel:Ve.BranchesTabName,columns:this.columns,itemProvider:e,onActivate:this._onActivateRow}))}}t[e].BranchesTable=i}("TabsBranchesBranchesTable"),function(e){dt=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this.selection=new $.DropdownSelection,this.ttiMarked=!1,this.onSelectRepository=(e,t)=>{this.dataService.fetchData(this.props.definitionId,Number(t.id),!0)},this.state={branches:[],repositoryItems:[]};const i=this.context.pageContext.getService("ISourceProviderService");this.dataService=this.context.pageContext.getService("IBranchesDataService"),this.dataService.data.subscribe((e=>{const t={};for(const e of this.state.repositoryItems)t[e.id]=e;for(const s of e)for(const e of s.builds)for(const s of e.usedRepositoryBranches)if(!t[s.repositoryId]){const e=i.getSourceProvider(s.repository.type),r=e?e.getRepoIconName():"";t[s.repositoryId]={id:s.repositoryId.toFixed(),iconProps:{iconName:r,className:"repo-filter-logo repo-filter-"+r},text:s.repository.name}}this.setState({branches:e,repositoryItems:Object.keys(t).map((e=>t[e]))})})),this.selection.select(0),this.dataService.fetchData(this.props.definitionId,0,!this.props.isPageLoad)}render(){const{branches:e,repositoryItems:t}=this.state;return r.createElement("div",{className:"flex-column rhythm-vertical-8"},t.length>1&&r.createElement("div",{className:"flex-row flex-center rhythm-horizontal-8 margin-horizontal-20 margin-bottom-8"},r.createElement("label",null,Ve.GroupByRepository),r.createElement(M.Dropdown,{className:"group-by-repository-dropdown",items:t,selection:this.selection,onSelect:this.onSelectRepository})),r.createElement(lt.BranchesTable,{branches:e,definitionId:this.props.definitionId}))}componentDidUpdate(){!this.ttiMarked&&this.state.branches.length>0&&(this.ttiMarked=!0,new Ge.Performance(this.context.pageContext).mark("branches"))}}t[e].BranchesView=i}("TabsBranchesBranchesView"),function(e){ct=t[e]={};class i extends N.Store{constructor(e){super(),this._onFilterUpdated=e=>{const t=this.filter.getFilterItemState(qe.RunFilterKeys.BranchFilter);let i="";if(t&&t.value){i=t.value.map((e=>e.ids.join())).join()}this._appliedFilterStrings.branch=i;const s=this.filter.getFilterItemState(qe.RunFilterKeys.KeywordFilter);this._appliedFilterStrings.keywords=s&&s.value?s.value:"";const r=this.filter.getFilterItemState(qe.RunFilterKeys.RepositoryFilter);let n="";if(r&&r.value){n=r.value.map((e=>e.id)).join(",")}this._appliedFilterStrings.repository=n;const a=this.filter.getFilterItemState(qe.RunFilterKeys.RequestedForFilter);let o="";if(a&&a.value){o=a.value.map((e=>e.id)).join(",")}this._appliedFilterStrings.requestedFor=o;const l=this.filter.getFilterItemState(qe.RunFilterKeys.TagFilter);this._appliedFilterStrings.tags=l&&l.value?l.value.map((e=>encodeURIComponent(e))).join():"";const d=this.filter.getFilterItemState(qe.RunFilterKeys.StatusFilter),c=d&&d.value?d.value:[],u=c.map((e=>{switch(e){case k.Status.Cancelled:return 32;case k.Status.Failed:return 8;case k.Status.Succeeded:return 2;case k.Status.Warning:return 4;default:return 0}})).reduce(((e,t)=>e|t),0);this._appliedFilterStrings.result=u?u+"":"";const h=c.map((e=>{switch(e){case k.Status.InProgress:return 1;case k.Status.Queued:return 32;default:return 0}})).reduce(((e,t)=>e|t),0);this._appliedFilterStrings.status=h?h+"":"",this.emitChanged()},this._appliedFilterStrings={branch:"",keywords:"",repository:"",requestedFor:"",status:"",result:"",tags:""},this._filter=e||new H.Filter,this._filter.subscribe(this._onFilterUpdated,H.FILTER_APPLIED_EVENT),this._filter.subscribe(this._onFilterUpdated,H.FILTER_RESET_EVENT)}get filter(){return this._filter}doFiltersMatch(e,t){let i="",s="";if(t){const t=e[qe.RunFilterKeys.StatusFilter];if(void 0!==t){const e=t.split(",");let r=0,n=0;e.forEach((e=>{switch(e.toLowerCase()){case k.Status.Cancelled:n|=32;break;case k.Status.Failed:n|=8;break;case k.Status.Succeeded:n|=2;break;case k.Status.Warning:n|=4;break;case k.Status.InProgress:r|=1;break;case k.Status.Queued:r|=32}})),0!=r&&(i=""+r),0!=n&&(s=""+n)}}else i=e[qe.RunFilterKeys.StatusFilter]||"",s=e[qe.RunFilterKeys.ResultFilter]||"";return this._appliedFilterStrings.branch==(e[qe.RunFilterKeys.BranchFilter]||"")&&this._appliedFilterStrings.keywords===(e[qe.RunFilterKeys.KeywordFilter]||"")&&this._appliedFilterStrings.repository===(e[qe.RunFilterKeys.RepositoryFilter]||"")&&this._appliedFilterStrings.requestedFor===(e[qe.RunFilterKeys.RequestedForFilter]||"")&&this._appliedFilterStrings.status===i&&this._appliedFilterStrings.result===s&&this._appliedFilterStrings.tags===(e[qe.RunFilterKeys.TagFilter]||"")}doBranchFiltersMatch(e){return this._appliedFilterStrings.branch==(e[qe.RunFilterKeys.BranchFilter]||"")}hasAppliedFilters(){return!!(this._appliedFilterStrings.branch||this._appliedFilterStrings.keywords||this._appliedFilterStrings.repository||this._appliedFilterStrings.requestedFor||this._appliedFilterStrings.result||this._appliedFilterStrings.status||this._appliedFilterStrings.tags)}addFilterRoutes(e){return this._appliedFilterStrings.branch&&(e[qe.RunFilterKeys.BranchFilter]=this._appliedFilterStrings.branch),this._appliedFilterStrings.keywords&&(e[qe.RunFilterKeys.KeywordFilter]=this._appliedFilterStrings.keywords),this._appliedFilterStrings.repository&&(e[qe.RunFilterKeys.RepositoryFilter]=this._appliedFilterStrings.repository),this._appliedFilterStrings.requestedFor&&(e[qe.RunFilterKeys.RequestedForFilter]=this._appliedFilterStrings.requestedFor),this._appliedFilterStrings.result&&(e[qe.RunFilterKeys.ResultFilter]=this._appliedFilterStrings.result),this._appliedFilterStrings.status&&(e[qe.RunFilterKeys.StatusFilter]=this._appliedFilterStrings.status),this._appliedFilterStrings.tags&&(e[qe.RunFilterKeys.TagFilter]=this._appliedFilterStrings.tags),e}dispose(){this._filter.unsubscribe(this._onFilterUpdated,H.FILTER_APPLIED_EVENT),this._filter.unsubscribe(this._onFilterUpdated,H.FILTER_RESET_EVENT)}}t[e].RunsAppliedFilterStore=i}("TabsRunsStoresRunsAppliedFilterStore"),function(e){ut=t[e]={};const i="ms.vss-build-web.filters-data-provider";class s extends N.Store{constructor(e){super(),this._definitionId=e.definitionId,this._filter={},this._identityService=e.pageContext.getService(le.VssIdentityServiceName),this._updating=!1,this._historyService=e.pageContext.getService("IVssHistoryService"),this._sourceProviderService=e.pageContext.getService("ISourceProviderService"),this._appliedFilterStore=e.appliedFilterStore,this._source=new E.ContributionSource({pageContext:e.pageContext})}get branches(){return this.repositories.map((e=>e.branches)).reduce(((e,t)=>[...e,...t]))}get canGetMoreRepos(){return this._canGetMoreRepos}get filterDefinition(){return this._filter}get identities(){return this._filter.identities||[]}get repositories(){return this._filter.repositories||[]}addNewIdentities(e){this._filter.identities=this.identities.concat(e),this.emitChanged()}searchBranches(e){if(!this._updating){this._updating=!0;const t={[qe.FilterRouteKeys.BranchSearch]:e};this._definitionId&&(t[qe.FilterRouteKeys.DefinitionId]=this._definitionId.toString());const s=this.branches;return s.length>0&&(t[qe.FilterRouteKeys.KnownBranches]=s.map((e=>e.id)).join(",")),this._source.getDataAsync(i,t,!0).then((e=>{this._updating=!1,e.repositories&&e.repositories.length>0&&(this._filter.repositories=this._updateRepos(e.repositories),this.emitChanged())}))}return Promise.resolve(void 0)}searchIdentities(e){return this._identityService.searchIdentitiesAsync(e,["user"],["ims","source"],"name",void 0,(e=>e.filter((e=>!this._filter.identities||this._filter.identities.findIndex((t=>e.localId===t.id||e.originId===t.id))<0)))).then((e=>e.map((e=>this._toListItem(e))).filter((e=>void 0!==e))))}async searchRepositories(e){if(!this._updating){this._updating=!0;const t={[qe.FilterRouteKeys.RepositorySearch]:e};this.repositories.length>0&&(t[qe.FilterRouteKeys.KnownRepositories]=this.repositories.join(","));const s=await this._source.getDataAsync(i,t,!0);return this._updating=!1,void(s&&s.repositories&&s.repositories.length>0&&(this._filter.repositories=this._updateRepos(s.repositories),this.emitChanged()))}return Promise.resolve(void 0)}setNewBranches(e){const t=this.getBranchesSelectedInFilter();null!=this._filter&&null!=this._filter.repositories&&null!=this._filter.repositories[0]&&e.forEach((e=>{var i,s;const r=null===(s=null===(i=this._filter)||void 0===i?void 0:i.repositories)||void 0===s?void 0:s.find((t=>t.identifier===e.repositoryId));if(r&&void 0===r.branches.find((t=>t.name===e.branchName))&&(0===t.length||t.find((t=>t.name===e.branchName)))){const t=this._sourceProviderService.getSourceProvider(r.type);this.searchBranches(t?t.getBranchText(e.branchName):e.branchName)}}))}updateFilter(e,t){if(!this._updating){this._updating=!0;const s={};this._definitionId&&(s[qe.FilterRouteKeys.DefinitionId]=this._definitionId.toString()),!e&&this.repositories.length>0&&(s[qe.FilterRouteKeys.KnownRepositories]=this.repositories.map((e=>e.id)).join(","));const r=this._historyService.getState()[qe.RunFilterKeys.BranchFilter];r&&(s[qe.RunFilterKeys.BranchFilter]=r),this._source.getDataAsync(i,s,!0).then((e=>{this._updating=!1;this._canGetMoreRepos=!!e.repositories&&8===e.repositories.length,this._filter.repositories=this._updateRepos(e.repositories),this._filter.identities=e.identities||this._filter.identities,this._filter.tags=e.tags||this._filter.tags,this.emitChanged(),t&&t()}))}}getBranchesSelectedInFilter(){var e=[];return this.repositories&&this.repositories.length>0&&this.branches&&this._appliedFilterStore&&this._appliedFilterStore.hasAppliedFilters()&&(e=this.branches.filter((e=>{const t={};if(t[qe.RunFilterKeys.BranchFilter]=e.id.toString(),this._appliedFilterStore.doBranchFiltersMatch(t))return e}))),e}_toListItem(e){if(e&&e.subjectDescriptor)return{key:e.localId||e.originId,data:{descriptor:e.subjectDescriptor,id:e.localId||e.originId,displayName:e.displayName,uniqueName:e.samAccountName?`${e.scopeName}\\${e.samAccountName}`:e.signInAddress||e.mail,_links:{avatar:{href:e.image}}},id:e.localId||e.originId,text:e.displayName}}_updateRepos(e){const t=this.repositories.concat(e||[]).reduce(((e,t)=>{const i=t.id;if(e[i]){const s=e[i].branches.map((e=>e.id));e[i].branches=e[i].branches.concat(t.branches.filter((e=>-1===s.indexOf(e.id))))}else e[i]=t;return e}),{});return Object.keys(t).map((e=>t[e]))}}t[e].RunsFilterStore=s}("TabsRunsStoresRunsFilterStore"),function(e){ht=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this.timerManagement=new D.TimerManagement,this._queuedInfo=(0,k.getStatusIndicatorData)(k.Status.Queued),this._inProgressInfo=(0,k.getStatusIndicatorData)(k.Status.InProgress),this._succeededInfo=(0,k.getStatusIndicatorData)(k.Status.Succeeded),this._warningInfo=(0,k.getStatusIndicatorData)(k.Status.Warning),this._failedInfo=(0,k.getStatusIndicatorData)(k.Status.Failed),this._canceledInfo=(0,k.getStatusIndicatorData)(k.Status.Cancelled),this._stateFilterItems=[{id:k.Status.Queued,text:Ve.Queued,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._queuedInfo.statusProps,{size:"16",animated:!1}))}},{id:k.Status.InProgress,text:Ve.Running,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._inProgressInfo.statusProps,{size:"16",animated:!1}))}},{id:k.Status.Succeeded,text:Ve.Succeeded,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._succeededInfo.statusProps,{size:"16",animated:!1}))}},{id:k.Status.Warning,text:Ve.PartiallySucceeded,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._warningInfo.statusProps,{size:"16",animated:!1}))}},{id:k.Status.Failed,text:Ve.Failed,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._failedInfo.statusProps,{size:"16",animated:!1}))}},{id:k.Status.Cancelled,text:Ve.Canceled,iconProps:{render:()=>r.createElement(R.Status,Object.assign({},this._canceledInfo.statusProps,{size:"16",animated:!1}))}}],this.onFilterChanged=()=>{this.performFilter()},this.performFilter=()=>{const e=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RepositoryFilter);if(e&&e.value){const t=e.value,i=this.state.repositories.filter((e=>t.find((t=>t.id?t.id.toString()===e.id.toString():t===e.id.toString()))));Object.keys(this.state.branches).length<=0&&this.repositorySelection.selectedCount>0&&(0,V.announce)(Ve.ShowingBranchFilter),Object.keys(this.state.branches).length>0&&0===this.repositorySelection.selectedCount&&((0,V.announce)(Ve.NotShowingBranchFilter),this.branchesSelection.selectedCount>0&&this.branchesSelection.clear()),this.previousRepoFilter!==e&&this.setState({branches:this._getBranchFilter(i)},this._getBranchListItems),this.previousRepoFilter=e}},this._getBranchIndicator=e=>{const t=this.state.branches[e];if(t&&t.isFavorite)return{iconProps:{iconType:0,iconName:"FavoriteStarFill",className:"branch-filter-favorite-icon flex-row"},className:"favorite-icon-color icon-margin"}},this._getBranchListItems=()=>{var e;const{favorites:t,others:i}=Object.keys(this.state.branches).reduce(((e,t)=>(this.state.branches[t].isFavorite?e.favorites.push(t):e.others.push(t),e)),{favorites:[],others:[]}),s=[...t.sort(),...i.sort()],r=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.BranchFilter),n=s.map((e=>{const t=this.state.branches[e],i=t.ids.join();let s=t;if(r&&r.value){const e=r.value.findIndex((e=>e.ids.join()===i));e>-1&&(s=r.value[e])}return{id:i,key:i,text:t.prettyName,iconProps:{iconName:t.icon,className:"branch-list-item-icon"},data:s}})),a=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.BranchFilter),o=null===(e=null==a?void 0:a.value)||void 0===e?void 0:e.map((e=>e.fullName));this._isFixFlashingRunsPageWhenNewBranchesLoadingFeatureEnabled?this.branchesListItems.change(0,...n):this.branchesListItems.splice(0,this.branchesListItems.length,...n),null==o||o.forEach((e=>{var t;const i=null===(t=this.branchesListItems.value)||void 0===t?void 0:t.findIndex((t=>t.data.fullName==e));i>-1&&this.branchesSelection.select(i)}))},this._renderBranchListItem=(e,t,i,s)=>{const n=this._getBranchIndicator(s.id);return n?r.createElement("td",{key:e,className:"bolt-list-cell-child flex-center bolt-list-cell-text branch-item"},r.createElement(c.Icon,Object.assign({},s.iconProps)),r.createElement(x.Tooltip,{overflowOnly:!0,text:s.text},r.createElement("div",{className:"branch-list-item-text text-ellipsis"},s.text)),r.createElement("div",{className:"branch-list-favorite-icon-div"},r.createElement(c.Icon,Object.assign({},n.iconProps)))):r.createElement("td",{key:e,className:"bolt-list-cell-child flex-center bolt-list-cell-text branch-item"},r.createElement(c.Icon,Object.assign({},s.iconProps)),r.createElement(x.Tooltip,{overflowOnly:!0,text:s.text},r.createElement("div",{className:"branch-list-item-text text-ellipsis body-m"},s.text)))},this._getBranchFilterUpdate=(e,t)=>{t&&this._dataStore.searchBranches(t).then((()=>{this._getBranchListItems()}))},this._getRepositoryFilterActions=()=>this._dataStore.canGetMoreRepos?[{text:Ve.ShowMore,iconProps:{iconType:0,iconName:"Download"},disabled:!1,onClick:()=>{this._dataStore.updateFilter(!1,this._getRepositoryListItems)}}]:[],this._getRepositoryListItems=()=>{const e=this.state.repositories.sort(((e,t)=>e.type.toLowerCase()===G.RepositoryTypes.TfsVersionControl?-1:t.type.toLowerCase()===G.RepositoryTypes.TfsVersionControl?1:e.name.toLowerCase().localeCompare(t.name.toLowerCase(),navigator.language))),t=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RepositoryFilter),i=e.map((e=>{const i=this._sourceProviderService.getSourceProvider(e.type),s=i.getRepoIconName(),r=e.id.toString();let n=e,a=e?e.name:"";if(i.getKey()===G.RepositoryTypes.TfsVersionControl&&(a.startsWith("$")||(a="$/"+a)),t&&t.value){const e=t.value.findIndex((e=>e.id.toString()===r));e>-1&&(n=t.value[e])}return{id:r,key:r,data:n,text:a,iconProps:{iconName:s,className:"repo-filter-logo repo-filter-"+s}}}));this.repositoryListItems.splice(0,this.repositoryListItems.length,...i)},this._getRepositoryFilterUpdate=(e,t)=>{t&&this._dataStore.searchRepositories(t).then((e=>{this._getRepositoryListItems()}))},this._getRequestedForListItems=()=>{const e=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RequestedForFilter),t=Object.keys(this.state.identities).map((e=>this.state.identities[e])).map((t=>{const i=t.id;let s=t;if(e&&e.value){const t=e.value.findIndex((e=>e.id===i));t>-1&&(s=e.value[t])}return{key:i,data:s,id:i,text:t.displayName}}));this.requestedForListItems.push(...t)},this._getSelectedRepos=()=>{const e=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RepositoryFilter),t=this._dataStore.filterDefinition,i=t.repositories&&1===t.repositories.length?t.repositories[0]:void 0;return e&&e.value?e.value:i?[i]:[]},this._onFilterStoreUpdated=()=>{const e=!this.state.initialized;let t=!1;const i=this._dataStore.filterDefinition;let s;if(e){let e=this.context.pageContext.getService("IVssHistoryService").getState()[qe.RunFilterKeys.RepositoryFilter];if(!e&&i.repositories&&1===i.repositories.length&&(e=i.repositories[0].id.toString()),e)this.setState({identities:i.identities?this._toIdentityLookup(i.identities):this.state.identities,repositories:i.repositories||[]}),s=this._parseRepositoryFilter(e);else{const e=i.repositories&&1===i.repositories.length?i.repositories[0]:void 0;s=e?[e]:[]}t=!0}else s=this._getSelectedRepos();const r=s.length>0?s:[],n=Object.keys(this.state.branches).length;if(i.tags&&i.tags!==this.previousTags&&(this.previousTags=i.tags,this.tagsListItems.value=i.tags.length?(0,ce.wrapListBoxItems)(i.tags):[]),this.setState({branches:this._getBranchFilter(r),identities:i.identities?this._toIdentityLookup(i.identities):this.state.identities,initialized:!0,repositories:i.repositories||[]},this._getBranchListItems),e){this._getRequestedForListItems(),this._getBranchListItems(),this._getRepositoryListItems(),this.context.pageContext.getService("IPageStateHistoryService").registerFilter(this.props.appliedFilterStore.filter,"",[{dataType:"string",filterKey:qe.RunFilterKeys.KeywordFilter,historyBehavior:0},{dataType:"object",filterKey:qe.RunFilterKeys.StatusFilter,historyBehavior:0,mappingFunction:e=>e.join(),parsingFunction:e=>e.split(",")},{dataType:"object",filterKey:qe.RunFilterKeys.RepositoryFilter,historyBehavior:0,mappingFunction:e=>e.map((e=>e.id)).join(),parsingFunction:this._parseRepositoryFilter},{dataType:"object",filterKey:qe.RunFilterKeys.BranchFilter,historyBehavior:0,mappingFunction:e=>e.map((e=>e.ids.join())).join(),parsingFunction:this._parseBranchFilter},{dataType:"object",filterKey:qe.RunFilterKeys.RequestedForFilter,historyBehavior:0,mappingFunction:e=>e.map((e=>e.id)).join(),parsingFunction:this._parseIdentitiesFilter},{dataType:"object",filterKey:qe.RunFilterKeys.TagFilter,historyBehavior:0,mappingFunction:e=>e.map((e=>encodeURIComponent(e))).join(),parsingFunction:e=>e.split(",").map((e=>decodeURIComponent(e)))}]),t&&setTimeout((()=>{(0,V.announce)(Ve.ShowingRepositoriesFilter)}),100),n<=0&&Object.keys(this.state.branches).length>0&&setTimeout((()=>{(0,V.announce)(Ve.ShowingBranchFilter)}),150)}},this._onFilterRequestedFor=(e,t)=>{const i=this.props.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RequestedForFilter);if(t)return this._dataStore.searchIdentities(t).then((e=>{const t=e.filter((e=>this.requestedForListItems.value.findIndex((t=>t.id===e.id))<0));this.requestedForListItems.push(...t)}));if(e&&i&&i.value&&this.props.appliedFilterStore.filter.setFilterItemState(qe.RunFilterKeys.RequestedForFilter,i),!t&&i&&i.value){const e=i.value.filter((e=>this._dataStore.identities.findIndex((t=>t.id===e.id))<0)).map((e=>{const t=this.requestedForListItems.value.findIndex((t=>e.id===t.id));return this.requestedForListItems.value[t].data}));this._dataStore.addNewIdentities(e)}this.requestedForListItems.removeAll((e=>!this._dataStore.identities.find((t=>e.id===t.id)))),this._isFixRunFilterRequestedForUndefinedIssueEnabled?void 0!==i&&(this.identitySelection.value=null==i?void 0:i.value.map((e=>{const t=this.requestedForListItems.value.findIndex((t=>t.id===e.id));return{beginIndex:t,endIndex:t}}))):this.identitySelection.value=null==i?void 0:i.value.map((e=>{const t=this.requestedForListItems.value.findIndex((t=>t.id===e.id));return{beginIndex:t,endIndex:t}}))},this._parseBranchFilter=e=>{const t=e.split(",").map((e=>Number(e))).map((e=>Object.keys(this.state.branches).map((e=>this.state.branches[e])).find((t=>t.ids.some((t=>t===e)))))).reduce(((e,t)=>{if(t){const i=t.ids.join();e[i]||(e[i]=t)}return e}),{});return Object.keys(t).map((e=>t[e]))},this._parseIdentitiesFilter=e=>e.split(",").map((e=>this.state.identities[e])).filter(Boolean),this._parseRepositoryFilter=e=>e.split(",").map((e=>this.state.repositories.find((t=>t.id.toString()===e)))).reduce(((e,t)=>(t&&e.push(t),e)),[]),this._dataStore=new ut.RunsFilterStore({definitionId:e.definitionId,pageContext:t.pageContext,appliedFilterStore:e.appliedFilterStore}),this._sourceProviderService=t.pageContext.getService("ISourceProviderService"),this.state={branches:{},repositories:[],identities:{},initialized:!1},this.statusSelection=new $.DropdownMultiSelection,this.repositorySelection=new $.DropdownMultiSelection,this.branchesSelection=new $.DropdownMultiSelection,this.identitySelection=new $.DropdownMultiSelection,this.tagsSelection=new $.DropdownMultiSelection,this.requestedForListItems=new p.ObservableArray,this.repositoryListItems=new p.ObservableArray,this.branchesListItems=new p.ObservableArray,this.tagsListItems=new p.ObservableArray,this.previousRepoFilter=e.appliedFilterStore.filter.getFilterItemState(qe.RunFilterKeys.RepositoryFilter),this._isFixFlashingRunsPageWhenNewBranchesLoadingFeatureEnabled=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.FixFlashingRunsPageWhenNewBranchesLoading",!1),this._isFixRunFilterRequestedForUndefinedIssueEnabled=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.FixRunFilterRequestedForUndefinedIssue",!1)}componentDidMount(){super.componentDidMount(),this._getRepositoryFilterUpdate=this.timerManagement.debounce(this._getRepositoryFilterUpdate,300),this._getBranchFilterUpdate=this.timerManagement.debounce(this._getBranchFilterUpdate,300),this._dataStore.addListener(this._onFilterStoreUpdated),this.props.appliedFilterStore.filter.subscribe(this.onFilterChanged,H.FILTER_CHANGE_EVENT),this._dataStore.updateFilter(!1)}componentWillUnmount(){super.componentWillUnmount(),this._dataStore.removeListener(this._onFilterStoreUpdated),this.props.appliedFilterStore.filter.unsubscribe(this.onFilterChanged,H.FILTER_CHANGE_EVENT)}render(){var e;return this._dataStore.setNewBranches(null!==(e=this.props.newBranches)&&void 0!==e?e:[]),r.createElement("div",{className:"page-content-left page-content-right page-content-top"},r.createElement(de.FilterBar,{filter:this.props.appliedFilterStore.filter},r.createElement(O.KeywordFilterBarItem,{filterItemKey:qe.RunFilterKeys.KeywordFilter,placeholder:Ve.KeywordFilterPlaceholderText,throttleWait:800}),r.createElement(M.DropdownFilterBarItem,{filterItemKey:qe.RunFilterKeys.StatusFilter,items:this._stateFilterItems,containerClassName:"status-dropdown",placeholder:Ve.State,selection:this.statusSelection}),this.state.repositories.length>0&&r.createElement(M.DropdownFilterBarItem,{filterItemKey:qe.RunFilterKeys.RepositoryFilter,actions:this._getRepositoryFilterActions(),items:this.repositoryListItems,disabled:1===this.state.repositories.length,placeholder:Ve.RepositoryPlaceholderText,selection:this.repositorySelection,showFilterBox:!0,filteredNoResultsText:Ve.NoResultsFound,renderCallout:e=>r.createElement(M.DropdownCallout,Object.assign({},e,{onFilterTextChanged:(t,i)=>{e.onFilterTextChanged&&e.onFilterTextChanged(t,i),this._getRepositoryFilterUpdate(t,i)}}))}),this.state.repositories.length>0&&Object.keys(this.state.branches).length>0&&r.createElement(M.DropdownFilterBarItem,{filterItemKey:qe.RunFilterKeys.BranchFilter,items:this.branchesListItems,renderItem:(e,t,i,s)=>this._renderBranchListItem(e,t,i,s),placeholder:Ve.BranchPlaceholderText,selection:this.branchesSelection,showFilterBox:!0,filteredNoResultsText:Ve.NoResultsFound,renderCallout:e=>r.createElement(M.DropdownCallout,Object.assign({},e,{onFilterTextChanged:(t,i)=>{e.onFilterTextChanged&&e.onFilterTextChanged(t,i),this._getBranchFilterUpdate(t,i)}}))}),r.createElement(M.DropdownFilterBarItem,{filterItemKey:qe.RunFilterKeys.RequestedForFilter,items:this.requestedForListItems,renderItem:(e,t,i,s)=>this._renderRequestedForListItem(e,t,i,s),placeholder:Ve.RequestedFor,selection:this.identitySelection,showFilterBox:!0,filteredNoResultsText:Ve.NoResultsFound,renderCallout:e=>r.createElement(M.DropdownCallout,Object.assign({},e,{onFilterTextChanged:(t,i)=>{this._onFilterRequestedFor(t,i),e.onFilterTextChanged&&e.onFilterTextChanged(t,i)}}))}),r.createElement(M.DropdownFilterBarItem,{filterItemKey:qe.RunFilterKeys.TagFilter,items:this.tagsListItems,containerClassName:"status-dropdown",placeholder:Ve.Tags,selection:this.tagsSelection,showFilterBox:!0,noItemsText:Ve.NoTagsAvailable})))}_getBranchFilter(e){const t=e.map((e=>this._getBranchStates(e))).reduce(((e,t)=>(t.forEach((t=>{const i=t.prettyName;e[i]?(e[i].ids=e[i].ids.concat(t.ids),e[i].isDefault=e[i].isDefault||t.isDefault,e[i].isFavorite=e[i].isFavorite||t.isFavorite):e[i]=t})),e)),{});return Object.keys(t).reduce(((e,i)=>{const s=t[i];return e[s.ids.join()]=s,e}),{})}_getBranchStates(e){const t=e.branches,i=this._sourceProviderService.getSourceProvider(e.type);return t?t.reduce(((e,t)=>(e.push({fullName:t.name,prettyName:i?i.getBranchText(t.name):t.name,icon:i?i.getBranchIconName(t.name):"OpenSource",isDefault:t.isDefault,isFavorite:t.isFavorite,ids:[t.id]}),e)),[]):[]}_renderRequestedForListItem(e,t,i,s){return r.createElement("td",{key:e,className:"bolt-list-cell-child flex-center bolt-list-cell-text identity-item"},r.createElement("span",{className:"history-filterbar-persona-container"},r.createElement(ue.VssPersona,{size:"small",identityDetailsProvider:{getIdentityImageUrl:e=>s.data.imageUrl,getDisplayName:()=>s.data.displayName}}),r.createElement("span",{className:"history-filterbar-persona-name text-ellipsis"},s.text)))}_toIdentityLookup(e){return e.reduce(((e,t)=>(e[t.id]=t,e)),{})}}t[e].RunsFilterBar=i}("TabsRunsRunsFilterBar"),function(e){pt=t[e]={};function i(e,t){const i=new Map,s=new Map,r=new Map;for(const t of e)i.set(t.id,t),s.set(t.refName,t.id),r.set(t.id,[]);for(const[e,i]of Object.entries(t)){const t=i.map((e=>s.get(e))).filter((e=>!!e));r.set(e,t)}let n=[];const a=[],o=new Set,l=new Set,d=t=>{if(o.has(t))return;if(l.has(t))throw new Error(`Circular dependency detected at stage: ${t}`);l.add(t);const s=r.get(t)||[];for(const e of s)d(e);l.delete(t),o.add(t);const c=i.get(t);c&&(n.push(c),a.push(e.indexOf(c)))};for(const t of e)o.has(t.id)||d(t.id);return n}function s(e,t,i,s,n,a,l,d,c){const u=d.getService("IVssLayoutManager"),h=(0,o.format)(Ve.StagesHidden,e.length);let p=(0,o.format)(Ve.StagesHidden,e.length);const g=e.find((e=>{var t;return null===(t=e.stateData)||void 0===t?void 0:t.pendingChecks})),m=e.find((e=>2===e.state&&2===e.result));let f;return g?f=(0,k.getTimelineStatusIndicatorData)(0,void 0,!0):m&&(f=(0,k.getTimelineStatusIndicatorData)(2,2)),f&&(p+=f.label),{status:f&&f.statusProps,hiddenStageCount:e.length,tooltip:h,ariaLabel:p,onClick:()=>{u.renderCallout((e=>r.createElement(re.CommandComponent,{commandType:"ciStagesComponent",stages:t,pageContext:d,onDismiss:e,buildId:i,buildNumber:s,pipelineName:n,canQueueBuild:c,appendCommitMessageToRunName:a,sourceVersionMessage:l},null)))}}}function n(e,t,i,s,r){var n;const l=(0,k.getTimelineStatusIndicatorData)(e.state,e.result,e.stateData?e.stateData.pendingChecks:void 0,e.stateData?!e.stateData.pendingDependencies:void 0);let d="",c="";if(2===e.state&&e.finishTime&&e.startTime){d=a(Math.abs(e.finishTime.getTime()-e.startTime.getTime())),c=h.duration(e.startTime,e.finishTime)}let u="",p="";e.name&&"__default"!=e.name&&(u+=e.name+": ",p+=e.name+" "),u+=l.label,p+=l.label,d&&(u+=" ("+d+")"),c&&(p+=" "+c);const g={};g[B.NavConstants.stage]=e.id;const m=r.getBuildUrl(t,B.NavConstants.logs,void 0,void 0,g);if(e.id==o.EmptyGuidString)return u+=" ("+Ve.NoStagesFound+")",{status:l.statusProps,tooltip:u,ariaLabel:p};const f=(0,A.getTFSPageData)(s),b=null===(n=null==f?void 0:f.project)||void 0===n?void 0:n.id;return{status:l.statusProps,tooltip:u,href:m,telemetrySource:B.TelemetryConstants.RunsOverviewLogs,telemetryProperties:{ProjectId:b,BuildId:t,DefinitionName:i},ariaLabel:p}}function a(e){const t=(0,he.getDurationStats)(e);let i="";return t.days>0?i=(0,o.format)("{0}:{1}:{2}:{3}",(0,he.padZeroes)(t.days),(0,he.padZeroes)(t.hours),(0,he.padZeroes)(t.minutes),(0,he.padZeroes)(t.seconds)):t.hours>0?i=(0,o.format)("{0}:{1}:{2}",(0,he.padZeroes)(t.hours),(0,he.padZeroes)(t.minutes),(0,he.padZeroes)(t.seconds)):t.minutes>0?i=(0,o.format)("{0}:{1}",(0,he.padZeroes)(t.minutes),(0,he.padZeroes)(t.seconds)):t.seconds>0&&(i=(0,o.format)("00:{0}",(0,he.padZeroes)(t.seconds))),i}t[e].RunsTableStages=e=>{const t=(0,ee.isFeatureFlagEnabled)(e.pageContext,"Pipelines.SortJobsListAndLogsView",!1),a=(0,r.useRef)(null),o=l(e.pageContext,a,e.stages.length,e.defaultVisibleStagesCount),c=t?i(e.stages.sort(((e,t)=>e.order-t.order)),e.stageDependencies):e.stages.sort(((e,t)=>e.order-t.order)),u=d(c),h=e.pageContext.getService("IBuildLinkingService");let p=c,g=[];e.stages.length>o&&(p=c.slice(0,o),g=c.slice(o,e.stages.length));const m=[],f=[],b=p.map((t=>n(t,e.buildId,e.pipelineName,e.pageContext,h)));return g.length>0&&b.push(s(g,u,e.buildId,e.buildNumber,e.pipelineName,e.appendCommitMessageToRunName,e.sourceVersionMessage,e.pageContext,e.canQueueBuild)),f.push(b),m.push(f),r.createElement("div",{ref:a,className:"stage-cell"},r.createElement(ze.StageGraph,{stages:m,size:"16"}))},t[e].sortStageList=i,t[e].getMultiStageNode=s,t[e].getStageNode=n,t[e].getDurationText=a;const l=(e,t,i,s)=>{let n=i;(0,ee.isFeatureFlagEnabled)(e,"Pipelines.SetPipelineRunsDefaultStagesShownToZero",!1)&&(n=0);const[a,o]=(0,r.useState)(n),l=(0,r.useRef)({maxVisibleStageCount:0});l.current.maxVisibleStageCount=a;const d=()=>{const e=null===(r=t.current)||void 0===r?void 0:r.offsetWidth;var r;const n=(0,ze.calculateVisibleStageCount)(i,e,s);n!==l.current.maxVisibleStageCount&&o(n)};return(0,r.useEffect)((()=>{if(t.current)return d(),window.ResizeObserver?(()=>{if(!t.current)return;const e=new ResizeObserver(d);return e.observe(t.current),()=>{t.current&&e.unobserve(t.current)}})():(window.addEventListener("resize",d),()=>window.removeEventListener("resize",d))}),[t]),a},d=e=>{const t=(0,r.useRef)(new p.ObservableArray([...e]));return(0,r.useEffect)((()=>{t.current.splice(0,t.current.length,...e)}),[e]),t.current}}("TabsRunsRunsTableStages"),function(e){gt=t[e]={};class i extends N.Store{constructor(e){super(),this._branches=[],this._runs=[],this._isLoading=!0,this._runsWithUpdates=[],this._newRuns=[],this._deletedRuns=[],this._initialRouteValues={},this._repositoryToProjectNameMap={},this._dataParser=e=>e,this._getNewBranches=()=>{this._runs.forEach((e=>{this._branches.push({branchName:e.run.sourceBranch,repositoryId:e.run.repository.id})})),this._branches=this._branches.filter(((e,t)=>this._branches.findIndex((t=>t.repositoryId==e.repositoryId&&t.branchName==e.branchName))===t)),this._getBranchesOnNewRun&&this._getBranchesOnNewRun(this._branches)},this._populateInitialRoutes=e=>{const t=e.getService("IVssHistoryService"),i=t.getState()[qe.RunFilterKeys.RepositoryFilter],s=t.getState()[qe.RunFilterKeys.BranchFilter],r=t.getState()[qe.RunFilterKeys.KeywordFilter],n=t.getState()[qe.RunFilterKeys.RequestedForFilter],a=t.getState()[qe.RunFilterKeys.ResultFilter],o=t.getState()[qe.RunFilterKeys.StatusFilter],l=t.getState()[qe.RunFilterKeys.TagFilter];this._initialRouteValues[qe.RunFilterKeys.RepositoryFilter]=i,this._initialRouteValues[qe.RunFilterKeys.BranchFilter]=s,this._initialRouteValues[qe.RunFilterKeys.KeywordFilter]=r,this._initialRouteValues[qe.RunFilterKeys.RequestedForFilter]=n,this._initialRouteValues[qe.RunFilterKeys.ResultFilter]=a,this._initialRouteValues[qe.RunFilterKeys.StatusFilter]=o,this._initialRouteValues[qe.RunFilterKeys.TagFilter]=null==l?void 0:l.split(",").map((e=>decodeURIComponent(e))).join()},this._triggerRunsUpdateBatch=()=>{if(this._runsWithUpdates.length>0){const e={buildIds:this._runsWithUpdates.join(",")};this._runsWithUpdates=[],this._contributionActionCreator.fetchContributionData("ms.vss-build-web.runs-data-provider",e,!0,this._onUpdatedRunsAvailable)}},this._onFiltersUpdated=()=>{this._appliedFilterStore.hasAppliedFilters()&&this._appliedFilterStore.doFiltersMatch(this._initialRouteValues,!0)||(this._initialRouteValues={},this.fetchData(!0))},this._onDataAvailable=(e,t)=>{this._appliedFilterStore.doFiltersMatch(t||{},!1)&&(this._newRuns=[],this._isLoading=!1,this._runs=e.runs||[],this._repositoryToProjectNameMap=this._mapRepositoriesToProjectNames(),this._continuationToken=e.continuationToken||void 0,this._getNewBranches(),this.emitChanged())},this._onMoreRunsAvailable=(e,t)=>{this._isLoading=!1,this._runs=this._runs.concat(e.runs),this._repositoryToProjectNameMap=this._mapRepositoriesToProjectNames(),this._continuationToken=e.continuationToken||void 0,this._getNewBranches(),this.emitChanged()},this._buildUpdated=e=>{this._definitionId&&e.definitionId!=this._definitionId||this._definitionScope&&e.definitionScope!=this._definitionScope||(this._runs.filter((t=>t.run&&t.run.id===e.buildId)).length>0?this._runsWithUpdates.indexOf(e.buildId)<0&&(this._runsWithUpdates.push(e.buildId),this._triggerRunsUpdateBatch()):!this._deletedRuns.filter((t=>t===e.buildId)).length&&!this._appliedFilterStore.hasAppliedFilters()&&this._newRuns.length<qe.MaxUpdates&&this._newRuns.indexOf(e.buildId)<0&&(this._newRuns.push(e.buildId),this.emitChanged()))},this._onUpdatedRunsAvailable=e=>{if(e&&e.runs&&e.runs.length>0){const t={};this._runs.forEach(((e,i)=>{e.run&&(t[e.run.id]=i)})),e.runs.forEach((e=>{if(e.run){const i=t[e.run.id];void 0!==i&&(this._runs[i]=e)}})),this.emitChanged()}},this._updateStages=e=>{let t=this.getLoadedRunsId();e&&e.buildId&&e.stageUpdates&&t.find((t=>t===e.buildId))&&this._updateRuns(e.buildId.toString())},this._updateRuns=e=>{this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.runs-data-provider",{buildIds:e},!0).then((e=>{var t;let i=!1;null===(t=null==e?void 0:e.runs)||void 0===t||t.forEach((e=>{const t=this._runs.findIndex((t=>!!t.run&&t.run.id==e.run.id));if(-1!=t){this._runs[t]=e,i=!0;this._runs[t].stages.every((e=>2!==e.state))&&this._runs[t].run&&!this._runs[t].run.finishTime&&(this._runs[t].run.finishTime=new Date)}})),i&&this.emitChanged()}))},this._appliedFilterStore=e.appliedFilterStore,this._definitionId=e.definitionId,this._definitionScope=e.definitionScope,this._signalRActionHub=e.signalRActionHub,this._signalRActionHub.stagesUpdated.addListener(this._updateStages),this._signalRActionHub.buildUpdated.addListener(this._buildUpdated),this._getBranchesOnNewRun=e.getBranchesOnNewRun,this._contributionActionCreator=new w.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:e.contributionActionHub,dataParser:this._dataParser}),this._appliedFilterStore.addListener(this._onFiltersUpdated),this._timerManagement=new D.TimerManagement,this._triggerRunsUpdateBatch=this._timerManagement.debounce(this._triggerRunsUpdateBatch,qe.BatchingDelayInMs),this._sourceProviderService=e.pageContext.getService("ISourceProviderService");const t=new E.ContributionSource({pageContext:e.pageContext}).getData("ms.vss-build-web.runs-data-provider");t&&(this._isLoading=!1,this._runs=t.runs||[],this._repositoryToProjectNameMap=this._mapRepositoriesToProjectNames(),this._continuationToken=t.continuationToken||void 0,this._getNewBranches()),this._buildClient=e.pageContext.getRestClient("IBuildRestClient"),this._pageContext=e.pageContext;const i=(0,A.getTFSPageData)(e.pageContext);i&&i.project&&(this._projectId=i.project.id);const s=e.pageContext.getService("IVssPageService").getData();s&&(this._userId=s.user.id),this._identityService=e.pageContext.getService("IVssIdentityService"),this._populateInitialRoutes(e.pageContext),this._populateAppliedFiltersFromInitialRouteValues()}dispose(){super.dispose(),this._signalRActionHub.stagesUpdated.removeListener(this._updateStages),this._signalRActionHub.buildUpdated.removeListener(this._buildUpdated)}fetchData(e=!1){if(e){this._runs=[],this._runsWithUpdates=[],this._newRuns=[],this._continuationToken="",this._isLoading=!0;let t={};this._appliedFilterStore.hasAppliedFilters()&&(t=this._appliedFilterStore.addFilterRoutes(t)),e&&this._definitionId&&(t.definitionId=this._definitionId.toString()),this._definitionScope&&(t.definitionScope=this._definitionScope),this._contributionActionCreator.fetchContributionData("ms.vss-build-web.runs-data-provider",t,e,this._onDataAvailable),this.emitChanged()}}_populateAppliedFiltersFromInitialRouteValues(){if(!this._appliedFilterStore.hasAppliedFilters()&&0!=Object.keys(this._initialRouteValues).length){var e={repository:this._initialRouteValues[qe.RunFilterKeys.RepositoryFilter],branch:this._initialRouteValues[qe.RunFilterKeys.BranchFilter],keywords:this._initialRouteValues[qe.RunFilterKeys.KeywordFilter],requestedFor:this._initialRouteValues[qe.RunFilterKeys.RequestedForFilter],result:this._initialRouteValues[qe.RunFilterKeys.ResultFilter],status:this._initialRouteValues[qe.RunFilterKeys.StatusFilter],tags:this._initialRouteValues[qe.RunFilterKeys.TagFilter]};for(const[t,i]of Object.entries(e))void 0!==i&&this._appliedFilterStore.filter.setFilterItemState(t,{value:i});this._appliedFilterStore.filter.applyChanges(),this.emitChanged()}}fetchMoreRuns(){if(!this._isLoading&&this._continuationToken){let e={continuationToken:this._continuationToken};this._definitionId&&(e.definitionId=this._definitionId.toString()),this._definitionScope&&(e.definitionScope=this._definitionScope),this._appliedFilterStore.hasAppliedFilters()&&(e=this._appliedFilterStore.addFilterRoutes(e)),this._isLoading=!0,this._contributionActionCreator.fetchContributionData("ms.vss-build-web.runs-data-provider",e,!0,this._onMoreRunsAvailable),this.emitChanged()}}getRunData(){return this._runs}getProjectNamePromise(e){return this._repositoryToProjectNameMap[e]||new Promise((()=>null))}hasMore(){return!!this._continuationToken}isLoading(){return this._isLoading}getNewRunsCount(){return this._newRuns.length}cancelRun(e){this._buildClient.updateBuild({status:4},this._projectId,e).then((()=>{}),s.handleError)}deleteRun(e){this._buildClient.deleteBuild(this._projectId,e).then((()=>{this._deletedRuns.push(e);const t=this._runs.findIndex((t=>t.run.id===e));t>=0&&(this._runs.splice(t,1),this.emitChanged())}),s.handleError)}retainRun(e,t){if(this._userId){const i="User:"+this._userId;this._buildClient.addRetentionLeases([{definitionId:e,runId:t,ownerId:i,daysValid:365e3,protectPipeline:!1}],this._projectId).then((e=>{if(e&&1===e.length){const i=this._runs.findIndex((e=>e.run.id===t));if(i>=0){const t=this._identityService.getIdentityDetails(this._userId);this._runs[i].run.retentionLeases.push({id:e[0].leaseId,validUntil:e[0].validUntil,leaseType:"User",ownerDisplayName:t.displayName,leaseOwnerIdentityRef:{id:this._userId,displayName:t.displayName,imageUrl:t.imageUrl}}),this.emitChanged()}}}),s.handleError)}}stopRetainingRun(e,t){if(this._userId){const i="User:"+this._userId;this._buildClient.getRetentionLeasesByOwnerId(this._projectId,i,e,t).then((e=>{const i=[];e.forEach((e=>{i.push(e.leaseId)})),this.deleteRetentionLeases(t,i)}),s.handleError)}}deleteRetentionLeases(e,t){t.length>0&&this._buildClient.deleteRetentionLeasesById(this._projectId,t).then((()=>{const i=this._runs.findIndex((t=>t.run.id===e));i>=0&&(t.forEach((e=>{const t=this._runs[i].run.retentionLeases.findIndex((t=>t.id===e));this._runs[i].run.retentionLeases.splice(t,1)})),this.emitChanged())}),s.handleError)}_fixRecordSerialization(e){let t=e.startTime;"string"==typeof e.startTime&&(t=new Date(e.startTime));let i=e.finishTime;"string"==typeof e.finishTime&&(i=new Date(e.finishTime));let s=e.state;if("string"==typeof e.state)switch(e.state.toLowerCase()){case"pending":s=0;break;case"inprogress":s=1;break;case"completed":s=2}let r=e.result;if("string"==typeof e.result)switch(e.result.toLowerCase()){case"succeeded":r=0;break;case"succeededwithissues":r=1;break;case"failed":r=2;break;case"canceled":r=3;break;case"skipped":r=4;break;case"abandoned":r=5}return{id:e.id,startTime:t,finishTime:i,state:s,result:r}}getLoadedRunsId(){return this._runs.map((e=>e.run.id))}_mapRepositoriesToProjectNames(){if(this._runs){const e={};return this._runs.forEach((t=>{const i=t.run.repository;if(!e[i.id]){const t=this._sourceProviderService.getSourceProvider(i.type);e[i.id]=t.getProjectName(i.id)}const s=t.run.triggeringRepository;if(s&&!e[s.id]){const t=this._sourceProviderService.getSourceProvider(s.type);e[s.id]=t.getProjectName(s.id)}})),e}return{}}}t[e].RunsStore=i}("TabsRunsStoresRunsStore"),function(e){mt=t[e]={};class i extends N.Store{constructor(e){super(),this._dataParser=e=>e,this._onInitialDataAvailable=(e,t)=>{this._pipelines=e.pipelines,this._loadingData=!1,this.emitChanged()},this._onQueryDataAvailable=(e,t)=>{let i;t&&t.query&&(i=t.query);const s=this._filter.getFilterItemState(qe.PipelineFilterKeys.NameFilter);i&&null!==s&&i===s.value&&(this._filteredPipelines=e.pipelines,this._loadingData=!1,this.emitChanged())},this._onUpdatedRunsAvailable=(e,t)=>{e.updatedRuns&&e.updatedRuns.forEach((e=>{this._pipelines.forEach((t=>{t.latestRun&&e.id===t.latestRun.id&&(t.latestRun.status=e.status,t.latestRun.result=e.result,t.latestRun.startTime=e.startTime,t.latestRun.finishTime=e.finishTime,t.latestRun.number=e.number)})),this._filteredPipelines&&this._filteredPipelines.forEach((t=>{t.latestRun&&e.id===t.latestRun.id&&(t.latestRun.status=e.status,t.latestRun.result=e.result,t.latestRun.startTime=e.startTime,t.latestRun.finishTime=e.finishTime,t.latestRun.number=e.number)})),this.emitChanged()}))},this._onDefinitionFavorited=e=>{if(this._pipelines&&this._pipelines.length>0){let t=!1;this._pipelines.forEach((i=>{e.definition.id===i.id&&(i.isFavorite=!0,t=!0)})),this._filteredPipelines&&this._filteredPipelines.forEach((i=>{e.definition.id===i.id&&(i.isFavorite=!0,t=!0)})),t&&this.emitChanged()}},this._onDefinitionUnfavorited=e=>{if(this._pipelines&&this._pipelines.length>0){let t=!1;this._pipelines.forEach((i=>{e.definition.id===i.id&&(i.isFavorite=!1,t=!0)})),this._filteredPipelines&&this._filteredPipelines.forEach((i=>{e.definition.id===i.id&&(i.isFavorite=!1,t=!0)})),t&&this.emitChanged()}},this._onFilterChanged=(e,t)=>{if("filter-applied"===t){const t=e[qe.PipelineFilterKeys.NameFilter];this._filterPipelines(t?t.value:"")}},this._filterPipelines=e=>{if(e&&""!==e)this._loadingData=!0,this._contributionActionCreator.fetchContributionData("ms.vss-build-web.pipelines-data-provider",{query:e,rootPath:this._rootFolder},!0,this._onQueryDataAvailable);else if(this._loadingData=!1,!this._pipelines){this._loadingData=!0;const e={option:"recent"};this._contributionActionCreator.fetchContributionData("ms.vss-build-web.pipelines-data-provider",e,!0,this._onInitialDataAvailable)}this.emitChanged()},this._buildUpdated=e=>{if(this._pipelines&&this._pipelines.length>0){let t=!1;this._pipelines.forEach((i=>{e.definitionId===i.id&&i.latestRun&&e.buildId===i.latestRun.id&&(t=!0)})),!t&&this._filteredPipelines&&this._filteredPipelines.forEach((i=>{e.definitionId===i.id&&i.latestRun&&e.buildId===i.latestRun.id&&(t=!0)})),t&&this._getUpdatedRun(e.definitionId,e.buildId)}},this._updateStages=e=>{if(this._pipelines&&this._pipelines.length>0&&e&&e.buildId&&e.stageUpdates){const t=this._pipelines.find((t=>t.latestRun&&t.latestRun.id===e.buildId));!t||32!==t.latestRun.status&&1!==t.latestRun.status||this._getUpdatedRun(t.id,e.buildId)}},this._getUpdatedRun=(e,t)=>{-1===this._runsToUpdate.indexOf(t)&&this._runsToUpdate.push(t),null==this._updateTimeout&&(this._updateTimeout=setTimeout(this._fetchUpdatedRuns,i.s_batchingDelayInMs))},this._fetchUpdatedRuns=()=>{const e=this._runsToUpdate;this._runsToUpdate=[],this._updateTimeout=void 0,e.length>0&&this._contributionActionCreator.fetchContributionData("ms.vss-build-web.pipelines-data-provider",{runIds:e.join(",")},!0,this._onUpdatedRunsAvailable)},this._pageContext=e.pageContext,this._favoritesActionHub=e.favoritesActionHub,this._signalRActionHub=e.signalRActionHub,this._filter=e.pipelinesFilter,this._loadingData=!1,this._runsToUpdate=[],this._updateTimeout=void 0,this._rootFolder=e.rootFolder,this._contributionActionCreator=new w.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:e.contributionActionHub,dataParser:this._dataParser}),this._favoritesActionHub.favoriteDefinition.addListener(this._onDefinitionFavorited),this._favoritesActionHub.unfavoriteDefinition.addListener(this._onDefinitionUnfavorited),this._signalRActionHub.buildUpdated.addListener(this._buildUpdated),this._signalRActionHub.stagesUpdated.addListener(this._updateStages),this._source=new E.ContributionSource({pageContext:this._pageContext});let t=this._source.getSharedData("pipelinesSharedData");if(this._hasPipelines=!!t&&t.hasPipelines,this._hasUserDefinedFolders=!!t&&t.hasUserDefinedFolders,this._hasDeletedPipelines=void 0,this.isListFiltered()){const e=this._source.getData("ms.vss-build-web.pipelines-data-provider");e&&(this._filteredPipelines=e.pipelines)}else if(!e.ignoreInitialData){const e=this._source.getData("ms.vss-build-web.pipelines-data-provider");e&&(this._pipelines=e.pipelines)}this._filter.subscribe(this._onFilterChanged)}dispose(){super.dispose(),this._runsToUpdate=[],null!=this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=void 0),this._favoritesActionHub.favoriteDefinition.removeListener(this._onDefinitionFavorited),this._favoritesActionHub.unfavoriteDefinition.removeListener(this._onDefinitionUnfavorited),this._signalRActionHub.buildUpdated.removeListener(this._buildUpdated),this._signalRActionHub.stagesUpdated.removeListener(this._updateStages)}fetchData(e=!1){if(e||!this._pipelines)if(this.isListFiltered())this._filterPipelines(this._filter.getFilterItemValue(qe.PipelineFilterKeys.NameFilter)||"");else{this._loadingData=!0;const t={option:"recent"};this._contributionActionCreator.fetchContributionData("ms.vss-build-web.pipelines-data-provider",t,e,this._onInitialDataAvailable)}this.fetchHasDeletedPipelines()}fetchHasDeletedPipelines(e=!1){if(e||void 0===this._hasDeletedPipelines){const e={existenceCheck:"true"};this._pageContext.getService("IVssContributionService").getDataAsync("ms.vss-build-web.deleted-pipelines-data-provider",e,!0).then((e=>{const t=this._hasDeletedPipelines;e.pipelines&&e.pipelines.length>0?this._hasDeletedPipelines=!0:this._hasDeletedPipelines=!1,t!==this._hasDeletedPipelines&&this.emitChanged()}))}}fetchSharedData(){this._source.getDataAsync("ms.vss-build-web.pipelines-data-provider",void 0,!0).then((e=>{let t=this._source.getSharedData("pipelinesSharedData");this._hasPipelines=!!t&&t.hasPipelines,this._hasUserDefinedFolders=!!t&&t.hasUserDefinedFolders,this.emitChanged()}))}hasPipelines(){return!!this._hasPipelines}hasUserDefinedFolders(){return!!this._hasUserDefinedFolders}hasDeletedPipelines(){return void 0!==this._hasDeletedPipelines&&this._hasDeletedPipelines}getPipelines(){return this.isListFiltered()?this._filteredPipelines?this._filteredPipelines:[]:this._pipelines?this._pipelines:[]}isListFiltered(){const e=this._filter.getFilterItemValue(qe.PipelineFilterKeys.NameFilter);return!(!e||""==e)}isLoadingData(){return this._loadingData}updatePipelineNameAndPath(e,t,i){this._pipelines&&this._pipelines.forEach((s=>{s.id===e&&(s.name=t,s.path=i)})),this._filteredPipelines&&this._filteredPipelines.forEach((s=>{s.id===e&&(s.name=t,s.path=i)})),this.emitChanged()}removePipeline(e){if(this._pipelines){const t=this._pipelines.findIndex((t=>t.id===e));t>=0&&this._pipelines.splice(t,1)}if(this._filteredPipelines){const t=this._filteredPipelines.findIndex((t=>t.id===e));t>=0&&this._filteredPipelines.splice(t,1)}this.emitChanged()}}t[e].PipelinesStore=i,i.s_batchingDelayInMs=6e3}("PipelinesStore"),function(e){ft=t[e]={},t[e].getInternalPipelineData=function(e){return e.getPipelines().map((e=>({id:e.id,isDraft:e.isDraft,isFavorite:e.isFavorite,latestRun:e.latestRun,href:e.linkProps.href,name:e.name,path:e.path,processType:e.processType,queueStatus:e.queueStatus,uri:e.uri})))},t[e].getInternalRunsListItemData=function(e){return e.getRunData().map((e=>({href:e.linkProps.href,run:e.run,sourceVersionMessage:e.sourceVersionMessage,stages:e.stages,stageDependencies:e.stageDependencies})))}}("ToolsDataShapeTools"),function(e){bt=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._tableBreakpoints=[{breakpoint:1,columnWidths:[-300,0,0,0]},{breakpoint:600,columnWidths:[0,-70,-30,156]},{breakpoint:1024,columnWidths:[0,-60,-50,156]},{breakpoint:1366,columnWidths:[0,-50,-50,156]}],this._getTableBreakpoints=()=>this._tableBreakpoints,this._getTableColumns=()=>this._columns,this._renderDescriptionNonMobileCell=(e,t,i,s)=>this._renderDescriptionCell(e,t,i,s),this._renderDescriptionMobileCell=(e,t,i,s)=>this._renderDescriptionCell(e,t,i,s,!1),this._renderDescriptionCell=(e,t,i,s,n=!0)=>{const a=s.run;if(a){let e;a.triggeringRepository?(e=a.triggeringRepository,(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.GitHubProximaInstallationFlowEnabled",!1)&&(0,me.isProximaRepository)(this.context.pageContext,{repositoryName:e.name,repositoryUrl:e.url})&&(e.connectionId=e.url)):e={id:a.repository.id,name:a.repository.name,alias:"self",connectionId:a.repository.url,refName:a.sourceBranch,version:a.sourceVersion,type:a.repository.type,projectId:"",projectName:"",url:""};let l=e.refName,d=e.version;(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.SelectTriggeringRepositoriesBasedOnSHA")&&256==a.reason&&(l=a.sourceBranch,d=a.sourceVersion);const h=r.createElement(c.Icon,{iconName:We.getReasonIcon(a.reason),className:"icon-margin"}),p=a.buildNumber?"#"+a.buildNumber+" ":"",g=(0,L.formatPipelineRunName)(a.buildNumber,s.sourceVersionMessage,a.appendCommitMessageToRunName),m=a.definition&&a.definition.name?(0,o.format)(Ve.OnDefinition,a.definition.name):"",f=this._store.getProjectNamePromise(e.id),b=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.RunArtifacts",!1)&&a.artifactName&&a.artifactProducerId&&a.artifactProducerProjectId&&r.createElement(pe.PipelineRunLink,{className:"pipelines-run-artifact-link",linkText:a.artifactName,runId:a.artifactProducerId,projectId:a.artifactProducerProjectId,c_TelemetrySource:"RunsTable"}),S=this.state.multiRepo&&r.createElement(q.RepoLink,{sourceRepositoryId:e.id,sourceRepositoryName:e.name,sourceRepositoryType:e.type,sourceRepositoryUrl:e.connectionId}),_=r.createElement(j.BranchLink,{repositoryType:e.type,repositoryName:e.name,repositoryId:e.id,repositoryUrl:e.connectionId,branch:l,monospace:!0,readonly:!n,projectNamePromise:f}),C=!b&&r.createElement(z.CommitLink,{repositoryName:e.name,repositoryId:e.id,repositoryType:e.type,commitId:d,monospace:!0,readonly:!n,projectNamePromise:f,repositoryUrl:e.connectionId}),y=a.retentionLeases&&a.retentionLeases.length>0?r.createElement(c.Icon,{iconName:"Pinned",ariaLabel:Ve.Retained,tooltipProps:{text:Ve.Retained}}):void 0;let T,I;a.requestedFor&&(I=this._identityService.getIdentityImageUrl(a.requestedFor),T=r.createElement("span",{className:"padding-left-4"},r.createElement(ue.VssPersona,{className:"v-align-middle",imageUrl:I,size:"extra-small"})));const P=r.createElement("span",{className:"text-ellipsis flex-row"},We.getReasonText(a.reason,!!I),T);let R,x;if(this.props.definitionId)R=r.createElement(v.Link,{className:"fontWeightSemiBold bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:s.href,tooltipProps:{overflowOnly:!0},onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,s.href,!0,e)}},g),x=r.createElement("span",{className:"fontSizeMS secondary-text flex-row flex-baseline text-ellipsis bolt-table-inline-link-left-padding pipeline-firefox-fix"},h,P,b,S,_,C,y);else{let e=s.sourceVersionMessage;e&&0!==e.length||(e=(0,o.format)(Ve.RunLabel,p)),R=r.createElement(v.Link,{className:"fontWeightSemiBold bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:s.href,tooltipProps:{overflowOnly:!0},onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,s.href,!0,e)}},e),x=r.createElement("span",{className:"fontSizeMS secondary-text flex-row flex-baseline text-ellipsis bolt-table-inline-link-left-padding pipeline-firefox-fix"},h,p,m,P,b,S,_,C,y)}let F={render:()=>this._renderBuildStatus(s)};return r.createElement(u.TwoLineTableCell,{className:"bolt-table-cell-content-with-inline-link no-v-padding",columnIndex:t,tableColumn:i,key:"col-"+t,iconProps:F,line1:R,line2:x})}return r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null))},this._renderStagesCell=(e,t,i,s)=>{const n=this.props.security.canQueueBuild({id:s.run.definition.id,path:s.run.definition.path});return s.run&&s.stages&&s.stages.length>0?r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement(pt.RunsTableStages,{key:"run-"+s.run.id,pageContext:this.context.pageContext,canQueueBuild:n,stages:s.stages,buildId:s.run.id,buildNumber:s.run.buildNumber,pipelineName:s.run.definition.name,appendCommitMessageToRunName:s.run.appendCommitMessageToRunName,sourceVersionMessage:s.sourceVersionMessage,signalR:this.props.signalRActionHub,defaultVisibleStagesCount:(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.SetPipelineRunsDefaultStagesShownToZero",!1)?0:void 0,stageDependencies:s.stageDependencies})):r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null))},this._renderBuildStatus=e=>{if(!e.run)return r.createElement(r.Fragment,null);const t=e.run,i=(0,k.getBuildStatusIndicatorData)(t.status,t.result);return r.createElement(x.Tooltip,{renderContent:()=>this._renderToolTip(t.status,t.result,e.stages,i.label)},r.createElement("div",{className:"flex-row"},r.createElement(R.Status,Object.assign({},i.statusProps,{className:"icon-large-margin",size:"16"}))))},this._renderTimesCell=(e,t,i,s)=>s.run?r.createElement(He.DateAndDuration,{queueTime:s.run.queueTime,startTime:s.run.startTime,finishTime:s.run.finishTime,key:"col-"+t,columnIndex:t,tableColumn:i}):r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null)),this._showMenuForItem=e=>{var t,i;if((null===(t=null==e?void 0:e.run)||void 0===t?void 0:t.definition)&&this.props.security.isMember()){const t=this.props.security.canDeleteBuild({id:e.run.definition.id,path:e.run.definition.path}),s=this.props.security.canRetainBuild({id:e.run.definition.id,path:e.run.definition.path});let r;return this.props.userId&&(r=this.props.security.canCancelBuildByUserId(this.props.userId,e.run.definition.id.toString(),e.run.definition.path,null===(i=e.run.requestedFor)||void 0===i?void 0:i.id,e.run.requestedById)),t||s||!!r}return!1},this._getMenuForItem=e=>{var t;const i=[],s=this.props.security.canDeleteBuild({id:e.run.definition.id,path:e.run.definition.path}),n=this.props.security.canRetainBuild({id:e.run.definition.id,path:e.run.definition.path});if(this.props.userId){this.props.security.canCancelBuildByUserId(this.props.userId,e.run.definition.id.toString(),e.run.definition.path,null===(t=e.run.requestedFor)||void 0===t?void 0:t.id,e.run.requestedById)&&2!=e.run.status&&i.push({text:Ve.Cancel,id:"run-action-cancel",onActivate:()=>{const t=(0,o.format)(Ve.ConfirmCancelRun,e.run.buildNumber);this._confirmAction(Ve.CancelRun,t,(()=>{this._store.cancelRun(e.run.id)}))}})}if(n){let t=!1;const s=this.context.pageContext.getService("IVssPageService").getData();s&&e.run.retentionLeases&&e.run.retentionLeases.forEach((e=>{e.leaseOwnerIdentityRef&&e.leaseOwnerIdentityRef.id===s.user.id&&(t=!0)})),t?i.push({text:Ve.StopRetainingRun,id:"run-action-retain",onActivate:()=>{this._store.stopRetainingRun(e.run.definition.id,e.run.id)},rank:10}):i.push({text:Ve.RetainRun,id:"run-action-retain",onActivate:()=>{this._store.retainRun(e.run.definition.id,e.run.id)},rank:10})}if(e.run.retentionLeases&&e.run.retentionLeases.length>0){const t=new p.ObservableArray(e.run.retentionLeases);i.push({text:Ve.ViewRetentionLeases,id:"run-action-view-retention",onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const s={canDeleteLeases:n,onDelete:i=>{this._store.deleteRetentionLeases(e.run.id,i),i.forEach((e=>{const i=t.value.findIndex((t=>t.id===e));t.splice(i,1)}))},onDismiss:i,retentionLeases:t};return r.createElement(ge.RetentionPanel,s)}))},rank:20})}!s||e.run.retentionLeases&&e.run.retentionLeases.length>0||i.push({text:Ve.Delete,id:"run-action-delete",onActivate:()=>{const t=(0,o.format)(Ve.ConfirmDeleteRun,e.run.buildNumber);this._confirmAction(Ve.DeleteRun,t,(()=>{this._store.deleteRun(e.run.id)}))},rank:30});const a=(0,fe.getMenuItems)(this.context.pageContext,"ms.vss-build-web.completed-build-menu",e.run);return i.push(...a.value),{id:"run-actions-menu",items:i}},this._confirmAction=(e,t,i)=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((s=>{const n={title:e,message:t,onClose:s,onConfirm:i};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciDConfirmPipelineComponent"},n),null)}))},this._onSize=(e,t,i,s)=>{s.width.value=i},this._setColumns=()=>{this._columns=[{id:"description-mobile",width:new p.ObservableValue(300),name:Ve.DescriptionHeader,className:"pipelines-cell",renderCell:this._renderDescriptionMobileCell,columnStyle:2},{id:"description",width:new p.ObservableValue(-60),name:Ve.DescriptionHeader,className:"pipelines-cell",onSize:this._onSize,renderCell:this._renderDescriptionNonMobileCell,columnStyle:2},{id:"stages",width:new p.ObservableValue(-40),name:Ve.StagesHeader,className:"pipelines-cell",onSize:this._onSize,renderCell:this._renderStagesCell},{ariaLabel:Ve.TimeAndDuration,id:"time",width:new p.ObservableValue(156),className:"pipelines-cell",renderCell:this._renderTimesCell},new u.ColumnMore(this._getMenuForItem,this._showMenuForItem)]},this._renderNewRunsRow=(e,t,i)=>{const s=this._store.getNewRunsCount(),n=s<qe.MaxUpdates?s.toString():s.toString()+"+",a=s>1?(0,o.format)(Ve.NewRuns,n):Ve.NewRun;return r.createElement(u.TableRow,{index:e,details:i,className:"runs-new-row"},r.createElement(u.SimpleTableCell,{className:"no-v-padding",columnIndex:1,colspan:5},r.createElement("div",{className:"runs-new-row-content"},a)))},this._renderLoadRow=(e,t)=>(this._store.fetchMoreRuns(),r.createElement(u.TableRow,{className:"bolt-list-row-loading",details:t,index:e},this._getTableColumns().map(((e,t)=>(0,u.TwoLineTableCell)({columnIndex:t,line1:(0,u.renderLoadingCell)(e.columnLayout),line2:(0,u.renderLoadingCell)(e.columnLayout)}))))),this._onActivateRow=(e,t)=>{const i=this.context.pageContext;t.data&&t.data.isNewRunsRow?this._store.fetchData(!0):t.data&&t.data.href&&(e.ctrlKey||e.metaKey?window.open(t.data.href,"_blank"):(0,U.onClickFPS)(i,t.data.href,!0,e))},this._onStoreChanged=()=>{let e=[];if(this._store.getNewRunsCount()&&e.push({isNewRunsRow:!0,renderRow:this._renderNewRunsRow}),e=e.concat((0,ft.getInternalRunsListItemData)(this._store).slice()),this._itemProvider.splice(0,this._itemProvider.length,...e),this._store.hasMore()){const e=new p.ObservableValue(void 0);this._itemProvider.push(e)}const t=this._isMultiRepo(e);this.setState({multiRepo:t});const i=e.length;i>0&&V.announce((0,o.format)(Ve.AnnounceFilterResults,i))},this._onZeroDataButtonClick=()=>{const e=this.context.pageContext.getRestClient("IBuildRestClient"),t=this.props.definitionId,i=(0,A.getTFSPageData)(this.context.pageContext),n=this.context.pageContext;if(t&&i&&i.project){const a=i.project.id;e.getDefinition(a,t).then((e=>{n.getService("IVssLayoutManager").renderCallout((t=>{const i={definition:e,repository:e.repository,processType:e.process.type,pageContext:n,project:e.project.id,source:"definitions",onSuccess:e=>{this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:(0,o.format)(Ve.RunQueued,e.buildNumber),level:3})},definitionVariables:e.variables,queue:e.queue,defaultSourceBranch:e.repository?e.repository.defaultBranch:void 0,onDismiss:t};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent"},i),null)}))}),s.handleError)}},this._store=new gt.RunsStore({pageContext:t.pageContext,contributionActionHub:new w.ContributionDataActionHub,appliedFilterStore:e.appliedFilterStore,definitionId:e.definitionId,definitionScope:e.definitionScope,signalRActionHub:e.signalRActionHub,getBranchesOnNewRun:e.getBranchesOnNewRun}),this._store.fetchData(!e.isPageLoad);const i=(0,ft.getInternalRunsListItemData)(this._store).slice();if(this._itemProvider=new p.ObservableArray(i),this._store.hasMore()){const e=new p.ObservableValue(void 0);this._itemProvider.push(e)}this._identityService=this.context.pageContext.getService("IVssIdentityService"),this._telemetryService=this.context.pageContext.getService("IVssTelemetryService"),this._setColumns();const n=this._isMultiRepo(i);this.state={multiRepo:n}}render(){if(0===this._itemProvider.length){if(this._store.isLoading())return r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement(T.Spinner,{className:"pipelines-filter-spinner",size:"large",label:Ve.Loading}));if(this.props.appliedFilterStore.hasAppliedFilters()||this.props.definitionScope){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png"),t=this.props.definitionScope?Ve.NoRunsFound:Ve.NoResultsFound;return V.announce(t),r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imageAltText:t,imagePath:e,secondaryText:t})))}if(this.props.definitionId&&this.props.canQueueBuild){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-runs.png");return V.announce(Ve.NoRunsGetStarted),r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imagePath:e,imageAltText:Ve.NoRunsGetStarted,secondaryText:Ve.NoRunsGetStarted,actionText:Ve.RunPipeline,actionType:0,onActionClick:this._onZeroDataButtonClick}))}{const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png");return V.announce(Ve.NoRunsFound),r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imagePath:e,imageAltText:Ve.NoRunsFound,secondaryText:Ve.NoRunsFound})))}}let e;return this.props.definitionId||this.props.definitionScope||(e=this.props.appliedFilterStore.hasAppliedFilters()?Ve.FilteredRunsView:Ve.RunsView),this.props.definitionScope&&(e=this.props.appliedFilterStore.hasAppliedFilters()?Ve.FilteredRunsView:(0,o.format)(Ve.RunsViewForFolder,this.props.definitionScope)),r.createElement("div",{className:"flex-column flex-grow",role:"alert","aria-live":"polite"},this.props.definitionId&&r.createElement(f.WrappedComponent,{dependencies:["ms.vss-build-web.pipeline-insights.runs-insights"],wrappedType:"pipelines-runs-insights",definitionId:this.props.definitionId}),r.createElement(b.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1},titleProps:e?{text:e,size:0}:void 0},r.createElement(u.Table,{ariaLabel:Ve.RunsTabName,className:"runs-table",columns:this._getTableColumns(),itemProvider:this._itemProvider,onActivate:this._onActivateRow,renderLoadingRow:this._renderLoadRow,showHeader:e=>e>=1,tableBreakpoints:this._getTableBreakpoints()})))}componentDidMount(){this._store.addListener(this._onStoreChanged),this._markTTI(),this._sendTelemetryEvent()}componentWillUnmount(){super.componentWillUnmount(),this._store.dispose()}componentDidUpdate(){this._markTTI()}_sendTelemetryEvent(){var e;const t=(0,A.getTFSPageData)(this.context.pageContext),i=null===(e=null==t?void 0:t.project)||void 0===e?void 0:e.id;this._telemetryService.publishEvent(B.TelemetryConstants.Area,B.TelemetryConstants.RunsOverviewShow,{ProjectId:i})}_markTTI(){this._ttiMarked||this._store.isLoading()||(this._ttiMarked=!0,new Ge.Performance(this.context.pageContext).mark("runs",this.props.definitionId))}_renderToolTip(e,t,i,s){const n=this._getStatusStagesTooltip(e,t,i);return n.length>4&&n.splice(4,n.length-4,"..."),r.createElement(r.Fragment,null,r.createElement("div",null,s),n.map(((e,t)=>r.createElement("div",{key:t},e))))}_getStatusStagesTooltip(e,t,i){let s=[];switch(e){case 1:s=i.filter((e=>1==e.state)).map((e=>e.name));break;case 32:case 8:s=i.filter((e=>0==e.state)).map((e=>e.name));break;case 2:if(8===t)s=i.filter((e=>2==e.state&&2==e.result)).map((e=>e.name))}return s}_isMultiRepo(e){var t,i,s,r,n,a;if(0===e.length)return!1;const o=(null===(s=null===(i=null===(t=e[0])||void 0===t?void 0:t.run)||void 0===i?void 0:i.triggeringRepository)||void 0===s?void 0:s.id)||(null===(a=null===(n=null===(r=e[0])||void 0===r?void 0:r.run)||void 0===n?void 0:n.repository)||void 0===a?void 0:a.id);return e.filter((e=>{var t,i;if(!e.run)return!1;return((null===(t=e.run.triggeringRepository)||void 0===t?void 0:t.id)||(null===(i=e.run.repository)||void 0===i?void 0:i.id))!=o})).length>0}}t[e].RunsTable=i}("TabsRunsRunsTable"),function(e){t[e]={};class i extends g.VssService{constructor(){super(),this.assignStageGroupOrder=(e,t=0)=>{var i,s;if(!e)return;let r=Number.MAX_VALUE;if(null===(i=e.stageGroups)||void 0===i?void 0:i.length)for(const i of e.stageGroups)this.assignStageGroupOrder(i,t+1),void 0!==i.order&&i.order<r&&(r=i.order);if(null===(s=e.stages)||void 0===s?void 0:s.length)for(const t of e.stages)t.order<r&&(r=t.order);e.order=r===Number.MAX_VALUE?0:r},this._data=new ve.TreeItemProvider([])}get data(){return this._data}_getRowData(e,t,i){return{stageName:e,displayName:t.displayName,stageId:t.stageId,requestedFor:t.requestedFor,appendCommitMessageToRunName:t.appendCommitMessageToRunName,buildId:t.buildId,buildNumber:t.buildNumber,buildUrl:t.buildUrl,branchName:t.branchName,changes:t.changes,order:t.order,workItems:t.workItems,latestRunPipelineName:t.latestRunPipelineName,queueTime:t.queueTime,startTime:t.startTime,finishTime:t.finishTime,needApproval:t.needApproval,state:t.state,result:t.result,reason:t.reason,stages:i}}_getTreeItemRowData(e,t,i,s){return{data:{stageName:e,displayName:t.displayName,stageId:t.stageId,requestedFor:t.requestedFor,appendCommitMessageToRunName:t.appendCommitMessageToRunName,buildId:t.buildId,buildNumber:t.buildNumber,buildUrl:t.buildUrl,branchName:t.branchName,changes:t.changes,order:t.order,workItems:t.workItems,latestRunPipelineName:t.latestRunPipelineName,queueTime:t.queueTime,startTime:t.startTime,finishTime:t.finishTime,needApproval:t.needApproval,state:t.state,result:t.result,reason:t.reason,stages:i},childItems:s}}_getLatestRun(e,t){if(!e)return t;const i=e.startTime?Date.parse(e.startTime.toString()):void 0,s=t.startTime?Date.parse(t.startTime.toString()):void 0;return void 0===s||void 0!==i&&s>i?t:e}_processStageGroup(e){let t,i=[],s=[],r=[];e.stageGroups&&r.push(...e.stageGroups.map((e=>({type:"group",item:e})))),e.stages&&r.push(...e.stages.map((e=>({type:"stage",item:e})))),r.sort(((e,t)=>{var i,s;return(null!==(i=e.item.order)&&void 0!==i?i:0)-(null!==(s=t.item.order)&&void 0!==s?s:0)}));for(const e of r){if("group"===e.type){const r=e.item,n=this._processStageGroup(r);t=this._getLatestRun(t,n.data);const a=this._getRowData(n.data.stageName,n.data,n.data.stages);s.push(a),i.push({data:a,childItems:n.childItems})}else if("stage"===e.type){const r=e.item,n=this._getRowData(r.stageName,r,void 0);t=this._getLatestRun(t,n);const a={data:n};i.push(a),s.push(n)}if(!t)throw Error("Couldn't get latest run")}if(i.length<1||s.length<1||!t)throw Error("Data should have either stageGroups or stages populated");return this._getTreeItemRowData(e.groupName,t,s,i)}processData(e){var t,i;let s=[];if(e){if(((null===(t=e.stageGroups)||void 0===t?void 0:t.length)||0)+((null===(i=e.stages)||void 0===i?void 0:i.length)||0)>0){if(this.assignStageGroupOrder(e,0),e.stageGroups)for(let t=0;t<e.stageGroups.length;t++){var r=this._processStageGroup(e.stageGroups[t]);s.push(r)}if(e.stages)for(let t=0;t<e.stages.length;t++){r=this._processStageView(e.stages[t]);s.push(r)}s.sort(((e,t)=>{const i=e.data.order,s=t.data.order;return i<s?-1:i>s?1:0}))}}this._data=new ve.TreeItemProvider(s)}_processStageView(e){let t,i=[];if(e){let s=this._getRowData(e.stageName,e,void 0);t=this._getLatestRun(t,s);const r={data:s};i.push(r)}if(!t)throw Error("Couldn't get latest run");return this._getTreeItemRowData(e.stageName,t,void 0,void 0)}async fetchDataAsync(e){const t=this.pageContext.getService("IVssContributionService"),i={definitionId:e.toString()};await t.getDataAsync("ms.vss-build-web.stages-data-provider",i).then((e=>{this.processData(e)}))}}t[e].StagesDataService=i,g.Services.add("IStagesDataService",{serviceFactory:i})}("TabsStagesStagesDataService"),function(e){vt=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._renderStagesCell=(e,t,i,s)=>{const n=s.underlyingItem.data,a=(0,k.getTimelineStatusIndicatorData)(n.state,n.result),o={text:n.displayName,overflowOnly:!0},l={};l[B.NavConstants.stage]=n.stageId.toString();const d=n.stages?"":this._linkingService.getBuildUrl(n.buildId,B.NavConstants.logs,void 0,void 0,l),c=r.createElement(r.Fragment,null,n.stages?r.createElement(x.Tooltip,{text:n.stageName,overflowOnly:!0},r.createElement(r.Fragment,null,r.createElement("div",{className:"padding-right-16 flex-row flex-center"},r.createElement(R.Status,Object.assign({},a.statusProps,{size:"16"}))),n.stageName)):r.createElement(v.Link,{className:"flex-row bolt-table-link bolt-link no-underline-link text-ellipsis",role:"button",href:d,tooltipProps:o},r.createElement("div",{className:"padding-right-16 flex-row flex-center"},r.createElement(R.Status,Object.assign({},a.statusProps,{size:"16"}))),n.displayName),n.needApproval&&r.createElement("div",{className:"padding-left-16"},r.createElement(ie.Pill,{size:0},Ve.NeedApproval)));return(0,Se.ExpandableTreeCell)({children:c,columnIndex:t,treeColumn:i,treeItem:s,contentClassName:"stages-expandable-tree-cell-content"})},this._renderLatestCell=(e,t,i,s)=>{const n=s.underlyingItem.data,a={text:(0,L.formatPipelineRunName)(n.buildNumber,n.latestRunPipelineName,n.appendCommitMessageToRunName),overflowOnly:!0},l=this._identityService.getIdentityImageUrl(n.requestedFor);return r.createElement(u.TwoLineTableCell,{className:"latest-cell",columnIndex:t,tableColumn:i,key:"col-"+t,line1:r.createElement(v.Link,{className:"flex-row bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:n.buildUrl,tooltipProps:a},(0,L.formatPipelineRunName)(n.buildNumber,n.latestRunPipelineName,n.appendCommitMessageToRunName)),line2:r.createElement(x.Tooltip,{text:o.format("{0} {1} {2} {3}",Ve.RunBy,n.requestedFor.displayName,Ve.InBranch,n.branchName),overflowOnly:!0},r.createElement("div",{className:"padding-left-8 fontSize secondary-text flex-row text-ellipsis"},r.createElement("span",{className:"padding-right-4"},Ve.RunBy),r.createElement("span",{className:"padding-right-4"},r.createElement(ue.VssPersona,{className:"v-align-middle",imageUrl:l,size:"extra-small"})),r.createElement("span",{className:"padding-right-4"},n.requestedFor.displayName),r.createElement(c.Icon,{iconName:"OpenSource",className:"padding-right-4"}),r.createElement("span",null,n.branchName)))})},this._renderChangesCell=(e,t,i,s,n,l)=>r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},s.underlyingItem.data.changes>0?r.createElement(a.Button,{text:s.underlyingItem.data.changes.toString(),iconProps:{iconName:"BranchCommit"},tooltipProps:{text:Ve.Commits},onClick:e=>{e.preventDefault(),this.setState({isChangesPanelOpen:!0}),s.underlyingItem.data.stages||this._showUpcomingPanel(_e.UpcomingChangesPanelTabId.Commits,s.underlyingItem.data)},subtle:!0,className:"stages-panel-changes-button margin-right-4"}):r.createElement(x.Tooltip,{text:o.format("{0}: {1}",Ve.Commits,s.underlyingItem.data.changes)},r.createElement("div",{className:"padding-right-16 flex-row flex-center"},r.createElement(c.Icon,{iconName:"BranchCommit",className:"padding-right-4"}),r.createElement("span",null,s.underlyingItem.data.changes))),s.underlyingItem.data.workItems>0?r.createElement(a.Button,{text:s.underlyingItem.data.workItems.toString(),iconProps:{iconName:"WorkItem"},tooltipProps:{text:Ve.WorkItems},onClick:e=>{e.preventDefault(),this.setState({isChangesPanelOpen:!0})},subtle:!0,className:"stages-panel-changes-button"}):r.createElement(x.Tooltip,{text:o.format("{0}: {1}",Ve.WorkItems,s.underlyingItem.data.workItems)},r.createElement("div",{className:"padding-right-8 flex-row flex-center"},r.createElement(c.Icon,{iconName:"WorkItem",className:"padding-right-4"}),r.createElement("span",null,s.underlyingItem.data.workItems)))),this._renderTimeCell=(e,t,i,s)=>{var n;return r.createElement(He.DateAndDuration,{queueTime:null!==(n=s.underlyingItem.data.startTime)&&void 0!==n?n:s.underlyingItem.data.queueTime,startTime:s.underlyingItem.data.startTime,finishTime:s.underlyingItem.data.finishTime,key:"col-"+t,columnIndex:t,tableColumn:i})},this._onSize=(e,t,i,s)=>{s.width.value=i},this._linkingService=t.pageContext.getService("IBuildLinkingService"),this._stagesDataService=t.pageContext.getService("IStagesDataService"),this._identityService=this.context.pageContext.getService("IVssIdentityService"),this.state={isLoading:!0,isChangesPanelOpen:!1},this._stagesDataService.fetchDataAsync(this.props.definitionId).then((()=>{this._itemProvider=this._stagesDataService.data,this.setState({isLoading:!1})})),this._isStageHistoryRunPanelEnabled=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ShowStageRunHistoryTab",!1),this._isChangesColumnEnabled=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ShowChangesColumn",!1)}render(){return this.state.isLoading?r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement(T.Spinner,{className:"pipelines-filter-spinner",size:"large",label:Ve.Loading})):!this._itemProvider||this._itemProvider.length<1?r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered"},r.createElement(be.ZeroData,{primaryText:Ve.NoStages,imagePath:(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png"),imageAltText:""}))):r.createElement(b.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1}},r.createElement(Se.Tree,{className:"stages-table",columns:this.getTreeColumns(this._isChangesColumnEnabled),itemProvider:this._itemProvider,onToggle:(e,t)=>{this._itemProvider.toggle(t.underlyingItem)},scrollable:!0,onSelect:(e,t)=>this._onRowClick(e,t)}))}_onRowClick(e,t){if(!t.data.underlyingItem.data.stages&&this._isStageHistoryRunPanelEnabled){this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>r.createElement(Ze.StagesHistoryPanel,{stageName:t.data.underlyingItem.data.stageName,displayName:t.data.underlyingItem.data.displayName,pageContext:this.context.pageContext,buildId:t.data.underlyingItem.data.buildId,buildNumber:t.data.underlyingItem.data.buildNumber,pipelineName:t.data.underlyingItem.data.latestRunPipelineName,onDismiss:e,appendCommitMessageToRunName:t.data.underlyingItem.data.appendCommitMessageToRunName,sourceVersionMessage:t.data.underlyingItem.data.latestRunPipelineName,signalRActionHub:this.props.signalRActionHub,definitionId:this.props.definitionId})))}}_showUpcomingPanel(e,t){this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const s={onDismiss:i,buildId:t.buildId,stageId:t.stageId,stageName:t.displayName,buildName:`#${t.buildNumber} - ${t.latestRunPipelineName}`,pipelineName:t.latestRunPipelineName,selectedTabId:e};return r.createElement(_e.UpcomingChangesPanel,s)}))}getTreeColumns(e){const t=[{id:"stages",name:Ve.Stages,renderCell:this._renderStagesCell,columnStyle:2,width:new p.ObservableValue(-40),onSize:this._onSize},{id:"latest",name:Ve.LatestRun,renderCell:this._renderLatestCell,width:new p.ObservableValue(-45),onSize:this._onSize},{id:"time",name:Ve.RunStartTime,renderCell:this._renderTimeCell,width:new p.ObservableValue(160)}];return e&&t.splice(2,0,{id:"changes",name:Ve.Changes,renderCell:this._renderChangesCell,width:new p.ObservableValue(-15),onSize:this._onSize}),t}}t[e].StagesTable=i}("TabsStagesStagesTable"),function(){var e;t.PipelineDetailsView={},function(e){e.Branches="branches",e.Runs="runs",e.TriggerIssues="triggerIssues",e.Stages="stages",e.Triggers="triggers"}(e||(e={}));class i extends f.VssComponent{constructor(t,i){var a;super(t,i),this._isPageLoad=!0,this._viewUrls={},this._extensionDefinitionCallBacks={},this._buildDefinition={},this.buttonProps=[{text:Ve.ViewDetails,onClick:()=>{this._selectedTabIdBackUp=this.state.selectedTab,this._hubViewState.selectedPivot.value=e.TriggerIssues,this.setState({selectedTab:e.TriggerIssues})}}],this._onStoreChanged=()=>{const e=this._triggerIssuesStore.getState(),t=this._getTriggerIssuesLength(this._triggerIssuesState.triggerIssueData);this.setState({triggerIssuesLength:t,triggerIssuesData:e.triggerIssueData})},this._getNewBranches=e=>{this.setState({newBranches:e})},this._getViewCommandBar=()=>this.state.selectedTab===e.Runs?r.createElement(ke.ScreenSizeConditional,{condition:e=>e>0},r.createElement(Ne.HeaderCommandBarWithFilter,{filter:this._runsFilter,items:[],filterToggled:this._runsFilterToggled})):r.createElement("div",null),this._onClickHeaderBack=()=>{const e=this.context.pageContext.getService("IBuildLinkingService").getDefinitionUrl(void 0);(0,U.onClickFPS)(this.context.pageContext,e,!0)},this._onTabChanged=e=>{this._isPageLoad=!1,new Ge.Performance(this.context.pageContext).onFPS(),this._hubViewState.selectedPivot.value=e,this._setTitle(e)},this._onViewStateChanged=e=>{this.setState({selectedTab:e})},this._getCommandBarItems=()=>{const t=this.context.pageContext.getService("IVssPageService").getData(),i=(0,A.getTFSPageData)(this.context.pageContext);if(!t||!i||!i.project)return[];if(!this._security.isMember()||void 0===this.state.pipelineDetails||"string"==typeof this.state.pipelineDetails)return[];const n=this.state.pipelineDetails.definitionId,a=this.state.pipelineDetails.definitionName,o=this.state.pipelineDetails.definitionPath,l=this.state.pipelineDetails.definitionUri,d=i.project.id,c=i.project.name,u=this.state.pipelineDetails.definitionQueueStatus,h=this.context.pageContext,p=this.context.pageContext.getRestClient("IBuildRestClient"),g=h.getService("IBuildLinkingService"),m=g.getDefinitionEditUrl(n),f=g.getYamlPipelineEditUrl(n),b=g.getCloneDefinitionEditUrl(n),v=g.getDefinitionUrl(void 0),S=1===this.state.pipelineDetails.definitionQueueStatus,_=2===this.state.pipelineDetails.definitionQueueStatus,C=this.state.pipelineDetails.definitionProcessType===B.ProcessType.Yaml,y=this._security.canEditDefinition({id:n,path:o}),T=this._security.canQueueBuild({id:n,path:o}),I=this._security.hasDefinitionPermission({id:n,path:o},Re.BuildRequiredPermissions.DeleteBuildDefinition),P=(this._security.canCreateDefinition({id:n,path:o}),[]);return P.push(at.GetEditViewMenuItem(h,y,C?f:m)),T&&!_&&P.push(at.GetRunMenuItem(h,d,n)),P.push(at.GetSecurityMenuItem(h,d,n)),!y||_||C||P.push({id:"pause-resume-pipeline-command",text:S?Ve.ResumePipeline:Ve.PausePipeline,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{e.queueStatus=S?0:1,e.comment=S?Ve.PipelineResumed:Ve.PipelinePaused,p.updateDefinition(e,d,n).then((e=>{this._updatePipelineDetails(e)}),s.handleError)}),s.handleError)}}),y&&P.push(at.GetRenameMoveMenuItem(h,d,n,(e=>{e.path!==o?this._dataService.refreshData():this._updatePipelineDetails(e)}))),P.push({id:"status-badge-command",text:Ve.StatusBadge,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{this._statusBadgePanelStore.showPanel(e)}),s.handleError)}}),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.EnableYamlPipelineTriggerIssues",!1)&&P.push({id:e.TriggerIssues,text:Ve.TriggerIssues,important:!1,onActivate:(t,i)=>{this._selectedTabIdBackUp=this.state.selectedTab,this._hubViewState.selectedPivot.value=e.TriggerIssues,this.setState({selectedTab:e.TriggerIssues})}}),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.EnableTriggersPage",!1)&&C&&P.push({id:"pipeline-triggers-command",text:Ve.Triggers,important:!1,onActivate:(t,i)=>{this._selectedTabIdBackUp=this.state.selectedTab,this._hubViewState.selectedPivot.value=e.Triggers,this.setState({selectedTab:e.Triggers})}}),C?P.push({id:"settings-pipeline-command",text:Ve.Settings,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{this._buildDefinition=e,this.setState({settingsPanelIsOpen:!0})}),s.handleError)}}):(P.push({id:"designer-build-command-divider",important:!1,itemType:1}),this.state.isClassicPipelineCreationDisabled||(P.push({id:"clone-pipeline-command",text:Ve.Clone,important:!1,href:C?void 0:b,onActivate:(e,t)=>{(0,U.onClickFPS)(h,b,!0,t)}}),y&&P.push({id:"save-pipeline-as-template-command",text:Ve.SaveAsTemplate,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{h.getService("IVssLayoutManager").renderCallout((t=>{const i={pageContext:h,definition:e,projectId:e.project.id,saveAsTemplate:!0,onClose:t};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciSaveDefinitionComponent"},i),null)}))}),s.handleError)}})),P.push({id:"export-pipeline-command",text:Ve.Export,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{const t=JSON.stringify(e),i=e.name.concat(".json"),s=new Blob([t],{type:"application/json"});if(window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(s,i);else{const e=document.createElement("a");e.href=URL.createObjectURL(s),e.setAttribute("download",i),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}),s.handleError)}}),P.push({id:"export-pipelineYaml-command",text:Ve.ExportToYaml,important:!1,onActivate:(e,t)=>{p.getDefinitionYaml(d,n).then((e=>{p.getDefinition(d,n).then((t=>{const i=e.yaml,s=t.name.concat(".yml"),r=new Blob([i],{type:"text/plain"});if(window.navigator&&window.navigator.msSaveBlob)window.navigator.msSaveBlob(r,s);else{const e=document.createElement("a");e.href=URL.createObjectURL(r),e.setAttribute("download",s),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}),s.handleError)}),s.handleError)}})),I&&(P.push({id:"delete-command-divider",important:!1,itemType:1}),P.push(at.GetDeleteMenuItem(h,d,n,(e=>{(0,U.onClickFPS)(h,v,!0)})))),P.push({id:"status-command-divider",important:!1,itemType:1}),P.push({id:"pipeline-scheduled-runs",text:Ve.PipelineScheduledRunsPanelTitle,important:!1,onActivate:(e,t)=>{p.getDefinition(d,n).then((e=>{this._buildDefinition=e,this.setState({scheduledRunsPanelIsOpen:!0})}),s.handleError)}}),new Ie.ObservableHeaderCommandArray(this.context.pageContext,P,[{contributionId:"ms.vss-build-web.build-definition-menu",getContributionContext:()=>({id:n,name:a,path:o,project:{id:d,name:c},uri:l,type:2,queueStatus:u})}],Ie.ItemOrdering.StaticFirst,{id:"extension-actions-divider",important:!1,itemType:1})},this._getCommandBarBreakpoints=()=>{const{pipelineDetails:e}=this.state;if(!e||"string"==typeof e)return[];const t=e.definitionId,i=e.definitionPath,s=this._security.canEditDefinition({id:t,path:i});return[{breakpoint:1,commandBarItems:[{iconProps:void 0,id:"edit-pipeline-command",important:!1,text:s?Ve.EditPipeline:Ve.ViewPipeline},{iconProps:void 0,id:"run-pipeline-command",important:!0,text:Ve.RunPipelineShort,tooltipProps:{text:Ve.RunPipeline}}]},{breakpoint:600,commandBarItems:[{iconProps:void 0,id:"edit-pipeline-command",important:!0,text:s?Ve.EditPipeline:Ve.ViewPipeline},{iconProps:void 0,id:"run-pipeline-command",important:!0,text:Ve.RunPipeline}]}]},this._getTriggerIssuesLength=e=>{let t=0;return e.map((e=>{"failed"===e.statusType.color.toString()&&t++})),t},this._dismissPipelineSettingsPanel=()=>{this.setState({settingsPanelIsOpen:!1,settingsErrorMessage:""})},this._dismissScheduledRunsPanel=()=>{this.setState({scheduledRunsPanelIsOpen:!1})},this.onTriggerIssuesBackButton=()=>{let t;t=this._selectedTabIdBackUp?this._selectedTabIdBackUp:e.Runs,this._hubViewState.selectedPivot.value=t,this.setState({selectedTab:t})},this.onTriggersBackButton=()=>{const t=this.context.pageContext.getService("IVssHistoryService"),i=t.getState();let s;qe.TriggersPageRouteKeys.BranchName in i&&delete i[qe.TriggersPageRouteKeys.BranchName],qe.TriggersPageRouteKeys.TriggerType in i&&delete i[qe.TriggersPageRouteKeys.TriggerType],t.replaceState(i),s=this._selectedTabIdBackUp?this._selectedTabIdBackUp:e.Runs,this._hubViewState.selectedPivot.value=s,this.setState({selectedTab:s})},this._onSavePipelineSettings=e=>{if(!e||!Object.keys(e).length)return;const t=[],i=Object.assign({},this._buildDefinition);this.setState({settingsIsSaving:!0,settingsErrorMessage:""});const s=this.context.pageContext.getRestClient("IBuildRestClient");if(void 0!==e.status)switch(i.queueStatus=e.status,e.status){case 2:t.push(n.SavePipelineCommentDisable);break;case 0:t.push(n.SavePipelineCommentEnable);break;case 1:t.push(n.SavePipelineCommentPause);break;default:t.push(n.SavePipelineCommentUnknownStatus)}if(void 0!==e.yamlFilePath){const s=Object.assign({},i.process);s.yamlFilename=e.yamlFilePath,i.process=s,t.push((0,o.format)(n.SavePipelineCommentYamlFile,e.yamlFilePath))}if(void 0!==e.witLinkingEnabled||e.witLinkingBranchFilter){i.options||(i.options=[]);let s=i.options.filter((e=>(0,o.equals)(e.definition.id,B.BuildOptionGUIDs.WitLinkingOptionGUID)))[0];e.witLinkingBranchFilter&&(t.push((0,o.format)(n.SavePipelineCommentUpdateAutoLinkBranch,e.witLinkingBranchFilter)),s?s.inputs={branchFilters:JSON.stringify([e.witLinkingBranchFilter])}:(s={definition:{id:B.BuildOptionGUIDs.WitLinkingOptionGUID},inputs:{branchFilters:JSON.stringify([e.witLinkingBranchFilter])},enabled:!0},i.options.push(s))),void 0!==e.witLinkingEnabled&&s&&(t.push((0,o.format)(n.SavePipelineCommentEnableAutoLink,e.witLinkingEnabled)),s.enabled=e.witLinkingEnabled)}i.comment=t.join(". "),s.updateDefinition(i,i.project.id,i.id).then((e=>{this._updatePipelineDetails(e),this.setState({settingsIsSaving:!1},this._dismissPipelineSettingsPanel)}),(e=>{const t=e&&e.message||n.SavePipelineErrorMessage;this.setState({settingsErrorMessage:t,settingsIsSaving:!1})}))},this._getTabProviders=()=>(0,Pe.getPivotItemToTabProvider)(this.context.pageContext,"ms.vss-build-web.build-definition-detail-view",this._getExtensionProps,this._viewUrls,this._hubViewState),this._getExtensionProps=e=>({onDefinitionChanged:this._onExtensionDefinitionContextChanged.bind(this,e)}),this._onExtensionDefinitionContextChanged=(e,t)=>{this._extensionDefinitionCallBacks[e]=t;const i=this._dataService.data.value,s=(0,A.getTFSPageData)(this.context.pageContext);if(s&&s.project){const t={id:i.definitionId,name:i.definitionName,path:i.definitionPath,uri:i.definitionUri,type:2,queueStatus:i.definitionQueueStatus,project:{id:s.project.id,name:s.project.name,url:s.project.url}};this._extensionDefinitionCallBacks[e](t)}},this._pipelineDetailsChanged=e=>{const t=(0,A.getTFSPageData)(this.context.pageContext);if(t&&t.project){const i={id:e.definitionId,name:e.definitionName,path:e.definitionPath,uri:e.definitionUri,type:2,queueStatus:e.definitionQueueStatus,project:{id:t.project.id,name:t.project.name,url:t.project.url}};Object.keys(this._extensionDefinitionCallBacks).forEach((e=>{this._extensionDefinitionCallBacks[e](i)}))}const i=this.context.pageContext.getService("IBuildLinkingService").getDefinitionUrl(e.definitionId);this.context.pageContext.getService("pipelines-header-breadcrumb-service").setPipeline(e.definitionName,i,e.definitionPath),this.setState({pipelineDetails:e})},this._projectSettingsChanged=e=>{this.setState({isClassicPipelineCreationDisabled:!(null==e?void 0:e.disableClassicBuildPipelineCreation)||e.disableClassicBuildPipelineCreation.enabled})},this._dataService=this.context.pageContext.getService("IPipelineDetailsDataService"),this._projectSettingsService=this.context.pageContext.getService("IGeneralSettingsService"),this._hubViewState=new De.VssHubViewState(i.pageContext,{defaultPivot:e.Runs});const l=(0,A.getTFSPageData)(this.context.pageContext),d=i.pageContext.getService("IVssPageService").getData();this._signalRActionHub=new Me.BuildSignalRActionHub,l&&l.project&&d&&(this._signalRHub=this.props.signalRHub||new ot.BuildSignalRHub({actionCreator:new Me.BuildSignalRActionCreator({actionHub:this._signalRActionHub}),hostInformation:{hostId:d.hostId,isHosted:d.isHosted,hostPath:d.hostPath,projectId:l.project.id},pageContext:this.context.pageContext,projectId:l.project.id})),this._permissions=new Fe.PermissionsStore({pageContext:i.pageContext}),this._security=new Re.Security({projectId:l&&l.project?l.project.id:"",store:this._permissions}),this._statusBadgePanelStore=new Ye.StatusBadgePanelStore({pageContext:i.pageContext});const c=this.context.pageContext.getService("IVssHistoryService").getState(),u=Object.keys(c).some((e=>e.endsWith("Filter")));this._runsFilter=new H.Filter,this._runsFilterToggled=new p.ObservableValue(u),this._runsAppliedFilterStore=new ct.RunsAppliedFilterStore(this._runsFilter),this._triggerIssuesStore=new $e.PipelineTriggerIssuesStore(i.pageContext,this._dataService.data?this._dataService.data.value.definitionId:-1),this._triggerIssuesState=this._triggerIssuesStore.getState(),this.state={selectedTab:this._hubViewState.selectedPivot.value,pipelineDetails:this._dataService.data?this._dataService.data.value:void 0,settingsPanelIsOpen:!1,settingsErrorMessage:"",settingsIsSaving:!1,scheduledRunsPanelIsOpen:!1,triggerIssuesLength:0,triggerIssuesData:this._triggerIssuesState.triggerIssueData,triggerIssueRecalculateClicked:!1,newBranches:[],isClassicPipelineCreationDisabled:!(null===(a=this._projectSettingsService.data)||void 0===a?void 0:a.value.disableClassicBuildPipelineCreation)||this._projectSettingsService.data.value.disableClassicBuildPipelineCreation.enabled}}componentWillMount(){this._triggerIssuesStore.addListener(this._onStoreChanged)}render(){if(void 0===this.state.pipelineDetails)return r.createElement(Be.Surface,{background:1},r.createElement(X.Page,{className:"pipelines-page"},r.createElement(_.MessageCard,{severity:"Error"},Ve.PipelineNotFound)));if("string"==typeof this.state.pipelineDetails)return r.createElement(Be.Surface,{background:1},r.createElement(X.Page,{className:"pipelines-page"},r.createElement(_.MessageCard,{severity:"Error"},this.state.pipelineDetails)));const t=this.state.pipelineDetails.definitionProcessType===B.ProcessType.Yaml,i=this._security.canQueueBuild({id:this.state.pipelineDetails.definitionId,path:this.state.pipelineDetails.definitionPath}),s=this.state.pipelineDetails.definitionName||Ve.PipelineDetailsTitle,n=this.context.pageContext.getService("IVssPageService").getData(),a=n?n.user.id:void 0,o=this._dataService.data.value;let l={},d={};o&&(l=o.definition||{},d=o.serviceConnection||{});const c=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.EnableTriggersPage",!1)&&t;return r.createElement(Be.Surface,{background:1},this.state.selectedTab!==e.TriggerIssues&&(this.state.selectedTab!==e.Triggers||!c)&&r.createElement(X.Page,{className:"pipelines-page",selectedTabId:this._hubViewState.selectedPivot,tabProviders:this._getTabProviders()},r.createElement(J.Header,{title:r.createElement(r.Fragment,null,r.createElement("span",null,s),r.createElement(we.ContributedPillGroup,{className:"margin-left-8 flex-noshrink",pageContext:this.context.pageContext,pills:(0,we.getPills)(this.context.pageContext,"ms.vss-build-web.build-definition-detail-view-header-pills",this.state.pipelineDetails),size:0})),titleClassName:"flex-row flex-center",description:this.state.pipelineDetails.isDraft?Ve.DraftDescription:void 0,titleSize:1,commandBarItems:this._getCommandBarItems(),headerBreakpoints:this._getCommandBarBreakpoints(),backButtonProps:{onClick:this._onClickHeaderBack,text:Ve.PipelinesHeader},className:"ci-pipeline-details-header"}),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.BuildSummaryPage.SwitchToAppConnection",!1)&&r.createElement(ye.UpgradeServiceConnectionHeader,{className:"padding-top-16",definition:l,connection:d}),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.BitbucketAzurePipelinesBackupOAuthClient",!1)&&d.isOutdated&&r.createElement(Ce.UpdateBitbucketServiceConnectionHeader,{className:"padding-top-16",definition:l,connection:d}),r.createElement(se.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged,renderAdditionalContent:this._getViewCommandBar},r.createElement(se.Tab,{name:Ve.RunsTabName,id:e.Runs,key:e.Runs}),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.PersistedStages.EnableNewAutoResolve",!1)&&(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ShowStagesPivotUI",!1)&&r.createElement(se.Tab,{name:Ve.Stages,id:e.Stages,key:e.Stages}),r.createElement(se.Tab,{name:Ve.BranchesTabName,id:e.Branches,key:e.Branches})),this.state.selectedTab===e.Runs&&r.createElement(Ee.ConditionalChildren,{renderChildren:this._runsFilterToggled},r.createElement(ht.RunsFilterBar,{appliedFilterStore:this._runsAppliedFilterStore,definitionId:this.state.pipelineDetails.definitionId,newBranches:this.state.newBranches})),r.createElement("div",{className:"page-content page-content-top"},this.state.pipelineDetails.throttleMessage&&r.createElement(_.MessageCard,{severity:"Warning",className:"margin-bottom-16",buttonProps:this._getThrottleButton(this.state.pipelineDetails.incidentId)},this.state.pipelineDetails.throttleMessage),(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"DistributedTask.EnableYamlPipelineTriggerIssues",!1)&&this.state.triggerIssuesLength>0&&r.createElement(_.MessageCard,{buttonProps:this.buttonProps,className:"flex-self-stretch margin-bottom-16",severity:"Error"},Ve.TriggerIssuesCardMessage),r.createElement(se.TabContent,null,this.state.selectedTab===e.Runs&&r.createElement(bt.RunsTable,{isPageLoad:this._isPageLoad,definitionId:this.state.pipelineDetails.definitionId,canQueueBuild:i,appliedFilterStore:this._runsAppliedFilterStore,signalRActionHub:this._signalRActionHub,security:this._security,userId:a,getBranchesOnNewRun:this._getNewBranches,repository:this.state.pipelineDetails.definition.repository}),this.state.selectedTab===e.Branches&&r.createElement(dt.BranchesView,{isPageLoad:this._isPageLoad,definitionId:this.state.pipelineDetails.definitionId}),this.state.selectedTab===e.Stages&&(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.PersistedStages.EnableNewAutoResolve",!1)&&(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.ShowStagesPivotUI",!1)&&r.createElement(vt.StagesTable,{definitionId:this.state.pipelineDetails.definitionId,signalRActionHub:this._signalRActionHub}))),r.createElement(Qe.StatusBadgePanel,{statusBadgePanelStore:this._statusBadgePanelStore}),t&&this.state.settingsPanelIsOpen&&r.createElement(Te.PipelineSettingsPanel,{key:this.state.pipelineDetails.definitionId,definition:this._buildDefinition,branch:this._buildDefinition&&this._buildDefinition.repository?this._buildDefinition.repository.defaultBranch:"",isYamlDirty:!1,errorMessage:this.state.settingsErrorMessage,isOpen:this.state.settingsPanelIsOpen,isSaving:this.state.settingsIsSaving,onSave:this._onSavePipelineSettings,onDismiss:this._dismissPipelineSettingsPanel,onError:e=>{this.setState({settingsErrorMessage:e})}}),this.state.scheduledRunsPanelIsOpen&&r.createElement(je.ScheduledRunsPanel,{key:this.state.pipelineDetails.definitionId+1,isOpen:this.state.scheduledRunsPanelIsOpen,onDismiss:this._dismissScheduledRunsPanel,definitionId:this.state.pipelineDetails.definitionId})),this.state.selectedTab===e.TriggerIssues&&r.createElement(Je.PipelineTriggerIssuesPage,{definitionId:this.state.pipelineDetails.definitionId,onBackButton:this.onTriggerIssuesBackButton,triggerIssuesData:this.state.triggerIssuesData,fetchTriggerIssueData:e=>{e&&this.setState({triggerIssueRecalculateClicked:!0}),this._triggerIssuesStore.fetchTriggerIssueData(e)},recalculateClicked:this.state.triggerIssueRecalculateClicked}),this.state.selectedTab===e.Triggers&&c&&r.createElement(nt.PipelineTriggersPage,{definitionId:this.state.pipelineDetails.definitionId,onBackButton:this.onTriggersBackButton}))}componentDidMount(){if((0,re.prefetch)(this.context.pageContext),this._signalRHub.watchProject(),this._hubViewState.selectedPivot.subscribe(this._onViewStateChanged),this._dataService.data&&this._dataService.data.subscribe(this._pipelineDetailsChanged),this._projectSettingsService.data&&this._projectSettingsService.data.subscribe(this._projectSettingsChanged),(0,s.registerErrorHandler)((e=>{if(e){this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:e.message,level:2})}})),this.state.pipelineDetails&&"string"!=typeof this.state.pipelineDetails){const e=this.context.pageContext.getService("IBuildLinkingService").getDefinitionUrl(this.state.pipelineDetails.definitionId);this.context.pageContext.getService("pipelines-header-breadcrumb-service").setPipeline(this.state.pipelineDetails.definitionName,e,this.state.pipelineDetails.definitionPath),this._setTitle(this.state.selectedTab)}}componentWillUnmount(){this._signalRHub.dispose(),this._hubViewState.selectedPivot.unsubscribe(this._onViewStateChanged),this._dataService.data&&this._dataService.data.unsubscribe(this._pipelineDetailsChanged),this._projectSettingsService.data&&this._projectSettingsService.data.unsubscribe(this._projectSettingsChanged),this._hubViewState.dispose();this.context.pageContext.getService("pipelines-header-breadcrumb-service").clearPipeline(),(0,s.registerErrorHandler)((e=>{})),Object.keys(this._viewUrls).forEach((e=>{this._viewUrls[e].dispose()})),(0,Ge.disposeFPS)(),(0,xe.clearTreeStateOnUnmount)(this.context.pageContext)}_getThrottleButton(e){let t;return e&&(t=[{text:Ve.LearnMore,onClick:()=>window.open("https://portal.microsofticm.com/imp/v3/incidents/details/"+e)}]),t}_setTitle(t){this.state.pipelineDetails&&"string"!=typeof this.state.pipelineDetails&&(t===e.Branches?document.title=(0,o.format)(Ve.TitlePipelineBranches,this.state.pipelineDetails.definitionName):t===e.Runs?document.title=(0,o.format)(Ve.TitlePipelineRuns,this.state.pipelineDetails.definitionName):document.title=(0,o.format)(Ve.Title,this.state.pipelineDetails.definitionName))}_updatePipelineDetails(e){const t={definitionId:e.id,definitionName:e.name,definitionPath:e.path,definitionUri:e.uri,definitionQueueStatus:e.queueStatus,definitionProcessType:e.process.type,isDraft:2==e.quality,definition:e,serviceConnection:{},throttleMessage:"",incidentId:""};this._dataService.updateData(t)}}f.Components.add("pipeline-details",i)}(),function(e){var i;St=t[e]={},function(e){e[e.NotRequested=0]="NotRequested",e[e.Requested=1]="Requested",e[e.Available=2]="Available"}(i||(i={}));class s extends ve.TreeItemProvider{constructor(e,t,s,r,n,a){super([]),this._onChildItemsAvailable=(e,t)=>{let s=t?t.data.value.path:this._rootPath;this._paths[s]=i.Available,t&&t.childItems&&this.splice(t,t.childItems);const r=this._convertPipelinesDataToTreeItems(s,e);t&&0===r.length?this.splice(t,void 0,[{items:[this._getEmptyFolderIndicator(s)]}]):this.splice(t,void 0,[{items:r}]),t||(this._loadingRoot.value=!1)},this._fetchDetails=()=>{let e=this._batchForUpdates;this._batchForUpdates=[],this._source.getDataAsync("ms.vss-build-web.pipelines-data-provider",{definitionIds:e.join(",")},!0).then((e=>{this._onLatestRunDetailsAvailable(e)}))},this._onLatestRunDetailsAvailable=e=>{e&&e.pipelines&&e.pipelines.forEach((e=>{this.value.forEach((t=>{const s=t.underlyingItem.data.value,r=s.pipeline;r&&r.id===e.id&&(this._detailRequests[r.id]=i.Available,r.latestRun=e.latestRun,t.underlyingItem.data.value=s)}))}))},this._isExpanded=e=>this._expandedFolders.indexOf(e)>-1,this._addPipelineToTree=(e,t)=>{e.childItems&&1===e.childItems.length&&e.childItems[0].data.value.isEmptyMarker?this.splice(e,[e.childItems[0]],[{items:[t]}]):this.splice(e,void 0,[{items:[t]}])},this._buildUpdated=e=>{let t=!1;this.value.forEach((i=>{const s=i.underlyingItem.data.value.pipeline;s&&s.id==e.definitionId&&s.latestRun&&s.latestRun.id==e.buildId&&(t=!0)})),!t&&this._filteredProvider&&(t=this._filteredProvider.containsRun(e.buildId)),t&&this._runsWithUpdates.indexOf(e.buildId)<0&&(this._runsWithUpdates.push(e.buildId),this._getUpdatedRunsDebounced())},this._updateStages=e=>{if(this.value&&e&&e.buildId){let t=this.value.find((t=>this.matchTreeItemToBuildId(t.underlyingItem.data.value.pipeline,e.buildId)));!t&&this._filteredProvider&&(t=this._filteredProvider.value.find((t=>this.matchTreeItemToBuildId(t.underlyingItem.data.value.pipeline,e.buildId))));let i=t&&t.underlyingItem.data.value.pipeline.latestRun;i&&(32===i.status||1===i.status)&&this._runsWithUpdates.indexOf(e.buildId)<0&&(this._runsWithUpdates.push(e.buildId),this._getUpdatedRunsDebounced())}},this._getUpdatedRuns=()=>{const e=this._runsWithUpdates;this._runsWithUpdates=[],e.length>0&&this._source.getDataAsync("ms.vss-build-web.pipelines-data-provider",{runIds:e.join(",")},!0).then((e=>{this._onLatestRunDetailsUpdated(e)}))},this._onLatestRunDetailsUpdated=e=>{e&&e.updatedRuns&&(e.updatedRuns.forEach((e=>{this.value.forEach((t=>{const i=t.underlyingItem.data.value,s=i.pipeline;if(s&&s.latestRun&&s.latestRun.id===e.id){const r=s.latestRun.sourceVersionMessage;s.latestRun=e,s.latestRun.sourceVersionMessage=r,t.underlyingItem.data.value=i}}))})),this._filteredProvider&&this._filteredProvider.updateRuns(e.updatedRuns))},this._rootPath=n,this._pageContext=e,this._paths={},this._pathMapping={},this._detailRequests={},this._loadingRoot=new p.ObservableValue(!1),this._expandedFolders=a?(0,Le.atou)(a).split("$"):[],this._timerManagement=new D.TimerManagement,this._fetchDetailsDebounced=this._timerManagement.debounce(this._fetchDetails,100),this._batchForUpdates=[],this._signalRHub=t,this._runsWithUpdates=[],this._getUpdatedRunsDebounced=this._timerManagement.debounce(this._getUpdatedRuns,3e3),this._signalRHub.buildUpdated.addListener(this._buildUpdated),this._signalRHub.stagesUpdated.addListener(this._updateStages),this._source=new E.ContributionSource({pageContext:this._pageContext}),s&&!r&&this._getChildItemsOnPageLoad()}loadRoot(){this._hasRequestedItemsAtPath(this._rootPath)||(this._loadingRoot.value=!0,this._getChildItems())}get loadingRoot(){return this._loadingRoot}toggle(e){if(super.toggle(e),e.expanded)this._expandedFolders.push(e.data.value.path);else{const t=e.data.value.path,i=this._expandedFolders.indexOf(t);i>-1&&this._expandedFolders.splice(i,1)}e.expanded&&!this._hasRequestedItemsAtPath(e.data.value.path)&&this._getChildItems(e)}fetchDetails(e,t){const s=this._detailRequests[e];if(void 0===s||s===i.NotRequested){for(let e=t;e<this.value.length&&e<t+20;e++){const t=this.value[e].underlyingItem.data.value.pipeline;t&&(void 0!==this._detailRequests[t.id]&&this._detailRequests[t.id]!==i.NotRequested||(this._detailRequests[t.id]=i.Requested,this._batchForUpdates.push(t.id)))}this._batchForUpdates.length>0&&this._fetchDetailsDebounced()}}hasDetails(e){return this._detailRequests[e]===i.Available}get expandedFolders(){return this._expandedFolders.join("$")}folderRenamed(e,t){const i=this._expandedFolders.indexOf(e);i>-1&&(this._expandedFolders.splice(i,1),this._expandedFolders.push(t)),this.value.forEach((i=>{const s=i.underlyingItem.data.value;if(s.path===e){let r={name:s.name,path:t,isLoading:s.isLoading,isEmptyMarker:s.isEmptyMarker};if(s.folder){const e=this._pageContext.getService("IBuildLinkingService").getPipelinesFolderUrl(void 0,void 0,t);r.name=t.split("\\").reverse()[0],r.folder=s.folder,r.folder.path=t,r.folder.linkProps.href=e}else s.pipeline&&(r.pipeline=s.pipeline,r.pipeline.path=t);i.underlyingItem.data.value=r,this._addPathMapping(e,t)}else if(s.path.startsWith(e+"\\")){let r=s.path.replace(e+"\\",t+"\\"),n={name:s.name,path:r,isLoading:s.isLoading,isEmptyMarker:s.isEmptyMarker};if(s.folder){const e=this._pageContext.getService("IBuildLinkingService").getPipelinesFolderUrl(void 0,void 0,r);n.folder=s.folder,n.folder.path=r,n.folder.linkProps.href=e}else s.pipeline&&(n.pipeline=s.pipeline,n.pipeline.path=r);i.underlyingItem.data.value=n,this._addPathMapping(s.path,r)}}))}folderCreated(e){const t=e.path.substr(0,e.path.lastIndexOf("\\")),i=e.path.split("\\").reverse()[0],s=this._pageContext.getService("IBuildLinkingService").getPipelinesFolderUrl(void 0,void 0,e.path),r={data:new p.ObservableValue({name:i,path:e.path,isLoading:!1,isEmptyMarker:!1,folder:{path:e.path,name:i,linkProps:{href:s}}}),childItems:[]};if("\\"===this._rootPath&&""===t||t===this._rootPath)return this._addPathMapping(this._rootPath,e.path),void this.splice(void 0,void 0,[{items:[r]}]);this._addPathMapping(t,e.path);for(let e=0;e<this.value.length;e++)if(this.value[e].underlyingItem.data.value.folder&&this.value[e].underlyingItem.data.value.path===t){const i=this.value[e].underlyingItem;return void(i.expanded?this._addPipelineToTree(i,r):this._hasRequestedItemsAtPath(t)&&this._clearChildItems(i))}}folderDeleted(e){for(let t=0;t<this.value.length;t++)if(this.value[t].underlyingItem.data.value.folder&&this.value[t].underlyingItem.data.value.path===e){const e=this.value[t];return this.splice(e.parentItem?e.parentItem.underlyingItem:void 0,[e.underlyingItem],void 0),void(!e.parentItem||e.parentItem.underlyingItem.childItems&&0!==e.parentItem.underlyingItem.childItems.length||this.splice(e.parentItem.underlyingItem,void 0,[{items:[this._getEmptyFolderIndicator(e.parentItem.underlyingItem.data.value.path)]}]))}}pipelineRenamed(e,t){for(let i=0;i<this.value.length;i++){const s=this.value[i].underlyingItem.data.value,r=s.pipeline;if(void 0!==r&&r.id===e)return r.name=t,void(this.value[i].underlyingItem.data.value={pipeline:r,isEmptyMarker:!1,isLoading:!1,href:s.href,name:t,path:s.path})}}pipelineMoved(e,t,s){const r=this._findPipelineById(e);if(null==r)return;this._removeItem(r);const n=this._createNewPipelineItem(r,s,t);if(this._addPathMapping(r.underlyingItem.data.value.path,t),""===t||t===this._rootPath)this.splice(void 0,void 0,[{items:[n]}]);else{const e=this._findClosestParentFolder(t);e?e.underlyingItem.data.value.path===t?this._pipelineMovedToExistingFolder(e.underlyingItem,n):e.underlyingItem.expanded?this._pipelineMovedToNewSubFolderOfExpandedFolder(e.underlyingItem,n):(this._reloadFolder(e.underlyingItem),this._detailRequests[n.data.value.pipeline.id]=i.NotRequested):this._pipelineMovedToNewFolderAtRoot(n)}}pipelineDeleted(e){for(let t=0;t<this.value.length;t++){const i=this.value[t].underlyingItem.data.value.pipeline;if(void 0!==i&&i.id===e){const e=this.value[t].parentItem;void 0!==e?this.splice(e.underlyingItem,[this.value[t].underlyingItem],void 0):this.splice(void 0,[this.value[t].underlyingItem],void 0);break}}}setFilteredProvider(e){this._filteredProvider=e}getMappedPath(e){const t=this._pathMapping[e];return void 0!==t?t:e}_getChildItems(e){let t=e?e.data.value.path:this._rootPath;this._paths[t]=i.Requested,e&&setTimeout((()=>{if(this._paths[t]===i.Requested){let t=[{data:new p.ObservableValue({name:"",path:"",isLoading:!0,isEmptyMarker:!1})}];this.splice(e,void 0,[{items:t}])}}),300),this._source.getDataAsync("ms.vss-build-web.pipelines-data-provider",{path:t},!0).then((t=>{this._onChildItemsAvailable(t,e)}))}_getChildItemsOnPageLoad(){let e=this._rootPath;this._paths[e]=i.Available;let t=this._source.getData("ms.vss-build-web.pipelines-data-provider");const s=this._convertPipelinesDataToTreeItems(e,t);this.splice(void 0,void 0,[{items:s}])}_hasRequestedItemsAtPath(e){return this._paths[e]&&this._paths[e]!==i.NotRequested}_clearChildItems(e){this._paths[e.data.value.path]=i.NotRequested,e.childItems&&(e.childItems.forEach((e=>{e.data.value.pipeline?this._detailRequests[e.data.value.pipeline.id]=i.NotRequested:e.data.value.folder&&this._clearChildItems(e)})),this.splice(e,e.childItems))}_convertPipelinesDataToTreeItems(e,t){let i=[];return t&&(t.folders&&t.folders.forEach((t=>{if(t.path!==e){const e={childItems:[],expanded:this._isExpanded(t.path),data:new p.ObservableValue({name:t.path.split("\\").reverse()[0],path:t.path,isLoading:!1,isEmptyMarker:!1,folder:t})};i.push(e),e.expanded&&!this._hasRequestedItemsAtPath(e.data.value.path)&&this._getChildItems(e)}})),t.pipelines&&t.pipelines.forEach((e=>{i.push({childItems:void 0,data:new p.ObservableValue({name:e.name,path:e.path,isLoading:!1,isEmptyMarker:!1,pipeline:e,href:e.linkProps.href})})}))),i}matchTreeItemToBuildId(e,t){return e&&e.latestRun&&e.latestRun.id===t}_addPathMapping(e,t){void 0!==this._pathMapping[e]?this._pathMapping[t]=this._pathMapping[e]:this._pathMapping[t]=e,this._pathMapping[e]=e}_getEmptyFolderIndicator(e){return{data:new p.ObservableValue({isEmptyMarker:!0,isLoading:!1,name:"",path:e})}}_findPipelineById(e){for(let t=0;t<this.value.length;t++){const i=this.value[t],s=i.underlyingItem.data.value.pipeline;if(void 0!==s&&s.id===e)return i}return null}_removeItem(e){const t=e.parentItem;void 0!==t?(this.splice(t.underlyingItem,[e.underlyingItem],void 0),t.underlyingItem.childItems&&0!==t.underlyingItem.childItems.length||this.splice(t.underlyingItem,void 0,[{items:[this._getEmptyFolderIndicator(t.underlyingItem.data.value.path)]}])):this.splice(void 0,[e.underlyingItem],void 0)}_createNewPipelineItem(e,t,i){const s=e.underlyingItem.data.value,r=s.pipeline;return{data:new p.ObservableValue({pipeline:{id:r.id,isDraft:r.isDraft,isFavorite:r.isFavorite,latestRun:r.latestRun,linkProps:r.linkProps,name:t,path:i,processType:r.processType,queueStatus:r.queueStatus,uri:r.uri},isEmptyMarker:!1,isLoading:!1,href:s.href,name:t,path:i})}}_findClosestParentFolder(e){let t=null;for(let i=0;i<this.value.length;i++){const s=this.value[i];if(!s.underlyingItem.data.value.folder)continue;const r=s.underlyingItem.data.value.path;if(r===e)return s;e.startsWith(r)&&s.depth>(t?t.depth:-1)&&(t=s)}return t}_pipelineMovedToExistingFolder(e,t){const s=t.data.value.pipeline;s&&(e.expanded?this._addPipelineToTree(e,t):this._hasRequestedItemsAtPath(s.path)&&this._reloadFolder(e),this._detailRequests[s.id]=i.NotRequested)}_pipelineMovedToNewSubFolderOfExpandedFolder(e,t){const i=t.data.value.pipeline;if(!i)return;const s=e.data.value.path,r=this._removePrefix(i.path,s).split("\\"),n=s+"\\"+r[1],a=this._createFolderItem(n);this.splice(e,void 0,[{items:[a]}]);2===r.length&&this._addPipelineToTree(a,t)}_pipelineMovedToNewFolderAtRoot(e){const t=e.data.value.pipeline;if(!t)return;const s=t.path.split("\\"),r="\\"+s[1],n=this._createFolderItem(r);this.splice(void 0,void 0,[{items:[n]}]);2===s.length?(this._addPipelineToTree(n,e),this._detailRequests[t.id]=i.NotRequested):this._reloadFolder(n)}_createFolderItem(e){const t=this._pageContext.getService("IBuildLinkingService").getPipelinesFolderUrl(void 0,void 0,e),i=e.split("\\").reverse()[0];return{data:new p.ObservableValue({name:i,path:e,isLoading:!1,isEmptyMarker:!1,folder:{path:e,name:i,linkProps:{href:t}}}),childItems:[]}}_removePrefix(e,t){return e.startsWith(t)?e.slice(t.length):e}_reloadFolder(e){this._clearChildItems(e),this._getChildItems(e)}}t[e].PipelineTreeItemProvider=s;class r extends ve.TreeItemProvider{constructor(e,t,i){super([]);let s=[];if(i){let r=[],n=[];i.forEach((i=>{if(i.path===t)n.push({childItems:void 0,data:new p.ObservableValue({name:i.name,path:i.path,isLoading:!1,isEmptyMarker:!1,pipeline:i,href:i.linkProps.href})});else{let s=i.path;s.startsWith(t)&&(s=s.substring(t.length)),s.startsWith("\\")||(s="\\"+s);let n=s.split("\\")[1],a="\\"===t?"\\"+n:t+"\\"+n;const o=e.pageContext.getService("IBuildLinkingService").getPipelinesFolderUrl(void 0,void 0,i.path);let l=!1;if(r.forEach((e=>{e.data.value.path===a&&(this._populateParentFolders(i,e),l=!0)})),!l){let e={childItems:[],expanded:!0,data:new p.ObservableValue({name:n,path:a,isLoading:!1,isEmptyMarker:!1,folder:{path:a,name:n,linkProps:{href:o}}})};r.push(e),this._populateParentFolders(i,e)}}})),s=r.concat(n)}this.splice(void 0,void 0,[{items:s}])}containsRun(e){let t=!1;return this.value.forEach((i=>{const s=i.underlyingItem.data.value.pipeline;s&&s.latestRun&&s.latestRun.id==e&&(t=!0)})),t}updateRuns(e){e&&e.forEach((e=>{this.value.forEach((t=>{const i=t.underlyingItem.data.value,s=i.pipeline;if(s&&s.latestRun&&s.latestRun.id===e.id){const r=s.latestRun.sourceVersionMessage;s.latestRun=e,s.latestRun.sourceVersionMessage=r,t.underlyingItem.data.value=i}}))}))}_populateParentFolders(e,t){const i=e.path;if(t.data.value.path===i)t.childItems||(t.childItems=[]),t.childItems.push({childItems:void 0,data:new p.ObservableValue({name:e.name,path:e.path,isLoading:!1,isEmptyMarker:!1,pipeline:e,href:e.linkProps.href})});else{let s=i.substring(t.data.value.path.length).split("\\")[1],r=t.data.value.path+"\\"+s,n=!1;if(t.childItems&&t.childItems.forEach((t=>{t.data.value.folder&&t.data.value.path===r&&(this._populateParentFolders(e,t),n=!0)})),!n){let i={childItems:[],expanded:!0,data:new p.ObservableValue({name:s,path:r,isLoading:!1,isEmptyMarker:!1,folder:{path:r,name:s}})};t.childItems||(t.childItems=[]),t.childItems.push(i),this._populateParentFolders(e,i)}}}}t[e].FilteredPipelineTreeItemProvider=r}("TabsPipelinesPipelinesTreeItemProvider"),function(e){_t=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._onActivate=(e,t)=>{if(t.data.underlyingItem.data.value.pipeline&&t.data.underlyingItem.data.value.href){const i=this.context.pageContext;e.ctrlKey||e.metaKey?window.open(t.data.underlyingItem.data.value.href,"_blank"):(0,U.onClickFPS)(i,t.data.underlyingItem.data.value.href,!0,e)}else t.data.underlyingItem.data.value.folder&&this._treeItemProvider.toggle(t.data.underlyingItem)},this._onStoreChanged=()=>{this.setState({filtered:this._store.isListFiltered(),loading:this._store.isListFiltered()?this._store.isLoadingData():this._treeItemProvider.loadingRoot.value})},this._onLoadingChanged=()=>{this.setState({loading:this._treeItemProvider.loadingRoot.value}),setTimeout((()=>this._markTTI()),0)},this._renderFavoriteCell=(e,t,i,s)=>{let n=r.createElement("span",null);const o=this.context.pageContext.getService("IFavoritesService");let l=!1;const d=s.underlyingItem.data.value.pipeline;if(o.canUseFavorites()&&d)if(d.isFavorite){l=!0;const e=e=>{e.preventDefault(),e.stopPropagation(),this.props.favoritesActionCreator.unfavoriteDefinition({id:d.id,name:d.name,uri:d.uri}),d.isFavorite=!1,this._treeItemProvider.value.forEach((e=>{const t=e.underlyingItem.data.value,i=t.pipeline;i&&i.id===d.id&&(i.isFavorite=!1,e.underlyingItem.data.value=t)}))};n=r.createElement("div",{className:"right-align flex-row"},r.createElement(a.Button,{primary:!1,className:"favorite-icon-color",subtle:!0,iconProps:{iconName:"FavoriteStarFill"},ariaLabel:Ve.RemoveFromMyFavorites,onClick:e,excludeTabStop:!0}))}else{const e=e=>{e.preventDefault(),e.stopPropagation(),this.props.favoritesActionCreator.favoriteDefinition({id:d.id,name:d.name,uri:d.uri}),d.isFavorite=!0,this._treeItemProvider.value.forEach((e=>{const t=e.underlyingItem.data.value,i=t.pipeline;i&&i.id===d.id&&(i.isFavorite=!0,e.underlyingItem.data.value=t)}))};n=r.createElement("div",{className:"right-align flex-row"},r.createElement(a.Button,{primary:!1,subtle:!0,iconProps:{iconName:"FavoriteStar"},ariaLabel:Ve.AddToMyFavorites,onClick:e,excludeTabStop:!0}))}return r.createElement(u.TableCell,{className:"bolt-table-cell-side-action pipelines-favorite-cell",columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:(0,f.css)("flex-column","padding-right-4",!l&&"bolt-table-cell-content-reveal")},n))},this._renderTreeRow=(e,t,i)=>{const s={id:"name",name:Ve.Name,width:-100,renderCell:this._renderTreeCell},r=new u.ColumnMore(this._getMenuForItem,this._showMenuForItem),n={id:"favorite",width:new p.ObservableValue(2.625),widthStyle:1,className:"favorite-cell",renderCell:this._renderFavoriteCell,ariaLabel:Ve.Favorite},a=t?t.underlyingItem.data:void 0,o=Object.assign({},i);return a&&a.value.isEmptyMarker&&(o.singleClickActivation=!1),(0,Se.renderTreeRow)(e,t,o,[s,n,r],a)},this._renderTreeCell=(e,t,i,s)=>{const{underlyingItem:n}=s;let a=r.createElement(C.Observer,{item:n.data},(()=>{var t,i;if(n.data.value.isLoading)return r.createElement("span",{className:"bolt-list-cell-child flex-row flex-center bolt-list-cell-text"},r.createElement(T.Spinner,{size:"small",className:"margin-right-8"}),r.createElement("span",{className:"secondary-text"},Ve.Loading));if(n.data.value.isEmptyMarker){const e=this.context.pageContext,t=this._treeItemProvider.getMappedPath(n.data.value.path),i=(0,ee.isFeatureFlagEnabled)(e,"Build2.CreateBuildDefinitionPermission",!1)?Re.BuildRequiredPermissions.CreateBuildDefinition:Re.BuildRequiredPermissions.EditBuildDefinition,s=this.props.security.hasFolderPermission(t,i),a=e.getService("IBuildLinkingService"),o=e.getService("IStartRightExtensionService").getCreatePipelineUrlByPipelineFolder(e,n.data.value.path)||a.getNewDefinitionEditUrl(n.data.value.path);return r.createElement("span",{className:"bolt-list-cell-child flex-row flex-center bolt-list-cell-text"},r.createElement("span",{className:"secondary-text"},Ve.EmptyFolder,"Â ",s&&r.createElement(P.FPSLink,{excludeTabStop:!0,href:o},Ve.EmptyFolderLink)))}let s,a,l,d=n.data.value.name,u=!1,h=null===(i=null===(t=n.data.value.pipeline)||void 0===t?void 0:t.linkProps)||void 0===i?void 0:i.href;if(n.data.value.folder)return l=r.createElement(c.Icon,{iconName:"FabricFolderFill",className:"margin-right-8 pipelines-folder-icon"}),n.data.value.folder.linkProps&&n.data.value.folder.linkProps.href?r.createElement("span",{className:"bolt-list-cell-child flex-row flex-center bolt-list-cell-text"},r.createElement(v.Link,{className:"bolt-table-link bolt-table-inline-link flex-row flex-center text-ellipsis small-margin",excludeTabStop:!0,href:n.data.value.folder.linkProps.href,ariaLabel:(0,o.format)(Ve.FolderAriaLabel,d),removeUnderline:!0},l,r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"inline-flex-row scroll-hidden pipeline-name"},r.createElement("span",{className:"text-ellipsis"},d))))):r.createElement("span",{className:"bolt-list-cell-child flex-row flex-center bolt-list-cell-text"},l,!!h&&r.createElement(v.Link,{className:"bolt-table-link bolt-table-inline-link text-ellipsis pipeline-name small-margin",href:h,tooltipProps:{overflowOnly:!0},ariaLabel:this.isPipelineNameAnnouncementFeatureEnabled?d:Ve.PipelineColumnName,onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,h,!0,e)}},d),!h&&r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"inline-flex-row scroll-hidden pipeline-name","aria-label":this.isPipelineNameAnnouncementFeatureEnabled?d:void 0},r.createElement("span",{className:"text-ellipsis"},d))));if(n.data.value.pipeline){const t=n.data.value.pipeline;if(u=t.isDraft,this.state.filtered||this._treeItemProvider.fetchDetails(t.id,e),this.state.filtered||this._treeItemProvider.hasDetails(t.id))if(t.latestRun){s=(0,L.formatPipelineRunName)(t.latestRun.number,t.latestRun.sourceVersionMessage,t.latestRun.appendCommitMessageToRunName);a=this.context.pageContext.getService("IBuildLinkingService").getBuildUrl(t.latestRun.id);const e=(0,k.getBuildStatusIndicatorData)(t.latestRun.status,t.latestRun.result);l=r.createElement("div",{className:"margin-right-8"},r.createElement(x.Tooltip,{text:e.label},r.createElement("span",{className:"flex-row"},r.createElement(R.Status,Object.assign({ariaLabel:e.statusProps.ariaLabel||e.label,size:"16"},e.statusProps)))))}else{s=Ve.NoRunsYet;const e=(0,k.getBuildStatusIndicatorData)(0);l=r.createElement("div",{className:"margin-right-8"},r.createElement(x.Tooltip,{text:e.label},r.createElement("span",{className:"flex-row"},r.createElement(R.Status,Object.assign({size:"16"},e.statusProps)))))}else l=r.createElement("div",{className:"margin-right-8"},r.createElement(T.Spinner,{size:"small"}))}return r.createElement("span",{className:"bolt-list-cell-child flex-row flex-center bolt-list-cell-text"},l,!!h&&r.createElement("span",{className:"inline-flex-row scroll-hidden pipeline-name"},r.createElement(v.Link,{className:"bolt-table-link bolt-table-inline-link text-ellipsis small-margin",href:h,removeUnderline:!0,tooltipProps:{overflowOnly:!0},ariaLabel:this.isPipelineNameAnnouncementFeatureEnabled?d:Ve.PipelineColumnName,onClick:e=>{(0,U.onClickFPS)(this.context.pageContext,h,!0,e)}},d,u&&r.createElement("sup",{className:"font-size-xxs pipelines-draft-indicator"},Ve.Draft))),!h&&r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"inline-flex-row scroll-hidden pipeline-name","aria-label":this.isPipelineNameAnnouncementFeatureEnabled?d:void 0},r.createElement("span",{className:"text-ellipsis"},d),u&&r.createElement("sup",{className:"font-size-xxs pipelines-draft-indicator"},Ve.Draft))),s&&a&&r.createElement("span",{className:"secondary-text text-ellipsis flex-row"},r.createElement(v.Link,{className:"bolt-table-link bolt-table-inline-link text-ellipsis small-margin",excludeTabStop:!0,href:a,removeUnderline:!0,tooltipProps:{overflowOnly:!0},ariaLabel:Ve.LastRunColumnName},s)),s&&!a&&r.createElement(x.Tooltip,{overflowOnly:!0},r.createElement("span",{className:"secondary-text text-ellipsis margin-left-8"},s)))}));return(0,Se.ExpandableTreeCell)({children:a,columnIndex:t,contentClassName:void 0,treeColumn:i,treeItem:s})},this._getHeaderCommandBarItems=()=>{const e=(0,A.getTFSPageData)(this.context.pageContext);if(!e||!e.project||!this.props.security.isMember())return[];const t=e.project.id;return[{id:"root-new-folder",text:Ve.NewFolder,important:!0,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const i={pageContext:this.context.pageContext,projectId:t,parentPath:this.props.rootPath,onClose:e,onFolderCreated:e=>{this._treeItemProvider.folderCreated(e),1===this._treeItemProvider.length&&this.setState({loading:!1}),(0,V.announce)((0,o.format)(Ve.FolderCreated,e.path))}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciNewFolderComponent"},i),null)}))}}]},this._getMenuForItem=e=>{const t=e.underlyingItem.data.value.folder,i=e.underlyingItem.data.value.pipeline,s=(0,A.getTFSPageData)(this.context.pageContext);if(!s||!s.project||!this.props.security.isMember())return{id:"folder-menu",items:[]};const r=s.project.id;return t?this._getMenuForFolder(t,r):i?this._getMenuForPipeline(i,r):{id:"folder-menu",items:[]}},this._getMenuForFolder=(e,t)=>{const i=this.context.pageContext,s=i.getService("IBuildLinkingService"),n=i.getService("IStartRightExtensionService").getCreatePipelineUrlByPipelineFolder(i,e.path)||s.getNewDefinitionEditUrl(e.path),a=[];a.push({text:Ve.Rename,id:"folder-menu-rename",onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const s={pageContext:this.context.pageContext,folder:{path:e.path},projectId:t,saveAsTemplate:!1,onClose:i,onFolderSaved:(e,t)=>{this._treeItemProvider.folderRenamed(t,e.path),(0,V.announce)((0,o.format)(Ve.FolderRenamed,t,e.path))}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciSaveDefinitionComponent"},s),null)}))}});const l=this._treeItemProvider.getMappedPath(e.path),d=(0,ee.isFeatureFlagEnabled)(i,"Build2.CreateBuildDefinitionPermission",!1)?Re.BuildRequiredPermissions.CreateBuildDefinition:Re.BuildRequiredPermissions.EditBuildDefinition;this.props.security.hasFolderPermission(l,d)&&a.push({text:Ve.NewPipeline,id:"folder-menu-new-pipeline",href:n,onActivate:(e,t)=>{(0,U.onClickFPS)(i,n,!0,t)}}),a.push({text:Ve.NewFolder,id:"folder-menu-new-folder",onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const s={pageContext:this.context.pageContext,projectId:t,parentPath:e.path,onClose:i,onFolderCreated:e=>{this._treeItemProvider.folderCreated(e),(0,V.announce)((0,o.format)(Ve.FolderCreated,e.path))}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciNewFolderComponent"},s),null)}))}}),a.push({text:Ve.Security,id:"folder-menu-security",onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const i={path:e.path};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciPermissionsComponent"},i),null)}))}}),a.push({text:Ve.Delete,id:"folder-menu-delete",onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((i=>{const s={pageContext:this.context.pageContext,path:e.path,projectId:t,onClose:i,onFolderDeleted:e=>{this._treeItemProvider.folderDeleted(e),this._store.fetchHasDeletedPipelines(!0),(0,V.announce)((0,o.format)(Ve.FolderDeleted,e)),0===this._treeItemProvider.length&&this.setState({loading:!1})}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciDeleteDefinitionComponent"},s),null)}))}});const c=(0,fe.getMenuItems)(this.context.pageContext,"ms.vss-build-web.pipelines-folder-menu",e);return a.push(...c.value),{id:"folder-menu",items:a}},this._getMenuForPipeline=(e,t)=>{const i=this._treeItemProvider.getMappedPath(e.path),s=null!=i?i:e.path,r=this.props.security.canEditDefinition({id:e.id,path:s}),n=this.props.security.canQueueBuild({id:e.id,path:s}),a=this.props.security.hasDefinitionPermission({id:e.id,path:s},Re.BuildRequiredPermissions.DeleteBuildDefinition),o=this.context.pageContext,l=o.getService("IBuildLinkingService"),d=l.getDefinitionEditUrl(e.id),c=l.getYamlPipelineEditUrl(e.id),u=e.processType===B.ProcessType.Yaml,h=2===e.queueStatus,p=[];return p.push(at.GetEditViewMenuItem(o,r,u?c:d)),n&&!h&&p.push(at.GetRunMenuItem(o,t,e.id)),p.push(at.GetSecurityMenuItem(o,t,e.id)),r&&p.push(at.GetRenameMoveMenuItem(o,t,e.id,(t=>{t.path!==e.path?this._treeItemProvider.pipelineMoved(t.id,t.path,t.name):this._treeItemProvider.pipelineRenamed(t.id,t.name)}))),a&&p.push(at.GetDeleteMenuItem(o,t,e.id,(e=>{[e.id,...e.drafts.map((e=>e.id))].forEach((e=>this._treeItemProvider.pipelineDeleted(e))),0===this._treeItemProvider.length&&this.setState({loading:!1})}))),{id:"folder-menu",items:p}},this._showMenuForItem=e=>this.props.security.isMember()&&(void 0!==e.underlyingItem.data.value.folder||void 0!==e.underlyingItem.data.value.pipeline),this._store=e.store,this._treeItemProvider=new St.PipelineTreeItemProvider(this.context.pageContext,e.signalRHub,e.isPageLoad,e.store.isListFiltered(),this.props.rootPath,this.props.treeState),this.state={loading:this._treeItemProvider.loadingRoot.value,filtered:this._store.isListFiltered()},this.isPipelineNameAnnouncementFeatureEnabled=(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Pipelines.PipelineNameAnnouncement",!1)}render(){if(this.state.loading)return r.createElement(b.Card,{className:"flex-grow pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement(T.Spinner,{className:"pipelines-filter-spinner",size:"large",label:Ve.Loading}));const e={id:"name",name:Ve.Name,width:-100,renderCell:this._renderTreeCell},t=new u.ColumnMore(this._getMenuForItem,this._showMenuForItem),i={id:"favorite",width:new p.ObservableValue(2.625),widthStyle:1,className:"favorite-cell",renderCell:this._renderFavoriteCell,ariaLabel:Ve.Favorite};if(this.state.filtered){if(0===this._store.getPipelines().length){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png");return r.createElement(b.Card,{className:"flex-grow pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imageAltText:Ve.NoResultsFound,imagePath:e,secondaryText:Ve.NoResultsFound})))}{const s=new St.FilteredPipelineTreeItemProvider(this.context,this.props.rootPath,this._store.getPipelines());return this._treeItemProvider.setFilteredProvider(s),r.createElement(b.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1},titleProps:{text:Ve.FilteredFolderView,size:0}},r.createElement(Se.Tree,{ariaLabel:Ve.FilteredFolderView,columns:[e,i,t],itemProvider:s,showLines:!0,singleClickActivation:!0,onActivate:this._onActivate,onToggle:(e,t)=>{s.toggle(t.underlyingItem)},scrollable:!1}))}}this._treeItemProvider.setFilteredProvider(void 0);let s=Ve.FolderView;if("\\"!==this.props.rootPath&&(s=(0,o.format)(Ve.FolderViewForFolder,this.props.rootPath)),0===this._treeItemProvider.length){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png");return r.createElement(b.Card,{className:"flex-grow bolt-table-card pipelines-minimum-card-height",contentProps:{contentPadding:!1},titleProps:{text:s,size:0},headerCommandBarItems:this._getHeaderCommandBarItems()},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imagePath:e,imageAltText:Ve.ZeroDataNoCreatePipelinesAltText,secondaryText:Ve.ZeroDataNoCreatePipelinesPrimary})))}return r.createElement(b.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1},titleProps:{text:s,size:0},headerCommandBarItems:this._getHeaderCommandBarItems()},r.createElement(Se.Tree,{ariaLabel:s,className:"pipelines-tree",columns:[e,i,t],itemProvider:this._treeItemProvider,showLines:!0,singleClickActivation:!0,onActivate:this._onActivate,onToggle:(e,t)=>{this._treeItemProvider.toggle(t.underlyingItem),(0,xe.updateTreeStateUrl)(this.context.pageContext,(0,Le.utoa)(this._treeItemProvider.expandedFolders))},scrollable:!1,renderRow:this._renderTreeRow}))}componentDidMount(){this._store.addListener(this._onStoreChanged),this._treeItemProvider.loadingRoot.subscribe(this._onLoadingChanged),this._treeItemProvider.loadRoot(),this._store.fetchHasDeletedPipelines(),this._markTTI()}componentWillUnmount(){this._store.removeListener(this._onStoreChanged),this._treeItemProvider.loadingRoot.unsubscribe(this._onLoadingChanged),(0,xe.updateTreeStateSettings)(this.context.pageContext,(0,Le.utoa)(this._treeItemProvider.expandedFolders))}_markTTI(){this._ttiMarked||this._treeItemProvider.loadingRoot.value||(this._ttiMarked=!0,new Ge.Performance(this.context.pageContext).mark("foldersView"))}}t[e].PipelinesTreeView=i}("TabsPipelinesPipelinesTreeView"),function(){var e;t.PipelinesFolderView={},function(e){e.Runs="runs",e.Pipelines="pipelines"}(e||(e={}));class i extends f.VssComponent{constructor(t,i){super(t,i),this._isPageLoad=!0,this._ttiMarked=!1,this._treeState="",this._onBackClick=e=>{const t=this.context.pageContext,i=t.getService("IBuildLinkingService"),s=this._getPath().replace(/(\\)+$/,"").split("\\");let r;r=s.length>2?i.getFolderUrl(s.slice(0,length-1).join("\\")):i.getFolderViewUrl(),(0,U.onClickFPS)(t,r,!0)},this._getFolderName=e=>{if(!e)return"";const t=e.replace(/(\\)+$/,"").split("\\").reverse();return t&&t.length>0?t[0]:""},this._getPath=()=>{const e=this.context.pageContext.getService("IVssHistoryService").getState();let t=e.definitionScope?e.definitionScope:e.path;return t.length>1&&t.endsWith("\\")&&(t=t.substr(0,t.length-1)),t},this._onTabChanged=e=>{this._isPageLoad=!1,new Ge.Performance(this.context.pageContext).onFPS(),this._hubViewState.selectedPivot.value=e},this._onFilterChanged=(e,t)=>{this.state.filterHasChanges.value=this._runsAppliedFilterStore.filter.hasChangesToReset()},this._getTabs=()=>{const t=this.context.pageContext.getService("IVssHistoryService").getState(),i=Object.keys(t).some((e=>e.endsWith("Filter")&&"pipelineNameFilter"!==e)),s=new p.ObservableValue(i),n=new p.ObservableCollection;return n.push([{id:e.Pipelines,name:Ve.PipelinesTabName,order:2,url:this._foldersUrl.value,render:()=>r.createElement("div",{className:"page-content page-content-top"},r.createElement(_t.PipelinesTreeView,{store:this._store,signalRHub:this._signalRActionHub,security:this._security,favoritesActionCreator:this._favoritesActionCreator,isPageLoad:this._isPageLoad,treeState:this._treeState,rootPath:this._folderPath.value?this._folderPath.value:"\\"})),renderFilterBar:e=>{if(e)return r.createElement("div",{className:"definitions-filterbar flex-row"},r.createElement(O.InlineKeywordFilterBarItem,{filter:this._pipelineFilter,placeholder:Ve.PipelinesFilterPlaceholderText,filterItemKey:qe.PipelineFilterKeys.NameFilter,maxTextLength:50}))}},{id:e.Runs,name:Ve.RunsTabName,order:3,url:this._runsUrl.value,render:()=>r.createElement(r.Fragment,null,r.createElement(C.Observer,{showFilterBar:s},(e=>e.showFilterBar?r.createElement(ht.RunsFilterBar,{appliedFilterStore:this._runsAppliedFilterStore,definitionId:void 0}):r.createElement(r.Fragment,null))),r.createElement("div",{className:"page-content page-content-top"},r.createElement(bt.RunsTable,{appliedFilterStore:this._runsAppliedFilterStore,isPageLoad:this._isPageLoad,signalRActionHub:this._signalRActionHub,security:this._security,definitionScope:this._folderPath.value}))),renderFilterBar:e=>{if(e)return r.createElement(C.Observer,{filterHasChanges:this.state.filterHasChanges},(e=>r.createElement(Ne.HeaderCommandBar,{items:[(0,Ne.getFilterItem)((()=>s.value=!s.value),e.filterHasChanges)]})))}}]),n},this._getCommandBarItems=()=>{const e=this.context.pageContext.getService("IVssPageService").getData(),t=(0,A.getTFSPageData)(this.context.pageContext);if(!e||!t||!t.project)return[];if(!this._security.isMember())return[];const i=this._folderPath.value||"",s=t.project.id,n=this.context.pageContext,a=n.getService("IBuildLinkingService"),o=n.getService("IStartRightExtensionService").getCreatePipelineUrlByPipelineFolder(n,i)||a.getNewDefinitionEditUrl(i);let l=[];l.push({text:Ve.Security,id:"folder-menu-security",important:!0,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const t={path:i};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciPermissionsComponent"},t),null)}))}});const d=(0,ee.isFeatureFlagEnabled)(n,"Build2.CreateBuildDefinitionPermission",!1)?Re.BuildRequiredPermissions.CreateBuildDefinition:Re.BuildRequiredPermissions.EditBuildDefinition;return this._security.hasFolderPermission(i,d)&&l.push({id:"new-pipeline-command",important:!0,isPrimary:!0,href:o,onActivate:(e,t)=>{(0,U.onClickFPS)(n,o,!0,t)},text:Ve.NewPipeline}),l.push({text:Ve.Rename,id:"folder-menu-rename",important:!1,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const t={pageContext:this.context.pageContext,folder:{path:i},projectId:s,saveAsTemplate:!1,onClose:e,onFolderSaved:(e,t)=>{this._folderPath.value=e.path,(0,U.onClickFPS)(this.context.pageContext,a.getFolderUrl(e.path),!0)}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciSaveDefinitionComponent"},t),null)}))}}),l.push({text:Ve.Delete,id:"folder-menu-delete",important:!1,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((e=>{const t={pageContext:this.context.pageContext,path:i,projectId:s,onClose:e,onFolderDeleted:e=>{this._onFolderDeleted()}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciDeleteDefinitionComponent"},t),null)}))}}),l},this._onFolderDeleted=()=>{const e=this.context.pageContext.getService("IBuildLinkingService").getDefinitionUrl(void 0);(0,U.onClickFPS)(this.context.pageContext,e,!0)},this._folderPath=new p.ObservableValue(this._getPath());const s=this.context.pageContext.getService("IVssHistoryService").getState(),n=Object.keys(s).some((e=>e.endsWith("Filter")));this._runsFilter=new H.Filter,this._runsFilterToggled=new p.ObservableValue(n),this._runsAppliedFilterStore=new ct.RunsAppliedFilterStore(this._runsFilter);const a=(0,A.getTFSPageData)(this.context.pageContext),o=i.pageContext.getService("IVssPageService").getData();this._signalRActionHub=new Me.BuildSignalRActionHub,a&&a.project&&o&&(this._signalRHub=this.props.signalRHub||new ot.BuildSignalRHub({actionCreator:new Me.BuildSignalRActionCreator({actionHub:this._signalRActionHub}),hostInformation:{hostId:o.hostId,isHosted:o.isHosted,hostPath:o.hostPath,projectId:a.project.id},pageContext:this.context.pageContext,projectId:a.project.id})),this._permissions=new Fe.PermissionsStore({pageContext:i.pageContext}),this._security=new Re.Security({projectId:a&&a.project?a.project.id:"",store:this._permissions}),this._favoritesActionHub=new Ue.DefinitionFavoritesActionHub,a&&a.project&&o&&(this._favoritesActionCreator=new Ue.DefinitionFavoritesActionCreator({actionHub:this._favoritesActionHub,favoritesService:i.pageContext.getService("IFavoritesService"),project:a.project,currentUser:o.user})),this._pipelineFilter=new H.Filter;this.context.pageContext.getService("IPageStateHistoryService").registerFilter(this._pipelineFilter,"pipeline",[{dataType:"string",filterKey:qe.PipelineFilterKeys.NameFilter,historyBehavior:0}]),this._hubViewState=new De.VssHubViewState(i.pageContext,{defaultPivot:e.Pipelines}),this._runsUrl=this._hubViewState.createObservableUrl({view:e.Runs}),this._foldersUrl=this._hubViewState.createObservableUrl({view:e.Pipelines}),this._treeState=(0,xe.getTreeState)(this.context.pageContext),this._store=new mt.PipelinesStore({pageContext:i.pageContext,contributionActionHub:new w.ContributionDataActionHub,favoritesActionHub:this._favoritesActionHub,signalRActionHub:this._signalRActionHub,pipelinesFilter:this._pipelineFilter,rootFolder:this._folderPath.value?this._folderPath.value:"\\",ignoreInitialData:this._hubViewState.selectedPivot.value===e.Pipelines}),this.state={tabs:this._getTabs(),filterHasChanges:new p.ObservableValue(!1)}}render(){return r.createElement(C.Observer,{folderPath:this._folderPath},(e=>r.createElement(Be.Surface,{background:1},r.createElement(X.Page,{className:"pipelines-page",selectedTabId:this._hubViewState.selectedPivot,tabProviders:this.state.tabs},r.createElement(J.Header,{title:this._getFolderName(e.folderPath),titleSize:1,commandBarItems:this._getCommandBarItems(),titleIconProps:{iconName:"FabricFolderFill",className:"pipelines-folder-icon font-size-ll"},backButtonProps:{onClick:this._onBackClick}}),r.createElement(se.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged}),r.createElement(se.TabContent,null)))))}componentDidMount(){this._signalRHub.watchProject(),this._runsAppliedFilterStore.filter.subscribe(this._onFilterChanged),(0,s.registerErrorHandler)((e=>{if(e){this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:e.message,level:2})}})),this._markTTI()}_markTTI(){this._ttiMarked||(new Ge.Performance(this.context.pageContext).mark("folderView",void 0,this._folderPath.value),this._ttiMarked=!0)}componentWillUnmount(){this._signalRHub.dispose(),this._runsAppliedFilterStore.filter.unsubscribe(this._onFilterChanged),(0,s.registerErrorHandler)((e=>{})),(0,xe.clearTreeStateOnUnmount)(this.context.pageContext)}}f.Components.add("pipelines-folder",i)}(),function(e){Ct=t[e]={};class i extends f.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._onStoreChanged=()=>{this._itemProvider.splice(0,this._itemProvider.length,...(0,ft.getInternalPipelineData)(this._store)),this.setState({loading:this._store.isLoadingData(),filtered:this._store.isListFiltered()})},this._renderStatusIcon=(e,t)=>{const i=(0,k.getBuildStatusIndicatorData)(e.latestRun?e.latestRun.status:0,e.latestRun?e.latestRun.result:void 0);return r.createElement(x.Tooltip,{text:i.label},r.createElement("span",{className:"flex-row"},r.createElement(R.Status,Object.assign({ariaLabel:i.statusProps.ariaLabel||i.label,className:t},i.statusProps,{size:"24"}))))},this._renderPipelineName=e=>r.createElement("span",{className:"inline-flex-row scroll-hidden font-weight-semibold body-m"},!!e.href&&r.createElement(v.Link,{className:"bolt-table-link bolt-link no-underline-link text-ellipsis small-margin",href:e.href,tooltipProps:{overflowOnly:!0},onClick:t=>{(0,U.onClickFPS)(this.context.pageContext,e.href,!0,t)}},e.name),!e.href&&r.createElement(x.Tooltip,{overflowOnly:!0,text:e.name},r.createElement("span",{className:"text-ellipsis"},e.name)),e.isDraft&&r.createElement("sup",{className:"font-size-xxs pipelines-draft-indicator"},Ve.Draft)),this._getLastRunText=e=>{let t="";return e.latestRun&&(t=(0,L.formatPipelineRunName)(e.latestRun.number,e.latestRun.sourceVersionMessage,e.latestRun.appendCommitMessageToRunName)),t},this._renderNameCell=(e,t,i,s)=>{let n;if("\\"===s.path)n=r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,contentClassName:"scroll-hidden"},this._renderStatusIcon(s,"icon-large-margin"),r.createElement("div",{className:"flex-row scroll-hidden"},this._renderPipelineName(s)));else{const e=s.path.substr(1);n=r.createElement(u.TwoLineTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,className:"scroll-hidden",iconProps:{render:()=>this._renderStatusIcon(s,"icon-large-margin")},line1:r.createElement("div",{className:"flex-row scroll-hidden"},this._renderPipelineName(s)),line2:r.createElement("span",{className:"fontSize secondary-text flex-row flex-baseline text-ellipsis pipeline-firefox-fix"},r.createElement(c.Icon,{iconName:"Folder",className:"icon-margin"}),r.createElement(x.Tooltip,{overflowOnly:!0,text:e},r.createElement("span",{className:"text-ellipsis",key:"run-folder-text"},e)))})}return n},this._renderDetailsCell=(e,t,i,s)=>{if(s.latestRun){const e=this.context.pageContext,l=e.getService("IBuildLinkingService").getBuildUrl(s.latestRun.id);let d=this._getLastRunText(s);const h=r.createElement(v.Link,{className:"bolt-table-link bolt-table-inline-link fontSizeM text-ellipsis",excludeTabStop:!0,href:l,tooltipProps:{overflowOnly:!0},onClick:t=>{(0,U.onClickFPS)(e,l,!0,t)}},d),p="";let g,m;s.latestRun.requestedForId&&((0,Ae.userHasClaim)(this.context.pageContext,"member")&&(m=this._identityService.getIdentityImageUrl(s.latestRun.requestedForId)),g=r.createElement("span",{className:"padding-left-4"},r.createElement(ue.VssPersona,{className:"v-align-middle",imageUrl:m,size:"extra-small"})));var n=s.latestRun.sourceRepositoryId,a=s.latestRun.sourceRepositoryName,o=s.latestRun.sourceRepositoryUrl;(0,ee.isFeatureFlagEnabled)(this.context.pageContext,"Build2.SelectTriggeringRepositoriesBasedOnSHA")&&(256===s.latestRun.reason&&s.latestRun.sourceRepositoryId!==s.latestRun.triggerInfo["pr.triggerRepository"]?(n=s.latestRun.triggerInfo["pr.triggerRepository"],a="",o=""):s.latestRun.triggerInfo["ci.triggerRepository"]&&s.latestRun.sourceRepositoryId!==s.latestRun.triggerInfo["ci.triggerRepository"]&&(n=s.latestRun.triggerInfo["ci.triggerRepository"],a="",o=""));const f=r.createElement(x.Tooltip,{overflowOnly:!0,text:p},r.createElement("span",{className:"fontSize secondary-text flex-row flex-baseline text-ellipsis bolt-table-inline-link-left-padding pipeline-firefox-fix"},r.createElement(c.Icon,{iconName:We.getReasonIcon(s.latestRun.reason),className:"icon-margin"}),r.createElement("span",{className:"text-ellipsis flex-row",key:"run-reason-text"},We.getReasonText(s.latestRun.reason,!!m),g),r.createElement(j.BranchLink,{repositoryType:s.latestRun.sourceRepositoryType,repositoryName:a,repositoryId:n,repositoryUrl:o,branch:s.latestRun.sourceBranch,monospace:!0})));return r.createElement(u.TwoLineTableCell,{className:"bolt-table-cell-content-with-inline-link no-v-padding",columnIndex:t,tableColumn:i,key:"col-"+t,line1:h,line2:f})}return r.createElement(u.TableCell,{className:"bolt-table-cell-content",columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null,Ve.NoRunsYet))},this._renderStatusIconCell=(e,t,i,s)=>r.createElement(u.SimpleTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},this._renderStatusIcon(s)),this._renderNameWithDetailsCell=(e,t,i,s)=>{const n=this._getLastRunText(s),a=r.createElement(x.Tooltip,{text:n},r.createElement("span",{className:"body-s text-ellipsis secondary-text"},n));return r.createElement(u.TwoLineTableCell,{columnIndex:t,tableColumn:i,key:"col-"+t,line1:this._renderPipelineName(s),line2:a})},this._renderTimeCell=(e,t,i,s)=>s.latestRun?r.createElement(He.DateAndDuration,{queueTime:s.latestRun.queueTime,startTime:s.latestRun.startTime,finishTime:s.latestRun.finishTime,key:"col-"+t,columnIndex:t,tableColumn:i}):r.createElement(u.TableCell,{columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",null)),this._renderFavoriteCell=(e,t,i,s)=>{let n=r.createElement("span",null);let o=!1;if(this.context.pageContext.getService("IFavoritesService").canUseFavorites())if(s.isFavorite){o=!0;const t=t=>{t.preventDefault(),t.stopPropagation();const i=this._store.getPipelines()[e];this.props.favoritesActionCreator.unfavoriteDefinition({id:i.id,name:i.name,uri:i.uri})};n=r.createElement("div",{className:"right-align flex-row"},r.createElement(a.Button,{primary:!1,className:"favorite-icon-color",subtle:!0,iconProps:{iconName:"FavoriteStarFill"},ariaLabel:Ve.RemoveFromMyFavorites,onClick:t,excludeTabStop:!0}))}else{const t=t=>{t.preventDefault(),t.stopPropagation();const i=this._store.getPipelines()[e];this.props.favoritesActionCreator.favoriteDefinition({id:i.id,name:i.name,uri:i.uri})};n=r.createElement("div",{className:"right-align flex-row"},r.createElement(a.Button,{primary:!1,subtle:!0,iconProps:{iconName:"FavoriteStar"},ariaLabel:Ve.AddToMyFavorites,onClick:t,excludeTabStop:!0}))}return r.createElement(u.TableCell,{className:"bolt-table-cell-side-action pipelines-favorite-cell",columnIndex:t,tableColumn:i,key:"col-"+t},r.createElement("div",{className:(0,F.css)("flex-column","padding-right-4",!o&&"bolt-table-cell-content-reveal")},n))},this._onActivateRow=(e,t)=>{const i=this.context.pageContext,s=(0,ft.getInternalPipelineData)(this._store)[t.index];s&&s.href&&(e.ctrlKey||e.metaKey?window.open(s.href,"_blank"):(0,U.onClickFPS)(i,s.href,!0,e))},this._showMenuForItem=e=>this.props.security.isMember(),this._getMenuForItem=e=>{const t=(0,A.getTFSPageData)(this.context.pageContext);if(!t||!t.project||!this.props.security.isMember())return{id:"pipeline-menu",items:[]};const i=t.project.id,s=this.props.security.canEditDefinition({id:e.id,path:e.path}),r=this.props.security.canQueueBuild({id:e.id,path:e.path}),n=this.props.security.hasDefinitionPermission({id:e.id,path:e.path},Re.BuildRequiredPermissions.DeleteBuildDefinition),a=this.context.pageContext,o=a.getService("IBuildLinkingService"),l=o.getDefinitionEditUrl(e.id),d=o.getYamlPipelineEditUrl(e.id),c=e.processType===B.ProcessType.Yaml,u=2===e.queueStatus,h=[];return h.push(at.GetEditViewMenuItem(a,s,c?d:l)),r&&!u&&h.push(at.GetRunMenuItem(a,i,e.id)),h.push(at.GetSecurityMenuItem(a,i,e.id)),s&&h.push(at.GetRenameMoveMenuItem(a,i,e.id,(e=>{this._store.updatePipelineNameAndPath(e.id,e.name,e.path)}))),n&&h.push(at.GetDeleteMenuItem(a,i,e.id,(e=>{this._store.removePipeline(e.id),e.drafts.forEach((e=>this._store.removePipeline(e.id)))}))),{id:"pipeline-menu",items:h}},this._tableBreakpoints=[{breakpoint:1,columnWidths:[0,0,38,-240,120,2.625,2.625]},{breakpoint:600,columnWidths:[240,-100,0,0,156,2.625,2.625]},{breakpoint:840,columnWidths:[340,-100,0,0,156,2.625,2.625]}],this._tableColumns=[{id:"name",width:new p.ObservableValue(340),name:Ve.PipelineColumnName,className:"pipelines-cell",renderCell:this._renderNameCell,columnStyle:2,onSize:this._onSize},{id:"details",width:new p.ObservableValue(-100),name:Ve.LastRunColumnName,className:"pipelines-cell",renderCell:this._renderDetailsCell},{id:"status-icon",width:new p.ObservableValue(38),className:"pipelines-cell",renderCell:this._renderStatusIconCell,ariaLabel:Ve.StatusLabel},{id:"name-with-details",width:new p.ObservableValue(-240),className:"pipelines-cell",renderCell:this._renderNameWithDetailsCell,columnStyle:2,ariaLabel:Ve.PipelineColumnName},{id:"time",width:new p.ObservableValue(156),className:"pipelines-cell",renderCell:this._renderTimeCell,name:Ve.TimeAndDuration,headerTitleClassName:"visually-hidden"},{id:"favorite",width:new p.ObservableValue(2.625),widthStyle:1,className:"pipelines-cell",renderCell:this._renderFavoriteCell,name:Ve.Favorite,headerTitleClassName:"visually-hidden"},new u.ColumnMore(this._getMenuForItem,this._showMenuForItem)],this._store=e.store,this._store.fetchData(!e.isPageLoad),this._itemProvider=new p.ObservableArray,this._itemProvider.splice(0,this._itemProvider.length,...(0,ft.getInternalPipelineData)(this._store)),this.state={loading:this._store.isLoadingData(),filtered:this._store.isListFiltered()},this._identityService=this.context.pageContext.getService("IVssIdentityService")}render(){let e=this._itemProvider;if(this.state.loading)return r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement(T.Spinner,{className:"pipelines-filter-spinner",size:"large",label:Ve.Loading}));if(0===e.length){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png"),t=this.state.filtered?Ve.NoResultsFound:Ve.ZeroDataNoCreatePipelinesPrimary;return r.createElement(b.Card,{className:"flex-grow bolt-card-no-vertical-padding pipelines-minimum-card-height",contentProps:{contentPadding:!1}},r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{imageAltText:t,imagePath:e,secondaryText:t})))}return r.createElement("div",{role:"alert","aria-live":"polite"},r.createElement(b.Card,{className:"flex-grow bolt-table-card",contentProps:{contentPadding:!1},titleProps:{text:this.state.filtered?Ve.FilteredPipelinesView:Ve.RecentView,size:0,ariaLevel:2}},r.createElement(u.Table,{ariaLabel:Ve.RecentPipelines,columns:this._tableColumns,itemProvider:e,onActivate:this._onActivateRow,tableBreakpoints:this._tableBreakpoints,showHeader:e=>e>=1})))}componentDidMount(){this._store.addListener(this._onStoreChanged),this._markTTI()}componentWillUnmount(){this._store.removeListener(this._onStoreChanged)}componentDidUpdate(){this._markTTI()}_markTTI(){this._ttiMarked||this.state.loading||(this._ttiMarked=!0,new Ge.Performance(this.context.pageContext).mark("recent"))}_onSize(e,t,i,s){s.width.value=i}}t[e].PipelinesTable=i}("TabsPipelinesPipelinesTable"),function(){var e;t.PipelinesView={},function(e){e.Folders="folders",e.Pipelines="pipelines",e.Runs="runs"}(e||(e={}));class i extends f.VssComponent{constructor(t,i){var s,n,a,o;super(t,i),this._isPageLoad=!0,this._treeState="",this._onTabChanged=e=>{this._isPageLoad=!1,new Ge.Performance(this.context.pageContext).onFPS(),this._hubViewState.selectedPivot.value=e,this._setTitle()},this._onStoreChanged=()=>{this._store.hasPipelines()||this._store.hasUserDefinedFolders()||this._store.isListFiltered()?this.setState({showZeroDataExperience:!1}):this.setState({showZeroDataExperience:!0}),this._headerCommandBarItems.value=this._getCommandBarItems(this._store.hasDeletedPipelines(),!1)},this._onProjectSettingsChanged=()=>{var e,t;(null===(t=null===(e=this._projectSettingsService.data)||void 0===e?void 0:e.value)||void 0===t?void 0:t.disableClassicBuildPipelineCreation)&&this.setState({showImport:!this._projectSettingsService.data.value.disableClassicBuildPipelineCreation.enabled}),this._headerCommandBarItems.value=this._getCommandBarItems(this._store.hasDeletedPipelines(),!1)},this._onFilterChanged=(e,t)=>{this.state.filterHasChanges.value=this._runsAppliedFilterStore.filter.hasChangesToReset()},this._getCommandBarItems=(t,i)=>{const s=this.context.pageContext,n=(0,A.getTFSProject)(s),a=s.getService("IBuildLinkingService"),o=a.getDeletedPipelinesUrl(),l=s.getService("IStartRightExtensionService").getCreatePipelineUrl(s)||a.getNewDefinitionEditUrl(),d=[],c=(0,fe.getMenuItems)(s,"ms.vss-build-web.pipelines-header-menu",n).value,u=c.findIndex((e=>"contributionId"in e&&"ms-1es.startright.startright-newpipeline"===e.contributionId));let h;if(u>-1&&(h=c[u],c.splice(u,1)),this._security.isMember()){if(this._hasCreatePipelinePermission){const e=!0,t=!0,r=i?Ve.ZeroDataPipelinesButtonText:Ve.NewPipeline;if(h){const i=h;i.important=e,i.isPrimary=t,i.text=r,d.push(i)}else d.push({id:"new-pipeline-command",important:e,isPrimary:t,href:l,onActivate:(e,t)=>{(0,U.onClickFPS)(s,l,!0,t)},text:r})}i&&this._security.hasFolderPermission("\\",Re.BuildRequiredPermissions.EditBuildDefinition)&&d.push({text:Ve.NewFolder,id:"new-folder",important:!1,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const i={pageContext:this.context.pageContext,projectId:n?n.id.toString():"",parentPath:"\\",onClose:t,onFolderCreated:()=>{this._store.fetchSharedData(),this._onTabChanged(e.Folders)}};return r.createElement(re.CommandComponent,Object.assign({commandType:"ciNewFolderComponent"},i),null)}))}}),this._hasCreatePipelinePermission&&this.state.showImport&&d.push({text:Ve.ImportAPipeline,id:"import-definition",important:!1,onActivate:()=>{s.getService("IVssLayoutManager").renderCallout((e=>r.createElement(re.CommandComponent,{commandType:"ciImportDefinitionComponent"},null)))}}),d.push({id:"pipeline-security-command",text:Ve.Security,important:i&&!this._security.hasFolderPermission("\\",Re.BuildRequiredPermissions.EditBuildDefinition),onActivate:(e,t)=>{s.getService("IVssLayoutManager").renderCallout((e=>r.createElement(re.CommandComponent,{commandType:"ciPermissionsComponent"},null)))}}),t&&d.push({id:"deleted-pipelines-command",text:Ve.ViewDeletedPipelines,important:!1,href:o,onActivate:(e,t)=>{(0,U.onClickFPS)(this.context.pageContext,o,!0,t)}})}return c.forEach((e=>{const t=e;d.push(t)})),d},this._getHeaderCommandBreakpoints=()=>[{breakpoint:1,commandBarItems:[{id:"new-pipeline-command",important:!0,iconProps:void 0,text:Ve.NewPipelineShort}]},{breakpoint:600,commandBarItems:[{id:"new-pipeline-command",important:!0,iconProps:void 0,text:Ve.NewPipeline}]}],this._getNewBranches=e=>{this.setState({newBranches:e})},this._getTabs=()=>{const t=this.context.pageContext.getService("IVssHistoryService").getState(),i=Object.keys(t).some((e=>e.endsWith("Filter")&&"pipelineNameFilter"!==e)),s=new p.ObservableValue(i),n=new p.ObservableCollection;return n.push([{id:e.Pipelines,name:Ve.RecentTabName,url:this._recentUrl.value,order:1,render:()=>r.createElement("div",{className:"page-content page-content-top"},r.createElement(Ct.PipelinesTable,{store:this._store,security:this._security,favoritesActionCreator:this._favoritesActionCreator,isPageLoad:this._isPageLoad})),renderFilterBar:e=>{if(e)return r.createElement("div",{className:"definitions-filterbar flex-row"},r.createElement(O.InlineKeywordFilterBarItem,{filter:this._pipelineFilter,placeholder:Ve.PipelinesFilterPlaceholderText,filterItemKey:qe.PipelineFilterKeys.NameFilter,maxTextLength:50}))}},{id:e.Folders,name:Ve.FoldersTabName,order:2,url:this._foldersUrl.value,render:()=>r.createElement("div",{className:"page-content page-content-top"},r.createElement(_t.PipelinesTreeView,{store:this._store,signalRHub:this._signalRActionHub,security:this._security,favoritesActionCreator:this._favoritesActionCreator,isPageLoad:this._isPageLoad,treeState:this._treeState,rootPath:"\\"})),renderFilterBar:e=>{if(e)return r.createElement("div",{className:"definitions-filterbar flex-row"},r.createElement(O.InlineKeywordFilterBarItem,{filter:this._pipelineFilter,placeholder:Ve.PipelinesFilterPlaceholderText,filterItemKey:qe.PipelineFilterKeys.NameFilter,maxTextLength:50}))}},{id:e.Runs,name:Ve.RunsTabName,order:3,url:this._runsUrl.value,render:()=>r.createElement(r.Fragment,null,r.createElement(C.Observer,{showFilterBar:s},(e=>e.showFilterBar?r.createElement(ht.RunsFilterBar,{appliedFilterStore:this._runsAppliedFilterStore,definitionId:void 0,newBranches:this.state.newBranches}):r.createElement(r.Fragment,null))),r.createElement("div",{className:"page-content page-content-top"},r.createElement(bt.RunsTable,{appliedFilterStore:this._runsAppliedFilterStore,isPageLoad:this._isPageLoad,getBranchesOnNewRun:this._getNewBranches,signalRActionHub:this._signalRActionHub,security:this._security}))),renderFilterBar:e=>{if(e)return r.createElement(C.Observer,{filterHasChanges:this.state.filterHasChanges},(e=>r.createElement(Ne.HeaderCommandBar,{items:[(0,Ne.getFilterItem)((()=>s.value=!s.value),e.filterHasChanges)]})))}}]),n},this._onZeroDataButtonClick=()=>{const e=this.context.pageContext.getService("IBuildLinkingService").getNewDefinitionEditUrl();(0,U.onClickFPS)(this.context.pageContext,e,!0)},this._favoritesActionHub=new Ue.DefinitionFavoritesActionHub,this._signalRActionHub=new Me.BuildSignalRActionHub;const l=(0,A.getTFSPageData)(i.pageContext);this._permissions=new Fe.PermissionsStore({pageContext:i.pageContext}),this._security=new Re.Security({projectId:l&&l.project?l.project.id:"",store:this._permissions}),this._pipelineFilter=new H.Filter;this.context.pageContext.getService("IPageStateHistoryService").registerFilter(this._pipelineFilter,"pipeline",[{dataType:"string",filterKey:qe.PipelineFilterKeys.NameFilter,historyBehavior:0}]),this._projectSettingsService=this.context.pageContext.getService("IGeneralSettingsService"),this._hubViewState=new De.VssHubViewState(i.pageContext,{defaultPivot:e.Pipelines}),this._recentUrl=this._hubViewState.createObservableUrl({view:e.Pipelines}),this._runsUrl=this._hubViewState.createObservableUrl({view:e.Runs}),this._foldersUrl=this._hubViewState.createObservableUrl({view:e.Folders}),this._runsAppliedFilterStore=new ct.RunsAppliedFilterStore(new H.Filter);const d=i.pageContext.getService("IVssPageService").getData();l&&l.project&&d&&(this._favoritesActionCreator=new Ue.DefinitionFavoritesActionCreator({actionHub:this._favoritesActionHub,favoritesService:i.pageContext.getService("IFavoritesService"),project:l.project,currentUser:d.user})),this._treeState=(0,xe.getTreeState)(this.context.pageContext),this._store=new mt.PipelinesStore({pageContext:i.pageContext,contributionActionHub:new w.ContributionDataActionHub,favoritesActionHub:this._favoritesActionHub,signalRActionHub:this._signalRActionHub,pipelinesFilter:this._pipelineFilter,rootFolder:"\\",ignoreInitialData:this._hubViewState.selectedPivot.value===e.Folders}),l&&l.project&&d&&(this._signalRHub=this.props.signalRHub||new ot.BuildSignalRHub({actionCreator:new Me.BuildSignalRActionCreator({actionHub:this._signalRActionHub}),hostInformation:{hostId:d.hostId,isHosted:d.isHosted,hostPath:d.hostPath,projectId:l.project.id},pageContext:this.context.pageContext,projectId:l.project.id}));const c=(0,ee.isFeatureFlagEnabled)(i.pageContext,"Build2.CreateBuildDefinitionPermission",!1)?Re.BuildRequiredPermissions.CreateBuildDefinition:Re.BuildRequiredPermissions.EditBuildDefinition;this._hasCreatePipelinePermission=this._security.hasFolderPermission("\\",c);const u=!(!this._hasCreatePipelinePermission||!(null===(n=null===(s=this._projectSettingsService.data)||void 0===s?void 0:s.value)||void 0===n?void 0:n.disableClassicBuildPipelineCreation))&&!(null===(o=null===(a=this._projectSettingsService.data)||void 0===a?void 0:a.value)||void 0===o?void 0:o.disableClassicBuildPipelineCreation.enabled);this.state={filterHasChanges:new p.ObservableValue(!1),showZeroDataExperience:!this._store.hasPipelines()&&!this._store.hasUserDefinedFolders(),tabs:this._getTabs(),newBranches:[],showImport:u},!this._store.hasPipelines()&&this._store.hasUserDefinedFolders()&&this._onTabChanged(e.Folders),this._headerCommandBarItems=new p.ObservableArray(this._getCommandBarItems(this._store.hasDeletedPipelines(),!1))}render(){if(this.context.pageContext.getService("IVssContributionService").getDataProviderExceptions()["ms.vss-build-web.pipelines-data-provider"])return r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{primaryText:Ve.ErrorMessage,imagePath:(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-results.png"),imageAltText:""}));if(this.state.showZeroDataExperience){const e=(0,te.getAssetLocation)(this.context.pageContext,"ms.vss-build-web/pipelines/Content/no-builds.png");return this._hasCreatePipelinePermission?r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{primaryText:Ve.ZeroDataPipelinesPrimary,imagePath:e,imageAltText:Ve.ZeroDataPipelinesAltText,secondaryText:Ve.ZeroDataPipelinesSecondary}),r.createElement(Ne.HeaderCommandBar,{className:"justify-center",items:this._getCommandBarItems(this._store.hasDeletedPipelines(),!0)})):r.createElement("div",{className:"pipelines-zero-data pipelines-whole-page-centered",role:"alert"},r.createElement(be.ZeroData,{primaryText:Ve.ZeroDataNoCreatePipelinesPrimary,imagePath:e,imageAltText:Ve.ZeroDataNoCreatePipelinesAltText}),r.createElement(Ne.HeaderCommandBar,{className:"justify-center",items:this._getCommandBarItems(this._store.hasDeletedPipelines(),!0)}))}return r.createElement(Be.Surface,{background:1},r.createElement(X.Page,{className:"pipelines-page",selectedTabId:this._hubViewState.selectedPivot,tabProviders:this.state.tabs},r.createElement(J.Header,{title:Ve.PipelinesHeader,titleSize:1,commandBarItems:this._headerCommandBarItems,headerBreakpoints:this._getHeaderCommandBreakpoints()}),r.createElement(se.TabBar,{tabSize:"tall",onSelectedTabChanged:this._onTabChanged}),r.createElement(se.TabContent,null)))}componentDidMount(){(0,re.prefetch)(this.context.pageContext),this._signalRHub.watchProject(),this._store.addListener(this._onStoreChanged),this._runsAppliedFilterStore.filter.subscribe(this._onFilterChanged),this._projectSettingsService.data.subscribe(this._onProjectSettingsChanged),(0,s.registerErrorHandler)((e=>{if(e){this.context.pageContext.getService("IGlobalMessagesService").addBanner({message:e.message,level:2})}})),this._setTitle()}componentWillUnmount(){this._store.removeListener(this._onStoreChanged),this._runsAppliedFilterStore.filter.unsubscribe(this._onFilterChanged),this._projectSettingsService.data.unsubscribe(this._onProjectSettingsChanged),this._hubViewState.dispose(),this._store.dispose(),this._signalRHub.dispose(),(0,s.registerErrorHandler)((e=>{})),(0,Ge.disposeFPS)(),(0,xe.clearTreeStateOnUnmount)(this.context.pageContext)}_setTitle(){const t=this._hubViewState.selectedPivot.value;t===e.Pipelines?document.title=Ve.TitleRecent:t===e.Folders?document.title=Ve.TitleFolders:t===e.Runs?document.title=Ve.TitleRuns:document.title=(0,o.format)(Ve.Title,t)}}f.Components.add("pipelines-hub",i)}()}),["Resources","Actions/Favorites","Actions/SignalR","Components/CopyToClipboardButton","Components/DateAndDuration","PipelineScheduledRunsDataService","Components/ScheduledRunsPanel","Components/StageGraph","Constants","Stores/StageHistoryStore","Tools/BuildReasonTools","Performance","Components/StagesHistoryPanel","Stores/StatusBadgePanelStore","Components/StatusBadgePanel","Stores/PipelineTriggerIssuesStore","Components/PipelineTriggerIssuesPage","Components/PipelineTriggers/PipelineTriggersHelper","Components/PipelineTriggers/CITriggerComponent","PipelineTriggersDataService","Components/PipelineTriggers/PRTriggerComponent","Components/PipelineTriggers/ScheduleTriggerComponent","Components/PipelineTriggers/RepositoryTriggerComponent","Components/PipelineTriggers/ResourceTriggerComponent","Components/PipelineTriggersPage","PipelineActions","PipelineDetailsDataService","PipelinesHeaderBreadcrumbService","SignalRHub","Tabs/Branches/BranchesDataService","Tabs/Branches/BranchesTable","Tabs/Branches/BranchesView","Tabs/Runs/Stores/RunsAppliedFilterStore","Tabs/Runs/Stores/RunsFilterStore","Tabs/Runs/RunsFilterBar","Tabs/Runs/RunsTableStages","Tabs/Runs/Stores/RunsStore","PipelinesStore","Tools/DataShapeTools","Tabs/Runs/RunsTable","Tabs/Stages/StagesDataService","Tabs/Stages/StagesTable","PipelineDetailsView","Tabs/Pipelines/PipelinesTreeItemProvider","Tabs/Pipelines/PipelinesTreeView","PipelinesFolderView","Tabs/Pipelines/PipelinesTable","PipelinesView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.pipelines"}}));